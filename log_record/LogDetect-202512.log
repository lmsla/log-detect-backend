SQL  2025/12/17 16:51:43 SQL Database 連線成功
2025/12/17 16:51:43 ✅ BatchWriter initialized successfully
2025/12/17 16:51:43 Starting database migrations...
2025/12/17 16:51:43 Database migrations completed successfully
INFO 2025/12/17 16:51:43 Initializing ES client via Connection Manager...
INFO 2025/12/17 16:51:43 Initializing ES Connection Manager...
INFO 2025/12/17 16:51:43 Found 5 ES connection(s) in database
DEBUG 2025/12/17 16:51:43 Created ES client for connection '213': https://10.99.1.213:9200
INFO 2025/12/17 16:51:43 Set default ES connection: '213' (ID: 3)
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'ncku': https://203.68.92.162:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'NTU': https://163.28.16.201:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'bimap123': https://10.99.1.123:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection '93': https://10.99.1.93:9200
INFO 2025/12/17 16:51:43 Successfully initialized 5/5 ES connection(s)
INFO 2025/12/17 16:51:43 ES Connection Manager initialized successfully
INFO 2025/12/17 16:51:43 Default ES connection test successful
Elasticsearch 2025/12/17 16:51:43 ES 連線成功
INFO 2025/12/17 16:51:44 ES Monitor Scheduler initialized
INFO 2025/12/17 16:51:44 Loading all enabled ES monitors...
INFO 2025/12/17 16:51:45 Started monitoring ES: 213 (ID: 1) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: ncku (ID: 2) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: NTU (ID: 3) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: bimap123 (ID: 4) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: 93 (ID: 5) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:51:45 Successfully started 5 ES monitors
INFO 2025/12/17 16:51:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:51:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: 93
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 16:51:45 ES monitor check completed for: 213, status: online
排程  2025/12/17 16:51:45 標的名稱: 日誌告警-NCKU ,日誌名稱: NCKU-forti , 初始化成功
WARN 2025/12/17 16:51:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 16:51:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 16:51:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 16:51:45 ES Alert Created [high][performance]: Memory usage high: 87.72% (threshold: 80.00%)
DEBUG 2025/12/17 16:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 16:51:46 ES Alert Created [high][capacity]: Disk usage high: 93.21% (threshold: 85.00%)
WARN 2025/12/17 16:51:46 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 16:51:46 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 16:51:46 ES monitor check completed for: 93, status: error
WARN 2025/12/17 16:51:46 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 16:51:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 16:51:50 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 16:51:50 ES monitor check completed for: NTU, status: warning
WARN 2025/12/17 16:51:59 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 16:52:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:52:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:52:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:52:00 Field: school_name.keyword
DEBUG 2025/12/17 16:52:00 Time From: 2025-12-17T16:51:00.000+08:00
DEBUG 2025/12/17 16:52:00 Time To: 2025-12-17T16:52:00.000+08:00
DEBUG 2025/12/17 16:52:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:51:00.000+08:00",
					"lte": "2025-12-17T16:52:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 16:52:01 ES Response Status: 200 OK
DEBUG 2025/12/17 16:52:01 ES Response IsError: false
DEBUG 2025/12/17 16:52:01 ES Response Body:
{"took":1262,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":521,"buckets":[{"key":"仁愛高農","doc_count":1873},{"key":"黑快馬主機","doc_count":1539},{"key":"南投高商","doc_count":982},{"key":"花蓮高農","doc_count":841},{"key":"新竹女中","doc_count":742},{"key":"金門農工","doc_count":600},{"key":"竹北高中","doc_count":550},{"key":"金門高中","doc_count":510},{"key":"臺東高中","doc_count":498},{"key":"宜蘭高商","doc_count":480},{"key":"北門高中","doc_count":451},{"key":"華僑高中","doc_count":428},{"key":"中大壢中","doc_count":395},{"key":"清華附小","doc_count":383},{"key":"興大附中","doc_count":369},{"key":"竹南高中","doc_count":359},{"key":"旗美高中","doc_count":354},{"key":"新港藝高","doc_count":351},{"key":"後壁高中","doc_count":326},{"key":"花蓮高商","doc_count":318},{"key":"關西高中","doc_count":307},{"key":"斗六家商","doc_count":303},{"key":"屏東女中","doc_count":294},{"key":"內埔農工","doc_count":293},{"key":"苗栗農工","doc_count":274},{"key":"蘇澳海事","doc_count":262},{"key":"南投特教","doc_count":256},{"key":"員林家商","doc_count":256},{"key":"關山工商","doc_count":235},{"key":"新竹高工","doc_count":183},{"key":"新營高工","doc_count":178},{"key":"新化高中","doc_count":176},{"key":"羅東高商","doc_count":157},{"key":"玉里高中","doc_count":150},{"key":"屏東高中","doc_count":149},{"key":"北教大實小","doc_count":145},{"key":"北港高中","doc_count":143},{"key":"嘉科實中","doc_count":140},{"key":"政大附中","doc_count":140},{"key":"東港海事","doc_count":138},{"key":"北斗家商","doc_count":136},{"key":"新化高工","doc_count":136},{"key":"彰師附工","doc_count":125},{"key":"師大附中高中部","doc_count":122},{"key":"水里商工","doc_count":122},{"key":"苗栗高商","doc_count":116},{"key":"新營高中","doc_count":114},{"key":"草屯商工","doc_count":111},{"key":"虎尾高中","doc_count":110},{"key":"南大附聰","doc_count":107},{"key":"嘉義高商","doc_count":107},{"key":"彰化高商","doc_count":104},{"key":"南投高中","doc_count":98},{"key":"成大南工","doc_count":97},{"key":"嘉義高中","doc_count":93},{"key":"曾文農工","doc_count":92},{"key":"二林工商","doc_count":90},{"key":"新竹高中","doc_count":87},{"key":"華南高商","doc_count":86},{"key":"新竹高商","doc_count":82},{"key":"員林農工","doc_count":81},{"key":"鳳山高中","doc_count":81},{"key":"宜蘭高中","doc_count":77},{"key":"基隆商工","doc_count":76},{"key":"屏科實中","doc_count":73},{"key":"溪湖高中","doc_count":72},{"key":"臺東女中","doc_count":69},{"key":"花蓮高工","doc_count":69},{"key":"屏東高工","doc_count":67},{"key":"潮州高中","doc_count":67},{"key":"北港農工","doc_count":65},{"key":"臺南高商","doc_count":64},{"key":"南大附中","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"南大附小","doc_count":62},{"key":"雲林特教","doc_count":62},{"key":"善化高中","doc_count":61},{"key":"旗山農工","doc_count":61},{"key":"海大附中","doc_count":61},{"key":"暨大附中","doc_count":59},{"key":"羅東高工","doc_count":58},{"key":"竹山高中","doc_count":57},{"key":"埔里高工","doc_count":56},{"key":"臺東高商","doc_count":56},{"key":"蘭陽女中","doc_count":56},{"key":"興大附農","doc_count":55},{"key":"嘉義高工","doc_count":53},{"key":"花蓮高中","doc_count":53},{"key":"中興高中","doc_count":52},{"key":"屏北高中","doc_count":51},{"key":"新豐高中","doc_count":51},{"key":"東石高中","doc_count":51},{"key":"永靖高工","doc_count":51},{"key":"臺南一中","doc_count":49},{"key":"屏東特教","doc_count":47},{"key":"土庫商工","doc_count":46},{"key":"成功商水","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"頭城家商","doc_count":44},{"key":"高餐大附中","doc_count":44}]}}}
DEBUG 2025/12/17 16:52:01 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:52:01   Bucket[0]: Key=仁愛高農, DocCount=1873
DEBUG 2025/12/17 16:52:01   Bucket[1]: Key=黑快馬主機, DocCount=1539
DEBUG 2025/12/17 16:52:01   Bucket[2]: Key=南投高商, DocCount=982
DEBUG 2025/12/17 16:52:01   Bucket[3]: Key=花蓮高農, DocCount=841
DEBUG 2025/12/17 16:52:01   Bucket[4]: Key=新竹女中, DocCount=742
DEBUG 2025/12/17 16:52:01   Bucket[5]: Key=金門農工, DocCount=600
DEBUG 2025/12/17 16:52:01   Bucket[6]: Key=竹北高中, DocCount=550
DEBUG 2025/12/17 16:52:01   Bucket[7]: Key=金門高中, DocCount=510
DEBUG 2025/12/17 16:52:01   Bucket[8]: Key=臺東高中, DocCount=498
DEBUG 2025/12/17 16:52:01   Bucket[9]: Key=宜蘭高商, DocCount=480
DEBUG 2025/12/17 16:52:01   Bucket[10]: Key=北門高中, DocCount=451
DEBUG 2025/12/17 16:52:01   Bucket[11]: Key=華僑高中, DocCount=428
DEBUG 2025/12/17 16:52:01   Bucket[12]: Key=中大壢中, DocCount=395
DEBUG 2025/12/17 16:52:01   Bucket[13]: Key=清華附小, DocCount=383
DEBUG 2025/12/17 16:52:01   Bucket[14]: Key=興大附中, DocCount=369
DEBUG 2025/12/17 16:52:01   Bucket[15]: Key=竹南高中, DocCount=359
DEBUG 2025/12/17 16:52:01   Bucket[16]: Key=旗美高中, DocCount=354
DEBUG 2025/12/17 16:52:01   Bucket[17]: Key=新港藝高, DocCount=351
DEBUG 2025/12/17 16:52:01   Bucket[18]: Key=後壁高中, DocCount=326
DEBUG 2025/12/17 16:52:01   Bucket[19]: Key=花蓮高商, DocCount=318
DEBUG 2025/12/17 16:52:01   Bucket[20]: Key=關西高中, DocCount=307
DEBUG 2025/12/17 16:52:01   Bucket[21]: Key=斗六家商, DocCount=303
DEBUG 2025/12/17 16:52:01   Bucket[22]: Key=屏東女中, DocCount=294
DEBUG 2025/12/17 16:52:01   Bucket[23]: Key=內埔農工, DocCount=293
DEBUG 2025/12/17 16:52:01   Bucket[24]: Key=苗栗農工, DocCount=274
DEBUG 2025/12/17 16:52:01   Bucket[25]: Key=蘇澳海事, DocCount=262
DEBUG 2025/12/17 16:52:01   Bucket[26]: Key=南投特教, DocCount=256
DEBUG 2025/12/17 16:52:01   Bucket[27]: Key=員林家商, DocCount=256
DEBUG 2025/12/17 16:52:01   Bucket[28]: Key=關山工商, DocCount=235
DEBUG 2025/12/17 16:52:01   Bucket[29]: Key=新竹高工, DocCount=183
DEBUG 2025/12/17 16:52:01   Bucket[30]: Key=新營高工, DocCount=178
DEBUG 2025/12/17 16:52:01   Bucket[31]: Key=新化高中, DocCount=176
DEBUG 2025/12/17 16:52:01   Bucket[32]: Key=羅東高商, DocCount=157
DEBUG 2025/12/17 16:52:01   Bucket[33]: Key=玉里高中, DocCount=150
DEBUG 2025/12/17 16:52:01   Bucket[34]: Key=屏東高中, DocCount=149
DEBUG 2025/12/17 16:52:01   Bucket[35]: Key=北教大實小, DocCount=145
DEBUG 2025/12/17 16:52:01   Bucket[36]: Key=北港高中, DocCount=143
DEBUG 2025/12/17 16:52:01   Bucket[37]: Key=嘉科實中, DocCount=140
DEBUG 2025/12/17 16:52:01   Bucket[38]: Key=政大附中, DocCount=140
DEBUG 2025/12/17 16:52:01   Bucket[39]: Key=東港海事, DocCount=138
DEBUG 2025/12/17 16:52:01   Bucket[40]: Key=北斗家商, DocCount=136
DEBUG 2025/12/17 16:52:01   Bucket[41]: Key=新化高工, DocCount=136
DEBUG 2025/12/17 16:52:01   Bucket[42]: Key=彰師附工, DocCount=125
DEBUG 2025/12/17 16:52:01   Bucket[43]: Key=師大附中高中部, DocCount=122
DEBUG 2025/12/17 16:52:01   Bucket[44]: Key=水里商工, DocCount=122
DEBUG 2025/12/17 16:52:01   Bucket[45]: Key=苗栗高商, DocCount=116
DEBUG 2025/12/17 16:52:01   Bucket[46]: Key=新營高中, DocCount=114
DEBUG 2025/12/17 16:52:01   Bucket[47]: Key=草屯商工, DocCount=111
DEBUG 2025/12/17 16:52:01   Bucket[48]: Key=虎尾高中, DocCount=110
DEBUG 2025/12/17 16:52:01   Bucket[49]: Key=南大附聰, DocCount=107
DEBUG 2025/12/17 16:52:01   Bucket[50]: Key=嘉義高商, DocCount=107
DEBUG 2025/12/17 16:52:01   Bucket[51]: Key=彰化高商, DocCount=104
DEBUG 2025/12/17 16:52:01   Bucket[52]: Key=南投高中, DocCount=98
DEBUG 2025/12/17 16:52:01   Bucket[53]: Key=成大南工, DocCount=97
DEBUG 2025/12/17 16:52:01   Bucket[54]: Key=嘉義高中, DocCount=93
DEBUG 2025/12/17 16:52:01   Bucket[55]: Key=曾文農工, DocCount=92
DEBUG 2025/12/17 16:52:01   Bucket[56]: Key=二林工商, DocCount=90
DEBUG 2025/12/17 16:52:01   Bucket[57]: Key=新竹高中, DocCount=87
DEBUG 2025/12/17 16:52:01   Bucket[58]: Key=華南高商, DocCount=86
DEBUG 2025/12/17 16:52:01   Bucket[59]: Key=新竹高商, DocCount=82
DEBUG 2025/12/17 16:52:01   Bucket[60]: Key=員林農工, DocCount=81
DEBUG 2025/12/17 16:52:01   Bucket[61]: Key=鳳山高中, DocCount=81
DEBUG 2025/12/17 16:52:01   Bucket[62]: Key=宜蘭高中, DocCount=77
DEBUG 2025/12/17 16:52:01   Bucket[63]: Key=基隆商工, DocCount=76
DEBUG 2025/12/17 16:52:01   Bucket[64]: Key=屏科實中, DocCount=73
DEBUG 2025/12/17 16:52:01   Bucket[65]: Key=溪湖高中, DocCount=72
DEBUG 2025/12/17 16:52:01   Bucket[66]: Key=臺東女中, DocCount=69
DEBUG 2025/12/17 16:52:01   Bucket[67]: Key=花蓮高工, DocCount=69
DEBUG 2025/12/17 16:52:01   Bucket[68]: Key=屏東高工, DocCount=67
DEBUG 2025/12/17 16:52:01   Bucket[69]: Key=潮州高中, DocCount=67
DEBUG 2025/12/17 16:52:01   Bucket[70]: Key=北港農工, DocCount=65
DEBUG 2025/12/17 16:52:01   Bucket[71]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 16:52:01   Bucket[72]: Key=南大附中, DocCount=63
DEBUG 2025/12/17 16:52:01   Bucket[73]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:52:01   Bucket[74]: Key=南大附小, DocCount=62
DEBUG 2025/12/17 16:52:01   Bucket[75]: Key=雲林特教, DocCount=62
DEBUG 2025/12/17 16:52:01   Bucket[76]: Key=善化高中, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[77]: Key=旗山農工, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[78]: Key=海大附中, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[79]: Key=暨大附中, DocCount=59
DEBUG 2025/12/17 16:52:01   Bucket[80]: Key=羅東高工, DocCount=58
DEBUG 2025/12/17 16:52:01   Bucket[81]: Key=竹山高中, DocCount=57
DEBUG 2025/12/17 16:52:01   Bucket[82]: Key=埔里高工, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[83]: Key=臺東高商, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[84]: Key=蘭陽女中, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[85]: Key=興大附農, DocCount=55
DEBUG 2025/12/17 16:52:01   Bucket[86]: Key=嘉義高工, DocCount=53
DEBUG 2025/12/17 16:52:01   Bucket[87]: Key=花蓮高中, DocCount=53
DEBUG 2025/12/17 16:52:01   Bucket[88]: Key=中興高中, DocCount=52
DEBUG 2025/12/17 16:52:01   Bucket[89]: Key=屏北高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[90]: Key=新豐高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[91]: Key=東石高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[92]: Key=永靖高工, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[93]: Key=臺南一中, DocCount=49
DEBUG 2025/12/17 16:52:01   Bucket[94]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 16:52:01   Bucket[95]: Key=土庫商工, DocCount=46
DEBUG 2025/12/17 16:52:01   Bucket[96]: Key=成功商水, DocCount=45
DEBUG 2025/12/17 16:52:01   Bucket[97]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 16:52:01   Bucket[98]: Key=頭城家商, DocCount=44
DEBUG 2025/12/17 16:52:01   Bucket[99]: Key=高餐大附中, DocCount=44
DEBUG 2025/12/17 16:52:01 ========================================================
INFO 2025/12/17 16:52:08 ✅ Successfully flushed 39/39 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 Processing 15 offline devices
INFO 2025/12/17 16:52:15 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:52:15 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:52:15 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:52:15 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:52:15 Creating history record for offline device: 崇實高工
INFO 2025/12/17 16:52:15 About to add history to batch for device: 崇實高工
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 16:52:15 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:52:15 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:52:15 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:52:15 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:52:16 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 白河商工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 白河商工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 家齊高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 家齊高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 秀水高工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 秀水高工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:52:16 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:52:18 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:52:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: 93
INFO 2025/12/17 16:52:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:52:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 16:52:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.57% (threshold: 80.00%)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.24% (threshold: 85.00%)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:52:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:52:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:52:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:52:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:53:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:53:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:53:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:53:00 Field: school_name.keyword
DEBUG 2025/12/17 16:53:00 Time From: 2025-12-17T16:52:00.000+08:00
DEBUG 2025/12/17 16:53:00 Time To: 2025-12-17T16:53:00.000+08:00
DEBUG 2025/12/17 16:53:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:52:00.000+08:00",
					"lte": "2025-12-17T16:53:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:53:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:53:00 ES Response IsError: false
DEBUG 2025/12/17 16:53:00 ES Response Body:
{"took":191,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":506,"buckets":[{"key":"黑快馬主機","doc_count":1509},{"key":"南投高商","doc_count":930},{"key":"花蓮高農","doc_count":803},{"key":"仁愛高農","doc_count":622},{"key":"新竹女中","doc_count":545},{"key":"臺東高中","doc_count":545},{"key":"華僑高中","doc_count":526},{"key":"中大壢中","doc_count":513},{"key":"金門高中","doc_count":510},{"key":"金門農工","doc_count":495},{"key":"宜蘭高商","doc_count":485},{"key":"竹北高中","doc_count":456},{"key":"北門高中","doc_count":429},{"key":"清華附小","doc_count":367},{"key":"興大附中","doc_count":358},{"key":"新港藝高","doc_count":346},{"key":"旗美高中","doc_count":311},{"key":"內埔農工","doc_count":303},{"key":"關西高中","doc_count":300},{"key":"後壁高中","doc_count":288},{"key":"竹南高中","doc_count":287},{"key":"斗六家商","doc_count":277},{"key":"花蓮高商","doc_count":263},{"key":"屏東女中","doc_count":258},{"key":"苗栗農工","doc_count":256},{"key":"蘇澳海事","doc_count":254},{"key":"南投特教","doc_count":234},{"key":"新化高中","doc_count":234},{"key":"員林家商","doc_count":220},{"key":"關山工商","doc_count":215},{"key":"嘉義高商","doc_count":193},{"key":"南大附聰","doc_count":172},{"key":"新化高工","doc_count":167},{"key":"新營高工","doc_count":167},{"key":"新竹高工","doc_count":165},{"key":"彰化高商","doc_count":162},{"key":"北港農工","doc_count":159},{"key":"政大附中","doc_count":157},{"key":"玉里高中","doc_count":156},{"key":"彰師附工","doc_count":153},{"key":"成大南工","doc_count":149},{"key":"屏東高中","doc_count":138},{"key":"東港海事","doc_count":138},{"key":"新竹高中","doc_count":137},{"key":"嘉科實中","doc_count":135},{"key":"蘭陽女中","doc_count":110},{"key":"南大附中","doc_count":105},{"key":"北斗家商","doc_count":99},{"key":"水里商工","doc_count":98},{"key":"師大附中高中部","doc_count":96},{"key":"苗栗高中","doc_count":95},{"key":"虎尾高中","doc_count":94},{"key":"臺東高商","doc_count":91},{"key":"花蓮高工","doc_count":89},{"key":"羅東高商","doc_count":88},{"key":"宜蘭高中","doc_count":87},{"key":"曾文農工","doc_count":85},{"key":"竹東高中","doc_count":85},{"key":"苗栗高商","doc_count":82},{"key":"屏科實中","doc_count":80},{"key":"新營高中","doc_count":80},{"key":"澎湖海事","doc_count":79},{"key":"北教大實小","doc_count":78},{"key":"基隆商工","doc_count":76},{"key":"玉井工商","doc_count":75},{"key":"南投高中","doc_count":73},{"key":"北港高中","doc_count":71},{"key":"崇實高工","doc_count":71},{"key":"埔里高工","doc_count":69},{"key":"中興高中","doc_count":68},{"key":"員林農工","doc_count":67},{"key":"嘉義高中","doc_count":67},{"key":"嘉義高工","doc_count":66},{"key":"雲林特教","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"東石高中","doc_count":63},{"key":"屏東高工","doc_count":61},{"key":"屏北高中","doc_count":56},{"key":"秀水高工","doc_count":56},{"key":"潮州高中","doc_count":54},{"key":"臺南一中","doc_count":54},{"key":"鳳山高中","doc_count":54},{"key":"善化高中","doc_count":50},{"key":"土庫商工","doc_count":50},{"key":"基隆特教","doc_count":49},{"key":"頭城家商","doc_count":49},{"key":"白河商工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"屏東特教","doc_count":47},{"key":"草屯商工","doc_count":47},{"key":"員林高中","doc_count":46},{"key":"溪湖高中","doc_count":46},{"key":"臺南高商","doc_count":46},{"key":"佳冬高農","doc_count":44},{"key":"花蓮特教","doc_count":44},{"key":"興大附農","doc_count":43},{"key":"家齊高中","doc_count":42},{"key":"成功商水","doc_count":42},{"key":"羅東高工","doc_count":42},{"key":"海大附中","doc_count":41}]}}}
DEBUG 2025/12/17 16:53:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:53:00   Bucket[0]: Key=黑快馬主機, DocCount=1509
DEBUG 2025/12/17 16:53:00   Bucket[1]: Key=南投高商, DocCount=930
DEBUG 2025/12/17 16:53:00   Bucket[2]: Key=花蓮高農, DocCount=803
DEBUG 2025/12/17 16:53:00   Bucket[3]: Key=仁愛高農, DocCount=622
DEBUG 2025/12/17 16:53:00   Bucket[4]: Key=新竹女中, DocCount=545
DEBUG 2025/12/17 16:53:00   Bucket[5]: Key=臺東高中, DocCount=545
DEBUG 2025/12/17 16:53:00   Bucket[6]: Key=華僑高中, DocCount=526
DEBUG 2025/12/17 16:53:00   Bucket[7]: Key=中大壢中, DocCount=513
DEBUG 2025/12/17 16:53:00   Bucket[8]: Key=金門高中, DocCount=510
DEBUG 2025/12/17 16:53:00   Bucket[9]: Key=金門農工, DocCount=495
DEBUG 2025/12/17 16:53:00   Bucket[10]: Key=宜蘭高商, DocCount=485
DEBUG 2025/12/17 16:53:00   Bucket[11]: Key=竹北高中, DocCount=456
DEBUG 2025/12/17 16:53:00   Bucket[12]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 16:53:00   Bucket[13]: Key=清華附小, DocCount=367
DEBUG 2025/12/17 16:53:00   Bucket[14]: Key=興大附中, DocCount=358
DEBUG 2025/12/17 16:53:00   Bucket[15]: Key=新港藝高, DocCount=346
DEBUG 2025/12/17 16:53:00   Bucket[16]: Key=旗美高中, DocCount=311
DEBUG 2025/12/17 16:53:00   Bucket[17]: Key=內埔農工, DocCount=303
DEBUG 2025/12/17 16:53:00   Bucket[18]: Key=關西高中, DocCount=300
DEBUG 2025/12/17 16:53:00   Bucket[19]: Key=後壁高中, DocCount=288
DEBUG 2025/12/17 16:53:00   Bucket[20]: Key=竹南高中, DocCount=287
DEBUG 2025/12/17 16:53:00   Bucket[21]: Key=斗六家商, DocCount=277
DEBUG 2025/12/17 16:53:00   Bucket[22]: Key=花蓮高商, DocCount=263
DEBUG 2025/12/17 16:53:00   Bucket[23]: Key=屏東女中, DocCount=258
DEBUG 2025/12/17 16:53:00   Bucket[24]: Key=苗栗農工, DocCount=256
DEBUG 2025/12/17 16:53:00   Bucket[25]: Key=蘇澳海事, DocCount=254
DEBUG 2025/12/17 16:53:00   Bucket[26]: Key=南投特教, DocCount=234
DEBUG 2025/12/17 16:53:00   Bucket[27]: Key=新化高中, DocCount=234
DEBUG 2025/12/17 16:53:00   Bucket[28]: Key=員林家商, DocCount=220
DEBUG 2025/12/17 16:53:00   Bucket[29]: Key=關山工商, DocCount=215
DEBUG 2025/12/17 16:53:00   Bucket[30]: Key=嘉義高商, DocCount=193
DEBUG 2025/12/17 16:53:00   Bucket[31]: Key=南大附聰, DocCount=172
DEBUG 2025/12/17 16:53:00   Bucket[32]: Key=新化高工, DocCount=167
DEBUG 2025/12/17 16:53:00   Bucket[33]: Key=新營高工, DocCount=167
DEBUG 2025/12/17 16:53:00   Bucket[34]: Key=新竹高工, DocCount=165
DEBUG 2025/12/17 16:53:00   Bucket[35]: Key=彰化高商, DocCount=162
DEBUG 2025/12/17 16:53:00   Bucket[36]: Key=北港農工, DocCount=159
DEBUG 2025/12/17 16:53:00   Bucket[37]: Key=政大附中, DocCount=157
DEBUG 2025/12/17 16:53:00   Bucket[38]: Key=玉里高中, DocCount=156
DEBUG 2025/12/17 16:53:00   Bucket[39]: Key=彰師附工, DocCount=153
DEBUG 2025/12/17 16:53:00   Bucket[40]: Key=成大南工, DocCount=149
DEBUG 2025/12/17 16:53:00   Bucket[41]: Key=屏東高中, DocCount=138
DEBUG 2025/12/17 16:53:00   Bucket[42]: Key=東港海事, DocCount=138
DEBUG 2025/12/17 16:53:00   Bucket[43]: Key=新竹高中, DocCount=137
DEBUG 2025/12/17 16:53:00   Bucket[44]: Key=嘉科實中, DocCount=135
DEBUG 2025/12/17 16:53:00   Bucket[45]: Key=蘭陽女中, DocCount=110
DEBUG 2025/12/17 16:53:00   Bucket[46]: Key=南大附中, DocCount=105
DEBUG 2025/12/17 16:53:00   Bucket[47]: Key=北斗家商, DocCount=99
DEBUG 2025/12/17 16:53:00   Bucket[48]: Key=水里商工, DocCount=98
DEBUG 2025/12/17 16:53:00   Bucket[49]: Key=師大附中高中部, DocCount=96
DEBUG 2025/12/17 16:53:00   Bucket[50]: Key=苗栗高中, DocCount=95
DEBUG 2025/12/17 16:53:00   Bucket[51]: Key=虎尾高中, DocCount=94
DEBUG 2025/12/17 16:53:00   Bucket[52]: Key=臺東高商, DocCount=91
DEBUG 2025/12/17 16:53:00   Bucket[53]: Key=花蓮高工, DocCount=89
DEBUG 2025/12/17 16:53:00   Bucket[54]: Key=羅東高商, DocCount=88
DEBUG 2025/12/17 16:53:00   Bucket[55]: Key=宜蘭高中, DocCount=87
DEBUG 2025/12/17 16:53:00   Bucket[56]: Key=曾文農工, DocCount=85
DEBUG 2025/12/17 16:53:00   Bucket[57]: Key=竹東高中, DocCount=85
DEBUG 2025/12/17 16:53:00   Bucket[58]: Key=苗栗高商, DocCount=82
DEBUG 2025/12/17 16:53:00   Bucket[59]: Key=屏科實中, DocCount=80
DEBUG 2025/12/17 16:53:00   Bucket[60]: Key=新營高中, DocCount=80
DEBUG 2025/12/17 16:53:00   Bucket[61]: Key=澎湖海事, DocCount=79
DEBUG 2025/12/17 16:53:00   Bucket[62]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 16:53:00   Bucket[63]: Key=基隆商工, DocCount=76
DEBUG 2025/12/17 16:53:00   Bucket[64]: Key=玉井工商, DocCount=75
DEBUG 2025/12/17 16:53:00   Bucket[65]: Key=南投高中, DocCount=73
DEBUG 2025/12/17 16:53:00   Bucket[66]: Key=北港高中, DocCount=71
DEBUG 2025/12/17 16:53:00   Bucket[67]: Key=崇實高工, DocCount=71
DEBUG 2025/12/17 16:53:00   Bucket[68]: Key=埔里高工, DocCount=69
DEBUG 2025/12/17 16:53:00   Bucket[69]: Key=中興高中, DocCount=68
DEBUG 2025/12/17 16:53:00   Bucket[70]: Key=員林農工, DocCount=67
DEBUG 2025/12/17 16:53:00   Bucket[71]: Key=嘉義高中, DocCount=67
DEBUG 2025/12/17 16:53:00   Bucket[72]: Key=嘉義高工, DocCount=66
DEBUG 2025/12/17 16:53:00   Bucket[73]: Key=雲林特教, DocCount=64
DEBUG 2025/12/17 16:53:00   Bucket[74]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 16:53:00   Bucket[75]: Key=東石高中, DocCount=63
DEBUG 2025/12/17 16:53:00   Bucket[76]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 16:53:00   Bucket[77]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 16:53:00   Bucket[78]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 16:53:00   Bucket[79]: Key=潮州高中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[80]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[81]: Key=鳳山高中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[82]: Key=善化高中, DocCount=50
DEBUG 2025/12/17 16:53:00   Bucket[83]: Key=土庫商工, DocCount=50
DEBUG 2025/12/17 16:53:00   Bucket[84]: Key=基隆特教, DocCount=49
DEBUG 2025/12/17 16:53:00   Bucket[85]: Key=頭城家商, DocCount=49
DEBUG 2025/12/17 16:53:00   Bucket[86]: Key=白河商工, DocCount=48
DEBUG 2025/12/17 16:53:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 16:53:00   Bucket[88]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 16:53:00   Bucket[89]: Key=草屯商工, DocCount=47
DEBUG 2025/12/17 16:53:00   Bucket[90]: Key=員林高中, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[91]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[92]: Key=臺南高商, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[93]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 16:53:00   Bucket[94]: Key=花蓮特教, DocCount=44
DEBUG 2025/12/17 16:53:00   Bucket[95]: Key=興大附農, DocCount=43
DEBUG 2025/12/17 16:53:00   Bucket[96]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[97]: Key=成功商水, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[98]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[99]: Key=海大附中, DocCount=41
DEBUG 2025/12/17 16:53:00 ========================================================
INFO 2025/12/17 16:53:03 ✅ Successfully flushed 15/15 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 16:53:08 ✅ Successfully flushed 4/4 history records to TimescaleDB
INFO 2025/12/17 16:53:09 Processing 15 offline devices
INFO 2025/12/17 16:53:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:53:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:53:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:53:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:53:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新竹高商
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新竹高商
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 16:53:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 16:53:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 16:53:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:53:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:53:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:53:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:53:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:53:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:53:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:53:10 Creating history record for offline device: 永靖高工
INFO 2025/12/17 16:53:10 About to add history to batch for device: 永靖高工
INFO 2025/12/17 16:53:10 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 16:53:13 ✅ Successfully flushed 32/32 history records to TimescaleDB
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:53:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:53:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:53:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:53:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:53:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:53:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.77% (threshold: 80.00%)
INFO 2025/12/17 16:53:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:53:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:53:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:53:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:53:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:54:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:54:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:54:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:54:00 Field: school_name.keyword
DEBUG 2025/12/17 16:54:00 Time From: 2025-12-17T16:53:00.000+08:00
DEBUG 2025/12/17 16:54:00 Time To: 2025-12-17T16:54:00.000+08:00
DEBUG 2025/12/17 16:54:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:53:00.000+08:00",
					"lte": "2025-12-17T16:54:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:54:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:54:00 ES Response IsError: false
DEBUG 2025/12/17 16:54:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":1753},{"key":"南投高商","doc_count":822},{"key":"花蓮高農","doc_count":813},{"key":"金門農工","doc_count":723},{"key":"仁愛高農","doc_count":609},{"key":"金門高中","doc_count":585},{"key":"竹北高中","doc_count":541},{"key":"新竹女中","doc_count":538},{"key":"臺東高中","doc_count":520},{"key":"華僑高中","doc_count":438},{"key":"北門高中","doc_count":429},{"key":"宜蘭高商","doc_count":414},{"key":"政大附中","doc_count":380},{"key":"新港藝高","doc_count":375},{"key":"興大附中","doc_count":366},{"key":"蘇澳海事","doc_count":320},{"key":"旗美高中","doc_count":310},{"key":"清華附小","doc_count":310},{"key":"內埔農工","doc_count":300},{"key":"新化高中","doc_count":299},{"key":"關西高中","doc_count":288},{"key":"後壁高中","doc_count":268},{"key":"竹南高中","doc_count":264},{"key":"花蓮高商","doc_count":256},{"key":"苗栗農工","doc_count":249},{"key":"南投特教","doc_count":248},{"key":"中大壢中","doc_count":241},{"key":"斗六家商","doc_count":228},{"key":"屏東女中","doc_count":199},{"key":"東港海事","doc_count":197},{"key":"關山工商","doc_count":197},{"key":"新化高工","doc_count":184},{"key":"南大附聰","doc_count":183},{"key":"嘉義高商","doc_count":171},{"key":"員林家商","doc_count":169},{"key":"北斗家商","doc_count":151},{"key":"苗栗高中","doc_count":149},{"key":"玉里高中","doc_count":146},{"key":"新營高工","doc_count":137},{"key":"苗栗高商","doc_count":124},{"key":"師大附中高中部","doc_count":119},{"key":"虎尾高中","doc_count":116},{"key":"南投高中","doc_count":115},{"key":"彰師附工","doc_count":112},{"key":"臺東女中","doc_count":112},{"key":"彰化高商","doc_count":110},{"key":"崇實高工","doc_count":100},{"key":"新竹高工","doc_count":100},{"key":"員林農工","doc_count":96},{"key":"宜蘭高中","doc_count":92},{"key":"花蓮高工","doc_count":90},{"key":"成大南工","doc_count":89},{"key":"北港高中","doc_count":88},{"key":"員林高中","doc_count":87},{"key":"北教大實小","doc_count":85},{"key":"南大附中","doc_count":85},{"key":"臺東高商","doc_count":83},{"key":"二林工商","doc_count":81},{"key":"新營高中","doc_count":77},{"key":"永靖高工","doc_count":77},{"key":"嘉科實中","doc_count":76},{"key":"羅東高商","doc_count":76},{"key":"水里商工","doc_count":72},{"key":"埔里高工","doc_count":70},{"key":"屏科實中","doc_count":70},{"key":"北港農工","doc_count":68},{"key":"屏東高工","doc_count":65},{"key":"嘉義高中","doc_count":63},{"key":"新竹高中","doc_count":62},{"key":"中興高中","doc_count":60},{"key":"雲林特教","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"東石高中","doc_count":59},{"key":"草屯商工","doc_count":55},{"key":"佳冬高農","doc_count":54},{"key":"花蓮特教","doc_count":54},{"key":"羅東高工","doc_count":53},{"key":"屏東特教","doc_count":52},{"key":"嘉義家職","doc_count":51},{"key":"華南高商","doc_count":51},{"key":"基隆商工","doc_count":50},{"key":"成功商水","doc_count":49},{"key":"臺南高商","doc_count":48},{"key":"頭城家商","doc_count":48},{"key":"興大附農","doc_count":47},{"key":"旗山農工","doc_count":46},{"key":"海大附中","doc_count":46},{"key":"屏東高中","doc_count":45},{"key":"潮州高中","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"家齊高中","doc_count":43},{"key":"善化高中","doc_count":42},{"key":"新豐高中","doc_count":42},{"key":"秀水高工","doc_count":42},{"key":"南大附小","doc_count":41},{"key":"白河商工","doc_count":41},{"key":"玉井工商","doc_count":40},{"key":"嘉義高工","doc_count":39},{"key":"曾文農工","doc_count":39},{"key":"竹東高中","doc_count":39}]}}}
DEBUG 2025/12/17 16:54:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:54:00   Bucket[0]: Key=黑快馬主機, DocCount=1753
DEBUG 2025/12/17 16:54:00   Bucket[1]: Key=南投高商, DocCount=822
DEBUG 2025/12/17 16:54:00   Bucket[2]: Key=花蓮高農, DocCount=813
DEBUG 2025/12/17 16:54:00   Bucket[3]: Key=金門農工, DocCount=723
DEBUG 2025/12/17 16:54:00   Bucket[4]: Key=仁愛高農, DocCount=609
DEBUG 2025/12/17 16:54:00   Bucket[5]: Key=金門高中, DocCount=585
DEBUG 2025/12/17 16:54:00   Bucket[6]: Key=竹北高中, DocCount=541
DEBUG 2025/12/17 16:54:00   Bucket[7]: Key=新竹女中, DocCount=538
DEBUG 2025/12/17 16:54:00   Bucket[8]: Key=臺東高中, DocCount=520
DEBUG 2025/12/17 16:54:00   Bucket[9]: Key=華僑高中, DocCount=438
DEBUG 2025/12/17 16:54:00   Bucket[10]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 16:54:00   Bucket[11]: Key=宜蘭高商, DocCount=414
DEBUG 2025/12/17 16:54:00   Bucket[12]: Key=政大附中, DocCount=380
DEBUG 2025/12/17 16:54:00   Bucket[13]: Key=新港藝高, DocCount=375
DEBUG 2025/12/17 16:54:00   Bucket[14]: Key=興大附中, DocCount=366
DEBUG 2025/12/17 16:54:00   Bucket[15]: Key=蘇澳海事, DocCount=320
DEBUG 2025/12/17 16:54:00   Bucket[16]: Key=旗美高中, DocCount=310
DEBUG 2025/12/17 16:54:00   Bucket[17]: Key=清華附小, DocCount=310
DEBUG 2025/12/17 16:54:00   Bucket[18]: Key=內埔農工, DocCount=300
DEBUG 2025/12/17 16:54:00   Bucket[19]: Key=新化高中, DocCount=299
DEBUG 2025/12/17 16:54:00   Bucket[20]: Key=關西高中, DocCount=288
DEBUG 2025/12/17 16:54:00   Bucket[21]: Key=後壁高中, DocCount=268
DEBUG 2025/12/17 16:54:00   Bucket[22]: Key=竹南高中, DocCount=264
DEBUG 2025/12/17 16:54:00   Bucket[23]: Key=花蓮高商, DocCount=256
DEBUG 2025/12/17 16:54:00   Bucket[24]: Key=苗栗農工, DocCount=249
DEBUG 2025/12/17 16:54:00   Bucket[25]: Key=南投特教, DocCount=248
DEBUG 2025/12/17 16:54:00   Bucket[26]: Key=中大壢中, DocCount=241
DEBUG 2025/12/17 16:54:00   Bucket[27]: Key=斗六家商, DocCount=228
DEBUG 2025/12/17 16:54:00   Bucket[28]: Key=屏東女中, DocCount=199
DEBUG 2025/12/17 16:54:00   Bucket[29]: Key=東港海事, DocCount=197
DEBUG 2025/12/17 16:54:00   Bucket[30]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 16:54:00   Bucket[31]: Key=新化高工, DocCount=184
DEBUG 2025/12/17 16:54:00   Bucket[32]: Key=南大附聰, DocCount=183
DEBUG 2025/12/17 16:54:00   Bucket[33]: Key=嘉義高商, DocCount=171
DEBUG 2025/12/17 16:54:00   Bucket[34]: Key=員林家商, DocCount=169
DEBUG 2025/12/17 16:54:00   Bucket[35]: Key=北斗家商, DocCount=151
DEBUG 2025/12/17 16:54:00   Bucket[36]: Key=苗栗高中, DocCount=149
DEBUG 2025/12/17 16:54:00   Bucket[37]: Key=玉里高中, DocCount=146
DEBUG 2025/12/17 16:54:00   Bucket[38]: Key=新營高工, DocCount=137
DEBUG 2025/12/17 16:54:00   Bucket[39]: Key=苗栗高商, DocCount=124
DEBUG 2025/12/17 16:54:00   Bucket[40]: Key=師大附中高中部, DocCount=119
DEBUG 2025/12/17 16:54:00   Bucket[41]: Key=虎尾高中, DocCount=116
DEBUG 2025/12/17 16:54:00   Bucket[42]: Key=南投高中, DocCount=115
DEBUG 2025/12/17 16:54:00   Bucket[43]: Key=彰師附工, DocCount=112
DEBUG 2025/12/17 16:54:00   Bucket[44]: Key=臺東女中, DocCount=112
DEBUG 2025/12/17 16:54:00   Bucket[45]: Key=彰化高商, DocCount=110
DEBUG 2025/12/17 16:54:00   Bucket[46]: Key=崇實高工, DocCount=100
DEBUG 2025/12/17 16:54:00   Bucket[47]: Key=新竹高工, DocCount=100
DEBUG 2025/12/17 16:54:00   Bucket[48]: Key=員林農工, DocCount=96
DEBUG 2025/12/17 16:54:00   Bucket[49]: Key=宜蘭高中, DocCount=92
DEBUG 2025/12/17 16:54:00   Bucket[50]: Key=花蓮高工, DocCount=90
DEBUG 2025/12/17 16:54:00   Bucket[51]: Key=成大南工, DocCount=89
DEBUG 2025/12/17 16:54:00   Bucket[52]: Key=北港高中, DocCount=88
DEBUG 2025/12/17 16:54:00   Bucket[53]: Key=員林高中, DocCount=87
DEBUG 2025/12/17 16:54:00   Bucket[54]: Key=北教大實小, DocCount=85
DEBUG 2025/12/17 16:54:00   Bucket[55]: Key=南大附中, DocCount=85
DEBUG 2025/12/17 16:54:00   Bucket[56]: Key=臺東高商, DocCount=83
DEBUG 2025/12/17 16:54:00   Bucket[57]: Key=二林工商, DocCount=81
DEBUG 2025/12/17 16:54:00   Bucket[58]: Key=新營高中, DocCount=77
DEBUG 2025/12/17 16:54:00   Bucket[59]: Key=永靖高工, DocCount=77
DEBUG 2025/12/17 16:54:00   Bucket[60]: Key=嘉科實中, DocCount=76
DEBUG 2025/12/17 16:54:00   Bucket[61]: Key=羅東高商, DocCount=76
DEBUG 2025/12/17 16:54:00   Bucket[62]: Key=水里商工, DocCount=72
DEBUG 2025/12/17 16:54:00   Bucket[63]: Key=埔里高工, DocCount=70
DEBUG 2025/12/17 16:54:00   Bucket[64]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 16:54:00   Bucket[65]: Key=北港農工, DocCount=68
DEBUG 2025/12/17 16:54:00   Bucket[66]: Key=屏東高工, DocCount=65
DEBUG 2025/12/17 16:54:00   Bucket[67]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 16:54:00   Bucket[68]: Key=新竹高中, DocCount=62
DEBUG 2025/12/17 16:54:00   Bucket[69]: Key=中興高中, DocCount=60
DEBUG 2025/12/17 16:54:00   Bucket[70]: Key=雲林特教, DocCount=60
DEBUG 2025/12/17 16:54:00   Bucket[71]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 16:54:00   Bucket[72]: Key=東石高中, DocCount=59
DEBUG 2025/12/17 16:54:00   Bucket[73]: Key=草屯商工, DocCount=55
DEBUG 2025/12/17 16:54:00   Bucket[74]: Key=佳冬高農, DocCount=54
DEBUG 2025/12/17 16:54:00   Bucket[75]: Key=花蓮特教, DocCount=54
DEBUG 2025/12/17 16:54:00   Bucket[76]: Key=羅東高工, DocCount=53
DEBUG 2025/12/17 16:54:00   Bucket[77]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 16:54:00   Bucket[78]: Key=嘉義家職, DocCount=51
DEBUG 2025/12/17 16:54:00   Bucket[79]: Key=華南高商, DocCount=51
DEBUG 2025/12/17 16:54:00   Bucket[80]: Key=基隆商工, DocCount=50
DEBUG 2025/12/17 16:54:00   Bucket[81]: Key=成功商水, DocCount=49
DEBUG 2025/12/17 16:54:00   Bucket[82]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 16:54:00   Bucket[83]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 16:54:00   Bucket[84]: Key=興大附農, DocCount=47
DEBUG 2025/12/17 16:54:00   Bucket[85]: Key=旗山農工, DocCount=46
DEBUG 2025/12/17 16:54:00   Bucket[86]: Key=海大附中, DocCount=46
DEBUG 2025/12/17 16:54:00   Bucket[87]: Key=屏東高中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[88]: Key=潮州高中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[89]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[90]: Key=家齊高中, DocCount=43
DEBUG 2025/12/17 16:54:00   Bucket[91]: Key=善化高中, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[92]: Key=新豐高中, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[93]: Key=秀水高工, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[94]: Key=南大附小, DocCount=41
DEBUG 2025/12/17 16:54:00   Bucket[95]: Key=白河商工, DocCount=41
DEBUG 2025/12/17 16:54:00   Bucket[96]: Key=玉井工商, DocCount=40
DEBUG 2025/12/17 16:54:00   Bucket[97]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 16:54:00   Bucket[98]: Key=曾文農工, DocCount=39
DEBUG 2025/12/17 16:54:00   Bucket[99]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 16:54:00 ========================================================
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 16:54:08 ✅ Successfully flushed 32/32 history records to TimescaleDB
INFO 2025/12/17 16:54:08 Processing 15 offline devices
INFO 2025/12/17 16:54:08 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:54:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:54:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:54:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:54:08 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 16:54:08 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 16:54:08 Creating history record for offline device: 新竹高商
INFO 2025/12/17 16:54:08 About to add history to batch for device: 新竹高商
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 16:54:08 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 鳳山高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 鳳山高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 鳳山高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:54:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:54:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:54:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:54:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:54:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:54:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:54:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.45% (threshold: 80.00%)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.31% (threshold: 85.00%)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:54:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 16:54:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:54:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:54:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:54:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:55:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:55:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:55:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:55:00 Field: school_name.keyword
DEBUG 2025/12/17 16:55:00 Time From: 2025-12-17T16:54:00.000+08:00
DEBUG 2025/12/17 16:55:00 Time To: 2025-12-17T16:55:00.000+08:00
DEBUG 2025/12/17 16:55:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:54:00.000+08:00",
					"lte": "2025-12-17T16:55:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:55:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:55:00 ES Response IsError: false
DEBUG 2025/12/17 16:55:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":510,"buckets":[{"key":"黑快馬主機","doc_count":1395},{"key":"南投高商","doc_count":876},{"key":"花蓮高農","doc_count":776},{"key":"仁愛高農","doc_count":665},{"key":"金門高中","doc_count":640},{"key":"臺東高中","doc_count":635},{"key":"新竹女中","doc_count":594},{"key":"竹北高中","doc_count":589},{"key":"金門農工","doc_count":521},{"key":"華僑高中","doc_count":467},{"key":"新港藝高","doc_count":426},{"key":"北門高中","doc_count":406},{"key":"興大附中","doc_count":405},{"key":"中大壢中","doc_count":397},{"key":"宜蘭高商","doc_count":396},{"key":"竹南高中","doc_count":351},{"key":"旗美高中","doc_count":326},{"key":"清華附小","doc_count":324},{"key":"內埔農工","doc_count":294},{"key":"蘇澳海事","doc_count":292},{"key":"新化高中","doc_count":291},{"key":"花蓮高商","doc_count":284},{"key":"後壁高中","doc_count":282},{"key":"南投特教","doc_count":275},{"key":"苗栗農工","doc_count":273},{"key":"關西高中","doc_count":264},{"key":"斗六家商","doc_count":231},{"key":"嘉義高商","doc_count":215},{"key":"成大南工","doc_count":202},{"key":"關山工商","doc_count":196},{"key":"東港海事","doc_count":186},{"key":"新竹高工","doc_count":179},{"key":"新化高工","doc_count":172},{"key":"屏東女中","doc_count":170},{"key":"員林家商","doc_count":160},{"key":"北斗家商","doc_count":154},{"key":"南大附中","doc_count":145},{"key":"南大附聰","doc_count":144},{"key":"新營高工","doc_count":144},{"key":"玉里高中","doc_count":143},{"key":"嘉科實中","doc_count":142},{"key":"彰師附工","doc_count":137},{"key":"鳳山高中","doc_count":135},{"key":"員林高中","doc_count":134},{"key":"虎尾高中","doc_count":131},{"key":"宜蘭高中","doc_count":127},{"key":"政大附中","doc_count":126},{"key":"花蓮高工","doc_count":120},{"key":"苗栗高商","doc_count":115},{"key":"秀水高工","doc_count":111},{"key":"南投高中","doc_count":107},{"key":"北港高中","doc_count":106},{"key":"臺東女中","doc_count":105},{"key":"永靖高工","doc_count":104},{"key":"苗栗高中","doc_count":100},{"key":"臺東高商","doc_count":99},{"key":"羅東高商","doc_count":98},{"key":"彰化高商","doc_count":96},{"key":"基隆商工","doc_count":93},{"key":"屏東高中","doc_count":91},{"key":"員林農工","doc_count":88},{"key":"屏科實中","doc_count":85},{"key":"水里商工","doc_count":85},{"key":"師大附中高中部","doc_count":81},{"key":"澎湖海事","doc_count":77},{"key":"旗山農工","doc_count":76},{"key":"臺南高商","doc_count":74},{"key":"新營高中","doc_count":72},{"key":"善化高中","doc_count":64},{"key":"屏東特教","doc_count":63},{"key":"草屯商工","doc_count":62},{"key":"土庫商工","doc_count":60},{"key":"中興高中","doc_count":59},{"key":"興大附農","doc_count":59},{"key":"二林工商","doc_count":58},{"key":"成功商水","doc_count":58},{"key":"花蓮特教","doc_count":58},{"key":"新竹高中","doc_count":57},{"key":"東石高中","doc_count":55},{"key":"羅東高工","doc_count":55},{"key":"嘉義特教","doc_count":54},{"key":"埔里高工","doc_count":54},{"key":"家齊高中","doc_count":53},{"key":"曾文農工","doc_count":53},{"key":"竹山高中","doc_count":53},{"key":"屏北高中","doc_count":52},{"key":"竹東高中","doc_count":52},{"key":"雲林特教","doc_count":52},{"key":"北教大實小","doc_count":51},{"key":"高餐大附中","doc_count":50},{"key":"嘉義高中","doc_count":48},{"key":"崇實高工","doc_count":47},{"key":"新竹高商","doc_count":47},{"key":"華南高商","doc_count":46},{"key":"溪湖高中","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"北港農工","doc_count":44},{"key":"暨大附中","doc_count":44},{"key":"白河商工","doc_count":44},{"key":"新豐高中","doc_count":43}]}}}
DEBUG 2025/12/17 16:55:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:55:00   Bucket[0]: Key=黑快馬主機, DocCount=1395
DEBUG 2025/12/17 16:55:00   Bucket[1]: Key=南投高商, DocCount=876
DEBUG 2025/12/17 16:55:00   Bucket[2]: Key=花蓮高農, DocCount=776
DEBUG 2025/12/17 16:55:00   Bucket[3]: Key=仁愛高農, DocCount=665
DEBUG 2025/12/17 16:55:00   Bucket[4]: Key=金門高中, DocCount=640
DEBUG 2025/12/17 16:55:00   Bucket[5]: Key=臺東高中, DocCount=635
DEBUG 2025/12/17 16:55:00   Bucket[6]: Key=新竹女中, DocCount=594
DEBUG 2025/12/17 16:55:00   Bucket[7]: Key=竹北高中, DocCount=589
DEBUG 2025/12/17 16:55:00   Bucket[8]: Key=金門農工, DocCount=521
DEBUG 2025/12/17 16:55:00   Bucket[9]: Key=華僑高中, DocCount=467
DEBUG 2025/12/17 16:55:00   Bucket[10]: Key=新港藝高, DocCount=426
DEBUG 2025/12/17 16:55:00   Bucket[11]: Key=北門高中, DocCount=406
DEBUG 2025/12/17 16:55:00   Bucket[12]: Key=興大附中, DocCount=405
DEBUG 2025/12/17 16:55:00   Bucket[13]: Key=中大壢中, DocCount=397
DEBUG 2025/12/17 16:55:00   Bucket[14]: Key=宜蘭高商, DocCount=396
DEBUG 2025/12/17 16:55:00   Bucket[15]: Key=竹南高中, DocCount=351
DEBUG 2025/12/17 16:55:00   Bucket[16]: Key=旗美高中, DocCount=326
DEBUG 2025/12/17 16:55:00   Bucket[17]: Key=清華附小, DocCount=324
DEBUG 2025/12/17 16:55:00   Bucket[18]: Key=內埔農工, DocCount=294
DEBUG 2025/12/17 16:55:00   Bucket[19]: Key=蘇澳海事, DocCount=292
DEBUG 2025/12/17 16:55:00   Bucket[20]: Key=新化高中, DocCount=291
DEBUG 2025/12/17 16:55:00   Bucket[21]: Key=花蓮高商, DocCount=284
DEBUG 2025/12/17 16:55:00   Bucket[22]: Key=後壁高中, DocCount=282
DEBUG 2025/12/17 16:55:00   Bucket[23]: Key=南投特教, DocCount=275
DEBUG 2025/12/17 16:55:00   Bucket[24]: Key=苗栗農工, DocCount=273
DEBUG 2025/12/17 16:55:00   Bucket[25]: Key=關西高中, DocCount=264
DEBUG 2025/12/17 16:55:00   Bucket[26]: Key=斗六家商, DocCount=231
DEBUG 2025/12/17 16:55:00   Bucket[27]: Key=嘉義高商, DocCount=215
DEBUG 2025/12/17 16:55:00   Bucket[28]: Key=成大南工, DocCount=202
DEBUG 2025/12/17 16:55:00   Bucket[29]: Key=關山工商, DocCount=196
DEBUG 2025/12/17 16:55:00   Bucket[30]: Key=東港海事, DocCount=186
DEBUG 2025/12/17 16:55:00   Bucket[31]: Key=新竹高工, DocCount=179
DEBUG 2025/12/17 16:55:00   Bucket[32]: Key=新化高工, DocCount=172
DEBUG 2025/12/17 16:55:00   Bucket[33]: Key=屏東女中, DocCount=170
DEBUG 2025/12/17 16:55:00   Bucket[34]: Key=員林家商, DocCount=160
DEBUG 2025/12/17 16:55:00   Bucket[35]: Key=北斗家商, DocCount=154
DEBUG 2025/12/17 16:55:00   Bucket[36]: Key=南大附中, DocCount=145
DEBUG 2025/12/17 16:55:00   Bucket[37]: Key=南大附聰, DocCount=144
DEBUG 2025/12/17 16:55:00   Bucket[38]: Key=新營高工, DocCount=144
DEBUG 2025/12/17 16:55:00   Bucket[39]: Key=玉里高中, DocCount=143
DEBUG 2025/12/17 16:55:00   Bucket[40]: Key=嘉科實中, DocCount=142
DEBUG 2025/12/17 16:55:00   Bucket[41]: Key=彰師附工, DocCount=137
DEBUG 2025/12/17 16:55:00   Bucket[42]: Key=鳳山高中, DocCount=135
DEBUG 2025/12/17 16:55:00   Bucket[43]: Key=員林高中, DocCount=134
DEBUG 2025/12/17 16:55:00   Bucket[44]: Key=虎尾高中, DocCount=131
DEBUG 2025/12/17 16:55:00   Bucket[45]: Key=宜蘭高中, DocCount=127
DEBUG 2025/12/17 16:55:00   Bucket[46]: Key=政大附中, DocCount=126
DEBUG 2025/12/17 16:55:00   Bucket[47]: Key=花蓮高工, DocCount=120
DEBUG 2025/12/17 16:55:00   Bucket[48]: Key=苗栗高商, DocCount=115
DEBUG 2025/12/17 16:55:00   Bucket[49]: Key=秀水高工, DocCount=111
DEBUG 2025/12/17 16:55:00   Bucket[50]: Key=南投高中, DocCount=107
DEBUG 2025/12/17 16:55:00   Bucket[51]: Key=北港高中, DocCount=106
DEBUG 2025/12/17 16:55:00   Bucket[52]: Key=臺東女中, DocCount=105
DEBUG 2025/12/17 16:55:00   Bucket[53]: Key=永靖高工, DocCount=104
DEBUG 2025/12/17 16:55:00   Bucket[54]: Key=苗栗高中, DocCount=100
DEBUG 2025/12/17 16:55:00   Bucket[55]: Key=臺東高商, DocCount=99
DEBUG 2025/12/17 16:55:00   Bucket[56]: Key=羅東高商, DocCount=98
DEBUG 2025/12/17 16:55:00   Bucket[57]: Key=彰化高商, DocCount=96
DEBUG 2025/12/17 16:55:00   Bucket[58]: Key=基隆商工, DocCount=93
DEBUG 2025/12/17 16:55:00   Bucket[59]: Key=屏東高中, DocCount=91
DEBUG 2025/12/17 16:55:00   Bucket[60]: Key=員林農工, DocCount=88
DEBUG 2025/12/17 16:55:00   Bucket[61]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 16:55:00   Bucket[62]: Key=水里商工, DocCount=85
DEBUG 2025/12/17 16:55:00   Bucket[63]: Key=師大附中高中部, DocCount=81
DEBUG 2025/12/17 16:55:00   Bucket[64]: Key=澎湖海事, DocCount=77
DEBUG 2025/12/17 16:55:00   Bucket[65]: Key=旗山農工, DocCount=76
DEBUG 2025/12/17 16:55:00   Bucket[66]: Key=臺南高商, DocCount=74
DEBUG 2025/12/17 16:55:00   Bucket[67]: Key=新營高中, DocCount=72
DEBUG 2025/12/17 16:55:00   Bucket[68]: Key=善化高中, DocCount=64
DEBUG 2025/12/17 16:55:00   Bucket[69]: Key=屏東特教, DocCount=63
DEBUG 2025/12/17 16:55:00   Bucket[70]: Key=草屯商工, DocCount=62
DEBUG 2025/12/17 16:55:00   Bucket[71]: Key=土庫商工, DocCount=60
DEBUG 2025/12/17 16:55:00   Bucket[72]: Key=中興高中, DocCount=59
DEBUG 2025/12/17 16:55:00   Bucket[73]: Key=興大附農, DocCount=59
DEBUG 2025/12/17 16:55:00   Bucket[74]: Key=二林工商, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[75]: Key=成功商水, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[76]: Key=花蓮特教, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[77]: Key=新竹高中, DocCount=57
DEBUG 2025/12/17 16:55:00   Bucket[78]: Key=東石高中, DocCount=55
DEBUG 2025/12/17 16:55:00   Bucket[79]: Key=羅東高工, DocCount=55
DEBUG 2025/12/17 16:55:00   Bucket[80]: Key=嘉義特教, DocCount=54
DEBUG 2025/12/17 16:55:00   Bucket[81]: Key=埔里高工, DocCount=54
DEBUG 2025/12/17 16:55:00   Bucket[82]: Key=家齊高中, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[83]: Key=曾文農工, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[84]: Key=竹山高中, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[85]: Key=屏北高中, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[86]: Key=竹東高中, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[87]: Key=雲林特教, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[88]: Key=北教大實小, DocCount=51
DEBUG 2025/12/17 16:55:00   Bucket[89]: Key=高餐大附中, DocCount=50
DEBUG 2025/12/17 16:55:00   Bucket[90]: Key=嘉義高中, DocCount=48
DEBUG 2025/12/17 16:55:00   Bucket[91]: Key=崇實高工, DocCount=47
DEBUG 2025/12/17 16:55:00   Bucket[92]: Key=新竹高商, DocCount=47
DEBUG 2025/12/17 16:55:00   Bucket[93]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 16:55:00   Bucket[94]: Key=溪湖高中, DocCount=45
DEBUG 2025/12/17 16:55:00   Bucket[95]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 16:55:00   Bucket[96]: Key=北港農工, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[97]: Key=暨大附中, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[98]: Key=白河商工, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[99]: Key=新豐高中, DocCount=43
DEBUG 2025/12/17 16:55:00 ========================================================
INFO 2025/12/17 16:55:08 ✅ Successfully flushed 37/37 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 Processing 15 offline devices
INFO 2025/12/17 16:55:11 Creating history record for offline device: 頭城家商
INFO 2025/12/17 16:55:11 About to add history to batch for device: 頭城家商
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:55:12 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 16:55:12 Creating history record for offline device: 屏東高工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 屏東高工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 16:55:12 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:55:12 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:55:12 Creating history record for offline device: 海大附中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 海大附中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 海大附中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:55:12 Creating history record for offline device: 潮州高中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 潮州高中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:55:12 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:55:12 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:55:12 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:55:12 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:55:12 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:55:12 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:55:12 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:55:12 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:55:12 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:55:12 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:55:12 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:55:12 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:55:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:55:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:55:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.46% (threshold: 80.00%)
INFO 2025/12/17 16:55:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.34% (threshold: 85.00%)
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:55:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:55:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:55:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:55:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:56:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:56:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:56:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:56:00 Field: school_name.keyword
DEBUG 2025/12/17 16:56:00 Time From: 2025-12-17T16:55:00.000+08:00
DEBUG 2025/12/17 16:56:00 Time To: 2025-12-17T16:56:00.000+08:00
DEBUG 2025/12/17 16:56:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:55:00.000+08:00",
					"lte": "2025-12-17T16:56:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:56:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:56:00 ES Response IsError: false
DEBUG 2025/12/17 16:56:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":511,"buckets":[{"key":"黑快馬主機","doc_count":1742},{"key":"花蓮高農","doc_count":877},{"key":"南投高商","doc_count":800},{"key":"新竹女中","doc_count":640},{"key":"仁愛高農","doc_count":588},{"key":"金門高中","doc_count":581},{"key":"金門農工","doc_count":562},{"key":"竹北高中","doc_count":546},{"key":"新港藝高","doc_count":509},{"key":"宜蘭高商","doc_count":489},{"key":"華僑高中","doc_count":474},{"key":"北門高中","doc_count":440},{"key":"臺東高中","doc_count":415},{"key":"興大附中","doc_count":351},{"key":"中大壢中","doc_count":337},{"key":"清華附小","doc_count":320},{"key":"旗美高中","doc_count":309},{"key":"竹南高中","doc_count":298},{"key":"蘇澳海事","doc_count":282},{"key":"埔里高工","doc_count":276},{"key":"玉里高中","doc_count":263},{"key":"南投特教","doc_count":251},{"key":"後壁高中","doc_count":241},{"key":"內埔農工","doc_count":239},{"key":"關山工商","doc_count":235},{"key":"關西高中","doc_count":231},{"key":"花蓮高商","doc_count":221},{"key":"苗栗農工","doc_count":220},{"key":"東港海事","doc_count":205},{"key":"斗六家商","doc_count":196},{"key":"新營高工","doc_count":191},{"key":"屏東女中","doc_count":184},{"key":"北斗家商","doc_count":171},{"key":"彰師附工","doc_count":167},{"key":"新化高中","doc_count":160},{"key":"虎尾高中","doc_count":158},{"key":"員林家商","doc_count":144},{"key":"成大南工","doc_count":144},{"key":"新化高工","doc_count":131},{"key":"嘉義高商","doc_count":126},{"key":"新竹高工","doc_count":126},{"key":"苗栗高商","doc_count":120},{"key":"南大附聰","doc_count":112},{"key":"嘉科實中","doc_count":101},{"key":"員林農工","doc_count":100},{"key":"屏東高工","doc_count":98},{"key":"員林高中","doc_count":97},{"key":"南投高中","doc_count":94},{"key":"水里商工","doc_count":94},{"key":"花蓮高工","doc_count":91},{"key":"南大附中","doc_count":90},{"key":"宜蘭高中","doc_count":90},{"key":"臺東高商","doc_count":90},{"key":"中興高中","doc_count":85},{"key":"師大附中高中部","doc_count":84},{"key":"屏北高中","doc_count":82},{"key":"屏科實中","doc_count":81},{"key":"秀水高工","doc_count":81},{"key":"土庫商工","doc_count":78},{"key":"雲林特教","doc_count":78},{"key":"彰化高商","doc_count":77},{"key":"新營高中","doc_count":75},{"key":"北教大實小","doc_count":74},{"key":"基隆商工","doc_count":74},{"key":"頭城家商","doc_count":71},{"key":"二林工商","doc_count":70},{"key":"嘉義家職","doc_count":69},{"key":"臺東女中","doc_count":69},{"key":"南大附小","doc_count":66},{"key":"高餐大附中","doc_count":65},{"key":"新豐高中","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"臺南一中","doc_count":63},{"key":"暨大附中","doc_count":60},{"key":"羅東高商","doc_count":60},{"key":"北港高中","doc_count":59},{"key":"嘉義特教","doc_count":59},{"key":"苗栗高中","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"竹山高中","doc_count":57},{"key":"華南高商","doc_count":57},{"key":"北港農工","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"鳳山高中","doc_count":56},{"key":"東石高中","doc_count":54},{"key":"善化高中","doc_count":53},{"key":"草屯商工","doc_count":53},{"key":"屏東高中","doc_count":52},{"key":"旗山農工","doc_count":52},{"key":"曾文農工","doc_count":52},{"key":"永靖高工","doc_count":51},{"key":"家齊高中","doc_count":50},{"key":"海大附中","doc_count":48},{"key":"師大附中國中部","doc_count":46},{"key":"白河商工","doc_count":46},{"key":"成功商水","doc_count":44},{"key":"新竹高商","doc_count":44},{"key":"興大附農","doc_count":44},{"key":"屏東特教","doc_count":43},{"key":"政大附中","doc_count":42}]}}}
DEBUG 2025/12/17 16:56:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:56:00   Bucket[0]: Key=黑快馬主機, DocCount=1742
DEBUG 2025/12/17 16:56:00   Bucket[1]: Key=花蓮高農, DocCount=877
DEBUG 2025/12/17 16:56:00   Bucket[2]: Key=南投高商, DocCount=800
DEBUG 2025/12/17 16:56:00   Bucket[3]: Key=新竹女中, DocCount=640
DEBUG 2025/12/17 16:56:00   Bucket[4]: Key=仁愛高農, DocCount=588
DEBUG 2025/12/17 16:56:00   Bucket[5]: Key=金門高中, DocCount=581
DEBUG 2025/12/17 16:56:00   Bucket[6]: Key=金門農工, DocCount=562
DEBUG 2025/12/17 16:56:00   Bucket[7]: Key=竹北高中, DocCount=546
DEBUG 2025/12/17 16:56:00   Bucket[8]: Key=新港藝高, DocCount=509
DEBUG 2025/12/17 16:56:00   Bucket[9]: Key=宜蘭高商, DocCount=489
DEBUG 2025/12/17 16:56:00   Bucket[10]: Key=華僑高中, DocCount=474
DEBUG 2025/12/17 16:56:00   Bucket[11]: Key=北門高中, DocCount=440
DEBUG 2025/12/17 16:56:00   Bucket[12]: Key=臺東高中, DocCount=415
DEBUG 2025/12/17 16:56:00   Bucket[13]: Key=興大附中, DocCount=351
DEBUG 2025/12/17 16:56:00   Bucket[14]: Key=中大壢中, DocCount=337
DEBUG 2025/12/17 16:56:00   Bucket[15]: Key=清華附小, DocCount=320
DEBUG 2025/12/17 16:56:00   Bucket[16]: Key=旗美高中, DocCount=309
DEBUG 2025/12/17 16:56:00   Bucket[17]: Key=竹南高中, DocCount=298
DEBUG 2025/12/17 16:56:00   Bucket[18]: Key=蘇澳海事, DocCount=282
DEBUG 2025/12/17 16:56:00   Bucket[19]: Key=埔里高工, DocCount=276
DEBUG 2025/12/17 16:56:00   Bucket[20]: Key=玉里高中, DocCount=263
DEBUG 2025/12/17 16:56:00   Bucket[21]: Key=南投特教, DocCount=251
DEBUG 2025/12/17 16:56:00   Bucket[22]: Key=後壁高中, DocCount=241
DEBUG 2025/12/17 16:56:00   Bucket[23]: Key=內埔農工, DocCount=239
DEBUG 2025/12/17 16:56:00   Bucket[24]: Key=關山工商, DocCount=235
DEBUG 2025/12/17 16:56:00   Bucket[25]: Key=關西高中, DocCount=231
DEBUG 2025/12/17 16:56:00   Bucket[26]: Key=花蓮高商, DocCount=221
DEBUG 2025/12/17 16:56:00   Bucket[27]: Key=苗栗農工, DocCount=220
DEBUG 2025/12/17 16:56:00   Bucket[28]: Key=東港海事, DocCount=205
DEBUG 2025/12/17 16:56:00   Bucket[29]: Key=斗六家商, DocCount=196
DEBUG 2025/12/17 16:56:00   Bucket[30]: Key=新營高工, DocCount=191
DEBUG 2025/12/17 16:56:00   Bucket[31]: Key=屏東女中, DocCount=184
DEBUG 2025/12/17 16:56:00   Bucket[32]: Key=北斗家商, DocCount=171
DEBUG 2025/12/17 16:56:00   Bucket[33]: Key=彰師附工, DocCount=167
DEBUG 2025/12/17 16:56:00   Bucket[34]: Key=新化高中, DocCount=160
DEBUG 2025/12/17 16:56:00   Bucket[35]: Key=虎尾高中, DocCount=158
DEBUG 2025/12/17 16:56:00   Bucket[36]: Key=員林家商, DocCount=144
DEBUG 2025/12/17 16:56:00   Bucket[37]: Key=成大南工, DocCount=144
DEBUG 2025/12/17 16:56:00   Bucket[38]: Key=新化高工, DocCount=131
DEBUG 2025/12/17 16:56:00   Bucket[39]: Key=嘉義高商, DocCount=126
DEBUG 2025/12/17 16:56:00   Bucket[40]: Key=新竹高工, DocCount=126
DEBUG 2025/12/17 16:56:00   Bucket[41]: Key=苗栗高商, DocCount=120
DEBUG 2025/12/17 16:56:00   Bucket[42]: Key=南大附聰, DocCount=112
DEBUG 2025/12/17 16:56:00   Bucket[43]: Key=嘉科實中, DocCount=101
DEBUG 2025/12/17 16:56:00   Bucket[44]: Key=員林農工, DocCount=100
DEBUG 2025/12/17 16:56:00   Bucket[45]: Key=屏東高工, DocCount=98
DEBUG 2025/12/17 16:56:00   Bucket[46]: Key=員林高中, DocCount=97
DEBUG 2025/12/17 16:56:00   Bucket[47]: Key=南投高中, DocCount=94
DEBUG 2025/12/17 16:56:00   Bucket[48]: Key=水里商工, DocCount=94
DEBUG 2025/12/17 16:56:00   Bucket[49]: Key=花蓮高工, DocCount=91
DEBUG 2025/12/17 16:56:00   Bucket[50]: Key=南大附中, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[51]: Key=宜蘭高中, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[52]: Key=臺東高商, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[53]: Key=中興高中, DocCount=85
DEBUG 2025/12/17 16:56:00   Bucket[54]: Key=師大附中高中部, DocCount=84
DEBUG 2025/12/17 16:56:00   Bucket[55]: Key=屏北高中, DocCount=82
DEBUG 2025/12/17 16:56:00   Bucket[56]: Key=屏科實中, DocCount=81
DEBUG 2025/12/17 16:56:00   Bucket[57]: Key=秀水高工, DocCount=81
DEBUG 2025/12/17 16:56:00   Bucket[58]: Key=土庫商工, DocCount=78
DEBUG 2025/12/17 16:56:00   Bucket[59]: Key=雲林特教, DocCount=78
DEBUG 2025/12/17 16:56:00   Bucket[60]: Key=彰化高商, DocCount=77
DEBUG 2025/12/17 16:56:00   Bucket[61]: Key=新營高中, DocCount=75
DEBUG 2025/12/17 16:56:00   Bucket[62]: Key=北教大實小, DocCount=74
DEBUG 2025/12/17 16:56:00   Bucket[63]: Key=基隆商工, DocCount=74
DEBUG 2025/12/17 16:56:00   Bucket[64]: Key=頭城家商, DocCount=71
DEBUG 2025/12/17 16:56:00   Bucket[65]: Key=二林工商, DocCount=70
DEBUG 2025/12/17 16:56:00   Bucket[66]: Key=嘉義家職, DocCount=69
DEBUG 2025/12/17 16:56:00   Bucket[67]: Key=臺東女中, DocCount=69
DEBUG 2025/12/17 16:56:00   Bucket[68]: Key=南大附小, DocCount=66
DEBUG 2025/12/17 16:56:00   Bucket[69]: Key=高餐大附中, DocCount=65
DEBUG 2025/12/17 16:56:00   Bucket[70]: Key=新豐高中, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[71]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[72]: Key=臺南一中, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[73]: Key=暨大附中, DocCount=60
DEBUG 2025/12/17 16:56:00   Bucket[74]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 16:56:00   Bucket[75]: Key=北港高中, DocCount=59
DEBUG 2025/12/17 16:56:00   Bucket[76]: Key=嘉義特教, DocCount=59
DEBUG 2025/12/17 16:56:00   Bucket[77]: Key=苗栗高中, DocCount=58
DEBUG 2025/12/17 16:56:00   Bucket[78]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[79]: Key=竹山高中, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[80]: Key=華南高商, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[81]: Key=北港農工, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[82]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[83]: Key=鳳山高中, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[84]: Key=東石高中, DocCount=54
DEBUG 2025/12/17 16:56:00   Bucket[85]: Key=善化高中, DocCount=53
DEBUG 2025/12/17 16:56:00   Bucket[86]: Key=草屯商工, DocCount=53
DEBUG 2025/12/17 16:56:00   Bucket[87]: Key=屏東高中, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[88]: Key=旗山農工, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[89]: Key=曾文農工, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[90]: Key=永靖高工, DocCount=51
DEBUG 2025/12/17 16:56:00   Bucket[91]: Key=家齊高中, DocCount=50
DEBUG 2025/12/17 16:56:00   Bucket[92]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 16:56:00   Bucket[93]: Key=師大附中國中部, DocCount=46
DEBUG 2025/12/17 16:56:00   Bucket[94]: Key=白河商工, DocCount=46
DEBUG 2025/12/17 16:56:00   Bucket[95]: Key=成功商水, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[96]: Key=新竹高商, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[97]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[98]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 16:56:00   Bucket[99]: Key=政大附中, DocCount=42
DEBUG 2025/12/17 16:56:00 ========================================================
INFO 2025/12/17 16:56:03 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:56:08 Processing 15 offline devices
INFO 2025/12/17 16:56:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:56:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:56:08 ✅ Successfully flushed 33/33 history records to TimescaleDB
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:56:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:56:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:56:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 16:56:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 16:56:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:56:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 嘉義高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 嘉義高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 嘉義高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:56:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 新竹高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 新竹高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:56:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:56:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 潮州高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 潮州高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:56:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:56:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:56:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:56:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:56:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:56:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:56:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:56:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:56:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:56:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 16:56:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 16:56:45 ES Alert Created [critical][performance]: Memory usage critical: 91.13% (threshold: 90.00%)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.37% (threshold: 85.00%)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:56:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:56:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:56:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:56:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:57:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:57:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:57:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:57:00 Field: school_name.keyword
DEBUG 2025/12/17 16:57:00 Time From: 2025-12-17T16:56:00.000+08:00
DEBUG 2025/12/17 16:57:00 Time To: 2025-12-17T16:57:00.000+08:00
DEBUG 2025/12/17 16:57:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:56:00.000+08:00",
					"lte": "2025-12-17T16:57:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:57:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:57:00 ES Response IsError: false
DEBUG 2025/12/17 16:57:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":490,"buckets":[{"key":"黑快馬主機","doc_count":947},{"key":"玉里高中","doc_count":824},{"key":"南投高商","doc_count":822},{"key":"花蓮高農","doc_count":809},{"key":"新竹女中","doc_count":793},{"key":"新港藝高","doc_count":792},{"key":"仁愛高農","doc_count":688},{"key":"中大壢中","doc_count":644},{"key":"竹北高中","doc_count":638},{"key":"金門高中","doc_count":599},{"key":"金門農工","doc_count":526},{"key":"華僑高中","doc_count":480},{"key":"臺東高中","doc_count":471},{"key":"宜蘭高商","doc_count":468},{"key":"北門高中","doc_count":441},{"key":"旗美高中","doc_count":400},{"key":"興大附中","doc_count":362},{"key":"清華附小","doc_count":349},{"key":"師大附中高中部","doc_count":330},{"key":"竹南高中","doc_count":282},{"key":"蘇澳海事","doc_count":271},{"key":"花蓮高商","doc_count":255},{"key":"新營高工","doc_count":254},{"key":"埔里高工","doc_count":248},{"key":"苗栗農工","doc_count":246},{"key":"南投特教","doc_count":242},{"key":"新化高中","doc_count":239},{"key":"屏東女中","doc_count":233},{"key":"關西高中","doc_count":230},{"key":"後壁高中","doc_count":225},{"key":"關山工商","doc_count":222},{"key":"斗六家商","doc_count":211},{"key":"內埔農工","doc_count":205},{"key":"員林家商","doc_count":187},{"key":"東港海事","doc_count":171},{"key":"北斗家商","doc_count":157},{"key":"新化高工","doc_count":153},{"key":"南大附聰","doc_count":126},{"key":"嘉義高商","doc_count":125},{"key":"新竹高工","doc_count":111},{"key":"苗栗高商","doc_count":106},{"key":"成大南工","doc_count":101},{"key":"北港高中","doc_count":98},{"key":"嘉科實中","doc_count":97},{"key":"屏北高中","doc_count":95},{"key":"虎尾高中","doc_count":94},{"key":"彰化高商","doc_count":93},{"key":"彰師附工","doc_count":91},{"key":"南大附中","doc_count":89},{"key":"高餐大附中","doc_count":88},{"key":"屏東高工","doc_count":86},{"key":"苗栗高中","doc_count":86},{"key":"華南高商","doc_count":86},{"key":"土庫商工","doc_count":85},{"key":"佳冬高農","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"新豐高中","doc_count":80},{"key":"二林工商","doc_count":79},{"key":"政大附中","doc_count":79},{"key":"水里商工","doc_count":78},{"key":"屏科實中","doc_count":77},{"key":"永靖高工","doc_count":77},{"key":"曾文農工","doc_count":75},{"key":"興大附農","doc_count":75},{"key":"宜蘭高中","doc_count":73},{"key":"新竹高商","doc_count":73},{"key":"鳳山高中","doc_count":73},{"key":"北教大實小","doc_count":72},{"key":"蘭陽女中","doc_count":72},{"key":"基隆商工","doc_count":70},{"key":"北港農工","doc_count":69},{"key":"臺東高商","doc_count":69},{"key":"頭城家商","doc_count":69},{"key":"澎湖海事","doc_count":66},{"key":"羅東高工","doc_count":66},{"key":"南投高中","doc_count":65},{"key":"新竹高中","doc_count":63},{"key":"家齊高中","doc_count":61},{"key":"臺南一中","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"暨大附中","doc_count":57},{"key":"花蓮高工","doc_count":57},{"key":"海大附中","doc_count":56},{"key":"雲林特教","doc_count":56},{"key":"草屯商工","doc_count":55},{"key":"屏東特教","doc_count":54},{"key":"嘉義高中","doc_count":53},{"key":"臺東女中","doc_count":53},{"key":"員林農工","doc_count":51},{"key":"秀水高工","doc_count":51},{"key":"花蓮特教","doc_count":51},{"key":"善化高中","doc_count":50},{"key":"南大附小","doc_count":49},{"key":"東石高中","doc_count":47},{"key":"成功商水","doc_count":46},{"key":"員林高中","doc_count":44},{"key":"嘉義特教","doc_count":44},{"key":"潮州高中","doc_count":43},{"key":"羅東高商","doc_count":43},{"key":"旗山農工","doc_count":41}]}}}
DEBUG 2025/12/17 16:57:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:57:00   Bucket[0]: Key=黑快馬主機, DocCount=947
DEBUG 2025/12/17 16:57:00   Bucket[1]: Key=玉里高中, DocCount=824
DEBUG 2025/12/17 16:57:00   Bucket[2]: Key=南投高商, DocCount=822
DEBUG 2025/12/17 16:57:00   Bucket[3]: Key=花蓮高農, DocCount=809
DEBUG 2025/12/17 16:57:00   Bucket[4]: Key=新竹女中, DocCount=793
DEBUG 2025/12/17 16:57:00   Bucket[5]: Key=新港藝高, DocCount=792
DEBUG 2025/12/17 16:57:00   Bucket[6]: Key=仁愛高農, DocCount=688
DEBUG 2025/12/17 16:57:00   Bucket[7]: Key=中大壢中, DocCount=644
DEBUG 2025/12/17 16:57:00   Bucket[8]: Key=竹北高中, DocCount=638
DEBUG 2025/12/17 16:57:00   Bucket[9]: Key=金門高中, DocCount=599
DEBUG 2025/12/17 16:57:00   Bucket[10]: Key=金門農工, DocCount=526
DEBUG 2025/12/17 16:57:00   Bucket[11]: Key=華僑高中, DocCount=480
DEBUG 2025/12/17 16:57:00   Bucket[12]: Key=臺東高中, DocCount=471
DEBUG 2025/12/17 16:57:00   Bucket[13]: Key=宜蘭高商, DocCount=468
DEBUG 2025/12/17 16:57:00   Bucket[14]: Key=北門高中, DocCount=441
DEBUG 2025/12/17 16:57:00   Bucket[15]: Key=旗美高中, DocCount=400
DEBUG 2025/12/17 16:57:00   Bucket[16]: Key=興大附中, DocCount=362
DEBUG 2025/12/17 16:57:00   Bucket[17]: Key=清華附小, DocCount=349
DEBUG 2025/12/17 16:57:00   Bucket[18]: Key=師大附中高中部, DocCount=330
DEBUG 2025/12/17 16:57:00   Bucket[19]: Key=竹南高中, DocCount=282
DEBUG 2025/12/17 16:57:00   Bucket[20]: Key=蘇澳海事, DocCount=271
DEBUG 2025/12/17 16:57:00   Bucket[21]: Key=花蓮高商, DocCount=255
DEBUG 2025/12/17 16:57:00   Bucket[22]: Key=新營高工, DocCount=254
DEBUG 2025/12/17 16:57:00   Bucket[23]: Key=埔里高工, DocCount=248
DEBUG 2025/12/17 16:57:00   Bucket[24]: Key=苗栗農工, DocCount=246
DEBUG 2025/12/17 16:57:00   Bucket[25]: Key=南投特教, DocCount=242
DEBUG 2025/12/17 16:57:00   Bucket[26]: Key=新化高中, DocCount=239
DEBUG 2025/12/17 16:57:00   Bucket[27]: Key=屏東女中, DocCount=233
DEBUG 2025/12/17 16:57:00   Bucket[28]: Key=關西高中, DocCount=230
DEBUG 2025/12/17 16:57:00   Bucket[29]: Key=後壁高中, DocCount=225
DEBUG 2025/12/17 16:57:00   Bucket[30]: Key=關山工商, DocCount=222
DEBUG 2025/12/17 16:57:00   Bucket[31]: Key=斗六家商, DocCount=211
DEBUG 2025/12/17 16:57:00   Bucket[32]: Key=內埔農工, DocCount=205
DEBUG 2025/12/17 16:57:00   Bucket[33]: Key=員林家商, DocCount=187
DEBUG 2025/12/17 16:57:00   Bucket[34]: Key=東港海事, DocCount=171
DEBUG 2025/12/17 16:57:00   Bucket[35]: Key=北斗家商, DocCount=157
DEBUG 2025/12/17 16:57:00   Bucket[36]: Key=新化高工, DocCount=153
DEBUG 2025/12/17 16:57:00   Bucket[37]: Key=南大附聰, DocCount=126
DEBUG 2025/12/17 16:57:00   Bucket[38]: Key=嘉義高商, DocCount=125
DEBUG 2025/12/17 16:57:00   Bucket[39]: Key=新竹高工, DocCount=111
DEBUG 2025/12/17 16:57:00   Bucket[40]: Key=苗栗高商, DocCount=106
DEBUG 2025/12/17 16:57:00   Bucket[41]: Key=成大南工, DocCount=101
DEBUG 2025/12/17 16:57:00   Bucket[42]: Key=北港高中, DocCount=98
DEBUG 2025/12/17 16:57:00   Bucket[43]: Key=嘉科實中, DocCount=97
DEBUG 2025/12/17 16:57:00   Bucket[44]: Key=屏北高中, DocCount=95
DEBUG 2025/12/17 16:57:00   Bucket[45]: Key=虎尾高中, DocCount=94
DEBUG 2025/12/17 16:57:00   Bucket[46]: Key=彰化高商, DocCount=93
DEBUG 2025/12/17 16:57:00   Bucket[47]: Key=彰師附工, DocCount=91
DEBUG 2025/12/17 16:57:00   Bucket[48]: Key=南大附中, DocCount=89
DEBUG 2025/12/17 16:57:00   Bucket[49]: Key=高餐大附中, DocCount=88
DEBUG 2025/12/17 16:57:00   Bucket[50]: Key=屏東高工, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[51]: Key=苗栗高中, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[52]: Key=華南高商, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[53]: Key=土庫商工, DocCount=85
DEBUG 2025/12/17 16:57:00   Bucket[54]: Key=佳冬高農, DocCount=82
DEBUG 2025/12/17 16:57:00   Bucket[55]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 16:57:00   Bucket[56]: Key=新豐高中, DocCount=80
DEBUG 2025/12/17 16:57:00   Bucket[57]: Key=二林工商, DocCount=79
DEBUG 2025/12/17 16:57:00   Bucket[58]: Key=政大附中, DocCount=79
DEBUG 2025/12/17 16:57:00   Bucket[59]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 16:57:00   Bucket[60]: Key=屏科實中, DocCount=77
DEBUG 2025/12/17 16:57:00   Bucket[61]: Key=永靖高工, DocCount=77
DEBUG 2025/12/17 16:57:00   Bucket[62]: Key=曾文農工, DocCount=75
DEBUG 2025/12/17 16:57:00   Bucket[63]: Key=興大附農, DocCount=75
DEBUG 2025/12/17 16:57:00   Bucket[64]: Key=宜蘭高中, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[65]: Key=新竹高商, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[66]: Key=鳳山高中, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[67]: Key=北教大實小, DocCount=72
DEBUG 2025/12/17 16:57:00   Bucket[68]: Key=蘭陽女中, DocCount=72
DEBUG 2025/12/17 16:57:00   Bucket[69]: Key=基隆商工, DocCount=70
DEBUG 2025/12/17 16:57:00   Bucket[70]: Key=北港農工, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[71]: Key=臺東高商, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[72]: Key=頭城家商, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[73]: Key=澎湖海事, DocCount=66
DEBUG 2025/12/17 16:57:00   Bucket[74]: Key=羅東高工, DocCount=66
DEBUG 2025/12/17 16:57:00   Bucket[75]: Key=南投高中, DocCount=65
DEBUG 2025/12/17 16:57:00   Bucket[76]: Key=新竹高中, DocCount=63
DEBUG 2025/12/17 16:57:00   Bucket[77]: Key=家齊高中, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[78]: Key=臺南一中, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[79]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[80]: Key=暨大附中, DocCount=57
DEBUG 2025/12/17 16:57:00   Bucket[81]: Key=花蓮高工, DocCount=57
DEBUG 2025/12/17 16:57:00   Bucket[82]: Key=海大附中, DocCount=56
DEBUG 2025/12/17 16:57:00   Bucket[83]: Key=雲林特教, DocCount=56
DEBUG 2025/12/17 16:57:00   Bucket[84]: Key=草屯商工, DocCount=55
DEBUG 2025/12/17 16:57:00   Bucket[85]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 16:57:00   Bucket[86]: Key=嘉義高中, DocCount=53
DEBUG 2025/12/17 16:57:00   Bucket[87]: Key=臺東女中, DocCount=53
DEBUG 2025/12/17 16:57:00   Bucket[88]: Key=員林農工, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[89]: Key=秀水高工, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[90]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[91]: Key=善化高中, DocCount=50
DEBUG 2025/12/17 16:57:00   Bucket[92]: Key=南大附小, DocCount=49
DEBUG 2025/12/17 16:57:00   Bucket[93]: Key=東石高中, DocCount=47
DEBUG 2025/12/17 16:57:00   Bucket[94]: Key=成功商水, DocCount=46
DEBUG 2025/12/17 16:57:00   Bucket[95]: Key=員林高中, DocCount=44
DEBUG 2025/12/17 16:57:00   Bucket[96]: Key=嘉義特教, DocCount=44
DEBUG 2025/12/17 16:57:00   Bucket[97]: Key=潮州高中, DocCount=43
DEBUG 2025/12/17 16:57:00   Bucket[98]: Key=羅東高商, DocCount=43
DEBUG 2025/12/17 16:57:00   Bucket[99]: Key=旗山農工, DocCount=41
DEBUG 2025/12/17 16:57:00 ========================================================
INFO 2025/12/17 16:57:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 16:57:08 ✅ Successfully flushed 20/20 history records to TimescaleDB
INFO 2025/12/17 16:57:08 Processing 15 offline devices
INFO 2025/12/17 16:57:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:57:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:57:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:57:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:57:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:57:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:57:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:57:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:57:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:57:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 中興高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 中興高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:57:10 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:57:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:57:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:57:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:57:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:57:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 16:57:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:57:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.36% (threshold: 90.00%)
INFO 2025/12/17 16:57:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 16:57:45 ES Alert Created [high][capacity]: Disk usage high: 93.41% (threshold: 85.00%)
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 16:57:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 16:57:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 16:57:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:57:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 16:57:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:57:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:58:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:58:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:58:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:58:00 Field: school_name.keyword
DEBUG 2025/12/17 16:58:00 Time From: 2025-12-17T16:57:00.000+08:00
DEBUG 2025/12/17 16:58:00 Time To: 2025-12-17T16:58:00.000+08:00
DEBUG 2025/12/17 16:58:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:57:00.000+08:00",
					"lte": "2025-12-17T16:58:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:58:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:58:00 ES Response IsError: false
DEBUG 2025/12/17 16:58:00 ES Response Body:
{"took":76,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":487,"buckets":[{"key":"黑快馬主機","doc_count":1284},{"key":"南投高商","doc_count":773},{"key":"花蓮高農","doc_count":723},{"key":"新竹女中","doc_count":702},{"key":"仁愛高農","doc_count":694},{"key":"金門高中","doc_count":655},{"key":"臺東高中","doc_count":527},{"key":"竹北高中","doc_count":524},{"key":"金門農工","doc_count":506},{"key":"華僑高中","doc_count":489},{"key":"北門高中","doc_count":428},{"key":"旗美高中","doc_count":424},{"key":"宜蘭高商","doc_count":403},{"key":"清華附小","doc_count":363},{"key":"師大附中高中部","doc_count":360},{"key":"興大附中","doc_count":337},{"key":"花蓮高商","doc_count":320},{"key":"新港藝高","doc_count":317},{"key":"屏東女中","doc_count":297},{"key":"竹南高中","doc_count":290},{"key":"內埔農工","doc_count":288},{"key":"南大附聰","doc_count":261},{"key":"關西高中","doc_count":260},{"key":"埔里高工","doc_count":258},{"key":"玉里高中","doc_count":253},{"key":"中大壢中","doc_count":250},{"key":"蘇澳海事","doc_count":248},{"key":"南投特教","doc_count":229},{"key":"關山工商","doc_count":222},{"key":"新化高中","doc_count":221},{"key":"後壁高中","doc_count":220},{"key":"苗栗農工","doc_count":216},{"key":"北斗家商","doc_count":210},{"key":"新營高工","doc_count":198},{"key":"員林家商","doc_count":193},{"key":"東港海事","doc_count":172},{"key":"斗六家商","doc_count":166},{"key":"嘉義高商","doc_count":154},{"key":"政大附中","doc_count":138},{"key":"新化高工","doc_count":123},{"key":"嘉科實中","doc_count":122},{"key":"臺東女中","doc_count":121},{"key":"彰化高商","doc_count":118},{"key":"彰師附工","doc_count":116},{"key":"虎尾高中","doc_count":111},{"key":"草屯商工","doc_count":109},{"key":"新營高中","doc_count":104},{"key":"北港高中","doc_count":100},{"key":"新竹高工","doc_count":99},{"key":"苗栗高商","doc_count":97},{"key":"南大附中","doc_count":91},{"key":"中興高中","doc_count":90},{"key":"頭城家商","doc_count":90},{"key":"花蓮高工","doc_count":87},{"key":"北港農工","doc_count":86},{"key":"屏科實中","doc_count":85},{"key":"員林農工","doc_count":82},{"key":"華南高商","doc_count":78},{"key":"南投高中","doc_count":77},{"key":"成大南工","doc_count":77},{"key":"嘉義高中","doc_count":72},{"key":"新竹高中","doc_count":71},{"key":"苗栗高中","doc_count":68},{"key":"水里商工","doc_count":67},{"key":"雲林特教","doc_count":67},{"key":"羅東高商","doc_count":65},{"key":"北教大實小","doc_count":64},{"key":"成功商水","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"白河商工","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"鳳山高中","doc_count":60},{"key":"宜蘭高中","doc_count":58},{"key":"永靖高工","doc_count":58},{"key":"臺東高商","doc_count":57},{"key":"蘭陽女中","doc_count":57},{"key":"基隆商工","doc_count":56},{"key":"新豐高中","doc_count":56},{"key":"秀水高工","doc_count":56},{"key":"土庫商工","doc_count":55},{"key":"新竹高商","doc_count":54},{"key":"臺南一中","doc_count":54},{"key":"羅東高工","doc_count":53},{"key":"高餐大附中","doc_count":53},{"key":"東石高中","doc_count":52},{"key":"興大附農","doc_count":51},{"key":"屏北高中","doc_count":49},{"key":"花蓮高中","doc_count":48},{"key":"玉井工商","doc_count":47},{"key":"善化高中","doc_count":45},{"key":"嘉義高工","doc_count":45},{"key":"屏東特教","doc_count":44},{"key":"暨大附中","doc_count":44},{"key":"崇實高工","doc_count":43},{"key":"旗山農工","doc_count":43},{"key":"潮州高中","doc_count":43},{"key":"家齊高中","doc_count":42},{"key":"溪湖高中","doc_count":41},{"key":"佳冬高農","doc_count":40}]}}}
DEBUG 2025/12/17 16:58:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:58:00   Bucket[0]: Key=黑快馬主機, DocCount=1284
DEBUG 2025/12/17 16:58:00   Bucket[1]: Key=南投高商, DocCount=773
DEBUG 2025/12/17 16:58:00   Bucket[2]: Key=花蓮高農, DocCount=723
DEBUG 2025/12/17 16:58:00   Bucket[3]: Key=新竹女中, DocCount=702
DEBUG 2025/12/17 16:58:00   Bucket[4]: Key=仁愛高農, DocCount=694
DEBUG 2025/12/17 16:58:00   Bucket[5]: Key=金門高中, DocCount=655
DEBUG 2025/12/17 16:58:00   Bucket[6]: Key=臺東高中, DocCount=527
DEBUG 2025/12/17 16:58:00   Bucket[7]: Key=竹北高中, DocCount=524
DEBUG 2025/12/17 16:58:00   Bucket[8]: Key=金門農工, DocCount=506
DEBUG 2025/12/17 16:58:00   Bucket[9]: Key=華僑高中, DocCount=489
DEBUG 2025/12/17 16:58:00   Bucket[10]: Key=北門高中, DocCount=428
DEBUG 2025/12/17 16:58:00   Bucket[11]: Key=旗美高中, DocCount=424
DEBUG 2025/12/17 16:58:00   Bucket[12]: Key=宜蘭高商, DocCount=403
DEBUG 2025/12/17 16:58:00   Bucket[13]: Key=清華附小, DocCount=363
DEBUG 2025/12/17 16:58:00   Bucket[14]: Key=師大附中高中部, DocCount=360
DEBUG 2025/12/17 16:58:00   Bucket[15]: Key=興大附中, DocCount=337
DEBUG 2025/12/17 16:58:00   Bucket[16]: Key=花蓮高商, DocCount=320
DEBUG 2025/12/17 16:58:00   Bucket[17]: Key=新港藝高, DocCount=317
DEBUG 2025/12/17 16:58:00   Bucket[18]: Key=屏東女中, DocCount=297
DEBUG 2025/12/17 16:58:00   Bucket[19]: Key=竹南高中, DocCount=290
DEBUG 2025/12/17 16:58:00   Bucket[20]: Key=內埔農工, DocCount=288
DEBUG 2025/12/17 16:58:00   Bucket[21]: Key=南大附聰, DocCount=261
DEBUG 2025/12/17 16:58:00   Bucket[22]: Key=關西高中, DocCount=260
DEBUG 2025/12/17 16:58:00   Bucket[23]: Key=埔里高工, DocCount=258
DEBUG 2025/12/17 16:58:00   Bucket[24]: Key=玉里高中, DocCount=253
DEBUG 2025/12/17 16:58:00   Bucket[25]: Key=中大壢中, DocCount=250
DEBUG 2025/12/17 16:58:00   Bucket[26]: Key=蘇澳海事, DocCount=248
DEBUG 2025/12/17 16:58:00   Bucket[27]: Key=南投特教, DocCount=229
DEBUG 2025/12/17 16:58:00   Bucket[28]: Key=關山工商, DocCount=222
DEBUG 2025/12/17 16:58:00   Bucket[29]: Key=新化高中, DocCount=221
DEBUG 2025/12/17 16:58:00   Bucket[30]: Key=後壁高中, DocCount=220
DEBUG 2025/12/17 16:58:00   Bucket[31]: Key=苗栗農工, DocCount=216
DEBUG 2025/12/17 16:58:00   Bucket[32]: Key=北斗家商, DocCount=210
DEBUG 2025/12/17 16:58:00   Bucket[33]: Key=新營高工, DocCount=198
DEBUG 2025/12/17 16:58:00   Bucket[34]: Key=員林家商, DocCount=193
DEBUG 2025/12/17 16:58:00   Bucket[35]: Key=東港海事, DocCount=172
DEBUG 2025/12/17 16:58:00   Bucket[36]: Key=斗六家商, DocCount=166
DEBUG 2025/12/17 16:58:00   Bucket[37]: Key=嘉義高商, DocCount=154
DEBUG 2025/12/17 16:58:00   Bucket[38]: Key=政大附中, DocCount=138
DEBUG 2025/12/17 16:58:00   Bucket[39]: Key=新化高工, DocCount=123
DEBUG 2025/12/17 16:58:00   Bucket[40]: Key=嘉科實中, DocCount=122
DEBUG 2025/12/17 16:58:00   Bucket[41]: Key=臺東女中, DocCount=121
DEBUG 2025/12/17 16:58:00   Bucket[42]: Key=彰化高商, DocCount=118
DEBUG 2025/12/17 16:58:00   Bucket[43]: Key=彰師附工, DocCount=116
DEBUG 2025/12/17 16:58:00   Bucket[44]: Key=虎尾高中, DocCount=111
DEBUG 2025/12/17 16:58:00   Bucket[45]: Key=草屯商工, DocCount=109
DEBUG 2025/12/17 16:58:00   Bucket[46]: Key=新營高中, DocCount=104
DEBUG 2025/12/17 16:58:00   Bucket[47]: Key=北港高中, DocCount=100
DEBUG 2025/12/17 16:58:00   Bucket[48]: Key=新竹高工, DocCount=99
DEBUG 2025/12/17 16:58:00   Bucket[49]: Key=苗栗高商, DocCount=97
DEBUG 2025/12/17 16:58:00   Bucket[50]: Key=南大附中, DocCount=91
DEBUG 2025/12/17 16:58:00   Bucket[51]: Key=中興高中, DocCount=90
DEBUG 2025/12/17 16:58:00   Bucket[52]: Key=頭城家商, DocCount=90
DEBUG 2025/12/17 16:58:00   Bucket[53]: Key=花蓮高工, DocCount=87
DEBUG 2025/12/17 16:58:00   Bucket[54]: Key=北港農工, DocCount=86
DEBUG 2025/12/17 16:58:00   Bucket[55]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 16:58:00   Bucket[56]: Key=員林農工, DocCount=82
DEBUG 2025/12/17 16:58:00   Bucket[57]: Key=華南高商, DocCount=78
DEBUG 2025/12/17 16:58:00   Bucket[58]: Key=南投高中, DocCount=77
DEBUG 2025/12/17 16:58:00   Bucket[59]: Key=成大南工, DocCount=77
DEBUG 2025/12/17 16:58:00   Bucket[60]: Key=嘉義高中, DocCount=72
DEBUG 2025/12/17 16:58:00   Bucket[61]: Key=新竹高中, DocCount=71
DEBUG 2025/12/17 16:58:00   Bucket[62]: Key=苗栗高中, DocCount=68
DEBUG 2025/12/17 16:58:00   Bucket[63]: Key=水里商工, DocCount=67
DEBUG 2025/12/17 16:58:00   Bucket[64]: Key=雲林特教, DocCount=67
DEBUG 2025/12/17 16:58:00   Bucket[65]: Key=羅東高商, DocCount=65
DEBUG 2025/12/17 16:58:00   Bucket[66]: Key=北教大實小, DocCount=64
DEBUG 2025/12/17 16:58:00   Bucket[67]: Key=成功商水, DocCount=64
DEBUG 2025/12/17 16:58:00   Bucket[68]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 16:58:00   Bucket[69]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:58:00   Bucket[70]: Key=白河商工, DocCount=61
DEBUG 2025/12/17 16:58:00   Bucket[71]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 16:58:00   Bucket[72]: Key=鳳山高中, DocCount=60
DEBUG 2025/12/17 16:58:00   Bucket[73]: Key=宜蘭高中, DocCount=58
DEBUG 2025/12/17 16:58:00   Bucket[74]: Key=永靖高工, DocCount=58
DEBUG 2025/12/17 16:58:00   Bucket[75]: Key=臺東高商, DocCount=57
DEBUG 2025/12/17 16:58:00   Bucket[76]: Key=蘭陽女中, DocCount=57
DEBUG 2025/12/17 16:58:00   Bucket[77]: Key=基隆商工, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[78]: Key=新豐高中, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[79]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[80]: Key=土庫商工, DocCount=55
DEBUG 2025/12/17 16:58:00   Bucket[81]: Key=新竹高商, DocCount=54
DEBUG 2025/12/17 16:58:00   Bucket[82]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 16:58:00   Bucket[83]: Key=羅東高工, DocCount=53
DEBUG 2025/12/17 16:58:00   Bucket[84]: Key=高餐大附中, DocCount=53
DEBUG 2025/12/17 16:58:00   Bucket[85]: Key=東石高中, DocCount=52
DEBUG 2025/12/17 16:58:00   Bucket[86]: Key=興大附農, DocCount=51
DEBUG 2025/12/17 16:58:00   Bucket[87]: Key=屏北高中, DocCount=49
DEBUG 2025/12/17 16:58:00   Bucket[88]: Key=花蓮高中, DocCount=48
DEBUG 2025/12/17 16:58:00   Bucket[89]: Key=玉井工商, DocCount=47
DEBUG 2025/12/17 16:58:00   Bucket[90]: Key=善化高中, DocCount=45
DEBUG 2025/12/17 16:58:00   Bucket[91]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 16:58:00   Bucket[92]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 16:58:00   Bucket[93]: Key=暨大附中, DocCount=44
DEBUG 2025/12/17 16:58:00   Bucket[94]: Key=崇實高工, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[95]: Key=旗山農工, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[96]: Key=潮州高中, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[97]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 16:58:00   Bucket[98]: Key=溪湖高中, DocCount=41
DEBUG 2025/12/17 16:58:00   Bucket[99]: Key=佳冬高農, DocCount=40
DEBUG 2025/12/17 16:58:00 ========================================================
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 16:58:08 ✅ Successfully flushed 31/31 history records to TimescaleDB
INFO 2025/12/17 16:58:08 Processing 15 offline devices
INFO 2025/12/17 16:58:08 Creating history record for offline device: 屏東高工
INFO 2025/12/17 16:58:08 About to add history to batch for device: 屏東高工
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 16:58:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:58:08 Creating history record for offline device: 海大附中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 海大附中
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 海大附中
INFO 2025/12/17 16:58:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:58:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:58:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:58:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:58:09 Creating history record for offline device: 曾文農工
INFO 2025/12/17 16:58:09 About to add history to batch for device: 曾文農工
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 16:58:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:58:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:58:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:58:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:58:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:58:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 16:58:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:58:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:58:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:58:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:58:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:58:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:58:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:58:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:58:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 16:58:45 ES Alert Created [high][performance]: Memory usage high: 88.28% (threshold: 80.00%)
INFO 2025/12/17 16:58:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.41% (threshold: 85.00%)
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:58:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:58:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:58:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:58:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:59:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:59:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:59:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:59:00 Field: school_name.keyword
DEBUG 2025/12/17 16:59:00 Time From: 2025-12-17T16:58:00.000+08:00
DEBUG 2025/12/17 16:59:00 Time To: 2025-12-17T16:59:00.000+08:00
DEBUG 2025/12/17 16:59:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:58:00.000+08:00",
					"lte": "2025-12-17T16:59:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:59:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:59:00 ES Response IsError: false
DEBUG 2025/12/17 16:59:00 ES Response Body:
{"took":76,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":456,"buckets":[{"key":"黑快馬主機","doc_count":1191},{"key":"花蓮高農","doc_count":777},{"key":"南投高商","doc_count":670},{"key":"仁愛高農","doc_count":632},{"key":"新竹女中","doc_count":605},{"key":"金門農工","doc_count":602},{"key":"華僑高中","doc_count":571},{"key":"金門高中","doc_count":524},{"key":"竹北高中","doc_count":519},{"key":"臺東高中","doc_count":478},{"key":"宜蘭高商","doc_count":405},{"key":"北門高中","doc_count":392},{"key":"旗美高中","doc_count":364},{"key":"蘇澳海事","doc_count":307},{"key":"興大附中","doc_count":305},{"key":"南大附聰","doc_count":297},{"key":"花蓮高商","doc_count":288},{"key":"北斗家商","doc_count":286},{"key":"中大壢中","doc_count":284},{"key":"清華附小","doc_count":283},{"key":"新港藝高","doc_count":276},{"key":"關西高中","doc_count":273},{"key":"屏東女中","doc_count":263},{"key":"玉里高中","doc_count":259},{"key":"中興高中","doc_count":254},{"key":"內埔農工","doc_count":248},{"key":"南投特教","doc_count":243},{"key":"竹南高中","doc_count":242},{"key":"嘉義高商","doc_count":234},{"key":"苗栗農工","doc_count":224},{"key":"後壁高中","doc_count":212},{"key":"斗六家商","doc_count":190},{"key":"草屯商工","doc_count":185},{"key":"新化高中","doc_count":184},{"key":"關山工商","doc_count":177},{"key":"東港海事","doc_count":163},{"key":"員林家商","doc_count":147},{"key":"新營高工","doc_count":137},{"key":"屏東高工","doc_count":127},{"key":"虎尾高中","doc_count":122},{"key":"苗栗高中","doc_count":120},{"key":"新化高工","doc_count":113},{"key":"員林農工","doc_count":107},{"key":"師大附中高中部","doc_count":104},{"key":"新竹高工","doc_count":104},{"key":"嘉科實中","doc_count":99},{"key":"屏科實中","doc_count":97},{"key":"新營高中","doc_count":96},{"key":"彰師附工","doc_count":95},{"key":"南大附中","doc_count":91},{"key":"花蓮高工","doc_count":86},{"key":"臺南高商","doc_count":85},{"key":"苗栗高商","doc_count":84},{"key":"彰化高商","doc_count":81},{"key":"新竹高中","doc_count":81},{"key":"臺東高商","doc_count":78},{"key":"鳳山高中","doc_count":77},{"key":"善化高中","doc_count":72},{"key":"土庫商工","doc_count":71},{"key":"永靖高工","doc_count":70},{"key":"南投高中","doc_count":69},{"key":"北教大實小","doc_count":67},{"key":"溪湖高中","doc_count":67},{"key":"嘉義高中","doc_count":65},{"key":"興大附農","doc_count":65},{"key":"成功商水","doc_count":64},{"key":"高餐大附中","doc_count":64},{"key":"水里商工","doc_count":62},{"key":"潮州高中","doc_count":60},{"key":"白河商工","doc_count":58},{"key":"屏東高中","doc_count":57},{"key":"華南高商","doc_count":57},{"key":"臺南一中","doc_count":56},{"key":"雲林特教","doc_count":56},{"key":"北港高中","doc_count":55},{"key":"羅東高工","doc_count":55},{"key":"海大附中","doc_count":54},{"key":"花蓮高中","doc_count":51},{"key":"基隆商工","doc_count":50},{"key":"蘭陽女中","doc_count":50},{"key":"埔里高工","doc_count":49},{"key":"新竹高商","doc_count":49},{"key":"頭城家商","doc_count":48},{"key":"宜蘭高中","doc_count":46},{"key":"家齊高中","doc_count":46},{"key":"東石高中","doc_count":46},{"key":"臺東女中","doc_count":46},{"key":"崇實高工","doc_count":45},{"key":"師大附中國中部","doc_count":45},{"key":"成大南工","doc_count":45},{"key":"嘉義高工","doc_count":44},{"key":"羅東高商","doc_count":44},{"key":"佳冬高農","doc_count":43},{"key":"屏東特教","doc_count":43},{"key":"二林工商","doc_count":42},{"key":"南大附小","doc_count":41},{"key":"竹東高中","doc_count":41},{"key":"新豐高中","doc_count":40},{"key":"澎湖海事","doc_count":40},{"key":"嘉義特教","doc_count":39}]}}}
DEBUG 2025/12/17 16:59:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:59:00   Bucket[0]: Key=黑快馬主機, DocCount=1191
DEBUG 2025/12/17 16:59:00   Bucket[1]: Key=花蓮高農, DocCount=777
DEBUG 2025/12/17 16:59:00   Bucket[2]: Key=南投高商, DocCount=670
DEBUG 2025/12/17 16:59:00   Bucket[3]: Key=仁愛高農, DocCount=632
DEBUG 2025/12/17 16:59:00   Bucket[4]: Key=新竹女中, DocCount=605
DEBUG 2025/12/17 16:59:00   Bucket[5]: Key=金門農工, DocCount=602
DEBUG 2025/12/17 16:59:00   Bucket[6]: Key=華僑高中, DocCount=571
DEBUG 2025/12/17 16:59:00   Bucket[7]: Key=金門高中, DocCount=524
DEBUG 2025/12/17 16:59:00   Bucket[8]: Key=竹北高中, DocCount=519
DEBUG 2025/12/17 16:59:00   Bucket[9]: Key=臺東高中, DocCount=478
DEBUG 2025/12/17 16:59:00   Bucket[10]: Key=宜蘭高商, DocCount=405
DEBUG 2025/12/17 16:59:00   Bucket[11]: Key=北門高中, DocCount=392
DEBUG 2025/12/17 16:59:00   Bucket[12]: Key=旗美高中, DocCount=364
DEBUG 2025/12/17 16:59:00   Bucket[13]: Key=蘇澳海事, DocCount=307
DEBUG 2025/12/17 16:59:00   Bucket[14]: Key=興大附中, DocCount=305
DEBUG 2025/12/17 16:59:00   Bucket[15]: Key=南大附聰, DocCount=297
DEBUG 2025/12/17 16:59:00   Bucket[16]: Key=花蓮高商, DocCount=288
DEBUG 2025/12/17 16:59:00   Bucket[17]: Key=北斗家商, DocCount=286
DEBUG 2025/12/17 16:59:00   Bucket[18]: Key=中大壢中, DocCount=284
DEBUG 2025/12/17 16:59:00   Bucket[19]: Key=清華附小, DocCount=283
DEBUG 2025/12/17 16:59:00   Bucket[20]: Key=新港藝高, DocCount=276
DEBUG 2025/12/17 16:59:00   Bucket[21]: Key=關西高中, DocCount=273
DEBUG 2025/12/17 16:59:00   Bucket[22]: Key=屏東女中, DocCount=263
DEBUG 2025/12/17 16:59:00   Bucket[23]: Key=玉里高中, DocCount=259
DEBUG 2025/12/17 16:59:00   Bucket[24]: Key=中興高中, DocCount=254
DEBUG 2025/12/17 16:59:00   Bucket[25]: Key=內埔農工, DocCount=248
DEBUG 2025/12/17 16:59:00   Bucket[26]: Key=南投特教, DocCount=243
DEBUG 2025/12/17 16:59:00   Bucket[27]: Key=竹南高中, DocCount=242
DEBUG 2025/12/17 16:59:00   Bucket[28]: Key=嘉義高商, DocCount=234
DEBUG 2025/12/17 16:59:00   Bucket[29]: Key=苗栗農工, DocCount=224
DEBUG 2025/12/17 16:59:00   Bucket[30]: Key=後壁高中, DocCount=212
DEBUG 2025/12/17 16:59:00   Bucket[31]: Key=斗六家商, DocCount=190
DEBUG 2025/12/17 16:59:00   Bucket[32]: Key=草屯商工, DocCount=185
DEBUG 2025/12/17 16:59:00   Bucket[33]: Key=新化高中, DocCount=184
DEBUG 2025/12/17 16:59:00   Bucket[34]: Key=關山工商, DocCount=177
DEBUG 2025/12/17 16:59:00   Bucket[35]: Key=東港海事, DocCount=163
DEBUG 2025/12/17 16:59:00   Bucket[36]: Key=員林家商, DocCount=147
DEBUG 2025/12/17 16:59:00   Bucket[37]: Key=新營高工, DocCount=137
DEBUG 2025/12/17 16:59:00   Bucket[38]: Key=屏東高工, DocCount=127
DEBUG 2025/12/17 16:59:00   Bucket[39]: Key=虎尾高中, DocCount=122
DEBUG 2025/12/17 16:59:00   Bucket[40]: Key=苗栗高中, DocCount=120
DEBUG 2025/12/17 16:59:00   Bucket[41]: Key=新化高工, DocCount=113
DEBUG 2025/12/17 16:59:00   Bucket[42]: Key=員林農工, DocCount=107
DEBUG 2025/12/17 16:59:00   Bucket[43]: Key=師大附中高中部, DocCount=104
DEBUG 2025/12/17 16:59:00   Bucket[44]: Key=新竹高工, DocCount=104
DEBUG 2025/12/17 16:59:00   Bucket[45]: Key=嘉科實中, DocCount=99
DEBUG 2025/12/17 16:59:00   Bucket[46]: Key=屏科實中, DocCount=97
DEBUG 2025/12/17 16:59:00   Bucket[47]: Key=新營高中, DocCount=96
DEBUG 2025/12/17 16:59:00   Bucket[48]: Key=彰師附工, DocCount=95
DEBUG 2025/12/17 16:59:00   Bucket[49]: Key=南大附中, DocCount=91
DEBUG 2025/12/17 16:59:00   Bucket[50]: Key=花蓮高工, DocCount=86
DEBUG 2025/12/17 16:59:00   Bucket[51]: Key=臺南高商, DocCount=85
DEBUG 2025/12/17 16:59:00   Bucket[52]: Key=苗栗高商, DocCount=84
DEBUG 2025/12/17 16:59:00   Bucket[53]: Key=彰化高商, DocCount=81
DEBUG 2025/12/17 16:59:00   Bucket[54]: Key=新竹高中, DocCount=81
DEBUG 2025/12/17 16:59:00   Bucket[55]: Key=臺東高商, DocCount=78
DEBUG 2025/12/17 16:59:00   Bucket[56]: Key=鳳山高中, DocCount=77
DEBUG 2025/12/17 16:59:00   Bucket[57]: Key=善化高中, DocCount=72
DEBUG 2025/12/17 16:59:00   Bucket[58]: Key=土庫商工, DocCount=71
DEBUG 2025/12/17 16:59:00   Bucket[59]: Key=永靖高工, DocCount=70
DEBUG 2025/12/17 16:59:00   Bucket[60]: Key=南投高中, DocCount=69
DEBUG 2025/12/17 16:59:00   Bucket[61]: Key=北教大實小, DocCount=67
DEBUG 2025/12/17 16:59:00   Bucket[62]: Key=溪湖高中, DocCount=67
DEBUG 2025/12/17 16:59:00   Bucket[63]: Key=嘉義高中, DocCount=65
DEBUG 2025/12/17 16:59:00   Bucket[64]: Key=興大附農, DocCount=65
DEBUG 2025/12/17 16:59:00   Bucket[65]: Key=成功商水, DocCount=64
DEBUG 2025/12/17 16:59:00   Bucket[66]: Key=高餐大附中, DocCount=64
DEBUG 2025/12/17 16:59:00   Bucket[67]: Key=水里商工, DocCount=62
DEBUG 2025/12/17 16:59:00   Bucket[68]: Key=潮州高中, DocCount=60
DEBUG 2025/12/17 16:59:00   Bucket[69]: Key=白河商工, DocCount=58
DEBUG 2025/12/17 16:59:00   Bucket[70]: Key=屏東高中, DocCount=57
DEBUG 2025/12/17 16:59:00   Bucket[71]: Key=華南高商, DocCount=57
DEBUG 2025/12/17 16:59:00   Bucket[72]: Key=臺南一中, DocCount=56
DEBUG 2025/12/17 16:59:00   Bucket[73]: Key=雲林特教, DocCount=56
DEBUG 2025/12/17 16:59:00   Bucket[74]: Key=北港高中, DocCount=55
DEBUG 2025/12/17 16:59:00   Bucket[75]: Key=羅東高工, DocCount=55
DEBUG 2025/12/17 16:59:00   Bucket[76]: Key=海大附中, DocCount=54
DEBUG 2025/12/17 16:59:00   Bucket[77]: Key=花蓮高中, DocCount=51
DEBUG 2025/12/17 16:59:00   Bucket[78]: Key=基隆商工, DocCount=50
DEBUG 2025/12/17 16:59:00   Bucket[79]: Key=蘭陽女中, DocCount=50
DEBUG 2025/12/17 16:59:00   Bucket[80]: Key=埔里高工, DocCount=49
DEBUG 2025/12/17 16:59:00   Bucket[81]: Key=新竹高商, DocCount=49
DEBUG 2025/12/17 16:59:00   Bucket[82]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 16:59:00   Bucket[83]: Key=宜蘭高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[84]: Key=家齊高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[85]: Key=東石高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[86]: Key=臺東女中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[87]: Key=崇實高工, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[88]: Key=師大附中國中部, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[89]: Key=成大南工, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[90]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 16:59:00   Bucket[91]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 16:59:00   Bucket[92]: Key=佳冬高農, DocCount=43
DEBUG 2025/12/17 16:59:00   Bucket[93]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 16:59:00   Bucket[94]: Key=二林工商, DocCount=42
DEBUG 2025/12/17 16:59:00   Bucket[95]: Key=南大附小, DocCount=41
DEBUG 2025/12/17 16:59:00   Bucket[96]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 16:59:00   Bucket[97]: Key=新豐高中, DocCount=40
DEBUG 2025/12/17 16:59:00   Bucket[98]: Key=澎湖海事, DocCount=40
DEBUG 2025/12/17 16:59:00   Bucket[99]: Key=嘉義特教, DocCount=39
DEBUG 2025/12/17 16:59:00 ========================================================
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 16:59:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 16:59:08 Processing 15 offline devices
INFO 2025/12/17 16:59:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 北港農工
INFO 2025/12/17 16:59:08 About to add history to batch for device: 北港農工
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 16:59:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 曾文農工
INFO 2025/12/17 16:59:08 About to add history to batch for device: 曾文農工
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 16:59:08 Creating history record for offline device: 政大附中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 政大附中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:59:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:59:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:59:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:59:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:59:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:59:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:59:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:59:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:59:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:59:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:59:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:59:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:59:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:59:13 ✅ Successfully flushed 16/16 history records to TimescaleDB
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:59:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:59:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:59:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:59:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:59:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:59:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:59:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:59:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:59:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:59:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:59:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:59:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:59:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:59:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.15% (threshold: 80.00%)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.44% (threshold: 85.00%)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:59:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:59:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:59:45 ES monitor check completed for: 213, status: online
INFO 2025/12/17 16:59:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:59:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:00:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:00:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:00:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:00:00 Field: school_name.keyword
DEBUG 2025/12/17 17:00:00 Time From: 2025-12-17T16:59:00.000+08:00
DEBUG 2025/12/17 17:00:00 Time To: 2025-12-17T17:00:00.000+08:00
DEBUG 2025/12/17 17:00:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:59:00.000+08:00",
					"lte": "2025-12-17T17:00:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:00:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:00:00 ES Response IsError: false
DEBUG 2025/12/17 17:00:00 ES Response Body:
{"took":81,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":490,"buckets":[{"key":"黑快馬主機","doc_count":1377},{"key":"花蓮高農","doc_count":799},{"key":"南投高商","doc_count":743},{"key":"新竹女中","doc_count":637},{"key":"仁愛高農","doc_count":559},{"key":"金門農工","doc_count":550},{"key":"金門高中","doc_count":542},{"key":"華僑高中","doc_count":461},{"key":"竹北高中","doc_count":441},{"key":"宜蘭高商","doc_count":433},{"key":"旗美高中","doc_count":398},{"key":"北門高中","doc_count":389},{"key":"臺東高中","doc_count":359},{"key":"南大附聰","doc_count":340},{"key":"興大附中","doc_count":300},{"key":"新港藝高","doc_count":282},{"key":"中大壢中","doc_count":281},{"key":"關山工商","doc_count":274},{"key":"清華附小","doc_count":268},{"key":"政大附中","doc_count":262},{"key":"蘇澳海事","doc_count":250},{"key":"內埔農工","doc_count":234},{"key":"南投特教","doc_count":233},{"key":"竹南高中","doc_count":229},{"key":"苗栗農工","doc_count":219},{"key":"花蓮高商","doc_count":213},{"key":"後壁高中","doc_count":197},{"key":"新化高中","doc_count":194},{"key":"中興高中","doc_count":186},{"key":"關西高中","doc_count":182},{"key":"嘉義高商","doc_count":179},{"key":"東港海事","doc_count":167},{"key":"北斗家商","doc_count":163},{"key":"新營高工","doc_count":163},{"key":"屏東女中","doc_count":155},{"key":"虎尾高中","doc_count":148},{"key":"斗六家商","doc_count":145},{"key":"玉里高中","doc_count":142},{"key":"員林家商","doc_count":140},{"key":"草屯商工","doc_count":133},{"key":"師大附中高中部","doc_count":126},{"key":"新化高工","doc_count":120},{"key":"彰化高商","doc_count":106},{"key":"潮州高中","doc_count":106},{"key":"土庫商工","doc_count":98},{"key":"新竹高中","doc_count":98},{"key":"嘉科實中","doc_count":97},{"key":"屏東高中","doc_count":94},{"key":"南投高中","doc_count":86},{"key":"北教大實小","doc_count":85},{"key":"苗栗高商","doc_count":85},{"key":"曾文農工","doc_count":82},{"key":"新竹高工","doc_count":80},{"key":"海大附中","doc_count":80},{"key":"基隆特教","doc_count":79},{"key":"南大附中","doc_count":75},{"key":"宜蘭高中","doc_count":72},{"key":"屏科實中","doc_count":71},{"key":"南大附小","doc_count":70},{"key":"嘉義高中","doc_count":70},{"key":"雲林特教","doc_count":68},{"key":"東石高中","doc_count":67},{"key":"澎湖海事","doc_count":67},{"key":"彰師附工","doc_count":65},{"key":"新營高中","doc_count":65},{"key":"員林高中","doc_count":64},{"key":"埔里高工","doc_count":64},{"key":"善化高中","doc_count":63},{"key":"成大南工","doc_count":63},{"key":"白河商工","doc_count":63},{"key":"臺南高商","doc_count":63},{"key":"北港高中","doc_count":62},{"key":"屏北高中","doc_count":62},{"key":"苗栗高中","doc_count":62},{"key":"花蓮高工","doc_count":61},{"key":"羅東高商","doc_count":60},{"key":"水里商工","doc_count":58},{"key":"二林工商","doc_count":57},{"key":"鳳山高中","doc_count":57},{"key":"嘉義家職","doc_count":55},{"key":"華南高商","doc_count":55},{"key":"臺東高商","doc_count":54},{"key":"屏東高工","doc_count":53},{"key":"嘉義高工","doc_count":52},{"key":"溪湖高中","doc_count":52},{"key":"北港農工","doc_count":50},{"key":"蘭陽女中","doc_count":49},{"key":"佳冬高農","doc_count":47},{"key":"成功商水","doc_count":47},{"key":"新豐高中","doc_count":46},{"key":"臺東女中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"新竹高商","doc_count":43},{"key":"臺南一中","doc_count":43},{"key":"頭城家商","doc_count":43},{"key":"竹山高中","doc_count":42},{"key":"羅東高工","doc_count":42},{"key":"旗山農工","doc_count":41},{"key":"竹東高中","doc_count":41}]}}}
DEBUG 2025/12/17 17:00:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:00:00   Bucket[0]: Key=黑快馬主機, DocCount=1377
DEBUG 2025/12/17 17:00:00   Bucket[1]: Key=花蓮高農, DocCount=799
DEBUG 2025/12/17 17:00:00   Bucket[2]: Key=南投高商, DocCount=743
DEBUG 2025/12/17 17:00:00   Bucket[3]: Key=新竹女中, DocCount=637
DEBUG 2025/12/17 17:00:00   Bucket[4]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:00:00   Bucket[5]: Key=金門農工, DocCount=550
DEBUG 2025/12/17 17:00:00   Bucket[6]: Key=金門高中, DocCount=542
DEBUG 2025/12/17 17:00:00   Bucket[7]: Key=華僑高中, DocCount=461
DEBUG 2025/12/17 17:00:00   Bucket[8]: Key=竹北高中, DocCount=441
DEBUG 2025/12/17 17:00:00   Bucket[9]: Key=宜蘭高商, DocCount=433
DEBUG 2025/12/17 17:00:00   Bucket[10]: Key=旗美高中, DocCount=398
DEBUG 2025/12/17 17:00:00   Bucket[11]: Key=北門高中, DocCount=389
DEBUG 2025/12/17 17:00:00   Bucket[12]: Key=臺東高中, DocCount=359
DEBUG 2025/12/17 17:00:00   Bucket[13]: Key=南大附聰, DocCount=340
DEBUG 2025/12/17 17:00:00   Bucket[14]: Key=興大附中, DocCount=300
DEBUG 2025/12/17 17:00:00   Bucket[15]: Key=新港藝高, DocCount=282
DEBUG 2025/12/17 17:00:00   Bucket[16]: Key=中大壢中, DocCount=281
DEBUG 2025/12/17 17:00:00   Bucket[17]: Key=關山工商, DocCount=274
DEBUG 2025/12/17 17:00:00   Bucket[18]: Key=清華附小, DocCount=268
DEBUG 2025/12/17 17:00:00   Bucket[19]: Key=政大附中, DocCount=262
DEBUG 2025/12/17 17:00:00   Bucket[20]: Key=蘇澳海事, DocCount=250
DEBUG 2025/12/17 17:00:00   Bucket[21]: Key=內埔農工, DocCount=234
DEBUG 2025/12/17 17:00:00   Bucket[22]: Key=南投特教, DocCount=233
DEBUG 2025/12/17 17:00:00   Bucket[23]: Key=竹南高中, DocCount=229
DEBUG 2025/12/17 17:00:00   Bucket[24]: Key=苗栗農工, DocCount=219
DEBUG 2025/12/17 17:00:00   Bucket[25]: Key=花蓮高商, DocCount=213
DEBUG 2025/12/17 17:00:00   Bucket[26]: Key=後壁高中, DocCount=197
DEBUG 2025/12/17 17:00:00   Bucket[27]: Key=新化高中, DocCount=194
DEBUG 2025/12/17 17:00:00   Bucket[28]: Key=中興高中, DocCount=186
DEBUG 2025/12/17 17:00:00   Bucket[29]: Key=關西高中, DocCount=182
DEBUG 2025/12/17 17:00:00   Bucket[30]: Key=嘉義高商, DocCount=179
DEBUG 2025/12/17 17:00:00   Bucket[31]: Key=東港海事, DocCount=167
DEBUG 2025/12/17 17:00:00   Bucket[32]: Key=北斗家商, DocCount=163
DEBUG 2025/12/17 17:00:00   Bucket[33]: Key=新營高工, DocCount=163
DEBUG 2025/12/17 17:00:00   Bucket[34]: Key=屏東女中, DocCount=155
DEBUG 2025/12/17 17:00:00   Bucket[35]: Key=虎尾高中, DocCount=148
DEBUG 2025/12/17 17:00:00   Bucket[36]: Key=斗六家商, DocCount=145
DEBUG 2025/12/17 17:00:00   Bucket[37]: Key=玉里高中, DocCount=142
DEBUG 2025/12/17 17:00:00   Bucket[38]: Key=員林家商, DocCount=140
DEBUG 2025/12/17 17:00:00   Bucket[39]: Key=草屯商工, DocCount=133
DEBUG 2025/12/17 17:00:00   Bucket[40]: Key=師大附中高中部, DocCount=126
DEBUG 2025/12/17 17:00:00   Bucket[41]: Key=新化高工, DocCount=120
DEBUG 2025/12/17 17:00:00   Bucket[42]: Key=彰化高商, DocCount=106
DEBUG 2025/12/17 17:00:00   Bucket[43]: Key=潮州高中, DocCount=106
DEBUG 2025/12/17 17:00:00   Bucket[44]: Key=土庫商工, DocCount=98
DEBUG 2025/12/17 17:00:00   Bucket[45]: Key=新竹高中, DocCount=98
DEBUG 2025/12/17 17:00:00   Bucket[46]: Key=嘉科實中, DocCount=97
DEBUG 2025/12/17 17:00:00   Bucket[47]: Key=屏東高中, DocCount=94
DEBUG 2025/12/17 17:00:00   Bucket[48]: Key=南投高中, DocCount=86
DEBUG 2025/12/17 17:00:00   Bucket[49]: Key=北教大實小, DocCount=85
DEBUG 2025/12/17 17:00:00   Bucket[50]: Key=苗栗高商, DocCount=85
DEBUG 2025/12/17 17:00:00   Bucket[51]: Key=曾文農工, DocCount=82
DEBUG 2025/12/17 17:00:00   Bucket[52]: Key=新竹高工, DocCount=80
DEBUG 2025/12/17 17:00:00   Bucket[53]: Key=海大附中, DocCount=80
DEBUG 2025/12/17 17:00:00   Bucket[54]: Key=基隆特教, DocCount=79
DEBUG 2025/12/17 17:00:00   Bucket[55]: Key=南大附中, DocCount=75
DEBUG 2025/12/17 17:00:00   Bucket[56]: Key=宜蘭高中, DocCount=72
DEBUG 2025/12/17 17:00:00   Bucket[57]: Key=屏科實中, DocCount=71
DEBUG 2025/12/17 17:00:00   Bucket[58]: Key=南大附小, DocCount=70
DEBUG 2025/12/17 17:00:00   Bucket[59]: Key=嘉義高中, DocCount=70
DEBUG 2025/12/17 17:00:00   Bucket[60]: Key=雲林特教, DocCount=68
DEBUG 2025/12/17 17:00:00   Bucket[61]: Key=東石高中, DocCount=67
DEBUG 2025/12/17 17:00:00   Bucket[62]: Key=澎湖海事, DocCount=67
DEBUG 2025/12/17 17:00:00   Bucket[63]: Key=彰師附工, DocCount=65
DEBUG 2025/12/17 17:00:00   Bucket[64]: Key=新營高中, DocCount=65
DEBUG 2025/12/17 17:00:00   Bucket[65]: Key=員林高中, DocCount=64
DEBUG 2025/12/17 17:00:00   Bucket[66]: Key=埔里高工, DocCount=64
DEBUG 2025/12/17 17:00:00   Bucket[67]: Key=善化高中, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[68]: Key=成大南工, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[69]: Key=白河商工, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[70]: Key=臺南高商, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[71]: Key=北港高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[72]: Key=屏北高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[73]: Key=苗栗高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[74]: Key=花蓮高工, DocCount=61
DEBUG 2025/12/17 17:00:00   Bucket[75]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 17:00:00   Bucket[76]: Key=水里商工, DocCount=58
DEBUG 2025/12/17 17:00:00   Bucket[77]: Key=二林工商, DocCount=57
DEBUG 2025/12/17 17:00:00   Bucket[78]: Key=鳳山高中, DocCount=57
DEBUG 2025/12/17 17:00:00   Bucket[79]: Key=嘉義家職, DocCount=55
DEBUG 2025/12/17 17:00:00   Bucket[80]: Key=華南高商, DocCount=55
DEBUG 2025/12/17 17:00:00   Bucket[81]: Key=臺東高商, DocCount=54
DEBUG 2025/12/17 17:00:00   Bucket[82]: Key=屏東高工, DocCount=53
DEBUG 2025/12/17 17:00:00   Bucket[83]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:00:00   Bucket[84]: Key=溪湖高中, DocCount=52
DEBUG 2025/12/17 17:00:00   Bucket[85]: Key=北港農工, DocCount=50
DEBUG 2025/12/17 17:00:00   Bucket[86]: Key=蘭陽女中, DocCount=49
DEBUG 2025/12/17 17:00:00   Bucket[87]: Key=佳冬高農, DocCount=47
DEBUG 2025/12/17 17:00:00   Bucket[88]: Key=成功商水, DocCount=47
DEBUG 2025/12/17 17:00:00   Bucket[89]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:00:00   Bucket[90]: Key=臺東女中, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[91]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[92]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[93]: Key=新竹高商, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[94]: Key=臺南一中, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[95]: Key=頭城家商, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[96]: Key=竹山高中, DocCount=42
DEBUG 2025/12/17 17:00:00   Bucket[97]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 17:00:00   Bucket[98]: Key=旗山農工, DocCount=41
DEBUG 2025/12/17 17:00:00   Bucket[99]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 17:00:00 ========================================================
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:00:08 ✅ Successfully flushed 31/31 history records to TimescaleDB
INFO 2025/12/17 17:00:08 Processing 15 offline devices
INFO 2025/12/17 17:00:08 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:00:08 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:00:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:00:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:00:08 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:00:08 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:00:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:00:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:00:08 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:00:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:00:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:00:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:00:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:00:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:00:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:00:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:00:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:00:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:00:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:00:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:00:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:00:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:00:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:00:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:00:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:00:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:00:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.42% (threshold: 80.00%)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.48% (threshold: 85.00%)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:00:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:00:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:00:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:00:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:01:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:01:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:01:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:01:00 Field: school_name.keyword
DEBUG 2025/12/17 17:01:00 Time From: 2025-12-17T17:00:00.000+08:00
DEBUG 2025/12/17 17:01:00 Time To: 2025-12-17T17:01:00.000+08:00
DEBUG 2025/12/17 17:01:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:00:00.000+08:00",
					"lte": "2025-12-17T17:01:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:01:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:01:00 ES Response IsError: false
DEBUG 2025/12/17 17:01:00 ES Response Body:
{"took":86,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"黑快馬主機","doc_count":1556},{"key":"花蓮高農","doc_count":767},{"key":"新竹女中","doc_count":671},{"key":"南投高商","doc_count":575},{"key":"仁愛高農","doc_count":573},{"key":"金門高中","doc_count":557},{"key":"金門農工","doc_count":549},{"key":"北門高中","doc_count":495},{"key":"華僑高中","doc_count":448},{"key":"宜蘭高商","doc_count":419},{"key":"旗美高中","doc_count":416},{"key":"興大附中","doc_count":406},{"key":"竹北高中","doc_count":385},{"key":"臺東高中","doc_count":383},{"key":"新化高中","doc_count":320},{"key":"中大壢中","doc_count":291},{"key":"清華附小","doc_count":272},{"key":"後壁高中","doc_count":262},{"key":"新港藝高","doc_count":262},{"key":"南投特教","doc_count":250},{"key":"蘇澳海事","doc_count":241},{"key":"嘉義高商","doc_count":238},{"key":"內埔農工","doc_count":235},{"key":"關山工商","doc_count":233},{"key":"竹南高中","doc_count":221},{"key":"關西高中","doc_count":212},{"key":"花蓮高商","doc_count":205},{"key":"玉里高中","doc_count":203},{"key":"師大附中高中部","doc_count":196},{"key":"屏東女中","doc_count":186},{"key":"新營高工","doc_count":184},{"key":"苗栗農工","doc_count":174},{"key":"新竹高工","doc_count":160},{"key":"東港海事","doc_count":148},{"key":"員林家商","doc_count":139},{"key":"新化高工","doc_count":138},{"key":"虎尾高中","doc_count":138},{"key":"斗六家商","doc_count":137},{"key":"北斗家商","doc_count":135},{"key":"苗栗高中","doc_count":131},{"key":"南大附中","doc_count":130},{"key":"白河商工","doc_count":130},{"key":"屏東高工","doc_count":127},{"key":"彰化高商","doc_count":113},{"key":"新營高中","doc_count":105},{"key":"南大附聰","doc_count":104},{"key":"屏科實中","doc_count":98},{"key":"彰師附工","doc_count":98},{"key":"成功商水","doc_count":92},{"key":"埔里高工","doc_count":90},{"key":"南投高中","doc_count":89},{"key":"成大南工","doc_count":86},{"key":"政大附中","doc_count":84},{"key":"羅東高商","doc_count":83},{"key":"苗栗高商","doc_count":83},{"key":"嘉義家職","doc_count":82},{"key":"中興高中","doc_count":81},{"key":"南大附小","doc_count":79},{"key":"曾文農工","doc_count":75},{"key":"北教大實小","doc_count":74},{"key":"員林高中","doc_count":74},{"key":"善化高中","doc_count":71},{"key":"秀水高工","doc_count":70},{"key":"嘉科實中","doc_count":67},{"key":"鳳山高中","doc_count":64},{"key":"北港高中","doc_count":61},{"key":"員林農工","doc_count":61},{"key":"東石高中","doc_count":61},{"key":"水里商工","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"嘉義高中","doc_count":60},{"key":"屏東高中","doc_count":60},{"key":"蘭陽女中","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"花蓮高工","doc_count":59},{"key":"新竹高商","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"屏北高中","doc_count":56},{"key":"旗山農工","doc_count":56},{"key":"澎湖海事","doc_count":56},{"key":"北港農工","doc_count":55},{"key":"雲林特教","doc_count":55},{"key":"草屯商工","doc_count":52},{"key":"溪湖高中","doc_count":51},{"key":"新竹高中","doc_count":49},{"key":"臺東高商","doc_count":49},{"key":"二林工商","doc_count":48},{"key":"海大附中","doc_count":47},{"key":"臺南一中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"宜蘭高中","doc_count":43},{"key":"基隆商工","doc_count":42},{"key":"花蓮高中","doc_count":42},{"key":"永靖高工","doc_count":41},{"key":"高餐大附中","doc_count":41},{"key":"屏東特教","doc_count":40},{"key":"頭城家商","doc_count":40},{"key":"師大附中國中部","doc_count":39},{"key":"華南高商","doc_count":39}]}}}
DEBUG 2025/12/17 17:01:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:01:00   Bucket[0]: Key=黑快馬主機, DocCount=1556
DEBUG 2025/12/17 17:01:00   Bucket[1]: Key=花蓮高農, DocCount=767
DEBUG 2025/12/17 17:01:00   Bucket[2]: Key=新竹女中, DocCount=671
DEBUG 2025/12/17 17:01:00   Bucket[3]: Key=南投高商, DocCount=575
DEBUG 2025/12/17 17:01:00   Bucket[4]: Key=仁愛高農, DocCount=573
DEBUG 2025/12/17 17:01:00   Bucket[5]: Key=金門高中, DocCount=557
DEBUG 2025/12/17 17:01:00   Bucket[6]: Key=金門農工, DocCount=549
DEBUG 2025/12/17 17:01:00   Bucket[7]: Key=北門高中, DocCount=495
DEBUG 2025/12/17 17:01:00   Bucket[8]: Key=華僑高中, DocCount=448
DEBUG 2025/12/17 17:01:00   Bucket[9]: Key=宜蘭高商, DocCount=419
DEBUG 2025/12/17 17:01:00   Bucket[10]: Key=旗美高中, DocCount=416
DEBUG 2025/12/17 17:01:00   Bucket[11]: Key=興大附中, DocCount=406
DEBUG 2025/12/17 17:01:00   Bucket[12]: Key=竹北高中, DocCount=385
DEBUG 2025/12/17 17:01:00   Bucket[13]: Key=臺東高中, DocCount=383
DEBUG 2025/12/17 17:01:00   Bucket[14]: Key=新化高中, DocCount=320
DEBUG 2025/12/17 17:01:00   Bucket[15]: Key=中大壢中, DocCount=291
DEBUG 2025/12/17 17:01:00   Bucket[16]: Key=清華附小, DocCount=272
DEBUG 2025/12/17 17:01:00   Bucket[17]: Key=後壁高中, DocCount=262
DEBUG 2025/12/17 17:01:00   Bucket[18]: Key=新港藝高, DocCount=262
DEBUG 2025/12/17 17:01:00   Bucket[19]: Key=南投特教, DocCount=250
DEBUG 2025/12/17 17:01:00   Bucket[20]: Key=蘇澳海事, DocCount=241
DEBUG 2025/12/17 17:01:00   Bucket[21]: Key=嘉義高商, DocCount=238
DEBUG 2025/12/17 17:01:00   Bucket[22]: Key=內埔農工, DocCount=235
DEBUG 2025/12/17 17:01:00   Bucket[23]: Key=關山工商, DocCount=233
DEBUG 2025/12/17 17:01:00   Bucket[24]: Key=竹南高中, DocCount=221
DEBUG 2025/12/17 17:01:00   Bucket[25]: Key=關西高中, DocCount=212
DEBUG 2025/12/17 17:01:00   Bucket[26]: Key=花蓮高商, DocCount=205
DEBUG 2025/12/17 17:01:00   Bucket[27]: Key=玉里高中, DocCount=203
DEBUG 2025/12/17 17:01:00   Bucket[28]: Key=師大附中高中部, DocCount=196
DEBUG 2025/12/17 17:01:00   Bucket[29]: Key=屏東女中, DocCount=186
DEBUG 2025/12/17 17:01:00   Bucket[30]: Key=新營高工, DocCount=184
DEBUG 2025/12/17 17:01:00   Bucket[31]: Key=苗栗農工, DocCount=174
DEBUG 2025/12/17 17:01:00   Bucket[32]: Key=新竹高工, DocCount=160
DEBUG 2025/12/17 17:01:00   Bucket[33]: Key=東港海事, DocCount=148
DEBUG 2025/12/17 17:01:00   Bucket[34]: Key=員林家商, DocCount=139
DEBUG 2025/12/17 17:01:00   Bucket[35]: Key=新化高工, DocCount=138
DEBUG 2025/12/17 17:01:00   Bucket[36]: Key=虎尾高中, DocCount=138
DEBUG 2025/12/17 17:01:00   Bucket[37]: Key=斗六家商, DocCount=137
DEBUG 2025/12/17 17:01:00   Bucket[38]: Key=北斗家商, DocCount=135
DEBUG 2025/12/17 17:01:00   Bucket[39]: Key=苗栗高中, DocCount=131
DEBUG 2025/12/17 17:01:00   Bucket[40]: Key=南大附中, DocCount=130
DEBUG 2025/12/17 17:01:00   Bucket[41]: Key=白河商工, DocCount=130
DEBUG 2025/12/17 17:01:00   Bucket[42]: Key=屏東高工, DocCount=127
DEBUG 2025/12/17 17:01:00   Bucket[43]: Key=彰化高商, DocCount=113
DEBUG 2025/12/17 17:01:00   Bucket[44]: Key=新營高中, DocCount=105
DEBUG 2025/12/17 17:01:00   Bucket[45]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:01:00   Bucket[46]: Key=屏科實中, DocCount=98
DEBUG 2025/12/17 17:01:00   Bucket[47]: Key=彰師附工, DocCount=98
DEBUG 2025/12/17 17:01:00   Bucket[48]: Key=成功商水, DocCount=92
DEBUG 2025/12/17 17:01:00   Bucket[49]: Key=埔里高工, DocCount=90
DEBUG 2025/12/17 17:01:00   Bucket[50]: Key=南投高中, DocCount=89
DEBUG 2025/12/17 17:01:00   Bucket[51]: Key=成大南工, DocCount=86
DEBUG 2025/12/17 17:01:00   Bucket[52]: Key=政大附中, DocCount=84
DEBUG 2025/12/17 17:01:00   Bucket[53]: Key=羅東高商, DocCount=83
DEBUG 2025/12/17 17:01:00   Bucket[54]: Key=苗栗高商, DocCount=83
DEBUG 2025/12/17 17:01:00   Bucket[55]: Key=嘉義家職, DocCount=82
DEBUG 2025/12/17 17:01:00   Bucket[56]: Key=中興高中, DocCount=81
DEBUG 2025/12/17 17:01:00   Bucket[57]: Key=南大附小, DocCount=79
DEBUG 2025/12/17 17:01:00   Bucket[58]: Key=曾文農工, DocCount=75
DEBUG 2025/12/17 17:01:00   Bucket[59]: Key=北教大實小, DocCount=74
DEBUG 2025/12/17 17:01:00   Bucket[60]: Key=員林高中, DocCount=74
DEBUG 2025/12/17 17:01:00   Bucket[61]: Key=善化高中, DocCount=71
DEBUG 2025/12/17 17:01:00   Bucket[62]: Key=秀水高工, DocCount=70
DEBUG 2025/12/17 17:01:00   Bucket[63]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:01:00   Bucket[64]: Key=鳳山高中, DocCount=64
DEBUG 2025/12/17 17:01:00   Bucket[65]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[66]: Key=員林農工, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[67]: Key=東石高中, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[68]: Key=水里商工, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[69]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[70]: Key=嘉義高中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[71]: Key=屏東高中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[72]: Key=蘭陽女中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[73]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 17:01:00   Bucket[74]: Key=花蓮高工, DocCount=59
DEBUG 2025/12/17 17:01:00   Bucket[75]: Key=新竹高商, DocCount=57
DEBUG 2025/12/17 17:01:00   Bucket[76]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:01:00   Bucket[77]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[78]: Key=旗山農工, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[79]: Key=澎湖海事, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[80]: Key=北港農工, DocCount=55
DEBUG 2025/12/17 17:01:00   Bucket[81]: Key=雲林特教, DocCount=55
DEBUG 2025/12/17 17:01:00   Bucket[82]: Key=草屯商工, DocCount=52
DEBUG 2025/12/17 17:01:00   Bucket[83]: Key=溪湖高中, DocCount=51
DEBUG 2025/12/17 17:01:00   Bucket[84]: Key=新竹高中, DocCount=49
DEBUG 2025/12/17 17:01:00   Bucket[85]: Key=臺東高商, DocCount=49
DEBUG 2025/12/17 17:01:00   Bucket[86]: Key=二林工商, DocCount=48
DEBUG 2025/12/17 17:01:00   Bucket[87]: Key=海大附中, DocCount=47
DEBUG 2025/12/17 17:01:00   Bucket[88]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 17:01:00   Bucket[89]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:01:00   Bucket[90]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:01:00   Bucket[91]: Key=宜蘭高中, DocCount=43
DEBUG 2025/12/17 17:01:00   Bucket[92]: Key=基隆商工, DocCount=42
DEBUG 2025/12/17 17:01:00   Bucket[93]: Key=花蓮高中, DocCount=42
DEBUG 2025/12/17 17:01:00   Bucket[94]: Key=永靖高工, DocCount=41
DEBUG 2025/12/17 17:01:00   Bucket[95]: Key=高餐大附中, DocCount=41
DEBUG 2025/12/17 17:01:00   Bucket[96]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:01:00   Bucket[97]: Key=頭城家商, DocCount=40
DEBUG 2025/12/17 17:01:00   Bucket[98]: Key=師大附中國中部, DocCount=39
DEBUG 2025/12/17 17:01:00   Bucket[99]: Key=華南高商, DocCount=39
DEBUG 2025/12/17 17:01:00 ========================================================
INFO 2025/12/17 17:01:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
ERROR 2025/12/17 17:01:06 Invalid password for user admin
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:01:07 Processing 15 offline devices
INFO 2025/12/17 17:01:07 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:01:07 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:01:07 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:01:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:01:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:01:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:01:07 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:01:07 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:01:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:01:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:01:08 ✅ Successfully flushed 34/34 history records to TimescaleDB
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:01:13 ✅ Successfully flushed 4/4 history records to TimescaleDB
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:32 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:01:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:01:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:01:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:01:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:01:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:01:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:01:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:01:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:01:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:01:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:01:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:01:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:01:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:01:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:01:45 ES Alert Created [critical][performance]: Memory usage critical: 91.37% (threshold: 90.00%)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:01:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:01:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:01:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:01:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:02:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:02:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:02:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:02:00 Field: school_name.keyword
DEBUG 2025/12/17 17:02:00 Time From: 2025-12-17T17:01:00.000+08:00
DEBUG 2025/12/17 17:02:00 Time To: 2025-12-17T17:02:00.000+08:00
DEBUG 2025/12/17 17:02:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:01:00.000+08:00",
					"lte": "2025-12-17T17:02:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:02:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:02:00 ES Response IsError: false
DEBUG 2025/12/17 17:02:00 ES Response Body:
{"took":57,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":414,"buckets":[{"key":"黑快馬主機","doc_count":2695},{"key":"花蓮高農","doc_count":800},{"key":"新竹女中","doc_count":597},{"key":"金門農工","doc_count":584},{"key":"仁愛高農","doc_count":564},{"key":"華僑高中","doc_count":518},{"key":"金門高中","doc_count":495},{"key":"南投高商","doc_count":428},{"key":"旗美高中","doc_count":398},{"key":"竹北高中","doc_count":379},{"key":"北門高中","doc_count":373},{"key":"臺東高中","doc_count":370},{"key":"玉里高中","doc_count":343},{"key":"宜蘭高商","doc_count":327},{"key":"興大附中","doc_count":311},{"key":"關西高中","doc_count":281},{"key":"嘉義高商","doc_count":265},{"key":"竹南高中","doc_count":257},{"key":"新港藝高","doc_count":249},{"key":"蘇澳海事","doc_count":246},{"key":"花蓮高商","doc_count":238},{"key":"內埔農工","doc_count":232},{"key":"中大壢中","doc_count":223},{"key":"清華附小","doc_count":219},{"key":"新竹高中","doc_count":211},{"key":"斗六家商","doc_count":207},{"key":"南投特教","doc_count":204},{"key":"關山工商","doc_count":197},{"key":"後壁高中","doc_count":195},{"key":"苗栗農工","doc_count":195},{"key":"新化高中","doc_count":175},{"key":"屏東女中","doc_count":156},{"key":"南大附中","doc_count":146},{"key":"員林家商","doc_count":146},{"key":"東港海事","doc_count":139},{"key":"虎尾高中","doc_count":130},{"key":"新化高工","doc_count":123},{"key":"臺南一中","doc_count":118},{"key":"南投高中","doc_count":115},{"key":"彰師附工","doc_count":112},{"key":"新營高工","doc_count":112},{"key":"新竹高工","doc_count":110},{"key":"南大附聰","doc_count":104},{"key":"臺東高商","doc_count":104},{"key":"水里商工","doc_count":99},{"key":"秀水高工","doc_count":99},{"key":"苗栗高商","doc_count":97},{"key":"草屯商工","doc_count":95},{"key":"北斗家商","doc_count":93},{"key":"員林高中","doc_count":91},{"key":"成大南工","doc_count":91},{"key":"臺東女中","doc_count":91},{"key":"中興高中","doc_count":86},{"key":"嘉義家職","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"埔里高工","doc_count":77},{"key":"屏科實中","doc_count":74},{"key":"北港農工","doc_count":71},{"key":"土庫商工","doc_count":71},{"key":"暨大附中","doc_count":71},{"key":"師大附中高中部","doc_count":67},{"key":"政大附中","doc_count":66},{"key":"苗栗高中","doc_count":66},{"key":"屏東高中","doc_count":62},{"key":"白河商工","doc_count":61},{"key":"宜蘭高中","doc_count":60},{"key":"嘉科實中","doc_count":58},{"key":"永靖高工","doc_count":55},{"key":"潮州高中","doc_count":55},{"key":"興大附農","doc_count":55},{"key":"二林工商","doc_count":54},{"key":"嘉義高中","doc_count":54},{"key":"佳冬高農","doc_count":53},{"key":"北教大實小","doc_count":52},{"key":"鳳山高中","doc_count":52},{"key":"花蓮高工","doc_count":51},{"key":"北港高中","doc_count":50},{"key":"臺南高商","doc_count":49},{"key":"善化高中","doc_count":48},{"key":"頭城家商","doc_count":48},{"key":"華南高商","doc_count":47},{"key":"員林農工","doc_count":46},{"key":"蘭陽女中","doc_count":46},{"key":"屏東高工","doc_count":45},{"key":"彰化高商","doc_count":45},{"key":"高餐大附中","doc_count":45},{"key":"玉井工商","doc_count":44},{"key":"溪湖高中","doc_count":43},{"key":"旗山農工","doc_count":42},{"key":"竹山高中","doc_count":41},{"key":"曾文農工","doc_count":40},{"key":"羅東高工","doc_count":40},{"key":"基隆商工","doc_count":39},{"key":"海大附中","doc_count":38},{"key":"雲林特教","doc_count":38},{"key":"東石高中","doc_count":37},{"key":"澎湖海事","doc_count":36},{"key":"崇實高工","doc_count":35},{"key":"羅東高商","doc_count":35},{"key":"南大附小","doc_count":34}]}}}
DEBUG 2025/12/17 17:02:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:02:00   Bucket[0]: Key=黑快馬主機, DocCount=2695
DEBUG 2025/12/17 17:02:00   Bucket[1]: Key=花蓮高農, DocCount=800
DEBUG 2025/12/17 17:02:00   Bucket[2]: Key=新竹女中, DocCount=597
DEBUG 2025/12/17 17:02:00   Bucket[3]: Key=金門農工, DocCount=584
DEBUG 2025/12/17 17:02:00   Bucket[4]: Key=仁愛高農, DocCount=564
DEBUG 2025/12/17 17:02:00   Bucket[5]: Key=華僑高中, DocCount=518
DEBUG 2025/12/17 17:02:00   Bucket[6]: Key=金門高中, DocCount=495
DEBUG 2025/12/17 17:02:00   Bucket[7]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:02:00   Bucket[8]: Key=旗美高中, DocCount=398
DEBUG 2025/12/17 17:02:00   Bucket[9]: Key=竹北高中, DocCount=379
DEBUG 2025/12/17 17:02:00   Bucket[10]: Key=北門高中, DocCount=373
DEBUG 2025/12/17 17:02:00   Bucket[11]: Key=臺東高中, DocCount=370
DEBUG 2025/12/17 17:02:00   Bucket[12]: Key=玉里高中, DocCount=343
DEBUG 2025/12/17 17:02:00   Bucket[13]: Key=宜蘭高商, DocCount=327
DEBUG 2025/12/17 17:02:00   Bucket[14]: Key=興大附中, DocCount=311
DEBUG 2025/12/17 17:02:00   Bucket[15]: Key=關西高中, DocCount=281
DEBUG 2025/12/17 17:02:00   Bucket[16]: Key=嘉義高商, DocCount=265
DEBUG 2025/12/17 17:02:00   Bucket[17]: Key=竹南高中, DocCount=257
DEBUG 2025/12/17 17:02:00   Bucket[18]: Key=新港藝高, DocCount=249
DEBUG 2025/12/17 17:02:00   Bucket[19]: Key=蘇澳海事, DocCount=246
DEBUG 2025/12/17 17:02:00   Bucket[20]: Key=花蓮高商, DocCount=238
DEBUG 2025/12/17 17:02:00   Bucket[21]: Key=內埔農工, DocCount=232
DEBUG 2025/12/17 17:02:00   Bucket[22]: Key=中大壢中, DocCount=223
DEBUG 2025/12/17 17:02:00   Bucket[23]: Key=清華附小, DocCount=219
DEBUG 2025/12/17 17:02:00   Bucket[24]: Key=新竹高中, DocCount=211
DEBUG 2025/12/17 17:02:00   Bucket[25]: Key=斗六家商, DocCount=207
DEBUG 2025/12/17 17:02:00   Bucket[26]: Key=南投特教, DocCount=204
DEBUG 2025/12/17 17:02:00   Bucket[27]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 17:02:00   Bucket[28]: Key=後壁高中, DocCount=195
DEBUG 2025/12/17 17:02:00   Bucket[29]: Key=苗栗農工, DocCount=195
DEBUG 2025/12/17 17:02:00   Bucket[30]: Key=新化高中, DocCount=175
DEBUG 2025/12/17 17:02:00   Bucket[31]: Key=屏東女中, DocCount=156
DEBUG 2025/12/17 17:02:00   Bucket[32]: Key=南大附中, DocCount=146
DEBUG 2025/12/17 17:02:00   Bucket[33]: Key=員林家商, DocCount=146
DEBUG 2025/12/17 17:02:00   Bucket[34]: Key=東港海事, DocCount=139
DEBUG 2025/12/17 17:02:00   Bucket[35]: Key=虎尾高中, DocCount=130
DEBUG 2025/12/17 17:02:00   Bucket[36]: Key=新化高工, DocCount=123
DEBUG 2025/12/17 17:02:00   Bucket[37]: Key=臺南一中, DocCount=118
DEBUG 2025/12/17 17:02:00   Bucket[38]: Key=南投高中, DocCount=115
DEBUG 2025/12/17 17:02:00   Bucket[39]: Key=彰師附工, DocCount=112
DEBUG 2025/12/17 17:02:00   Bucket[40]: Key=新營高工, DocCount=112
DEBUG 2025/12/17 17:02:00   Bucket[41]: Key=新竹高工, DocCount=110
DEBUG 2025/12/17 17:02:00   Bucket[42]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:02:00   Bucket[43]: Key=臺東高商, DocCount=104
DEBUG 2025/12/17 17:02:00   Bucket[44]: Key=水里商工, DocCount=99
DEBUG 2025/12/17 17:02:00   Bucket[45]: Key=秀水高工, DocCount=99
DEBUG 2025/12/17 17:02:00   Bucket[46]: Key=苗栗高商, DocCount=97
DEBUG 2025/12/17 17:02:00   Bucket[47]: Key=草屯商工, DocCount=95
DEBUG 2025/12/17 17:02:00   Bucket[48]: Key=北斗家商, DocCount=93
DEBUG 2025/12/17 17:02:00   Bucket[49]: Key=員林高中, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[50]: Key=成大南工, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[51]: Key=臺東女中, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[52]: Key=中興高中, DocCount=86
DEBUG 2025/12/17 17:02:00   Bucket[53]: Key=嘉義家職, DocCount=82
DEBUG 2025/12/17 17:02:00   Bucket[54]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 17:02:00   Bucket[55]: Key=埔里高工, DocCount=77
DEBUG 2025/12/17 17:02:00   Bucket[56]: Key=屏科實中, DocCount=74
DEBUG 2025/12/17 17:02:00   Bucket[57]: Key=北港農工, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[58]: Key=土庫商工, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[59]: Key=暨大附中, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[60]: Key=師大附中高中部, DocCount=67
DEBUG 2025/12/17 17:02:00   Bucket[61]: Key=政大附中, DocCount=66
DEBUG 2025/12/17 17:02:00   Bucket[62]: Key=苗栗高中, DocCount=66
DEBUG 2025/12/17 17:02:00   Bucket[63]: Key=屏東高中, DocCount=62
DEBUG 2025/12/17 17:02:00   Bucket[64]: Key=白河商工, DocCount=61
DEBUG 2025/12/17 17:02:00   Bucket[65]: Key=宜蘭高中, DocCount=60
DEBUG 2025/12/17 17:02:00   Bucket[66]: Key=嘉科實中, DocCount=58
DEBUG 2025/12/17 17:02:00   Bucket[67]: Key=永靖高工, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[68]: Key=潮州高中, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[69]: Key=興大附農, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[70]: Key=二林工商, DocCount=54
DEBUG 2025/12/17 17:02:00   Bucket[71]: Key=嘉義高中, DocCount=54
DEBUG 2025/12/17 17:02:00   Bucket[72]: Key=佳冬高農, DocCount=53
DEBUG 2025/12/17 17:02:00   Bucket[73]: Key=北教大實小, DocCount=52
DEBUG 2025/12/17 17:02:00   Bucket[74]: Key=鳳山高中, DocCount=52
DEBUG 2025/12/17 17:02:00   Bucket[75]: Key=花蓮高工, DocCount=51
DEBUG 2025/12/17 17:02:00   Bucket[76]: Key=北港高中, DocCount=50
DEBUG 2025/12/17 17:02:00   Bucket[77]: Key=臺南高商, DocCount=49
DEBUG 2025/12/17 17:02:00   Bucket[78]: Key=善化高中, DocCount=48
DEBUG 2025/12/17 17:02:00   Bucket[79]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 17:02:00   Bucket[80]: Key=華南高商, DocCount=47
DEBUG 2025/12/17 17:02:00   Bucket[81]: Key=員林農工, DocCount=46
DEBUG 2025/12/17 17:02:00   Bucket[82]: Key=蘭陽女中, DocCount=46
DEBUG 2025/12/17 17:02:00   Bucket[83]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[84]: Key=彰化高商, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[85]: Key=高餐大附中, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[86]: Key=玉井工商, DocCount=44
DEBUG 2025/12/17 17:02:00   Bucket[87]: Key=溪湖高中, DocCount=43
DEBUG 2025/12/17 17:02:00   Bucket[88]: Key=旗山農工, DocCount=42
DEBUG 2025/12/17 17:02:00   Bucket[89]: Key=竹山高中, DocCount=41
DEBUG 2025/12/17 17:02:00   Bucket[90]: Key=曾文農工, DocCount=40
DEBUG 2025/12/17 17:02:00   Bucket[91]: Key=羅東高工, DocCount=40
DEBUG 2025/12/17 17:02:00   Bucket[92]: Key=基隆商工, DocCount=39
DEBUG 2025/12/17 17:02:00   Bucket[93]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:02:00   Bucket[94]: Key=雲林特教, DocCount=38
DEBUG 2025/12/17 17:02:00   Bucket[95]: Key=東石高中, DocCount=37
DEBUG 2025/12/17 17:02:00   Bucket[96]: Key=澎湖海事, DocCount=36
DEBUG 2025/12/17 17:02:00   Bucket[97]: Key=崇實高工, DocCount=35
DEBUG 2025/12/17 17:02:00   Bucket[98]: Key=羅東高商, DocCount=35
DEBUG 2025/12/17 17:02:00   Bucket[99]: Key=南大附小, DocCount=34
DEBUG 2025/12/17 17:02:00 ========================================================
INFO 2025/12/17 17:02:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:02:08 ✅ Successfully flushed 11/11 history records to TimescaleDB
INFO 2025/12/17 17:02:10 Processing 15 offline devices
INFO 2025/12/17 17:02:10 Creating history record for offline device: 新竹高商
INFO 2025/12/17 17:02:10 About to add history to batch for device: 新竹高商
INFO 2025/12/17 17:02:10 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 17:02:10 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:02:10 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:02:11 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:02:11 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:02:11 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:02:11 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:02:11 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:02:11 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:02:11 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:02:11 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:02:12 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:02:12 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:02:12 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:02:12 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:02:12 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:02:12 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:02:12 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:02:12 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:02:12 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:02:13 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:02:13 ✅ Successfully flushed 33/33 history records to TimescaleDB
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:02:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:02:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:02:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:02:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:02:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:02:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:02:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:02:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:02:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:02:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:02:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:02:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:02:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:02:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:02:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.01% (threshold: 90.00%)
WARN 2025/12/17 17:02:45 ES Alert Created [high][capacity]: Disk usage high: 93.31% (threshold: 85.00%)
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:02:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:02:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:02:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
INFO 2025/12/17 17:02:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:02:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:02:48 ES monitor check completed for: NTU, status: warning
WARN 2025/12/17 17:02:59 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:03:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:03:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:03:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:03:00 Field: school_name.keyword
DEBUG 2025/12/17 17:03:00 Time From: 2025-12-17T17:02:00.000+08:00
DEBUG 2025/12/17 17:03:00 Time To: 2025-12-17T17:03:00.000+08:00
DEBUG 2025/12/17 17:03:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:02:00.000+08:00",
					"lte": "2025-12-17T17:03:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:03:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:03:00 ES Response IsError: false
DEBUG 2025/12/17 17:03:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":92,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":445,"buckets":[{"key":"黑快馬主機","doc_count":2443},{"key":"花蓮高農","doc_count":759},{"key":"新竹女中","doc_count":758},{"key":"金門農工","doc_count":592},{"key":"仁愛高農","doc_count":576},{"key":"竹北高中","doc_count":501},{"key":"華僑高中","doc_count":486},{"key":"玉里高中","doc_count":461},{"key":"金門高中","doc_count":448},{"key":"南投高商","doc_count":428},{"key":"旗美高中","doc_count":418},{"key":"北門高中","doc_count":408},{"key":"宜蘭高商","doc_count":383},{"key":"新港藝高","doc_count":347},{"key":"臺東高中","doc_count":328},{"key":"興大附中","doc_count":301},{"key":"清華附小","doc_count":295},{"key":"竹南高中","doc_count":285},{"key":"蘇澳海事","doc_count":282},{"key":"內埔農工","doc_count":275},{"key":"中大壢中","doc_count":274},{"key":"嘉義高商","doc_count":265},{"key":"關西高中","doc_count":253},{"key":"苗栗農工","doc_count":238},{"key":"北斗家商","doc_count":232},{"key":"花蓮高商","doc_count":232},{"key":"關山工商","doc_count":217},{"key":"南投特教","doc_count":207},{"key":"後壁高中","doc_count":203},{"key":"草屯商工","doc_count":177},{"key":"成大南工","doc_count":176},{"key":"新化高中","doc_count":176},{"key":"東港海事","doc_count":176},{"key":"屏東女中","doc_count":175},{"key":"斗六家商","doc_count":154},{"key":"花蓮高中","doc_count":153},{"key":"虎尾高中","doc_count":146},{"key":"新化高工","doc_count":142},{"key":"彰師附工","doc_count":136},{"key":"政大附中","doc_count":136},{"key":"南大附中","doc_count":131},{"key":"南大附聰","doc_count":131},{"key":"新營高工","doc_count":130},{"key":"員林家商","doc_count":126},{"key":"員林高中","doc_count":125},{"key":"新竹高中","doc_count":125},{"key":"北港高中","doc_count":111},{"key":"新竹高工","doc_count":111},{"key":"師大附中高中部","doc_count":92},{"key":"員林農工","doc_count":91},{"key":"永靖高工","doc_count":84},{"key":"南投高中","doc_count":83},{"key":"北教大實小","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"苗栗高商","doc_count":80},{"key":"北港農工","doc_count":72},{"key":"嘉科實中","doc_count":72},{"key":"新營高中","doc_count":72},{"key":"新竹高商","doc_count":72},{"key":"頭城家商","doc_count":72},{"key":"竹山高中","doc_count":71},{"key":"屏科實中","doc_count":70},{"key":"臺東高商","doc_count":69},{"key":"宜蘭高中","doc_count":66},{"key":"彰化高商","doc_count":65},{"key":"二林工商","doc_count":63},{"key":"基隆商工","doc_count":59},{"key":"埔里高工","doc_count":58},{"key":"崇實高工","doc_count":58},{"key":"羅東高商","doc_count":58},{"key":"暨大附中","doc_count":53},{"key":"雲林特教","doc_count":53},{"key":"中興高中","doc_count":52},{"key":"海大附中","doc_count":52},{"key":"水里商工","doc_count":51},{"key":"花蓮高工","doc_count":51},{"key":"蘭陽女中","doc_count":51},{"key":"東石高中","doc_count":49},{"key":"苗栗高中","doc_count":49},{"key":"臺南一中","doc_count":48},{"key":"羅東高工","doc_count":47},{"key":"臺南高商","doc_count":47},{"key":"華南高商","doc_count":46},{"key":"興大附農","doc_count":44},{"key":"鳳山高中","doc_count":44},{"key":"臺東女中","doc_count":42},{"key":"曾文農工","doc_count":41},{"key":"竹東高中","doc_count":41},{"key":"嘉義特教","doc_count":40},{"key":"花蓮特教","doc_count":40},{"key":"嘉義高中","doc_count":39},{"key":"白河商工","doc_count":39},{"key":"南大附小","doc_count":38},{"key":"嘉義高工","doc_count":38},{"key":"土庫商工","doc_count":37},{"key":"屏東高中","doc_count":37},{"key":"旗山農工","doc_count":37},{"key":"潮州高中","doc_count":37},{"key":"屏東特教","doc_count":36},{"key":"嘉義家職","doc_count":35}]}}}
DEBUG 2025/12/17 17:03:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:03:00   Bucket[0]: Key=黑快馬主機, DocCount=2443
DEBUG 2025/12/17 17:03:00   Bucket[1]: Key=花蓮高農, DocCount=759
DEBUG 2025/12/17 17:03:00   Bucket[2]: Key=新竹女中, DocCount=758
DEBUG 2025/12/17 17:03:00   Bucket[3]: Key=金門農工, DocCount=592
DEBUG 2025/12/17 17:03:00   Bucket[4]: Key=仁愛高農, DocCount=576
DEBUG 2025/12/17 17:03:00   Bucket[5]: Key=竹北高中, DocCount=501
DEBUG 2025/12/17 17:03:00   Bucket[6]: Key=華僑高中, DocCount=486
DEBUG 2025/12/17 17:03:00   Bucket[7]: Key=玉里高中, DocCount=461
DEBUG 2025/12/17 17:03:00   Bucket[8]: Key=金門高中, DocCount=448
DEBUG 2025/12/17 17:03:00   Bucket[9]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:03:00   Bucket[10]: Key=旗美高中, DocCount=418
DEBUG 2025/12/17 17:03:00   Bucket[11]: Key=北門高中, DocCount=408
DEBUG 2025/12/17 17:03:00   Bucket[12]: Key=宜蘭高商, DocCount=383
DEBUG 2025/12/17 17:03:00   Bucket[13]: Key=新港藝高, DocCount=347
DEBUG 2025/12/17 17:03:00   Bucket[14]: Key=臺東高中, DocCount=328
DEBUG 2025/12/17 17:03:00   Bucket[15]: Key=興大附中, DocCount=301
DEBUG 2025/12/17 17:03:00   Bucket[16]: Key=清華附小, DocCount=295
DEBUG 2025/12/17 17:03:00   Bucket[17]: Key=竹南高中, DocCount=285
DEBUG 2025/12/17 17:03:00   Bucket[18]: Key=蘇澳海事, DocCount=282
DEBUG 2025/12/17 17:03:00   Bucket[19]: Key=內埔農工, DocCount=275
DEBUG 2025/12/17 17:03:00   Bucket[20]: Key=中大壢中, DocCount=274
DEBUG 2025/12/17 17:03:00   Bucket[21]: Key=嘉義高商, DocCount=265
DEBUG 2025/12/17 17:03:00   Bucket[22]: Key=關西高中, DocCount=253
DEBUG 2025/12/17 17:03:00   Bucket[23]: Key=苗栗農工, DocCount=238
DEBUG 2025/12/17 17:03:00   Bucket[24]: Key=北斗家商, DocCount=232
DEBUG 2025/12/17 17:03:00   Bucket[25]: Key=花蓮高商, DocCount=232
DEBUG 2025/12/17 17:03:00   Bucket[26]: Key=關山工商, DocCount=217
DEBUG 2025/12/17 17:03:00   Bucket[27]: Key=南投特教, DocCount=207
DEBUG 2025/12/17 17:03:00   Bucket[28]: Key=後壁高中, DocCount=203
DEBUG 2025/12/17 17:03:00   Bucket[29]: Key=草屯商工, DocCount=177
DEBUG 2025/12/17 17:03:00   Bucket[30]: Key=成大南工, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[31]: Key=新化高中, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[32]: Key=東港海事, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[33]: Key=屏東女中, DocCount=175
DEBUG 2025/12/17 17:03:00   Bucket[34]: Key=斗六家商, DocCount=154
DEBUG 2025/12/17 17:03:00   Bucket[35]: Key=花蓮高中, DocCount=153
DEBUG 2025/12/17 17:03:00   Bucket[36]: Key=虎尾高中, DocCount=146
DEBUG 2025/12/17 17:03:00   Bucket[37]: Key=新化高工, DocCount=142
DEBUG 2025/12/17 17:03:00   Bucket[38]: Key=彰師附工, DocCount=136
DEBUG 2025/12/17 17:03:00   Bucket[39]: Key=政大附中, DocCount=136
DEBUG 2025/12/17 17:03:00   Bucket[40]: Key=南大附中, DocCount=131
DEBUG 2025/12/17 17:03:00   Bucket[41]: Key=南大附聰, DocCount=131
DEBUG 2025/12/17 17:03:00   Bucket[42]: Key=新營高工, DocCount=130
DEBUG 2025/12/17 17:03:00   Bucket[43]: Key=員林家商, DocCount=126
DEBUG 2025/12/17 17:03:00   Bucket[44]: Key=員林高中, DocCount=125
DEBUG 2025/12/17 17:03:00   Bucket[45]: Key=新竹高中, DocCount=125
DEBUG 2025/12/17 17:03:00   Bucket[46]: Key=北港高中, DocCount=111
DEBUG 2025/12/17 17:03:00   Bucket[47]: Key=新竹高工, DocCount=111
DEBUG 2025/12/17 17:03:00   Bucket[48]: Key=師大附中高中部, DocCount=92
DEBUG 2025/12/17 17:03:00   Bucket[49]: Key=員林農工, DocCount=91
DEBUG 2025/12/17 17:03:00   Bucket[50]: Key=永靖高工, DocCount=84
DEBUG 2025/12/17 17:03:00   Bucket[51]: Key=南投高中, DocCount=83
DEBUG 2025/12/17 17:03:00   Bucket[52]: Key=北教大實小, DocCount=82
DEBUG 2025/12/17 17:03:00   Bucket[53]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:03:00   Bucket[54]: Key=苗栗高商, DocCount=80
DEBUG 2025/12/17 17:03:00   Bucket[55]: Key=北港農工, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[56]: Key=嘉科實中, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[57]: Key=新營高中, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[58]: Key=新竹高商, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[59]: Key=頭城家商, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[60]: Key=竹山高中, DocCount=71
DEBUG 2025/12/17 17:03:00   Bucket[61]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:03:00   Bucket[62]: Key=臺東高商, DocCount=69
DEBUG 2025/12/17 17:03:00   Bucket[63]: Key=宜蘭高中, DocCount=66
DEBUG 2025/12/17 17:03:00   Bucket[64]: Key=彰化高商, DocCount=65
DEBUG 2025/12/17 17:03:00   Bucket[65]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 17:03:00   Bucket[66]: Key=基隆商工, DocCount=59
DEBUG 2025/12/17 17:03:00   Bucket[67]: Key=埔里高工, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[68]: Key=崇實高工, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[69]: Key=羅東高商, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[70]: Key=暨大附中, DocCount=53
DEBUG 2025/12/17 17:03:00   Bucket[71]: Key=雲林特教, DocCount=53
DEBUG 2025/12/17 17:03:00   Bucket[72]: Key=中興高中, DocCount=52
DEBUG 2025/12/17 17:03:00   Bucket[73]: Key=海大附中, DocCount=52
DEBUG 2025/12/17 17:03:00   Bucket[74]: Key=水里商工, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[75]: Key=花蓮高工, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[76]: Key=蘭陽女中, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[77]: Key=東石高中, DocCount=49
DEBUG 2025/12/17 17:03:00   Bucket[78]: Key=苗栗高中, DocCount=49
DEBUG 2025/12/17 17:03:00   Bucket[79]: Key=臺南一中, DocCount=48
DEBUG 2025/12/17 17:03:00   Bucket[80]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:03:00   Bucket[81]: Key=臺南高商, DocCount=47
DEBUG 2025/12/17 17:03:00   Bucket[82]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:03:00   Bucket[83]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 17:03:00   Bucket[84]: Key=鳳山高中, DocCount=44
DEBUG 2025/12/17 17:03:00   Bucket[85]: Key=臺東女中, DocCount=42
DEBUG 2025/12/17 17:03:00   Bucket[86]: Key=曾文農工, DocCount=41
DEBUG 2025/12/17 17:03:00   Bucket[87]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 17:03:00   Bucket[88]: Key=嘉義特教, DocCount=40
DEBUG 2025/12/17 17:03:00   Bucket[89]: Key=花蓮特教, DocCount=40
DEBUG 2025/12/17 17:03:00   Bucket[90]: Key=嘉義高中, DocCount=39
DEBUG 2025/12/17 17:03:00   Bucket[91]: Key=白河商工, DocCount=39
DEBUG 2025/12/17 17:03:00   Bucket[92]: Key=南大附小, DocCount=38
DEBUG 2025/12/17 17:03:00   Bucket[93]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:03:00   Bucket[94]: Key=土庫商工, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[95]: Key=屏東高中, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[96]: Key=旗山農工, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[97]: Key=潮州高中, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[98]: Key=屏東特教, DocCount=36
DEBUG 2025/12/17 17:03:00   Bucket[99]: Key=嘉義家職, DocCount=35
DEBUG 2025/12/17 17:03:00 ========================================================
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:03:08 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:03:09 Processing 15 offline devices
INFO 2025/12/17 17:03:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:03:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:03:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:03:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:03:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:03:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:03:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:03:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:03:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:03:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:03:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:03:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:03:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:03:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:03:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:03:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:03:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:03:10 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:03:10 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:03:13 ✅ Successfully flushed 36/36 history records to TimescaleDB
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:03:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:03:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:03:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:03:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:03:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:03:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:03:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:03:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:03:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:03:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:03:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:03:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:03:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:03:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:03:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:03:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.90% (threshold: 80.00%)
INFO 2025/12/17 17:03:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:03:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:03:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:03:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:03:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:04:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:04:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:04:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:04:00 Field: school_name.keyword
DEBUG 2025/12/17 17:04:00 Time From: 2025-12-17T17:03:00.000+08:00
DEBUG 2025/12/17 17:04:00 Time To: 2025-12-17T17:04:00.000+08:00
DEBUG 2025/12/17 17:04:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:03:00.000+08:00",
					"lte": "2025-12-17T17:04:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:04:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:04:00 ES Response IsError: false
DEBUG 2025/12/17 17:04:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":493,"buckets":[{"key":"黑快馬主機","doc_count":2134},{"key":"花蓮高農","doc_count":779},{"key":"金門農工","doc_count":656},{"key":"新竹女中","doc_count":625},{"key":"仁愛高農","doc_count":612},{"key":"竹北高中","doc_count":532},{"key":"金門高中","doc_count":518},{"key":"華僑高中","doc_count":469},{"key":"宜蘭高商","doc_count":426},{"key":"中大壢中","doc_count":388},{"key":"北門高中","doc_count":388},{"key":"南投高商","doc_count":364},{"key":"旗美高中","doc_count":364},{"key":"內埔農工","doc_count":358},{"key":"臺東高中","doc_count":349},{"key":"玉里高中","doc_count":343},{"key":"新港藝高","doc_count":334},{"key":"清華附小","doc_count":300},{"key":"興大附中","doc_count":299},{"key":"嘉義高商","doc_count":287},{"key":"蘇澳海事","doc_count":279},{"key":"屏東女中","doc_count":273},{"key":"竹南高中","doc_count":273},{"key":"關西高中","doc_count":259},{"key":"花蓮高商","doc_count":249},{"key":"南投特教","doc_count":212},{"key":"後壁高中","doc_count":205},{"key":"斗六家商","doc_count":194},{"key":"苗栗農工","doc_count":193},{"key":"關山工商","doc_count":190},{"key":"彰師附工","doc_count":180},{"key":"北港農工","doc_count":176},{"key":"南大附中","doc_count":165},{"key":"東港海事","doc_count":154},{"key":"成大南工","doc_count":151},{"key":"虎尾高中","doc_count":147},{"key":"員林家商","doc_count":141},{"key":"新營高工","doc_count":136},{"key":"師大附中高中部","doc_count":134},{"key":"嘉科實中","doc_count":125},{"key":"新化高中","doc_count":125},{"key":"新化高工","doc_count":122},{"key":"員林高中","doc_count":120},{"key":"南大附聰","doc_count":118},{"key":"花蓮高中","doc_count":110},{"key":"水里商工","doc_count":107},{"key":"北斗家商","doc_count":104},{"key":"潮州高中","doc_count":100},{"key":"東石高中","doc_count":89},{"key":"蘭陽女中","doc_count":89},{"key":"臺南一中","doc_count":88},{"key":"北教大實小","doc_count":84},{"key":"北港高中","doc_count":84},{"key":"宜蘭高中","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"暨大附中","doc_count":80},{"key":"曾文農工","doc_count":79},{"key":"屏科實中","doc_count":75},{"key":"新竹高工","doc_count":75},{"key":"苗栗高商","doc_count":74},{"key":"興大附農","doc_count":73},{"key":"草屯商工","doc_count":72},{"key":"員林農工","doc_count":71},{"key":"嘉義家職","doc_count":71},{"key":"屏東高中","doc_count":71},{"key":"南大附小","doc_count":70},{"key":"屏東高工","doc_count":67},{"key":"白河商工","doc_count":67},{"key":"二林工商","doc_count":66},{"key":"成功商水","doc_count":66},{"key":"嘉義特教","doc_count":65},{"key":"旗山農工","doc_count":64},{"key":"中興高中","doc_count":63},{"key":"屏北高中","doc_count":60},{"key":"新竹高商","doc_count":60},{"key":"永靖高工","doc_count":59},{"key":"埔里高工","doc_count":57},{"key":"南投高中","doc_count":55},{"key":"彰化高商","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"花蓮高工","doc_count":54},{"key":"臺南高商","doc_count":52},{"key":"溪湖高中","doc_count":48},{"key":"鳳山高中","doc_count":48},{"key":"善化高中","doc_count":47},{"key":"屏東特教","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"新豐高中","doc_count":46},{"key":"嘉義高中","doc_count":45},{"key":"崇實高工","doc_count":45},{"key":"竹東高中","doc_count":45},{"key":"秀水高工","doc_count":44},{"key":"臺東高商","doc_count":44},{"key":"雲林特教","doc_count":44},{"key":"高餐大附中","doc_count":44},{"key":"嘉義高工","doc_count":43},{"key":"澎湖海事","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"羅東高商","doc_count":41}]}}}
DEBUG 2025/12/17 17:04:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:04:00   Bucket[0]: Key=黑快馬主機, DocCount=2134
DEBUG 2025/12/17 17:04:00   Bucket[1]: Key=花蓮高農, DocCount=779
DEBUG 2025/12/17 17:04:00   Bucket[2]: Key=金門農工, DocCount=656
DEBUG 2025/12/17 17:04:00   Bucket[3]: Key=新竹女中, DocCount=625
DEBUG 2025/12/17 17:04:00   Bucket[4]: Key=仁愛高農, DocCount=612
DEBUG 2025/12/17 17:04:00   Bucket[5]: Key=竹北高中, DocCount=532
DEBUG 2025/12/17 17:04:00   Bucket[6]: Key=金門高中, DocCount=518
DEBUG 2025/12/17 17:04:00   Bucket[7]: Key=華僑高中, DocCount=469
DEBUG 2025/12/17 17:04:00   Bucket[8]: Key=宜蘭高商, DocCount=426
DEBUG 2025/12/17 17:04:00   Bucket[9]: Key=中大壢中, DocCount=388
DEBUG 2025/12/17 17:04:00   Bucket[10]: Key=北門高中, DocCount=388
DEBUG 2025/12/17 17:04:00   Bucket[11]: Key=南投高商, DocCount=364
DEBUG 2025/12/17 17:04:00   Bucket[12]: Key=旗美高中, DocCount=364
DEBUG 2025/12/17 17:04:00   Bucket[13]: Key=內埔農工, DocCount=358
DEBUG 2025/12/17 17:04:00   Bucket[14]: Key=臺東高中, DocCount=349
DEBUG 2025/12/17 17:04:00   Bucket[15]: Key=玉里高中, DocCount=343
DEBUG 2025/12/17 17:04:00   Bucket[16]: Key=新港藝高, DocCount=334
DEBUG 2025/12/17 17:04:00   Bucket[17]: Key=清華附小, DocCount=300
DEBUG 2025/12/17 17:04:00   Bucket[18]: Key=興大附中, DocCount=299
DEBUG 2025/12/17 17:04:00   Bucket[19]: Key=嘉義高商, DocCount=287
DEBUG 2025/12/17 17:04:00   Bucket[20]: Key=蘇澳海事, DocCount=279
DEBUG 2025/12/17 17:04:00   Bucket[21]: Key=屏東女中, DocCount=273
DEBUG 2025/12/17 17:04:00   Bucket[22]: Key=竹南高中, DocCount=273
DEBUG 2025/12/17 17:04:00   Bucket[23]: Key=關西高中, DocCount=259
DEBUG 2025/12/17 17:04:00   Bucket[24]: Key=花蓮高商, DocCount=249
DEBUG 2025/12/17 17:04:00   Bucket[25]: Key=南投特教, DocCount=212
DEBUG 2025/12/17 17:04:00   Bucket[26]: Key=後壁高中, DocCount=205
DEBUG 2025/12/17 17:04:00   Bucket[27]: Key=斗六家商, DocCount=194
DEBUG 2025/12/17 17:04:00   Bucket[28]: Key=苗栗農工, DocCount=193
DEBUG 2025/12/17 17:04:00   Bucket[29]: Key=關山工商, DocCount=190
DEBUG 2025/12/17 17:04:00   Bucket[30]: Key=彰師附工, DocCount=180
DEBUG 2025/12/17 17:04:00   Bucket[31]: Key=北港農工, DocCount=176
DEBUG 2025/12/17 17:04:00   Bucket[32]: Key=南大附中, DocCount=165
DEBUG 2025/12/17 17:04:00   Bucket[33]: Key=東港海事, DocCount=154
DEBUG 2025/12/17 17:04:00   Bucket[34]: Key=成大南工, DocCount=151
DEBUG 2025/12/17 17:04:00   Bucket[35]: Key=虎尾高中, DocCount=147
DEBUG 2025/12/17 17:04:00   Bucket[36]: Key=員林家商, DocCount=141
DEBUG 2025/12/17 17:04:00   Bucket[37]: Key=新營高工, DocCount=136
DEBUG 2025/12/17 17:04:00   Bucket[38]: Key=師大附中高中部, DocCount=134
DEBUG 2025/12/17 17:04:00   Bucket[39]: Key=嘉科實中, DocCount=125
DEBUG 2025/12/17 17:04:00   Bucket[40]: Key=新化高中, DocCount=125
DEBUG 2025/12/17 17:04:00   Bucket[41]: Key=新化高工, DocCount=122
DEBUG 2025/12/17 17:04:00   Bucket[42]: Key=員林高中, DocCount=120
DEBUG 2025/12/17 17:04:00   Bucket[43]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:04:00   Bucket[44]: Key=花蓮高中, DocCount=110
DEBUG 2025/12/17 17:04:00   Bucket[45]: Key=水里商工, DocCount=107
DEBUG 2025/12/17 17:04:00   Bucket[46]: Key=北斗家商, DocCount=104
DEBUG 2025/12/17 17:04:00   Bucket[47]: Key=潮州高中, DocCount=100
DEBUG 2025/12/17 17:04:00   Bucket[48]: Key=東石高中, DocCount=89
DEBUG 2025/12/17 17:04:00   Bucket[49]: Key=蘭陽女中, DocCount=89
DEBUG 2025/12/17 17:04:00   Bucket[50]: Key=臺南一中, DocCount=88
DEBUG 2025/12/17 17:04:00   Bucket[51]: Key=北教大實小, DocCount=84
DEBUG 2025/12/17 17:04:00   Bucket[52]: Key=北港高中, DocCount=84
DEBUG 2025/12/17 17:04:00   Bucket[53]: Key=宜蘭高中, DocCount=82
DEBUG 2025/12/17 17:04:00   Bucket[54]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 17:04:00   Bucket[55]: Key=暨大附中, DocCount=80
DEBUG 2025/12/17 17:04:00   Bucket[56]: Key=曾文農工, DocCount=79
DEBUG 2025/12/17 17:04:00   Bucket[57]: Key=屏科實中, DocCount=75
DEBUG 2025/12/17 17:04:00   Bucket[58]: Key=新竹高工, DocCount=75
DEBUG 2025/12/17 17:04:00   Bucket[59]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:04:00   Bucket[60]: Key=興大附農, DocCount=73
DEBUG 2025/12/17 17:04:00   Bucket[61]: Key=草屯商工, DocCount=72
DEBUG 2025/12/17 17:04:00   Bucket[62]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[63]: Key=嘉義家職, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[64]: Key=屏東高中, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[65]: Key=南大附小, DocCount=70
DEBUG 2025/12/17 17:04:00   Bucket[66]: Key=屏東高工, DocCount=67
DEBUG 2025/12/17 17:04:00   Bucket[67]: Key=白河商工, DocCount=67
DEBUG 2025/12/17 17:04:00   Bucket[68]: Key=二林工商, DocCount=66
DEBUG 2025/12/17 17:04:00   Bucket[69]: Key=成功商水, DocCount=66
DEBUG 2025/12/17 17:04:00   Bucket[70]: Key=嘉義特教, DocCount=65
DEBUG 2025/12/17 17:04:00   Bucket[71]: Key=旗山農工, DocCount=64
DEBUG 2025/12/17 17:04:00   Bucket[72]: Key=中興高中, DocCount=63
DEBUG 2025/12/17 17:04:00   Bucket[73]: Key=屏北高中, DocCount=60
DEBUG 2025/12/17 17:04:00   Bucket[74]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:04:00   Bucket[75]: Key=永靖高工, DocCount=59
DEBUG 2025/12/17 17:04:00   Bucket[76]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:04:00   Bucket[77]: Key=南投高中, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[78]: Key=彰化高商, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[79]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[80]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[81]: Key=花蓮高工, DocCount=54
DEBUG 2025/12/17 17:04:00   Bucket[82]: Key=臺南高商, DocCount=52
DEBUG 2025/12/17 17:04:00   Bucket[83]: Key=溪湖高中, DocCount=48
DEBUG 2025/12/17 17:04:00   Bucket[84]: Key=鳳山高中, DocCount=48
DEBUG 2025/12/17 17:04:00   Bucket[85]: Key=善化高中, DocCount=47
DEBUG 2025/12/17 17:04:00   Bucket[86]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:04:00   Bucket[87]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:04:00   Bucket[88]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:04:00   Bucket[89]: Key=嘉義高中, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[90]: Key=崇實高工, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[91]: Key=竹東高中, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[92]: Key=秀水高工, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[93]: Key=臺東高商, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[94]: Key=雲林特教, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[95]: Key=高餐大附中, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[96]: Key=嘉義高工, DocCount=43
DEBUG 2025/12/17 17:04:00   Bucket[97]: Key=澎湖海事, DocCount=42
DEBUG 2025/12/17 17:04:00   Bucket[98]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:04:00   Bucket[99]: Key=羅東高商, DocCount=41
DEBUG 2025/12/17 17:04:00 ========================================================
INFO 2025/12/17 17:04:03 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:04:07 Processing 15 offline devices
INFO 2025/12/17 17:04:07 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:04:07 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:04:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:04:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:04:07 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:04:07 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:04:07 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:04:07 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:04:07 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:04:07 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:04:07 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:04:07 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:04:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:04:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:04:08 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:04:08 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:04:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:04:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:04:08 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:04:08 ✅ Successfully flushed 33/33 history records to TimescaleDB
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:04:13 ✅ Successfully flushed 1/1 history records to TimescaleDB
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:04:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:04:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:04:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:04:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:04:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:04:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:04:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:04:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:04:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:04:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:04:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:04:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:04:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:04:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:04:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:04:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:04:45 ES Alert Created [high][performance]: Memory usage high: 87.04% (threshold: 80.00%)
INFO 2025/12/17 17:04:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.15% (threshold: 85.00%)
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:04:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:04:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:04:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:04:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:05:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:05:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:05:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:05:00 Field: school_name.keyword
DEBUG 2025/12/17 17:05:00 Time From: 2025-12-17T17:04:00.000+08:00
DEBUG 2025/12/17 17:05:00 Time To: 2025-12-17T17:05:00.000+08:00
DEBUG 2025/12/17 17:05:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:04:00.000+08:00",
					"lte": "2025-12-17T17:05:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:05:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:05:00 ES Response IsError: false
DEBUG 2025/12/17 17:05:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":465,"buckets":[{"key":"黑快馬主機","doc_count":2499},{"key":"花蓮高農","doc_count":791},{"key":"金門農工","doc_count":623},{"key":"仁愛高農","doc_count":576},{"key":"新竹女中","doc_count":533},{"key":"華僑高中","doc_count":510},{"key":"金門高中","doc_count":481},{"key":"竹北高中","doc_count":429},{"key":"北門高中","doc_count":388},{"key":"玉里高中","doc_count":359},{"key":"宜蘭高商","doc_count":350},{"key":"旗美高中","doc_count":320},{"key":"南投高商","doc_count":319},{"key":"中大壢中","doc_count":314},{"key":"新港藝高","doc_count":313},{"key":"臺東高中","doc_count":311},{"key":"內埔農工","doc_count":294},{"key":"師大附中高中部","doc_count":289},{"key":"蘇澳海事","doc_count":288},{"key":"嘉義高商","doc_count":277},{"key":"竹南高中","doc_count":259},{"key":"興大附中","doc_count":248},{"key":"清華附小","doc_count":236},{"key":"關西高中","doc_count":229},{"key":"後壁高中","doc_count":207},{"key":"斗六家商","doc_count":205},{"key":"花蓮高商","doc_count":201},{"key":"東港海事","doc_count":194},{"key":"關山工商","doc_count":194},{"key":"南投特教","doc_count":186},{"key":"苗栗農工","doc_count":184},{"key":"屏東女中","doc_count":161},{"key":"成大南工","doc_count":157},{"key":"新化高工","doc_count":155},{"key":"虎尾高中","doc_count":141},{"key":"屏東高工","doc_count":140},{"key":"新營高工","doc_count":132},{"key":"南大附聰","doc_count":122},{"key":"員林家商","doc_count":122},{"key":"南大附中","doc_count":117},{"key":"北港農工","doc_count":109},{"key":"澎湖海事","doc_count":109},{"key":"北斗家商","doc_count":107},{"key":"中興高中","doc_count":105},{"key":"新竹高工","doc_count":97},{"key":"彰師附工","doc_count":95},{"key":"苗栗高商","doc_count":94},{"key":"鳳山高中","doc_count":93},{"key":"新化高中","doc_count":91},{"key":"彰化高商","doc_count":90},{"key":"新營高中","doc_count":90},{"key":"二林工商","doc_count":88},{"key":"屏科實中","doc_count":86},{"key":"員林高中","doc_count":85},{"key":"北港高中","doc_count":84},{"key":"曾文農工","doc_count":84},{"key":"北教大實小","doc_count":82},{"key":"嘉義高中","doc_count":82},{"key":"臺東高商","doc_count":82},{"key":"旗山農工","doc_count":73},{"key":"嘉科實中","doc_count":69},{"key":"嘉義家職","doc_count":69},{"key":"永靖高工","doc_count":68},{"key":"苗栗高中","doc_count":68},{"key":"員林農工","doc_count":66},{"key":"蘭陽女中","doc_count":65},{"key":"南投高中","doc_count":64},{"key":"興大附農","doc_count":62},{"key":"新竹高中","doc_count":61},{"key":"竹東高中","doc_count":61},{"key":"臺南一中","doc_count":61},{"key":"新竹高商","doc_count":60},{"key":"羅東高商","doc_count":59},{"key":"海大附中","doc_count":57},{"key":"宜蘭高中","doc_count":56},{"key":"屏東高中","doc_count":55},{"key":"潮州高中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"埔里高工","doc_count":52},{"key":"基隆商工","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"南大附小","doc_count":51},{"key":"水里商工","doc_count":51},{"key":"花蓮高中","doc_count":48},{"key":"臺東女中","doc_count":47},{"key":"土庫商工","doc_count":45},{"key":"屏北高中","doc_count":45},{"key":"屏東特教","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"嘉義高工","doc_count":44},{"key":"高餐大附中","doc_count":41},{"key":"善化高中","doc_count":40},{"key":"東石高中","doc_count":40},{"key":"臺南高商","doc_count":39},{"key":"雲林特教","doc_count":39},{"key":"白河商工","doc_count":38},{"key":"羅東高工","doc_count":36},{"key":"溪湖高中","doc_count":35},{"key":"玉井工商","doc_count":35},{"key":"政大附中","doc_count":34}]}}}
DEBUG 2025/12/17 17:05:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:05:00   Bucket[0]: Key=黑快馬主機, DocCount=2499
DEBUG 2025/12/17 17:05:00   Bucket[1]: Key=花蓮高農, DocCount=791
DEBUG 2025/12/17 17:05:00   Bucket[2]: Key=金門農工, DocCount=623
DEBUG 2025/12/17 17:05:00   Bucket[3]: Key=仁愛高農, DocCount=576
DEBUG 2025/12/17 17:05:00   Bucket[4]: Key=新竹女中, DocCount=533
DEBUG 2025/12/17 17:05:00   Bucket[5]: Key=華僑高中, DocCount=510
DEBUG 2025/12/17 17:05:00   Bucket[6]: Key=金門高中, DocCount=481
DEBUG 2025/12/17 17:05:00   Bucket[7]: Key=竹北高中, DocCount=429
DEBUG 2025/12/17 17:05:00   Bucket[8]: Key=北門高中, DocCount=388
DEBUG 2025/12/17 17:05:00   Bucket[9]: Key=玉里高中, DocCount=359
DEBUG 2025/12/17 17:05:00   Bucket[10]: Key=宜蘭高商, DocCount=350
DEBUG 2025/12/17 17:05:00   Bucket[11]: Key=旗美高中, DocCount=320
DEBUG 2025/12/17 17:05:00   Bucket[12]: Key=南投高商, DocCount=319
DEBUG 2025/12/17 17:05:00   Bucket[13]: Key=中大壢中, DocCount=314
DEBUG 2025/12/17 17:05:00   Bucket[14]: Key=新港藝高, DocCount=313
DEBUG 2025/12/17 17:05:00   Bucket[15]: Key=臺東高中, DocCount=311
DEBUG 2025/12/17 17:05:00   Bucket[16]: Key=內埔農工, DocCount=294
DEBUG 2025/12/17 17:05:00   Bucket[17]: Key=師大附中高中部, DocCount=289
DEBUG 2025/12/17 17:05:00   Bucket[18]: Key=蘇澳海事, DocCount=288
DEBUG 2025/12/17 17:05:00   Bucket[19]: Key=嘉義高商, DocCount=277
DEBUG 2025/12/17 17:05:00   Bucket[20]: Key=竹南高中, DocCount=259
DEBUG 2025/12/17 17:05:00   Bucket[21]: Key=興大附中, DocCount=248
DEBUG 2025/12/17 17:05:00   Bucket[22]: Key=清華附小, DocCount=236
DEBUG 2025/12/17 17:05:00   Bucket[23]: Key=關西高中, DocCount=229
DEBUG 2025/12/17 17:05:00   Bucket[24]: Key=後壁高中, DocCount=207
DEBUG 2025/12/17 17:05:00   Bucket[25]: Key=斗六家商, DocCount=205
DEBUG 2025/12/17 17:05:00   Bucket[26]: Key=花蓮高商, DocCount=201
DEBUG 2025/12/17 17:05:00   Bucket[27]: Key=東港海事, DocCount=194
DEBUG 2025/12/17 17:05:00   Bucket[28]: Key=關山工商, DocCount=194
DEBUG 2025/12/17 17:05:00   Bucket[29]: Key=南投特教, DocCount=186
DEBUG 2025/12/17 17:05:00   Bucket[30]: Key=苗栗農工, DocCount=184
DEBUG 2025/12/17 17:05:00   Bucket[31]: Key=屏東女中, DocCount=161
DEBUG 2025/12/17 17:05:00   Bucket[32]: Key=成大南工, DocCount=157
DEBUG 2025/12/17 17:05:00   Bucket[33]: Key=新化高工, DocCount=155
DEBUG 2025/12/17 17:05:00   Bucket[34]: Key=虎尾高中, DocCount=141
DEBUG 2025/12/17 17:05:00   Bucket[35]: Key=屏東高工, DocCount=140
DEBUG 2025/12/17 17:05:00   Bucket[36]: Key=新營高工, DocCount=132
DEBUG 2025/12/17 17:05:00   Bucket[37]: Key=南大附聰, DocCount=122
DEBUG 2025/12/17 17:05:00   Bucket[38]: Key=員林家商, DocCount=122
DEBUG 2025/12/17 17:05:00   Bucket[39]: Key=南大附中, DocCount=117
DEBUG 2025/12/17 17:05:00   Bucket[40]: Key=北港農工, DocCount=109
DEBUG 2025/12/17 17:05:00   Bucket[41]: Key=澎湖海事, DocCount=109
DEBUG 2025/12/17 17:05:00   Bucket[42]: Key=北斗家商, DocCount=107
DEBUG 2025/12/17 17:05:00   Bucket[43]: Key=中興高中, DocCount=105
DEBUG 2025/12/17 17:05:00   Bucket[44]: Key=新竹高工, DocCount=97
DEBUG 2025/12/17 17:05:00   Bucket[45]: Key=彰師附工, DocCount=95
DEBUG 2025/12/17 17:05:00   Bucket[46]: Key=苗栗高商, DocCount=94
DEBUG 2025/12/17 17:05:00   Bucket[47]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:05:00   Bucket[48]: Key=新化高中, DocCount=91
DEBUG 2025/12/17 17:05:00   Bucket[49]: Key=彰化高商, DocCount=90
DEBUG 2025/12/17 17:05:00   Bucket[50]: Key=新營高中, DocCount=90
DEBUG 2025/12/17 17:05:00   Bucket[51]: Key=二林工商, DocCount=88
DEBUG 2025/12/17 17:05:00   Bucket[52]: Key=屏科實中, DocCount=86
DEBUG 2025/12/17 17:05:00   Bucket[53]: Key=員林高中, DocCount=85
DEBUG 2025/12/17 17:05:00   Bucket[54]: Key=北港高中, DocCount=84
DEBUG 2025/12/17 17:05:00   Bucket[55]: Key=曾文農工, DocCount=84
DEBUG 2025/12/17 17:05:00   Bucket[56]: Key=北教大實小, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[57]: Key=嘉義高中, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[58]: Key=臺東高商, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[59]: Key=旗山農工, DocCount=73
DEBUG 2025/12/17 17:05:00   Bucket[60]: Key=嘉科實中, DocCount=69
DEBUG 2025/12/17 17:05:00   Bucket[61]: Key=嘉義家職, DocCount=69
DEBUG 2025/12/17 17:05:00   Bucket[62]: Key=永靖高工, DocCount=68
DEBUG 2025/12/17 17:05:00   Bucket[63]: Key=苗栗高中, DocCount=68
DEBUG 2025/12/17 17:05:00   Bucket[64]: Key=員林農工, DocCount=66
DEBUG 2025/12/17 17:05:00   Bucket[65]: Key=蘭陽女中, DocCount=65
DEBUG 2025/12/17 17:05:00   Bucket[66]: Key=南投高中, DocCount=64
DEBUG 2025/12/17 17:05:00   Bucket[67]: Key=興大附農, DocCount=62
DEBUG 2025/12/17 17:05:00   Bucket[68]: Key=新竹高中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[69]: Key=竹東高中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[70]: Key=臺南一中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[71]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:05:00   Bucket[72]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:05:00   Bucket[73]: Key=海大附中, DocCount=57
DEBUG 2025/12/17 17:05:00   Bucket[74]: Key=宜蘭高中, DocCount=56
DEBUG 2025/12/17 17:05:00   Bucket[75]: Key=屏東高中, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[76]: Key=潮州高中, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[77]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[78]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[79]: Key=基隆商工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[80]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[81]: Key=南大附小, DocCount=51
DEBUG 2025/12/17 17:05:00   Bucket[82]: Key=水里商工, DocCount=51
DEBUG 2025/12/17 17:05:00   Bucket[83]: Key=花蓮高中, DocCount=48
DEBUG 2025/12/17 17:05:00   Bucket[84]: Key=臺東女中, DocCount=47
DEBUG 2025/12/17 17:05:00   Bucket[85]: Key=土庫商工, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[86]: Key=屏北高中, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[87]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[88]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[89]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 17:05:00   Bucket[90]: Key=高餐大附中, DocCount=41
DEBUG 2025/12/17 17:05:00   Bucket[91]: Key=善化高中, DocCount=40
DEBUG 2025/12/17 17:05:00   Bucket[92]: Key=東石高中, DocCount=40
DEBUG 2025/12/17 17:05:00   Bucket[93]: Key=臺南高商, DocCount=39
DEBUG 2025/12/17 17:05:00   Bucket[94]: Key=雲林特教, DocCount=39
DEBUG 2025/12/17 17:05:00   Bucket[95]: Key=白河商工, DocCount=38
DEBUG 2025/12/17 17:05:00   Bucket[96]: Key=羅東高工, DocCount=36
DEBUG 2025/12/17 17:05:00   Bucket[97]: Key=溪湖高中, DocCount=35
DEBUG 2025/12/17 17:05:00   Bucket[98]: Key=玉井工商, DocCount=35
DEBUG 2025/12/17 17:05:00   Bucket[99]: Key=政大附中, DocCount=34
DEBUG 2025/12/17 17:05:00 ========================================================
INFO 2025/12/17 17:05:03 ✅ Successfully flushed 3/3 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:05:08 ✅ Successfully flushed 17/17 history records to TimescaleDB
INFO 2025/12/17 17:05:09 Processing 15 offline devices
INFO 2025/12/17 17:05:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:05:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:05:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:05:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:05:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:05:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:05:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:05:09 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:05:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:05:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:05:10 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:05:10 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:05:10 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:05:13 ✅ Successfully flushed 29/29 history records to TimescaleDB
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:05:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:05:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:05:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:05:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:05:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:05:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:05:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:05:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:05:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:05:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:05:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:05:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.63% (threshold: 80.00%)
INFO 2025/12/17 17:05:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.15% (threshold: 85.00%)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:05:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:05:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:05:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:05:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:06:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:06:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:06:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:06:00 Field: school_name.keyword
DEBUG 2025/12/17 17:06:00 Time From: 2025-12-17T17:05:00.000+08:00
DEBUG 2025/12/17 17:06:00 Time To: 2025-12-17T17:06:00.000+08:00
DEBUG 2025/12/17 17:06:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:05:00.000+08:00",
					"lte": "2025-12-17T17:06:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:06:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:06:00 ES Response IsError: false
DEBUG 2025/12/17 17:06:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":450,"buckets":[{"key":"黑快馬主機","doc_count":1689},{"key":"花蓮高農","doc_count":752},{"key":"新竹女中","doc_count":571},{"key":"仁愛高農","doc_count":559},{"key":"金門農工","doc_count":529},{"key":"金門高中","doc_count":528},{"key":"華僑高中","doc_count":458},{"key":"玉里高中","doc_count":446},{"key":"南投高商","doc_count":423},{"key":"竹北高中","doc_count":409},{"key":"北門高中","doc_count":382},{"key":"宜蘭高商","doc_count":368},{"key":"臺東高中","doc_count":351},{"key":"花蓮高商","doc_count":344},{"key":"新港藝高","doc_count":343},{"key":"旗美高中","doc_count":325},{"key":"興大附中","doc_count":280},{"key":"內埔農工","doc_count":271},{"key":"蘇澳海事","doc_count":265},{"key":"關西高中","doc_count":245},{"key":"關山工商","doc_count":238},{"key":"中大壢中","doc_count":232},{"key":"清華附小","doc_count":228},{"key":"屏東女中","doc_count":226},{"key":"竹南高中","doc_count":225},{"key":"後壁高中","doc_count":224},{"key":"斗六家商","doc_count":190},{"key":"南投特教","doc_count":173},{"key":"苗栗農工","doc_count":164},{"key":"虎尾高中","doc_count":160},{"key":"東港海事","doc_count":153},{"key":"彰化高商","doc_count":150},{"key":"新竹高工","doc_count":149},{"key":"師大附中高中部","doc_count":144},{"key":"嘉義高商","doc_count":140},{"key":"新化高中","doc_count":139},{"key":"新營高工","doc_count":139},{"key":"員林家商","doc_count":131},{"key":"南大附聰","doc_count":120},{"key":"二林工商","doc_count":119},{"key":"宜蘭高中","doc_count":112},{"key":"成大南工","doc_count":111},{"key":"中興高中","doc_count":110},{"key":"彰師附工","doc_count":109},{"key":"鳳山高中","doc_count":108},{"key":"新化高工","doc_count":105},{"key":"北教大實小","doc_count":96},{"key":"屏科實中","doc_count":85},{"key":"土庫商工","doc_count":84},{"key":"員林農工","doc_count":82},{"key":"羅東高工","doc_count":82},{"key":"興大附農","doc_count":82},{"key":"屏東高中","doc_count":81},{"key":"嘉科實中","doc_count":79},{"key":"南大附小","doc_count":75},{"key":"北港高中","doc_count":72},{"key":"南大附中","doc_count":72},{"key":"北斗家商","doc_count":71},{"key":"嘉義高中","doc_count":71},{"key":"新營高中","doc_count":71},{"key":"高餐大附中","doc_count":70},{"key":"苗栗高商","doc_count":69},{"key":"曾文農工","doc_count":67},{"key":"臺南高商","doc_count":66},{"key":"南投高中","doc_count":64},{"key":"澎湖海事","doc_count":64},{"key":"頭城家商","doc_count":63},{"key":"北港農工","doc_count":62},{"key":"花蓮高工","doc_count":62},{"key":"潮州高中","doc_count":61},{"key":"永靖高工","doc_count":59},{"key":"臺東高商","doc_count":59},{"key":"暨大附中","doc_count":56},{"key":"華南高商","doc_count":54},{"key":"屏東高工","doc_count":53},{"key":"政大附中","doc_count":52},{"key":"臺南一中","doc_count":52},{"key":"竹東高中","doc_count":51},{"key":"苗栗高中","doc_count":51},{"key":"埔里高工","doc_count":50},{"key":"秀水高工","doc_count":50},{"key":"員林高中","doc_count":49},{"key":"草屯商工","doc_count":49},{"key":"嘉義高工","doc_count":48},{"key":"東石高中","doc_count":48},{"key":"水里商工","doc_count":48},{"key":"海大附中","doc_count":48},{"key":"白河商工","doc_count":47},{"key":"屏東特教","doc_count":45},{"key":"基隆商工","doc_count":42},{"key":"溪湖高中","doc_count":42},{"key":"雲林特教","doc_count":42},{"key":"師大附中國中部","doc_count":41},{"key":"羅東高商","doc_count":41},{"key":"家齊高中","doc_count":40},{"key":"佳冬高農","doc_count":39},{"key":"嘉義特教","doc_count":39},{"key":"新豐高中","doc_count":37},{"key":"玉井工商","doc_count":37},{"key":"新竹高商","doc_count":35}]}}}
DEBUG 2025/12/17 17:06:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:06:00   Bucket[0]: Key=黑快馬主機, DocCount=1689
DEBUG 2025/12/17 17:06:00   Bucket[1]: Key=花蓮高農, DocCount=752
DEBUG 2025/12/17 17:06:00   Bucket[2]: Key=新竹女中, DocCount=571
DEBUG 2025/12/17 17:06:00   Bucket[3]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:06:00   Bucket[4]: Key=金門農工, DocCount=529
DEBUG 2025/12/17 17:06:00   Bucket[5]: Key=金門高中, DocCount=528
DEBUG 2025/12/17 17:06:00   Bucket[6]: Key=華僑高中, DocCount=458
DEBUG 2025/12/17 17:06:00   Bucket[7]: Key=玉里高中, DocCount=446
DEBUG 2025/12/17 17:06:00   Bucket[8]: Key=南投高商, DocCount=423
DEBUG 2025/12/17 17:06:00   Bucket[9]: Key=竹北高中, DocCount=409
DEBUG 2025/12/17 17:06:00   Bucket[10]: Key=北門高中, DocCount=382
DEBUG 2025/12/17 17:06:00   Bucket[11]: Key=宜蘭高商, DocCount=368
DEBUG 2025/12/17 17:06:00   Bucket[12]: Key=臺東高中, DocCount=351
DEBUG 2025/12/17 17:06:00   Bucket[13]: Key=花蓮高商, DocCount=344
DEBUG 2025/12/17 17:06:00   Bucket[14]: Key=新港藝高, DocCount=343
DEBUG 2025/12/17 17:06:00   Bucket[15]: Key=旗美高中, DocCount=325
DEBUG 2025/12/17 17:06:00   Bucket[16]: Key=興大附中, DocCount=280
DEBUG 2025/12/17 17:06:00   Bucket[17]: Key=內埔農工, DocCount=271
DEBUG 2025/12/17 17:06:00   Bucket[18]: Key=蘇澳海事, DocCount=265
DEBUG 2025/12/17 17:06:00   Bucket[19]: Key=關西高中, DocCount=245
DEBUG 2025/12/17 17:06:00   Bucket[20]: Key=關山工商, DocCount=238
DEBUG 2025/12/17 17:06:00   Bucket[21]: Key=中大壢中, DocCount=232
DEBUG 2025/12/17 17:06:00   Bucket[22]: Key=清華附小, DocCount=228
DEBUG 2025/12/17 17:06:00   Bucket[23]: Key=屏東女中, DocCount=226
DEBUG 2025/12/17 17:06:00   Bucket[24]: Key=竹南高中, DocCount=225
DEBUG 2025/12/17 17:06:00   Bucket[25]: Key=後壁高中, DocCount=224
DEBUG 2025/12/17 17:06:00   Bucket[26]: Key=斗六家商, DocCount=190
DEBUG 2025/12/17 17:06:00   Bucket[27]: Key=南投特教, DocCount=173
DEBUG 2025/12/17 17:06:00   Bucket[28]: Key=苗栗農工, DocCount=164
DEBUG 2025/12/17 17:06:00   Bucket[29]: Key=虎尾高中, DocCount=160
DEBUG 2025/12/17 17:06:00   Bucket[30]: Key=東港海事, DocCount=153
DEBUG 2025/12/17 17:06:00   Bucket[31]: Key=彰化高商, DocCount=150
DEBUG 2025/12/17 17:06:00   Bucket[32]: Key=新竹高工, DocCount=149
DEBUG 2025/12/17 17:06:00   Bucket[33]: Key=師大附中高中部, DocCount=144
DEBUG 2025/12/17 17:06:00   Bucket[34]: Key=嘉義高商, DocCount=140
DEBUG 2025/12/17 17:06:00   Bucket[35]: Key=新化高中, DocCount=139
DEBUG 2025/12/17 17:06:00   Bucket[36]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:06:00   Bucket[37]: Key=員林家商, DocCount=131
DEBUG 2025/12/17 17:06:00   Bucket[38]: Key=南大附聰, DocCount=120
DEBUG 2025/12/17 17:06:00   Bucket[39]: Key=二林工商, DocCount=119
DEBUG 2025/12/17 17:06:00   Bucket[40]: Key=宜蘭高中, DocCount=112
DEBUG 2025/12/17 17:06:00   Bucket[41]: Key=成大南工, DocCount=111
DEBUG 2025/12/17 17:06:00   Bucket[42]: Key=中興高中, DocCount=110
DEBUG 2025/12/17 17:06:00   Bucket[43]: Key=彰師附工, DocCount=109
DEBUG 2025/12/17 17:06:00   Bucket[44]: Key=鳳山高中, DocCount=108
DEBUG 2025/12/17 17:06:00   Bucket[45]: Key=新化高工, DocCount=105
DEBUG 2025/12/17 17:06:00   Bucket[46]: Key=北教大實小, DocCount=96
DEBUG 2025/12/17 17:06:00   Bucket[47]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:06:00   Bucket[48]: Key=土庫商工, DocCount=84
DEBUG 2025/12/17 17:06:00   Bucket[49]: Key=員林農工, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[50]: Key=羅東高工, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[51]: Key=興大附農, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[52]: Key=屏東高中, DocCount=81
DEBUG 2025/12/17 17:06:00   Bucket[53]: Key=嘉科實中, DocCount=79
DEBUG 2025/12/17 17:06:00   Bucket[54]: Key=南大附小, DocCount=75
DEBUG 2025/12/17 17:06:00   Bucket[55]: Key=北港高中, DocCount=72
DEBUG 2025/12/17 17:06:00   Bucket[56]: Key=南大附中, DocCount=72
DEBUG 2025/12/17 17:06:00   Bucket[57]: Key=北斗家商, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[58]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[59]: Key=新營高中, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[60]: Key=高餐大附中, DocCount=70
DEBUG 2025/12/17 17:06:00   Bucket[61]: Key=苗栗高商, DocCount=69
DEBUG 2025/12/17 17:06:00   Bucket[62]: Key=曾文農工, DocCount=67
DEBUG 2025/12/17 17:06:00   Bucket[63]: Key=臺南高商, DocCount=66
DEBUG 2025/12/17 17:06:00   Bucket[64]: Key=南投高中, DocCount=64
DEBUG 2025/12/17 17:06:00   Bucket[65]: Key=澎湖海事, DocCount=64
DEBUG 2025/12/17 17:06:00   Bucket[66]: Key=頭城家商, DocCount=63
DEBUG 2025/12/17 17:06:00   Bucket[67]: Key=北港農工, DocCount=62
DEBUG 2025/12/17 17:06:00   Bucket[68]: Key=花蓮高工, DocCount=62
DEBUG 2025/12/17 17:06:00   Bucket[69]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:06:00   Bucket[70]: Key=永靖高工, DocCount=59
DEBUG 2025/12/17 17:06:00   Bucket[71]: Key=臺東高商, DocCount=59
DEBUG 2025/12/17 17:06:00   Bucket[72]: Key=暨大附中, DocCount=56
DEBUG 2025/12/17 17:06:00   Bucket[73]: Key=華南高商, DocCount=54
DEBUG 2025/12/17 17:06:00   Bucket[74]: Key=屏東高工, DocCount=53
DEBUG 2025/12/17 17:06:00   Bucket[75]: Key=政大附中, DocCount=52
DEBUG 2025/12/17 17:06:00   Bucket[76]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:06:00   Bucket[77]: Key=竹東高中, DocCount=51
DEBUG 2025/12/17 17:06:00   Bucket[78]: Key=苗栗高中, DocCount=51
DEBUG 2025/12/17 17:06:00   Bucket[79]: Key=埔里高工, DocCount=50
DEBUG 2025/12/17 17:06:00   Bucket[80]: Key=秀水高工, DocCount=50
DEBUG 2025/12/17 17:06:00   Bucket[81]: Key=員林高中, DocCount=49
DEBUG 2025/12/17 17:06:00   Bucket[82]: Key=草屯商工, DocCount=49
DEBUG 2025/12/17 17:06:00   Bucket[83]: Key=嘉義高工, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[84]: Key=東石高中, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[85]: Key=水里商工, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[86]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[87]: Key=白河商工, DocCount=47
DEBUG 2025/12/17 17:06:00   Bucket[88]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:06:00   Bucket[89]: Key=基隆商工, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[90]: Key=溪湖高中, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[91]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[92]: Key=師大附中國中部, DocCount=41
DEBUG 2025/12/17 17:06:00   Bucket[93]: Key=羅東高商, DocCount=41
DEBUG 2025/12/17 17:06:00   Bucket[94]: Key=家齊高中, DocCount=40
DEBUG 2025/12/17 17:06:00   Bucket[95]: Key=佳冬高農, DocCount=39
DEBUG 2025/12/17 17:06:00   Bucket[96]: Key=嘉義特教, DocCount=39
DEBUG 2025/12/17 17:06:00   Bucket[97]: Key=新豐高中, DocCount=37
DEBUG 2025/12/17 17:06:00   Bucket[98]: Key=玉井工商, DocCount=37
DEBUG 2025/12/17 17:06:00   Bucket[99]: Key=新竹高商, DocCount=35
DEBUG 2025/12/17 17:06:00 ========================================================
INFO 2025/12/17 17:06:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:06:08 ✅ Successfully flushed 17/17 history records to TimescaleDB
INFO 2025/12/17 17:06:09 Processing 15 offline devices
INFO 2025/12/17 17:06:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:06:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:06:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:06:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:06:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:06:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:06:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:06:13 ✅ Successfully flushed 28/28 history records to TimescaleDB
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:06:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:06:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:06:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:06:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:06:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:06:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:06:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:06:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:06:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:06:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:06:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:06:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:06:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.13% (threshold: 80.00%)
INFO 2025/12/17 17:06:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.19% (threshold: 85.00%)
INFO 2025/12/17 17:06:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:06:45 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:06:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:06:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:07:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:07:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:07:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:07:00 Field: school_name.keyword
DEBUG 2025/12/17 17:07:00 Time From: 2025-12-17T17:06:00.000+08:00
DEBUG 2025/12/17 17:07:00 Time To: 2025-12-17T17:07:00.000+08:00
DEBUG 2025/12/17 17:07:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:06:00.000+08:00",
					"lte": "2025-12-17T17:07:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:07:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:07:00 ES Response IsError: false
DEBUG 2025/12/17 17:07:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":520,"buckets":[{"key":"黑快馬主機","doc_count":1517},{"key":"花蓮高農","doc_count":771},{"key":"仁愛高農","doc_count":605},{"key":"金門農工","doc_count":605},{"key":"新竹女中","doc_count":582},{"key":"南投高商","doc_count":549},{"key":"花蓮高商","doc_count":526},{"key":"金門高中","doc_count":504},{"key":"旗美高中","doc_count":503},{"key":"宜蘭高商","doc_count":418},{"key":"華僑高中","doc_count":415},{"key":"北門高中","doc_count":392},{"key":"竹北高中","doc_count":388},{"key":"中大壢中","doc_count":381},{"key":"新港藝高","doc_count":364},{"key":"內埔農工","doc_count":362},{"key":"臺東高中","doc_count":321},{"key":"蘇澳海事","doc_count":318},{"key":"興大附中","doc_count":304},{"key":"後壁高中","doc_count":294},{"key":"玉里高中","doc_count":250},{"key":"竹南高中","doc_count":248},{"key":"清華附小","doc_count":221},{"key":"關西高中","doc_count":202},{"key":"關山工商","doc_count":201},{"key":"北斗家商","doc_count":195},{"key":"南投特教","doc_count":191},{"key":"斗六家商","doc_count":187},{"key":"屏東女中","doc_count":185},{"key":"東港海事","doc_count":172},{"key":"苗栗農工","doc_count":170},{"key":"成大南工","doc_count":166},{"key":"嘉義高商","doc_count":150},{"key":"新營高工","doc_count":146},{"key":"新化高中","doc_count":135},{"key":"新化高工","doc_count":125},{"key":"員林家商","doc_count":124},{"key":"中興高中","doc_count":122},{"key":"虎尾高中","doc_count":117},{"key":"師大附中高中部","doc_count":111},{"key":"南大附聰","doc_count":105},{"key":"屏科實中","doc_count":103},{"key":"草屯商工","doc_count":97},{"key":"二林工商","doc_count":93},{"key":"北港高中","doc_count":92},{"key":"南投高中","doc_count":92},{"key":"雲林特教","doc_count":91},{"key":"彰師附工","doc_count":90},{"key":"鳳山高中","doc_count":89},{"key":"員林農工","doc_count":86},{"key":"臺南高商","doc_count":86},{"key":"新營高中","doc_count":85},{"key":"新竹高工","doc_count":85},{"key":"花蓮高工","doc_count":83},{"key":"北教大實小","doc_count":79},{"key":"員林高中","doc_count":78},{"key":"南大附中","doc_count":77},{"key":"南大附小","doc_count":74},{"key":"屏東高中","doc_count":74},{"key":"苗栗高商","doc_count":74},{"key":"嘉義家職","doc_count":73},{"key":"嘉義高中","doc_count":71},{"key":"新竹高中","doc_count":70},{"key":"北港農工","doc_count":69},{"key":"嘉科實中","doc_count":69},{"key":"永靖高工","doc_count":67},{"key":"基隆商工","doc_count":64},{"key":"水里商工","doc_count":64},{"key":"政大附中","doc_count":63},{"key":"潮州高中","doc_count":63},{"key":"興大附農","doc_count":63},{"key":"秀水高工","doc_count":62},{"key":"善化高中","doc_count":61},{"key":"新竹特教","doc_count":60},{"key":"頭城家商","doc_count":60},{"key":"彰化高商","doc_count":59},{"key":"臺東高商","doc_count":59},{"key":"崇實高工","doc_count":58},{"key":"羅東高商","doc_count":58},{"key":"嘉義高工","doc_count":57},{"key":"曾文農工","doc_count":56},{"key":"溪湖高中","doc_count":56},{"key":"臺南一中","doc_count":55},{"key":"宜蘭高中","doc_count":51},{"key":"白河商工","doc_count":51},{"key":"竹山高中","doc_count":49},{"key":"暨大附中","doc_count":48},{"key":"澎湖海事","doc_count":46},{"key":"竹東高中","doc_count":46},{"key":"華南高商","doc_count":46},{"key":"嘉義特教","doc_count":45},{"key":"新竹高商","doc_count":45},{"key":"海大附中","doc_count":44},{"key":"羅東高工","doc_count":44},{"key":"花蓮特教","doc_count":42},{"key":"高餐大附中","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"屏東特教","doc_count":41},{"key":"土庫商工","doc_count":40},{"key":"旗山農工","doc_count":40}]}}}
DEBUG 2025/12/17 17:07:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:07:00   Bucket[0]: Key=黑快馬主機, DocCount=1517
DEBUG 2025/12/17 17:07:00   Bucket[1]: Key=花蓮高農, DocCount=771
DEBUG 2025/12/17 17:07:00   Bucket[2]: Key=仁愛高農, DocCount=605
DEBUG 2025/12/17 17:07:00   Bucket[3]: Key=金門農工, DocCount=605
DEBUG 2025/12/17 17:07:00   Bucket[4]: Key=新竹女中, DocCount=582
DEBUG 2025/12/17 17:07:00   Bucket[5]: Key=南投高商, DocCount=549
DEBUG 2025/12/17 17:07:00   Bucket[6]: Key=花蓮高商, DocCount=526
DEBUG 2025/12/17 17:07:00   Bucket[7]: Key=金門高中, DocCount=504
DEBUG 2025/12/17 17:07:00   Bucket[8]: Key=旗美高中, DocCount=503
DEBUG 2025/12/17 17:07:00   Bucket[9]: Key=宜蘭高商, DocCount=418
DEBUG 2025/12/17 17:07:00   Bucket[10]: Key=華僑高中, DocCount=415
DEBUG 2025/12/17 17:07:00   Bucket[11]: Key=北門高中, DocCount=392
DEBUG 2025/12/17 17:07:00   Bucket[12]: Key=竹北高中, DocCount=388
DEBUG 2025/12/17 17:07:00   Bucket[13]: Key=中大壢中, DocCount=381
DEBUG 2025/12/17 17:07:00   Bucket[14]: Key=新港藝高, DocCount=364
DEBUG 2025/12/17 17:07:00   Bucket[15]: Key=內埔農工, DocCount=362
DEBUG 2025/12/17 17:07:00   Bucket[16]: Key=臺東高中, DocCount=321
DEBUG 2025/12/17 17:07:00   Bucket[17]: Key=蘇澳海事, DocCount=318
DEBUG 2025/12/17 17:07:00   Bucket[18]: Key=興大附中, DocCount=304
DEBUG 2025/12/17 17:07:00   Bucket[19]: Key=後壁高中, DocCount=294
DEBUG 2025/12/17 17:07:00   Bucket[20]: Key=玉里高中, DocCount=250
DEBUG 2025/12/17 17:07:00   Bucket[21]: Key=竹南高中, DocCount=248
DEBUG 2025/12/17 17:07:00   Bucket[22]: Key=清華附小, DocCount=221
DEBUG 2025/12/17 17:07:00   Bucket[23]: Key=關西高中, DocCount=202
DEBUG 2025/12/17 17:07:00   Bucket[24]: Key=關山工商, DocCount=201
DEBUG 2025/12/17 17:07:00   Bucket[25]: Key=北斗家商, DocCount=195
DEBUG 2025/12/17 17:07:00   Bucket[26]: Key=南投特教, DocCount=191
DEBUG 2025/12/17 17:07:00   Bucket[27]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:07:00   Bucket[28]: Key=屏東女中, DocCount=185
DEBUG 2025/12/17 17:07:00   Bucket[29]: Key=東港海事, DocCount=172
DEBUG 2025/12/17 17:07:00   Bucket[30]: Key=苗栗農工, DocCount=170
DEBUG 2025/12/17 17:07:00   Bucket[31]: Key=成大南工, DocCount=166
DEBUG 2025/12/17 17:07:00   Bucket[32]: Key=嘉義高商, DocCount=150
DEBUG 2025/12/17 17:07:00   Bucket[33]: Key=新營高工, DocCount=146
DEBUG 2025/12/17 17:07:00   Bucket[34]: Key=新化高中, DocCount=135
DEBUG 2025/12/17 17:07:00   Bucket[35]: Key=新化高工, DocCount=125
DEBUG 2025/12/17 17:07:00   Bucket[36]: Key=員林家商, DocCount=124
DEBUG 2025/12/17 17:07:00   Bucket[37]: Key=中興高中, DocCount=122
DEBUG 2025/12/17 17:07:00   Bucket[38]: Key=虎尾高中, DocCount=117
DEBUG 2025/12/17 17:07:00   Bucket[39]: Key=師大附中高中部, DocCount=111
DEBUG 2025/12/17 17:07:00   Bucket[40]: Key=南大附聰, DocCount=105
DEBUG 2025/12/17 17:07:00   Bucket[41]: Key=屏科實中, DocCount=103
DEBUG 2025/12/17 17:07:00   Bucket[42]: Key=草屯商工, DocCount=97
DEBUG 2025/12/17 17:07:00   Bucket[43]: Key=二林工商, DocCount=93
DEBUG 2025/12/17 17:07:00   Bucket[44]: Key=北港高中, DocCount=92
DEBUG 2025/12/17 17:07:00   Bucket[45]: Key=南投高中, DocCount=92
DEBUG 2025/12/17 17:07:00   Bucket[46]: Key=雲林特教, DocCount=91
DEBUG 2025/12/17 17:07:00   Bucket[47]: Key=彰師附工, DocCount=90
DEBUG 2025/12/17 17:07:00   Bucket[48]: Key=鳳山高中, DocCount=89
DEBUG 2025/12/17 17:07:00   Bucket[49]: Key=員林農工, DocCount=86
DEBUG 2025/12/17 17:07:00   Bucket[50]: Key=臺南高商, DocCount=86
DEBUG 2025/12/17 17:07:00   Bucket[51]: Key=新營高中, DocCount=85
DEBUG 2025/12/17 17:07:00   Bucket[52]: Key=新竹高工, DocCount=85
DEBUG 2025/12/17 17:07:00   Bucket[53]: Key=花蓮高工, DocCount=83
DEBUG 2025/12/17 17:07:00   Bucket[54]: Key=北教大實小, DocCount=79
DEBUG 2025/12/17 17:07:00   Bucket[55]: Key=員林高中, DocCount=78
DEBUG 2025/12/17 17:07:00   Bucket[56]: Key=南大附中, DocCount=77
DEBUG 2025/12/17 17:07:00   Bucket[57]: Key=南大附小, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[58]: Key=屏東高中, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[59]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[60]: Key=嘉義家職, DocCount=73
DEBUG 2025/12/17 17:07:00   Bucket[61]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:07:00   Bucket[62]: Key=新竹高中, DocCount=70
DEBUG 2025/12/17 17:07:00   Bucket[63]: Key=北港農工, DocCount=69
DEBUG 2025/12/17 17:07:00   Bucket[64]: Key=嘉科實中, DocCount=69
DEBUG 2025/12/17 17:07:00   Bucket[65]: Key=永靖高工, DocCount=67
DEBUG 2025/12/17 17:07:00   Bucket[66]: Key=基隆商工, DocCount=64
DEBUG 2025/12/17 17:07:00   Bucket[67]: Key=水里商工, DocCount=64
DEBUG 2025/12/17 17:07:00   Bucket[68]: Key=政大附中, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[69]: Key=潮州高中, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[70]: Key=興大附農, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[71]: Key=秀水高工, DocCount=62
DEBUG 2025/12/17 17:07:00   Bucket[72]: Key=善化高中, DocCount=61
DEBUG 2025/12/17 17:07:00   Bucket[73]: Key=新竹特教, DocCount=60
DEBUG 2025/12/17 17:07:00   Bucket[74]: Key=頭城家商, DocCount=60
DEBUG 2025/12/17 17:07:00   Bucket[75]: Key=彰化高商, DocCount=59
DEBUG 2025/12/17 17:07:00   Bucket[76]: Key=臺東高商, DocCount=59
DEBUG 2025/12/17 17:07:00   Bucket[77]: Key=崇實高工, DocCount=58
DEBUG 2025/12/17 17:07:00   Bucket[78]: Key=羅東高商, DocCount=58
DEBUG 2025/12/17 17:07:00   Bucket[79]: Key=嘉義高工, DocCount=57
DEBUG 2025/12/17 17:07:00   Bucket[80]: Key=曾文農工, DocCount=56
DEBUG 2025/12/17 17:07:00   Bucket[81]: Key=溪湖高中, DocCount=56
DEBUG 2025/12/17 17:07:00   Bucket[82]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:07:00   Bucket[83]: Key=宜蘭高中, DocCount=51
DEBUG 2025/12/17 17:07:00   Bucket[84]: Key=白河商工, DocCount=51
DEBUG 2025/12/17 17:07:00   Bucket[85]: Key=竹山高中, DocCount=49
DEBUG 2025/12/17 17:07:00   Bucket[86]: Key=暨大附中, DocCount=48
DEBUG 2025/12/17 17:07:00   Bucket[87]: Key=澎湖海事, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[88]: Key=竹東高中, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[89]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[90]: Key=嘉義特教, DocCount=45
DEBUG 2025/12/17 17:07:00   Bucket[91]: Key=新竹高商, DocCount=45
DEBUG 2025/12/17 17:07:00   Bucket[92]: Key=海大附中, DocCount=44
DEBUG 2025/12/17 17:07:00   Bucket[93]: Key=羅東高工, DocCount=44
DEBUG 2025/12/17 17:07:00   Bucket[94]: Key=花蓮特教, DocCount=42
DEBUG 2025/12/17 17:07:00   Bucket[95]: Key=高餐大附中, DocCount=42
DEBUG 2025/12/17 17:07:00   Bucket[96]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:07:00   Bucket[97]: Key=屏東特教, DocCount=41
DEBUG 2025/12/17 17:07:00   Bucket[98]: Key=土庫商工, DocCount=40
DEBUG 2025/12/17 17:07:00   Bucket[99]: Key=旗山農工, DocCount=40
DEBUG 2025/12/17 17:07:00 ========================================================
INFO 2025/12/17 17:07:08 ✅ Successfully flushed 26/26 history records to TimescaleDB
INFO 2025/12/17 17:07:13 ✅ Successfully flushed 44/44 history records to TimescaleDB
INFO 2025/12/17 17:07:17 Processing 15 offline devices
INFO 2025/12/17 17:07:17 Creating history record for offline device: 屏東高工
INFO 2025/12/17 17:07:17 About to add history to batch for device: 屏東高工
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 17:07:17 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:07:17 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:07:17 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:07:17 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:07:17 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:07:17 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:07:17 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:07:17 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:07:18 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:07:18 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:07:18 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:07:18 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:07:18 ✅ Successfully flushed 36/36 history records to TimescaleDB
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:07:18 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:07:18 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:07:19 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:07:19 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:07:19 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:07:19 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:07:19 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:07:19 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:07:19 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:07:20 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:07:23 ✅ Successfully flushed 9/9 history records to TimescaleDB
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:07:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:07:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:07:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:07:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:07:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:07:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:07:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:07:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:07:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:07:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:07:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:07:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:07:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:07:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:07:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:07:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:07:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:07:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.80% (threshold: 80.00%)
INFO 2025/12/17 17:07:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:07:45 ES Alert Created [high][capacity]: Disk usage high: 93.22% (threshold: 85.00%)
WARN 2025/12/17 17:07:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:07:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:07:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:07:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:07:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:07:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:07:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:07:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:08:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:08:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:08:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:08:00 Field: school_name.keyword
DEBUG 2025/12/17 17:08:00 Time From: 2025-12-17T17:07:00.000+08:00
DEBUG 2025/12/17 17:08:00 Time To: 2025-12-17T17:08:00.000+08:00
DEBUG 2025/12/17 17:08:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:07:00.000+08:00",
					"lte": "2025-12-17T17:08:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:08:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:08:00 ES Response IsError: false
DEBUG 2025/12/17 17:08:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":481,"buckets":[{"key":"黑快馬主機","doc_count":1724},{"key":"花蓮高農","doc_count":796},{"key":"新竹女中","doc_count":681},{"key":"金門農工","doc_count":630},{"key":"仁愛高農","doc_count":588},{"key":"南投高商","doc_count":529},{"key":"旗美高中","doc_count":483},{"key":"金門高中","doc_count":481},{"key":"宜蘭高商","doc_count":480},{"key":"竹北高中","doc_count":458},{"key":"花蓮高商","doc_count":431},{"key":"北門高中","doc_count":380},{"key":"華僑高中","doc_count":380},{"key":"興大附中","doc_count":367},{"key":"清華附小","doc_count":355},{"key":"臺東高中","doc_count":353},{"key":"政大附中","doc_count":334},{"key":"內埔農工","doc_count":317},{"key":"中大壢中","doc_count":303},{"key":"關西高中","doc_count":290},{"key":"新港藝高","doc_count":288},{"key":"蘇澳海事","doc_count":280},{"key":"竹南高中","doc_count":275},{"key":"關山工商","doc_count":233},{"key":"後壁高中","doc_count":218},{"key":"成大南工","doc_count":208},{"key":"南投特教","doc_count":201},{"key":"新化高中","doc_count":187},{"key":"斗六家商","doc_count":177},{"key":"新化高工","doc_count":177},{"key":"苗栗農工","doc_count":174},{"key":"玉里高中","doc_count":170},{"key":"東港海事","doc_count":162},{"key":"屏東女中","doc_count":147},{"key":"嘉義高商","doc_count":144},{"key":"虎尾高中","doc_count":142},{"key":"南大附聰","doc_count":126},{"key":"新營高工","doc_count":121},{"key":"彰師附工","doc_count":117},{"key":"苗栗高商","doc_count":116},{"key":"員林家商","doc_count":113},{"key":"新豐高中","doc_count":113},{"key":"師大附中高中部","doc_count":109},{"key":"中興高中","doc_count":100},{"key":"暨大附中","doc_count":98},{"key":"員林農工","doc_count":88},{"key":"屏科實中","doc_count":86},{"key":"臺南高商","doc_count":86},{"key":"北港高中","doc_count":80},{"key":"南投高中","doc_count":80},{"key":"新營高中","doc_count":79},{"key":"草屯商工","doc_count":79},{"key":"嘉義高中","doc_count":78},{"key":"南大附中","doc_count":77},{"key":"北斗家商","doc_count":76},{"key":"水里商工","doc_count":76},{"key":"嘉義家職","doc_count":73},{"key":"曾文農工","doc_count":73},{"key":"白河商工","doc_count":72},{"key":"臺南一中","doc_count":67},{"key":"秀水高工","doc_count":66},{"key":"潮州高中","doc_count":65},{"key":"北教大實小","doc_count":63},{"key":"嘉科實中","doc_count":63},{"key":"雲林特教","doc_count":63},{"key":"溪湖高中","doc_count":62},{"key":"臺東高商","doc_count":62},{"key":"花蓮高工","doc_count":62},{"key":"鳳山高中","doc_count":62},{"key":"基隆商工","doc_count":61},{"key":"屏東高工","doc_count":60},{"key":"新竹高工","doc_count":59},{"key":"彰化高商","doc_count":58},{"key":"新竹高中","doc_count":58},{"key":"高餐大附中","doc_count":58},{"key":"員林高中","doc_count":57},{"key":"苗栗高中","doc_count":56},{"key":"崇實高工","doc_count":55},{"key":"東石高中","doc_count":55},{"key":"屏東高中","doc_count":54},{"key":"新竹高商","doc_count":54},{"key":"海大附中","doc_count":54},{"key":"北港農工","doc_count":53},{"key":"花蓮特教","doc_count":51},{"key":"土庫商工","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"二林工商","doc_count":48},{"key":"竹山高中","doc_count":48},{"key":"屏東特教","doc_count":46},{"key":"羅東高商","doc_count":46},{"key":"佳冬高農","doc_count":45},{"key":"嘉義高工","doc_count":45},{"key":"嘉義特教","doc_count":44},{"key":"家齊高中","doc_count":44},{"key":"永靖高工","doc_count":44},{"key":"埔里高工","doc_count":43},{"key":"師大附中國中部","doc_count":43},{"key":"興大附農","doc_count":43},{"key":"南大附小","doc_count":42},{"key":"善化高中","doc_count":41}]}}}
DEBUG 2025/12/17 17:08:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:08:00   Bucket[0]: Key=黑快馬主機, DocCount=1724
DEBUG 2025/12/17 17:08:00   Bucket[1]: Key=花蓮高農, DocCount=796
DEBUG 2025/12/17 17:08:00   Bucket[2]: Key=新竹女中, DocCount=681
DEBUG 2025/12/17 17:08:00   Bucket[3]: Key=金門農工, DocCount=630
DEBUG 2025/12/17 17:08:00   Bucket[4]: Key=仁愛高農, DocCount=588
DEBUG 2025/12/17 17:08:00   Bucket[5]: Key=南投高商, DocCount=529
DEBUG 2025/12/17 17:08:00   Bucket[6]: Key=旗美高中, DocCount=483
DEBUG 2025/12/17 17:08:00   Bucket[7]: Key=金門高中, DocCount=481
DEBUG 2025/12/17 17:08:00   Bucket[8]: Key=宜蘭高商, DocCount=480
DEBUG 2025/12/17 17:08:00   Bucket[9]: Key=竹北高中, DocCount=458
DEBUG 2025/12/17 17:08:00   Bucket[10]: Key=花蓮高商, DocCount=431
DEBUG 2025/12/17 17:08:00   Bucket[11]: Key=北門高中, DocCount=380
DEBUG 2025/12/17 17:08:00   Bucket[12]: Key=華僑高中, DocCount=380
DEBUG 2025/12/17 17:08:00   Bucket[13]: Key=興大附中, DocCount=367
DEBUG 2025/12/17 17:08:00   Bucket[14]: Key=清華附小, DocCount=355
DEBUG 2025/12/17 17:08:00   Bucket[15]: Key=臺東高中, DocCount=353
DEBUG 2025/12/17 17:08:00   Bucket[16]: Key=政大附中, DocCount=334
DEBUG 2025/12/17 17:08:00   Bucket[17]: Key=內埔農工, DocCount=317
DEBUG 2025/12/17 17:08:00   Bucket[18]: Key=中大壢中, DocCount=303
DEBUG 2025/12/17 17:08:00   Bucket[19]: Key=關西高中, DocCount=290
DEBUG 2025/12/17 17:08:00   Bucket[20]: Key=新港藝高, DocCount=288
DEBUG 2025/12/17 17:08:00   Bucket[21]: Key=蘇澳海事, DocCount=280
DEBUG 2025/12/17 17:08:00   Bucket[22]: Key=竹南高中, DocCount=275
DEBUG 2025/12/17 17:08:00   Bucket[23]: Key=關山工商, DocCount=233
DEBUG 2025/12/17 17:08:00   Bucket[24]: Key=後壁高中, DocCount=218
DEBUG 2025/12/17 17:08:00   Bucket[25]: Key=成大南工, DocCount=208
DEBUG 2025/12/17 17:08:00   Bucket[26]: Key=南投特教, DocCount=201
DEBUG 2025/12/17 17:08:00   Bucket[27]: Key=新化高中, DocCount=187
DEBUG 2025/12/17 17:08:00   Bucket[28]: Key=斗六家商, DocCount=177
DEBUG 2025/12/17 17:08:00   Bucket[29]: Key=新化高工, DocCount=177
DEBUG 2025/12/17 17:08:00   Bucket[30]: Key=苗栗農工, DocCount=174
DEBUG 2025/12/17 17:08:00   Bucket[31]: Key=玉里高中, DocCount=170
DEBUG 2025/12/17 17:08:00   Bucket[32]: Key=東港海事, DocCount=162
DEBUG 2025/12/17 17:08:00   Bucket[33]: Key=屏東女中, DocCount=147
DEBUG 2025/12/17 17:08:00   Bucket[34]: Key=嘉義高商, DocCount=144
DEBUG 2025/12/17 17:08:00   Bucket[35]: Key=虎尾高中, DocCount=142
DEBUG 2025/12/17 17:08:00   Bucket[36]: Key=南大附聰, DocCount=126
DEBUG 2025/12/17 17:08:00   Bucket[37]: Key=新營高工, DocCount=121
DEBUG 2025/12/17 17:08:00   Bucket[38]: Key=彰師附工, DocCount=117
DEBUG 2025/12/17 17:08:00   Bucket[39]: Key=苗栗高商, DocCount=116
DEBUG 2025/12/17 17:08:00   Bucket[40]: Key=員林家商, DocCount=113
DEBUG 2025/12/17 17:08:00   Bucket[41]: Key=新豐高中, DocCount=113
DEBUG 2025/12/17 17:08:00   Bucket[42]: Key=師大附中高中部, DocCount=109
DEBUG 2025/12/17 17:08:00   Bucket[43]: Key=中興高中, DocCount=100
DEBUG 2025/12/17 17:08:00   Bucket[44]: Key=暨大附中, DocCount=98
DEBUG 2025/12/17 17:08:00   Bucket[45]: Key=員林農工, DocCount=88
DEBUG 2025/12/17 17:08:00   Bucket[46]: Key=屏科實中, DocCount=86
DEBUG 2025/12/17 17:08:00   Bucket[47]: Key=臺南高商, DocCount=86
DEBUG 2025/12/17 17:08:00   Bucket[48]: Key=北港高中, DocCount=80
DEBUG 2025/12/17 17:08:00   Bucket[49]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:08:00   Bucket[50]: Key=新營高中, DocCount=79
DEBUG 2025/12/17 17:08:00   Bucket[51]: Key=草屯商工, DocCount=79
DEBUG 2025/12/17 17:08:00   Bucket[52]: Key=嘉義高中, DocCount=78
DEBUG 2025/12/17 17:08:00   Bucket[53]: Key=南大附中, DocCount=77
DEBUG 2025/12/17 17:08:00   Bucket[54]: Key=北斗家商, DocCount=76
DEBUG 2025/12/17 17:08:00   Bucket[55]: Key=水里商工, DocCount=76
DEBUG 2025/12/17 17:08:00   Bucket[56]: Key=嘉義家職, DocCount=73
DEBUG 2025/12/17 17:08:00   Bucket[57]: Key=曾文農工, DocCount=73
DEBUG 2025/12/17 17:08:00   Bucket[58]: Key=白河商工, DocCount=72
DEBUG 2025/12/17 17:08:00   Bucket[59]: Key=臺南一中, DocCount=67
DEBUG 2025/12/17 17:08:00   Bucket[60]: Key=秀水高工, DocCount=66
DEBUG 2025/12/17 17:08:00   Bucket[61]: Key=潮州高中, DocCount=65
DEBUG 2025/12/17 17:08:00   Bucket[62]: Key=北教大實小, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[63]: Key=嘉科實中, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[64]: Key=雲林特教, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[65]: Key=溪湖高中, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[66]: Key=臺東高商, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[67]: Key=花蓮高工, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[68]: Key=鳳山高中, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[69]: Key=基隆商工, DocCount=61
DEBUG 2025/12/17 17:08:00   Bucket[70]: Key=屏東高工, DocCount=60
DEBUG 2025/12/17 17:08:00   Bucket[71]: Key=新竹高工, DocCount=59
DEBUG 2025/12/17 17:08:00   Bucket[72]: Key=彰化高商, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[73]: Key=新竹高中, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[74]: Key=高餐大附中, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[75]: Key=員林高中, DocCount=57
DEBUG 2025/12/17 17:08:00   Bucket[76]: Key=苗栗高中, DocCount=56
DEBUG 2025/12/17 17:08:00   Bucket[77]: Key=崇實高工, DocCount=55
DEBUG 2025/12/17 17:08:00   Bucket[78]: Key=東石高中, DocCount=55
DEBUG 2025/12/17 17:08:00   Bucket[79]: Key=屏東高中, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[80]: Key=新竹高商, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[81]: Key=海大附中, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[82]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:08:00   Bucket[83]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 17:08:00   Bucket[84]: Key=土庫商工, DocCount=50
DEBUG 2025/12/17 17:08:00   Bucket[85]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:08:00   Bucket[86]: Key=二林工商, DocCount=48
DEBUG 2025/12/17 17:08:00   Bucket[87]: Key=竹山高中, DocCount=48
DEBUG 2025/12/17 17:08:00   Bucket[88]: Key=屏東特教, DocCount=46
DEBUG 2025/12/17 17:08:00   Bucket[89]: Key=羅東高商, DocCount=46
DEBUG 2025/12/17 17:08:00   Bucket[90]: Key=佳冬高農, DocCount=45
DEBUG 2025/12/17 17:08:00   Bucket[91]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:08:00   Bucket[92]: Key=嘉義特教, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[93]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[94]: Key=永靖高工, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[95]: Key=埔里高工, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[96]: Key=師大附中國中部, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[97]: Key=興大附農, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[98]: Key=南大附小, DocCount=42
DEBUG 2025/12/17 17:08:00   Bucket[99]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:08:00 ========================================================
INFO 2025/12/17 17:08:03 ✅ Successfully flushed 10/10 history records to TimescaleDB
INFO 2025/12/17 17:08:06 ✅ Successfully flushed 50/60 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:08:08 Processing 15 offline devices
INFO 2025/12/17 17:08:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:08:08 ✅ Successfully flushed 20/20 history records to TimescaleDB
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:08:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:08:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:08:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:08:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:08:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:08:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:08:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:08:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:08:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:08:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:08:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:08:08 Creating history record for offline device: 宜蘭高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 宜蘭高中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 宜蘭高中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:08:09 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:08:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:08:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:08:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:08:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:08:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:08:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:08:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:08:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:08:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:08:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:08:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:08:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:08:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:08:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:08:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:08:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:08:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:08:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:08:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:08:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:08:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:08:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:08:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:08:45 ES Alert Created [critical][performance]: Memory usage critical: 90.01% (threshold: 90.00%)
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.25% (threshold: 85.00%)
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:08:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:08:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:08:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:08:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:09:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:09:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:09:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:09:00 Field: school_name.keyword
DEBUG 2025/12/17 17:09:00 Time From: 2025-12-17T17:08:00.000+08:00
DEBUG 2025/12/17 17:09:00 Time To: 2025-12-17T17:09:00.000+08:00
DEBUG 2025/12/17 17:09:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:08:00.000+08:00",
					"lte": "2025-12-17T17:09:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:09:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:09:00 ES Response IsError: false
DEBUG 2025/12/17 17:09:00 ES Response Body:
{"took":61,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":1279},{"key":"花蓮高農","doc_count":733},{"key":"新竹女中","doc_count":625},{"key":"仁愛高農","doc_count":591},{"key":"金門農工","doc_count":522},{"key":"旗美高中","doc_count":487},{"key":"金門高中","doc_count":471},{"key":"宜蘭高商","doc_count":426},{"key":"花蓮高商","doc_count":396},{"key":"南投高商","doc_count":381},{"key":"竹北高中","doc_count":379},{"key":"華僑高中","doc_count":345},{"key":"清華附小","doc_count":344},{"key":"竹南高中","doc_count":340},{"key":"中大壢中","doc_count":322},{"key":"臺東高中","doc_count":322},{"key":"興大附中","doc_count":309},{"key":"新港藝高","doc_count":300},{"key":"內埔農工","doc_count":286},{"key":"蘇澳海事","doc_count":270},{"key":"關山工商","doc_count":253},{"key":"關西高中","doc_count":244},{"key":"斗六家商","doc_count":243},{"key":"玉里高中","doc_count":221},{"key":"高餐大附中","doc_count":203},{"key":"後壁高中","doc_count":195},{"key":"新化高工","doc_count":172},{"key":"苗栗農工","doc_count":167},{"key":"嘉義高商","doc_count":161},{"key":"嘉科實中","doc_count":158},{"key":"新營高工","doc_count":156},{"key":"新化高中","doc_count":154},{"key":"虎尾高中","doc_count":153},{"key":"南投特教","doc_count":150},{"key":"屏東女中","doc_count":147},{"key":"水里商工","doc_count":146},{"key":"北斗家商","doc_count":145},{"key":"新竹高工","doc_count":144},{"key":"南大附中","doc_count":143},{"key":"成大南工","doc_count":135},{"key":"東港海事","doc_count":132},{"key":"澎湖海事","doc_count":130},{"key":"彰師附工","doc_count":126},{"key":"南大附聰","doc_count":115},{"key":"員林家商","doc_count":115},{"key":"政大附中","doc_count":106},{"key":"師大附中高中部","doc_count":101},{"key":"苗栗高商","doc_count":100},{"key":"員林農工","doc_count":94},{"key":"新竹高中","doc_count":91},{"key":"新營高中","doc_count":89},{"key":"南投高中","doc_count":80},{"key":"中興高中","doc_count":79},{"key":"北教大實小","doc_count":79},{"key":"屏科實中","doc_count":77},{"key":"雲林特教","doc_count":75},{"key":"苗栗高中","doc_count":73},{"key":"草屯商工","doc_count":72},{"key":"秀水高工","doc_count":71},{"key":"北港農工","doc_count":68},{"key":"鳳山高中","doc_count":67},{"key":"二林工商","doc_count":66},{"key":"嘉義高中","doc_count":65},{"key":"北港高中","doc_count":64},{"key":"屏東高工","doc_count":63},{"key":"永靖高工","doc_count":63},{"key":"白河商工","doc_count":62},{"key":"蘭陽女中","doc_count":62},{"key":"彰化高商","doc_count":61},{"key":"北門高中","doc_count":60},{"key":"員林高中","doc_count":60},{"key":"海大附中","doc_count":60},{"key":"嘉義特教","doc_count":58},{"key":"頭城家商","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"東石高中","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"臺南一中","doc_count":55},{"key":"竹東高中","doc_count":54},{"key":"埔里高工","doc_count":53},{"key":"溪湖高中","doc_count":53},{"key":"興大附農","doc_count":53},{"key":"新竹高商","doc_count":52},{"key":"佳冬高農","doc_count":51},{"key":"新豐高中","doc_count":51},{"key":"竹山高中","doc_count":51},{"key":"潮州高中","doc_count":50},{"key":"嘉義家職","doc_count":49},{"key":"屏東高中","doc_count":49},{"key":"南大附小","doc_count":47},{"key":"花蓮高工","doc_count":47},{"key":"花蓮特教","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"基隆商工","doc_count":45},{"key":"暨大附中","doc_count":45},{"key":"羅東高商","doc_count":45},{"key":"屏東特教","doc_count":43},{"key":"羅東高工","doc_count":42},{"key":"華南高商","doc_count":40},{"key":"土庫商工","doc_count":39}]}}}
DEBUG 2025/12/17 17:09:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:09:00   Bucket[0]: Key=黑快馬主機, DocCount=1279
DEBUG 2025/12/17 17:09:00   Bucket[1]: Key=花蓮高農, DocCount=733
DEBUG 2025/12/17 17:09:00   Bucket[2]: Key=新竹女中, DocCount=625
DEBUG 2025/12/17 17:09:00   Bucket[3]: Key=仁愛高農, DocCount=591
DEBUG 2025/12/17 17:09:00   Bucket[4]: Key=金門農工, DocCount=522
DEBUG 2025/12/17 17:09:00   Bucket[5]: Key=旗美高中, DocCount=487
DEBUG 2025/12/17 17:09:00   Bucket[6]: Key=金門高中, DocCount=471
DEBUG 2025/12/17 17:09:00   Bucket[7]: Key=宜蘭高商, DocCount=426
DEBUG 2025/12/17 17:09:00   Bucket[8]: Key=花蓮高商, DocCount=396
DEBUG 2025/12/17 17:09:00   Bucket[9]: Key=南投高商, DocCount=381
DEBUG 2025/12/17 17:09:00   Bucket[10]: Key=竹北高中, DocCount=379
DEBUG 2025/12/17 17:09:00   Bucket[11]: Key=華僑高中, DocCount=345
DEBUG 2025/12/17 17:09:00   Bucket[12]: Key=清華附小, DocCount=344
DEBUG 2025/12/17 17:09:00   Bucket[13]: Key=竹南高中, DocCount=340
DEBUG 2025/12/17 17:09:00   Bucket[14]: Key=中大壢中, DocCount=322
DEBUG 2025/12/17 17:09:00   Bucket[15]: Key=臺東高中, DocCount=322
DEBUG 2025/12/17 17:09:00   Bucket[16]: Key=興大附中, DocCount=309
DEBUG 2025/12/17 17:09:00   Bucket[17]: Key=新港藝高, DocCount=300
DEBUG 2025/12/17 17:09:00   Bucket[18]: Key=內埔農工, DocCount=286
DEBUG 2025/12/17 17:09:00   Bucket[19]: Key=蘇澳海事, DocCount=270
DEBUG 2025/12/17 17:09:00   Bucket[20]: Key=關山工商, DocCount=253
DEBUG 2025/12/17 17:09:00   Bucket[21]: Key=關西高中, DocCount=244
DEBUG 2025/12/17 17:09:00   Bucket[22]: Key=斗六家商, DocCount=243
DEBUG 2025/12/17 17:09:00   Bucket[23]: Key=玉里高中, DocCount=221
DEBUG 2025/12/17 17:09:00   Bucket[24]: Key=高餐大附中, DocCount=203
DEBUG 2025/12/17 17:09:00   Bucket[25]: Key=後壁高中, DocCount=195
DEBUG 2025/12/17 17:09:00   Bucket[26]: Key=新化高工, DocCount=172
DEBUG 2025/12/17 17:09:00   Bucket[27]: Key=苗栗農工, DocCount=167
DEBUG 2025/12/17 17:09:00   Bucket[28]: Key=嘉義高商, DocCount=161
DEBUG 2025/12/17 17:09:00   Bucket[29]: Key=嘉科實中, DocCount=158
DEBUG 2025/12/17 17:09:00   Bucket[30]: Key=新營高工, DocCount=156
DEBUG 2025/12/17 17:09:00   Bucket[31]: Key=新化高中, DocCount=154
DEBUG 2025/12/17 17:09:00   Bucket[32]: Key=虎尾高中, DocCount=153
DEBUG 2025/12/17 17:09:00   Bucket[33]: Key=南投特教, DocCount=150
DEBUG 2025/12/17 17:09:00   Bucket[34]: Key=屏東女中, DocCount=147
DEBUG 2025/12/17 17:09:00   Bucket[35]: Key=水里商工, DocCount=146
DEBUG 2025/12/17 17:09:00   Bucket[36]: Key=北斗家商, DocCount=145
DEBUG 2025/12/17 17:09:00   Bucket[37]: Key=新竹高工, DocCount=144
DEBUG 2025/12/17 17:09:00   Bucket[38]: Key=南大附中, DocCount=143
DEBUG 2025/12/17 17:09:00   Bucket[39]: Key=成大南工, DocCount=135
DEBUG 2025/12/17 17:09:00   Bucket[40]: Key=東港海事, DocCount=132
DEBUG 2025/12/17 17:09:00   Bucket[41]: Key=澎湖海事, DocCount=130
DEBUG 2025/12/17 17:09:00   Bucket[42]: Key=彰師附工, DocCount=126
DEBUG 2025/12/17 17:09:00   Bucket[43]: Key=南大附聰, DocCount=115
DEBUG 2025/12/17 17:09:00   Bucket[44]: Key=員林家商, DocCount=115
DEBUG 2025/12/17 17:09:00   Bucket[45]: Key=政大附中, DocCount=106
DEBUG 2025/12/17 17:09:00   Bucket[46]: Key=師大附中高中部, DocCount=101
DEBUG 2025/12/17 17:09:00   Bucket[47]: Key=苗栗高商, DocCount=100
DEBUG 2025/12/17 17:09:00   Bucket[48]: Key=員林農工, DocCount=94
DEBUG 2025/12/17 17:09:00   Bucket[49]: Key=新竹高中, DocCount=91
DEBUG 2025/12/17 17:09:00   Bucket[50]: Key=新營高中, DocCount=89
DEBUG 2025/12/17 17:09:00   Bucket[51]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:09:00   Bucket[52]: Key=中興高中, DocCount=79
DEBUG 2025/12/17 17:09:00   Bucket[53]: Key=北教大實小, DocCount=79
DEBUG 2025/12/17 17:09:00   Bucket[54]: Key=屏科實中, DocCount=77
DEBUG 2025/12/17 17:09:00   Bucket[55]: Key=雲林特教, DocCount=75
DEBUG 2025/12/17 17:09:00   Bucket[56]: Key=苗栗高中, DocCount=73
DEBUG 2025/12/17 17:09:00   Bucket[57]: Key=草屯商工, DocCount=72
DEBUG 2025/12/17 17:09:00   Bucket[58]: Key=秀水高工, DocCount=71
DEBUG 2025/12/17 17:09:00   Bucket[59]: Key=北港農工, DocCount=68
DEBUG 2025/12/17 17:09:00   Bucket[60]: Key=鳳山高中, DocCount=67
DEBUG 2025/12/17 17:09:00   Bucket[61]: Key=二林工商, DocCount=66
DEBUG 2025/12/17 17:09:00   Bucket[62]: Key=嘉義高中, DocCount=65
DEBUG 2025/12/17 17:09:00   Bucket[63]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:09:00   Bucket[64]: Key=屏東高工, DocCount=63
DEBUG 2025/12/17 17:09:00   Bucket[65]: Key=永靖高工, DocCount=63
DEBUG 2025/12/17 17:09:00   Bucket[66]: Key=白河商工, DocCount=62
DEBUG 2025/12/17 17:09:00   Bucket[67]: Key=蘭陽女中, DocCount=62
DEBUG 2025/12/17 17:09:00   Bucket[68]: Key=彰化高商, DocCount=61
DEBUG 2025/12/17 17:09:00   Bucket[69]: Key=北門高中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[70]: Key=員林高中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[71]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[72]: Key=嘉義特教, DocCount=58
DEBUG 2025/12/17 17:09:00   Bucket[73]: Key=頭城家商, DocCount=58
DEBUG 2025/12/17 17:09:00   Bucket[74]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 17:09:00   Bucket[75]: Key=東石高中, DocCount=56
DEBUG 2025/12/17 17:09:00   Bucket[76]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 17:09:00   Bucket[77]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:09:00   Bucket[78]: Key=竹東高中, DocCount=54
DEBUG 2025/12/17 17:09:00   Bucket[79]: Key=埔里高工, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[80]: Key=溪湖高中, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[81]: Key=興大附農, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[82]: Key=新竹高商, DocCount=52
DEBUG 2025/12/17 17:09:00   Bucket[83]: Key=佳冬高農, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[84]: Key=新豐高中, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[85]: Key=竹山高中, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[86]: Key=潮州高中, DocCount=50
DEBUG 2025/12/17 17:09:00   Bucket[87]: Key=嘉義家職, DocCount=49
DEBUG 2025/12/17 17:09:00   Bucket[88]: Key=屏東高中, DocCount=49
DEBUG 2025/12/17 17:09:00   Bucket[89]: Key=南大附小, DocCount=47
DEBUG 2025/12/17 17:09:00   Bucket[90]: Key=花蓮高工, DocCount=47
DEBUG 2025/12/17 17:09:00   Bucket[91]: Key=花蓮特教, DocCount=46
DEBUG 2025/12/17 17:09:00   Bucket[92]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[93]: Key=基隆商工, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[94]: Key=暨大附中, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[95]: Key=羅東高商, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[96]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 17:09:00   Bucket[97]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 17:09:00   Bucket[98]: Key=華南高商, DocCount=40
DEBUG 2025/12/17 17:09:00   Bucket[99]: Key=土庫商工, DocCount=39
DEBUG 2025/12/17 17:09:00 ========================================================
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:09:09 Processing 15 offline devices
INFO 2025/12/17 17:09:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:09:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:09:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:09:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:09:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:09:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:09:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:09:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:09:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:09:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:09:10 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:09:10 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:09:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:09:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:09:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:09:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:09:10 Creating history record for offline device: 宜蘭高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 宜蘭高中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 宜蘭高中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:09:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:09:10 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:09:10 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:09:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:09:11 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:09:11 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:09:11 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:09:11 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:09:13 ✅ Successfully flushed 40/40 history records to TimescaleDB
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:09:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:09:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:09:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:09:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:09:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:09:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:09:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:09:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:09:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:09:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:09:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:09:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:09:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:09:45 ES Alert Created [high][performance]: Memory usage high: 88.50% (threshold: 80.00%)
INFO 2025/12/17 17:09:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:09:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:09:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:09:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:09:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:10:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:10:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:10:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:10:00 Field: school_name.keyword
DEBUG 2025/12/17 17:10:00 Time From: 2025-12-17T17:09:00.000+08:00
DEBUG 2025/12/17 17:10:00 Time To: 2025-12-17T17:10:00.000+08:00
DEBUG 2025/12/17 17:10:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:09:00.000+08:00",
					"lte": "2025-12-17T17:10:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:10:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:10:00 ES Response IsError: false
DEBUG 2025/12/17 17:10:00 ES Response Body:
{"took":126,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":495,"buckets":[{"key":"黑快馬主機","doc_count":1152},{"key":"花蓮高農","doc_count":800},{"key":"新竹女中","doc_count":735},{"key":"仁愛高農","doc_count":626},{"key":"金門農工","doc_count":543},{"key":"金門高中","doc_count":527},{"key":"中大壢中","doc_count":499},{"key":"旗美高中","doc_count":454},{"key":"南投高商","doc_count":447},{"key":"竹北高中","doc_count":433},{"key":"花蓮高商","doc_count":398},{"key":"宜蘭高商","doc_count":382},{"key":"華僑高中","doc_count":333},{"key":"北斗家商","doc_count":325},{"key":"政大附中","doc_count":306},{"key":"臺東高中","doc_count":304},{"key":"興大附中","doc_count":297},{"key":"中興高中","doc_count":291},{"key":"斗六家商","doc_count":288},{"key":"清華附小","doc_count":277},{"key":"新港藝高","doc_count":270},{"key":"內埔農工","doc_count":266},{"key":"蘇澳海事","doc_count":250},{"key":"竹南高中","doc_count":231},{"key":"南大附中","doc_count":215},{"key":"關西高中","doc_count":215},{"key":"澎湖海事","doc_count":212},{"key":"關山工商","doc_count":208},{"key":"師大附中高中部","doc_count":205},{"key":"後壁高中","doc_count":203},{"key":"玉里高中","doc_count":198},{"key":"基隆商工","doc_count":168},{"key":"虎尾高中","doc_count":168},{"key":"苗栗農工","doc_count":160},{"key":"東港海事","doc_count":155},{"key":"鳳山高中","doc_count":153},{"key":"彰師附工","doc_count":150},{"key":"新化高中","doc_count":149},{"key":"南投特教","doc_count":147},{"key":"嘉科實中","doc_count":146},{"key":"南投高中","doc_count":144},{"key":"新化高工","doc_count":142},{"key":"新營高中","doc_count":142},{"key":"員林農工","doc_count":138},{"key":"嘉義高商","doc_count":136},{"key":"屏東女中","doc_count":126},{"key":"新營高工","doc_count":126},{"key":"員林家商","doc_count":121},{"key":"成大南工","doc_count":120},{"key":"南大附聰","doc_count":119},{"key":"苗栗高商","doc_count":118},{"key":"苗栗高中","doc_count":116},{"key":"彰化高商","doc_count":110},{"key":"草屯商工","doc_count":99},{"key":"水里商工","doc_count":93},{"key":"新竹高工","doc_count":91},{"key":"屏科實中","doc_count":85},{"key":"雲林特教","doc_count":82},{"key":"北港農工","doc_count":79},{"key":"潮州高中","doc_count":79},{"key":"北教大實小","doc_count":78},{"key":"屏東高中","doc_count":78},{"key":"羅東高商","doc_count":78},{"key":"新竹高中","doc_count":76},{"key":"玉井工商","doc_count":76},{"key":"蘭陽女中","doc_count":75},{"key":"東石高中","doc_count":72},{"key":"臺南一中","doc_count":72},{"key":"嘉義高中","doc_count":71},{"key":"南大附小","doc_count":69},{"key":"高餐大附中","doc_count":67},{"key":"崇實高工","doc_count":65},{"key":"臺南高商","doc_count":65},{"key":"北港高中","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"員林高中","doc_count":63},{"key":"屏東高工","doc_count":62},{"key":"北門高中","doc_count":61},{"key":"竹東高中","doc_count":61},{"key":"新竹高商","doc_count":60},{"key":"華南高商","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"溪湖高中","doc_count":59},{"key":"海大附中","doc_count":58},{"key":"興大附農","doc_count":54},{"key":"頭城家商","doc_count":54},{"key":"埔里高工","doc_count":52},{"key":"白河商工","doc_count":52},{"key":"嘉義家職","doc_count":51},{"key":"暨大附中","doc_count":50},{"key":"旗山農工","doc_count":47},{"key":"新豐高中","doc_count":46},{"key":"羅東高工","doc_count":46},{"key":"佳冬高農","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"臺東高商","doc_count":42},{"key":"花蓮高工","doc_count":41},{"key":"宜蘭高中","doc_count":39},{"key":"嘉義高工","doc_count":38},{"key":"師大附中國中部","doc_count":38}]}}}
DEBUG 2025/12/17 17:10:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:10:00   Bucket[0]: Key=黑快馬主機, DocCount=1152
DEBUG 2025/12/17 17:10:00   Bucket[1]: Key=花蓮高農, DocCount=800
DEBUG 2025/12/17 17:10:00   Bucket[2]: Key=新竹女中, DocCount=735
DEBUG 2025/12/17 17:10:00   Bucket[3]: Key=仁愛高農, DocCount=626
DEBUG 2025/12/17 17:10:00   Bucket[4]: Key=金門農工, DocCount=543
DEBUG 2025/12/17 17:10:00   Bucket[5]: Key=金門高中, DocCount=527
DEBUG 2025/12/17 17:10:00   Bucket[6]: Key=中大壢中, DocCount=499
DEBUG 2025/12/17 17:10:00   Bucket[7]: Key=旗美高中, DocCount=454
DEBUG 2025/12/17 17:10:00   Bucket[8]: Key=南投高商, DocCount=447
DEBUG 2025/12/17 17:10:00   Bucket[9]: Key=竹北高中, DocCount=433
DEBUG 2025/12/17 17:10:00   Bucket[10]: Key=花蓮高商, DocCount=398
DEBUG 2025/12/17 17:10:00   Bucket[11]: Key=宜蘭高商, DocCount=382
DEBUG 2025/12/17 17:10:00   Bucket[12]: Key=華僑高中, DocCount=333
DEBUG 2025/12/17 17:10:00   Bucket[13]: Key=北斗家商, DocCount=325
DEBUG 2025/12/17 17:10:00   Bucket[14]: Key=政大附中, DocCount=306
DEBUG 2025/12/17 17:10:00   Bucket[15]: Key=臺東高中, DocCount=304
DEBUG 2025/12/17 17:10:00   Bucket[16]: Key=興大附中, DocCount=297
DEBUG 2025/12/17 17:10:00   Bucket[17]: Key=中興高中, DocCount=291
DEBUG 2025/12/17 17:10:00   Bucket[18]: Key=斗六家商, DocCount=288
DEBUG 2025/12/17 17:10:00   Bucket[19]: Key=清華附小, DocCount=277
DEBUG 2025/12/17 17:10:00   Bucket[20]: Key=新港藝高, DocCount=270
DEBUG 2025/12/17 17:10:00   Bucket[21]: Key=內埔農工, DocCount=266
DEBUG 2025/12/17 17:10:00   Bucket[22]: Key=蘇澳海事, DocCount=250
DEBUG 2025/12/17 17:10:00   Bucket[23]: Key=竹南高中, DocCount=231
DEBUG 2025/12/17 17:10:00   Bucket[24]: Key=南大附中, DocCount=215
DEBUG 2025/12/17 17:10:00   Bucket[25]: Key=關西高中, DocCount=215
DEBUG 2025/12/17 17:10:00   Bucket[26]: Key=澎湖海事, DocCount=212
DEBUG 2025/12/17 17:10:00   Bucket[27]: Key=關山工商, DocCount=208
DEBUG 2025/12/17 17:10:00   Bucket[28]: Key=師大附中高中部, DocCount=205
DEBUG 2025/12/17 17:10:00   Bucket[29]: Key=後壁高中, DocCount=203
DEBUG 2025/12/17 17:10:00   Bucket[30]: Key=玉里高中, DocCount=198
DEBUG 2025/12/17 17:10:00   Bucket[31]: Key=基隆商工, DocCount=168
DEBUG 2025/12/17 17:10:00   Bucket[32]: Key=虎尾高中, DocCount=168
DEBUG 2025/12/17 17:10:00   Bucket[33]: Key=苗栗農工, DocCount=160
DEBUG 2025/12/17 17:10:00   Bucket[34]: Key=東港海事, DocCount=155
DEBUG 2025/12/17 17:10:00   Bucket[35]: Key=鳳山高中, DocCount=153
DEBUG 2025/12/17 17:10:00   Bucket[36]: Key=彰師附工, DocCount=150
DEBUG 2025/12/17 17:10:00   Bucket[37]: Key=新化高中, DocCount=149
DEBUG 2025/12/17 17:10:00   Bucket[38]: Key=南投特教, DocCount=147
DEBUG 2025/12/17 17:10:00   Bucket[39]: Key=嘉科實中, DocCount=146
DEBUG 2025/12/17 17:10:00   Bucket[40]: Key=南投高中, DocCount=144
DEBUG 2025/12/17 17:10:00   Bucket[41]: Key=新化高工, DocCount=142
DEBUG 2025/12/17 17:10:00   Bucket[42]: Key=新營高中, DocCount=142
DEBUG 2025/12/17 17:10:00   Bucket[43]: Key=員林農工, DocCount=138
DEBUG 2025/12/17 17:10:00   Bucket[44]: Key=嘉義高商, DocCount=136
DEBUG 2025/12/17 17:10:00   Bucket[45]: Key=屏東女中, DocCount=126
DEBUG 2025/12/17 17:10:00   Bucket[46]: Key=新營高工, DocCount=126
DEBUG 2025/12/17 17:10:00   Bucket[47]: Key=員林家商, DocCount=121
DEBUG 2025/12/17 17:10:00   Bucket[48]: Key=成大南工, DocCount=120
DEBUG 2025/12/17 17:10:00   Bucket[49]: Key=南大附聰, DocCount=119
DEBUG 2025/12/17 17:10:00   Bucket[50]: Key=苗栗高商, DocCount=118
DEBUG 2025/12/17 17:10:00   Bucket[51]: Key=苗栗高中, DocCount=116
DEBUG 2025/12/17 17:10:00   Bucket[52]: Key=彰化高商, DocCount=110
DEBUG 2025/12/17 17:10:00   Bucket[53]: Key=草屯商工, DocCount=99
DEBUG 2025/12/17 17:10:00   Bucket[54]: Key=水里商工, DocCount=93
DEBUG 2025/12/17 17:10:00   Bucket[55]: Key=新竹高工, DocCount=91
DEBUG 2025/12/17 17:10:00   Bucket[56]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:10:00   Bucket[57]: Key=雲林特教, DocCount=82
DEBUG 2025/12/17 17:10:00   Bucket[58]: Key=北港農工, DocCount=79
DEBUG 2025/12/17 17:10:00   Bucket[59]: Key=潮州高中, DocCount=79
DEBUG 2025/12/17 17:10:00   Bucket[60]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[61]: Key=屏東高中, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[62]: Key=羅東高商, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[63]: Key=新竹高中, DocCount=76
DEBUG 2025/12/17 17:10:00   Bucket[64]: Key=玉井工商, DocCount=76
DEBUG 2025/12/17 17:10:00   Bucket[65]: Key=蘭陽女中, DocCount=75
DEBUG 2025/12/17 17:10:00   Bucket[66]: Key=東石高中, DocCount=72
DEBUG 2025/12/17 17:10:00   Bucket[67]: Key=臺南一中, DocCount=72
DEBUG 2025/12/17 17:10:00   Bucket[68]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:10:00   Bucket[69]: Key=南大附小, DocCount=69
DEBUG 2025/12/17 17:10:00   Bucket[70]: Key=高餐大附中, DocCount=67
DEBUG 2025/12/17 17:10:00   Bucket[71]: Key=崇實高工, DocCount=65
DEBUG 2025/12/17 17:10:00   Bucket[72]: Key=臺南高商, DocCount=65
DEBUG 2025/12/17 17:10:00   Bucket[73]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:10:00   Bucket[74]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 17:10:00   Bucket[75]: Key=員林高中, DocCount=63
DEBUG 2025/12/17 17:10:00   Bucket[76]: Key=屏東高工, DocCount=62
DEBUG 2025/12/17 17:10:00   Bucket[77]: Key=北門高中, DocCount=61
DEBUG 2025/12/17 17:10:00   Bucket[78]: Key=竹東高中, DocCount=61
DEBUG 2025/12/17 17:10:00   Bucket[79]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:10:00   Bucket[80]: Key=華南高商, DocCount=60
DEBUG 2025/12/17 17:10:00   Bucket[81]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 17:10:00   Bucket[82]: Key=溪湖高中, DocCount=59
DEBUG 2025/12/17 17:10:00   Bucket[83]: Key=海大附中, DocCount=58
DEBUG 2025/12/17 17:10:00   Bucket[84]: Key=興大附農, DocCount=54
DEBUG 2025/12/17 17:10:00   Bucket[85]: Key=頭城家商, DocCount=54
DEBUG 2025/12/17 17:10:00   Bucket[86]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:10:00   Bucket[87]: Key=白河商工, DocCount=52
DEBUG 2025/12/17 17:10:00   Bucket[88]: Key=嘉義家職, DocCount=51
DEBUG 2025/12/17 17:10:00   Bucket[89]: Key=暨大附中, DocCount=50
DEBUG 2025/12/17 17:10:00   Bucket[90]: Key=旗山農工, DocCount=47
DEBUG 2025/12/17 17:10:00   Bucket[91]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:10:00   Bucket[92]: Key=羅東高工, DocCount=46
DEBUG 2025/12/17 17:10:00   Bucket[93]: Key=佳冬高農, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[94]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[95]: Key=臺東高商, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[96]: Key=花蓮高工, DocCount=41
DEBUG 2025/12/17 17:10:00   Bucket[97]: Key=宜蘭高中, DocCount=39
DEBUG 2025/12/17 17:10:00   Bucket[98]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:10:00   Bucket[99]: Key=師大附中國中部, DocCount=38
DEBUG 2025/12/17 17:10:00 ========================================================
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:10:07 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:10:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:10:08 ✅ Successfully flushed 28/28 history records to TimescaleDB
INFO 2025/12/17 17:10:08 Processing 15 offline devices
INFO 2025/12/17 17:10:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:10:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:10:08 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:10:08 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:10:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:10:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:10:08 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:10:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:10:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:10:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:10:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:10:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:10:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:10:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:10:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:10:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:10:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:10:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:10:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:10:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:10:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:10:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:10:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:10:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:10:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:10:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:10:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:10:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:10:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Memory usage critical: 91.14% (threshold: 90.00%)
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.32% (threshold: 85.00%)
INFO 2025/12/17 17:10:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:10:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:10:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:10:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:10:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:11:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:11:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:11:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:11:00 Field: school_name.keyword
DEBUG 2025/12/17 17:11:00 Time From: 2025-12-17T17:10:00.000+08:00
DEBUG 2025/12/17 17:11:00 Time To: 2025-12-17T17:11:00.000+08:00
DEBUG 2025/12/17 17:11:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:10:00.000+08:00",
					"lte": "2025-12-17T17:11:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:11:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:11:00 ES Response IsError: false
DEBUG 2025/12/17 17:11:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":513,"buckets":[{"key":"花蓮高農","doc_count":790},{"key":"黑快馬主機","doc_count":775},{"key":"新竹女中","doc_count":743},{"key":"仁愛高農","doc_count":652},{"key":"金門農工","doc_count":574},{"key":"金門高中","doc_count":539},{"key":"旗美高中","doc_count":478},{"key":"中大壢中","doc_count":457},{"key":"宜蘭高商","doc_count":453},{"key":"南投高商","doc_count":441},{"key":"臺東高中","doc_count":401},{"key":"華僑高中","doc_count":400},{"key":"竹北高中","doc_count":337},{"key":"花蓮高商","doc_count":336},{"key":"興大附中","doc_count":335},{"key":"內埔農工","doc_count":284},{"key":"清華附小","doc_count":281},{"key":"關山工商","doc_count":274},{"key":"關西高中","doc_count":268},{"key":"新港藝高","doc_count":260},{"key":"苗栗農工","doc_count":255},{"key":"蘇澳海事","doc_count":239},{"key":"師大附中高中部","doc_count":235},{"key":"玉里高中","doc_count":225},{"key":"後壁高中","doc_count":219},{"key":"斗六家商","doc_count":208},{"key":"竹南高中","doc_count":208},{"key":"虎尾高中","doc_count":194},{"key":"新營高工","doc_count":175},{"key":"屏東女中","doc_count":169},{"key":"中興高中","doc_count":168},{"key":"新化高中","doc_count":164},{"key":"南投特教","doc_count":157},{"key":"新化高工","doc_count":149},{"key":"澎湖海事","doc_count":144},{"key":"東港海事","doc_count":139},{"key":"員林家商","doc_count":138},{"key":"北斗家商","doc_count":127},{"key":"頭城家商","doc_count":126},{"key":"嘉義高商","doc_count":120},{"key":"二林工商","doc_count":115},{"key":"竹山高中","doc_count":113},{"key":"溪湖高中","doc_count":108},{"key":"北港高中","doc_count":104},{"key":"南大附聰","doc_count":99},{"key":"曾文農工","doc_count":99},{"key":"彰師附工","doc_count":98},{"key":"政大附中","doc_count":94},{"key":"嘉科實中","doc_count":88},{"key":"屏科實中","doc_count":85},{"key":"新營高中","doc_count":83},{"key":"基隆商工","doc_count":81},{"key":"北教大實小","doc_count":80},{"key":"南大附小","doc_count":80},{"key":"南投高中","doc_count":80},{"key":"彰化高商","doc_count":78},{"key":"水里商工","doc_count":78},{"key":"新竹高中","doc_count":77},{"key":"雲林特教","doc_count":77},{"key":"臺南高商","doc_count":76},{"key":"暨大附中","doc_count":74},{"key":"南大附中","doc_count":73},{"key":"苗栗高商","doc_count":71},{"key":"成大南工","doc_count":67},{"key":"新竹高工","doc_count":67},{"key":"羅東高商","doc_count":67},{"key":"臺東高商","doc_count":67},{"key":"花蓮高工","doc_count":65},{"key":"新豐高中","doc_count":64},{"key":"崇實高工","doc_count":63},{"key":"白河商工","doc_count":63},{"key":"嘉義高中","doc_count":62},{"key":"屏東高工","doc_count":61},{"key":"秀水高工","doc_count":60},{"key":"高餐大附中","doc_count":58},{"key":"屏東高中","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"臺南一中","doc_count":57},{"key":"土庫商工","doc_count":56},{"key":"海大附中","doc_count":56},{"key":"員林農工","doc_count":55},{"key":"新竹高商","doc_count":55},{"key":"屏東特教","doc_count":52},{"key":"苗栗高中","doc_count":52},{"key":"員林高中","doc_count":51},{"key":"華南高商","doc_count":50},{"key":"旗山農工","doc_count":49},{"key":"永靖高工","doc_count":49},{"key":"臺東女中","doc_count":49},{"key":"善化高中","doc_count":46},{"key":"北港農工","doc_count":45},{"key":"埔里高工","doc_count":45},{"key":"東石高中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"花蓮高中","doc_count":45},{"key":"北門高中","doc_count":44},{"key":"嘉義高工","doc_count":44},{"key":"羅東高工","doc_count":43},{"key":"宜蘭高中","doc_count":41},{"key":"花蓮特教","doc_count":41}]}}}
DEBUG 2025/12/17 17:11:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:11:00   Bucket[0]: Key=花蓮高農, DocCount=790
DEBUG 2025/12/17 17:11:00   Bucket[1]: Key=黑快馬主機, DocCount=775
DEBUG 2025/12/17 17:11:00   Bucket[2]: Key=新竹女中, DocCount=743
DEBUG 2025/12/17 17:11:00   Bucket[3]: Key=仁愛高農, DocCount=652
DEBUG 2025/12/17 17:11:00   Bucket[4]: Key=金門農工, DocCount=574
DEBUG 2025/12/17 17:11:00   Bucket[5]: Key=金門高中, DocCount=539
DEBUG 2025/12/17 17:11:00   Bucket[6]: Key=旗美高中, DocCount=478
DEBUG 2025/12/17 17:11:00   Bucket[7]: Key=中大壢中, DocCount=457
DEBUG 2025/12/17 17:11:00   Bucket[8]: Key=宜蘭高商, DocCount=453
DEBUG 2025/12/17 17:11:00   Bucket[9]: Key=南投高商, DocCount=441
DEBUG 2025/12/17 17:11:00   Bucket[10]: Key=臺東高中, DocCount=401
DEBUG 2025/12/17 17:11:00   Bucket[11]: Key=華僑高中, DocCount=400
DEBUG 2025/12/17 17:11:00   Bucket[12]: Key=竹北高中, DocCount=337
DEBUG 2025/12/17 17:11:00   Bucket[13]: Key=花蓮高商, DocCount=336
DEBUG 2025/12/17 17:11:00   Bucket[14]: Key=興大附中, DocCount=335
DEBUG 2025/12/17 17:11:00   Bucket[15]: Key=內埔農工, DocCount=284
DEBUG 2025/12/17 17:11:00   Bucket[16]: Key=清華附小, DocCount=281
DEBUG 2025/12/17 17:11:00   Bucket[17]: Key=關山工商, DocCount=274
DEBUG 2025/12/17 17:11:00   Bucket[18]: Key=關西高中, DocCount=268
DEBUG 2025/12/17 17:11:00   Bucket[19]: Key=新港藝高, DocCount=260
DEBUG 2025/12/17 17:11:00   Bucket[20]: Key=苗栗農工, DocCount=255
DEBUG 2025/12/17 17:11:00   Bucket[21]: Key=蘇澳海事, DocCount=239
DEBUG 2025/12/17 17:11:00   Bucket[22]: Key=師大附中高中部, DocCount=235
DEBUG 2025/12/17 17:11:00   Bucket[23]: Key=玉里高中, DocCount=225
DEBUG 2025/12/17 17:11:00   Bucket[24]: Key=後壁高中, DocCount=219
DEBUG 2025/12/17 17:11:00   Bucket[25]: Key=斗六家商, DocCount=208
DEBUG 2025/12/17 17:11:00   Bucket[26]: Key=竹南高中, DocCount=208
DEBUG 2025/12/17 17:11:00   Bucket[27]: Key=虎尾高中, DocCount=194
DEBUG 2025/12/17 17:11:00   Bucket[28]: Key=新營高工, DocCount=175
DEBUG 2025/12/17 17:11:00   Bucket[29]: Key=屏東女中, DocCount=169
DEBUG 2025/12/17 17:11:00   Bucket[30]: Key=中興高中, DocCount=168
DEBUG 2025/12/17 17:11:00   Bucket[31]: Key=新化高中, DocCount=164
DEBUG 2025/12/17 17:11:00   Bucket[32]: Key=南投特教, DocCount=157
DEBUG 2025/12/17 17:11:00   Bucket[33]: Key=新化高工, DocCount=149
DEBUG 2025/12/17 17:11:00   Bucket[34]: Key=澎湖海事, DocCount=144
DEBUG 2025/12/17 17:11:00   Bucket[35]: Key=東港海事, DocCount=139
DEBUG 2025/12/17 17:11:00   Bucket[36]: Key=員林家商, DocCount=138
DEBUG 2025/12/17 17:11:00   Bucket[37]: Key=北斗家商, DocCount=127
DEBUG 2025/12/17 17:11:00   Bucket[38]: Key=頭城家商, DocCount=126
DEBUG 2025/12/17 17:11:00   Bucket[39]: Key=嘉義高商, DocCount=120
DEBUG 2025/12/17 17:11:00   Bucket[40]: Key=二林工商, DocCount=115
DEBUG 2025/12/17 17:11:00   Bucket[41]: Key=竹山高中, DocCount=113
DEBUG 2025/12/17 17:11:00   Bucket[42]: Key=溪湖高中, DocCount=108
DEBUG 2025/12/17 17:11:00   Bucket[43]: Key=北港高中, DocCount=104
DEBUG 2025/12/17 17:11:00   Bucket[44]: Key=南大附聰, DocCount=99
DEBUG 2025/12/17 17:11:00   Bucket[45]: Key=曾文農工, DocCount=99
DEBUG 2025/12/17 17:11:00   Bucket[46]: Key=彰師附工, DocCount=98
DEBUG 2025/12/17 17:11:00   Bucket[47]: Key=政大附中, DocCount=94
DEBUG 2025/12/17 17:11:00   Bucket[48]: Key=嘉科實中, DocCount=88
DEBUG 2025/12/17 17:11:00   Bucket[49]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:11:00   Bucket[50]: Key=新營高中, DocCount=83
DEBUG 2025/12/17 17:11:00   Bucket[51]: Key=基隆商工, DocCount=81
DEBUG 2025/12/17 17:11:00   Bucket[52]: Key=北教大實小, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[53]: Key=南大附小, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[54]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[55]: Key=彰化高商, DocCount=78
DEBUG 2025/12/17 17:11:00   Bucket[56]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 17:11:00   Bucket[57]: Key=新竹高中, DocCount=77
DEBUG 2025/12/17 17:11:00   Bucket[58]: Key=雲林特教, DocCount=77
DEBUG 2025/12/17 17:11:00   Bucket[59]: Key=臺南高商, DocCount=76
DEBUG 2025/12/17 17:11:00   Bucket[60]: Key=暨大附中, DocCount=74
DEBUG 2025/12/17 17:11:00   Bucket[61]: Key=南大附中, DocCount=73
DEBUG 2025/12/17 17:11:00   Bucket[62]: Key=苗栗高商, DocCount=71
DEBUG 2025/12/17 17:11:00   Bucket[63]: Key=成大南工, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[64]: Key=新竹高工, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[65]: Key=羅東高商, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[66]: Key=臺東高商, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[67]: Key=花蓮高工, DocCount=65
DEBUG 2025/12/17 17:11:00   Bucket[68]: Key=新豐高中, DocCount=64
DEBUG 2025/12/17 17:11:00   Bucket[69]: Key=崇實高工, DocCount=63
DEBUG 2025/12/17 17:11:00   Bucket[70]: Key=白河商工, DocCount=63
DEBUG 2025/12/17 17:11:00   Bucket[71]: Key=嘉義高中, DocCount=62
DEBUG 2025/12/17 17:11:00   Bucket[72]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 17:11:00   Bucket[73]: Key=秀水高工, DocCount=60
DEBUG 2025/12/17 17:11:00   Bucket[74]: Key=高餐大附中, DocCount=58
DEBUG 2025/12/17 17:11:00   Bucket[75]: Key=屏東高中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[76]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[77]: Key=臺南一中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[78]: Key=土庫商工, DocCount=56
DEBUG 2025/12/17 17:11:00   Bucket[79]: Key=海大附中, DocCount=56
DEBUG 2025/12/17 17:11:00   Bucket[80]: Key=員林農工, DocCount=55
DEBUG 2025/12/17 17:11:00   Bucket[81]: Key=新竹高商, DocCount=55
DEBUG 2025/12/17 17:11:00   Bucket[82]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 17:11:00   Bucket[83]: Key=苗栗高中, DocCount=52
DEBUG 2025/12/17 17:11:00   Bucket[84]: Key=員林高中, DocCount=51
DEBUG 2025/12/17 17:11:00   Bucket[85]: Key=華南高商, DocCount=50
DEBUG 2025/12/17 17:11:00   Bucket[86]: Key=旗山農工, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[87]: Key=永靖高工, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[88]: Key=臺東女中, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[89]: Key=善化高中, DocCount=46
DEBUG 2025/12/17 17:11:00   Bucket[90]: Key=北港農工, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[91]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[92]: Key=東石高中, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[93]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[94]: Key=花蓮高中, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[95]: Key=北門高中, DocCount=44
DEBUG 2025/12/17 17:11:00   Bucket[96]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 17:11:00   Bucket[97]: Key=羅東高工, DocCount=43
DEBUG 2025/12/17 17:11:00   Bucket[98]: Key=宜蘭高中, DocCount=41
DEBUG 2025/12/17 17:11:00   Bucket[99]: Key=花蓮特教, DocCount=41
DEBUG 2025/12/17 17:11:00 ========================================================
INFO 2025/12/17 17:11:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:11:08 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:11:09 Processing 15 offline devices
INFO 2025/12/17 17:11:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:11:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:11:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:11:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:11:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:11:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:11:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:11:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:11:09 Creating history record for offline device: 鳳山高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 鳳山高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 鳳山高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:11:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:11:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:11:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:11:09 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:11:09 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:11:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:11:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:11:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:11:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:11:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:11:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:11:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:11:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:11:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:11:13 ✅ Successfully flushed 30/30 history records to TimescaleDB
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:11:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:11:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:11:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:11:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:11:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:11:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:11:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:11:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:11:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:11:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:11:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:11:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:11:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:11:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:11:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:11:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:11:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.08% (threshold: 90.00%)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:11:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:11:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:11:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:11:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:12:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:12:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:12:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:12:00 Field: school_name.keyword
DEBUG 2025/12/17 17:12:00 Time From: 2025-12-17T17:11:00.000+08:00
DEBUG 2025/12/17 17:12:00 Time To: 2025-12-17T17:12:00.000+08:00
DEBUG 2025/12/17 17:12:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:11:00.000+08:00",
					"lte": "2025-12-17T17:12:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:12:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:12:00 ES Response IsError: false
DEBUG 2025/12/17 17:12:00 ES Response Body:
{"took":60,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":832},{"key":"花蓮高農","doc_count":753},{"key":"新竹女中","doc_count":690},{"key":"仁愛高農","doc_count":595},{"key":"金門農工","doc_count":589},{"key":"金門高中","doc_count":543},{"key":"宜蘭高商","doc_count":490},{"key":"中大壢中","doc_count":464},{"key":"旗美高中","doc_count":464},{"key":"竹北高中","doc_count":359},{"key":"華僑高中","doc_count":357},{"key":"澎湖海事","doc_count":355},{"key":"臺東高中","doc_count":355},{"key":"興大附中","doc_count":339},{"key":"政大附中","doc_count":326},{"key":"北門高中","doc_count":324},{"key":"南投高商","doc_count":299},{"key":"關西高中","doc_count":287},{"key":"虎尾高中","doc_count":284},{"key":"新港藝高","doc_count":259},{"key":"內埔農工","doc_count":258},{"key":"清華附小","doc_count":257},{"key":"玉里高中","doc_count":254},{"key":"花蓮高商","doc_count":245},{"key":"蘇澳海事","doc_count":231},{"key":"竹南高中","doc_count":216},{"key":"關山工商","doc_count":208},{"key":"苗栗農工","doc_count":195},{"key":"斗六家商","doc_count":187},{"key":"屏東女中","doc_count":186},{"key":"花蓮高中","doc_count":185},{"key":"後壁高中","doc_count":168},{"key":"東港海事","doc_count":159},{"key":"南投特教","doc_count":151},{"key":"彰師附工","doc_count":148},{"key":"南大附中","doc_count":139},{"key":"新化高工","doc_count":138},{"key":"南大附聰","doc_count":118},{"key":"北教大實小","doc_count":115},{"key":"師大附中高中部","doc_count":112},{"key":"新化高中","doc_count":110},{"key":"鳳山高中","doc_count":108},{"key":"成大南工","doc_count":107},{"key":"北斗家商","doc_count":104},{"key":"員林家商","doc_count":103},{"key":"嘉科實中","doc_count":100},{"key":"花蓮高工","doc_count":100},{"key":"南投高中","doc_count":98},{"key":"新營高工","doc_count":95},{"key":"秀水高工","doc_count":93},{"key":"暨大附中","doc_count":92},{"key":"草屯商工","doc_count":92},{"key":"彰化高商","doc_count":89},{"key":"員林農工","doc_count":87},{"key":"屏東高工","doc_count":87},{"key":"嘉義高商","doc_count":85},{"key":"頭城家商","doc_count":85},{"key":"臺南高商","doc_count":84},{"key":"雲林特教","doc_count":81},{"key":"苗栗高中","doc_count":80},{"key":"屏科實中","doc_count":79},{"key":"崇實高工","doc_count":77},{"key":"嘉義高中","doc_count":76},{"key":"永靖高工","doc_count":76},{"key":"臺南一中","doc_count":72},{"key":"新營高中","doc_count":71},{"key":"新竹高中","doc_count":70},{"key":"水里商工","doc_count":70},{"key":"竹山高中","doc_count":70},{"key":"曾文農工","doc_count":69},{"key":"中興高中","doc_count":68},{"key":"宜蘭高中","doc_count":68},{"key":"屏東高中","doc_count":68},{"key":"臺東高商","doc_count":66},{"key":"苗栗高商","doc_count":63},{"key":"北港高中","doc_count":59},{"key":"佳冬高農","doc_count":58},{"key":"竹東高中","doc_count":58},{"key":"東石高中","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"新竹高工","doc_count":56},{"key":"善化高中","doc_count":55},{"key":"埔里高工","doc_count":55},{"key":"二林工商","doc_count":51},{"key":"北港農工","doc_count":51},{"key":"花蓮特教","doc_count":51},{"key":"南大附小","doc_count":50},{"key":"羅東高工","doc_count":50},{"key":"興大附農","doc_count":49},{"key":"嘉義家職","doc_count":48},{"key":"基隆商工","doc_count":48},{"key":"海大附中","doc_count":48},{"key":"溪湖高中","doc_count":46},{"key":"華南高商","doc_count":46},{"key":"羅東高商","doc_count":44},{"key":"新豐高中","doc_count":43},{"key":"新竹高商","doc_count":41},{"key":"成功商水","doc_count":40},{"key":"嘉義高工","doc_count":39},{"key":"屏北高中","doc_count":39}]}}}
DEBUG 2025/12/17 17:12:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:12:00   Bucket[0]: Key=黑快馬主機, DocCount=832
DEBUG 2025/12/17 17:12:00   Bucket[1]: Key=花蓮高農, DocCount=753
DEBUG 2025/12/17 17:12:00   Bucket[2]: Key=新竹女中, DocCount=690
DEBUG 2025/12/17 17:12:00   Bucket[3]: Key=仁愛高農, DocCount=595
DEBUG 2025/12/17 17:12:00   Bucket[4]: Key=金門農工, DocCount=589
DEBUG 2025/12/17 17:12:00   Bucket[5]: Key=金門高中, DocCount=543
DEBUG 2025/12/17 17:12:00   Bucket[6]: Key=宜蘭高商, DocCount=490
DEBUG 2025/12/17 17:12:00   Bucket[7]: Key=中大壢中, DocCount=464
DEBUG 2025/12/17 17:12:00   Bucket[8]: Key=旗美高中, DocCount=464
DEBUG 2025/12/17 17:12:00   Bucket[9]: Key=竹北高中, DocCount=359
DEBUG 2025/12/17 17:12:00   Bucket[10]: Key=華僑高中, DocCount=357
DEBUG 2025/12/17 17:12:00   Bucket[11]: Key=澎湖海事, DocCount=355
DEBUG 2025/12/17 17:12:00   Bucket[12]: Key=臺東高中, DocCount=355
DEBUG 2025/12/17 17:12:00   Bucket[13]: Key=興大附中, DocCount=339
DEBUG 2025/12/17 17:12:00   Bucket[14]: Key=政大附中, DocCount=326
DEBUG 2025/12/17 17:12:00   Bucket[15]: Key=北門高中, DocCount=324
DEBUG 2025/12/17 17:12:00   Bucket[16]: Key=南投高商, DocCount=299
DEBUG 2025/12/17 17:12:00   Bucket[17]: Key=關西高中, DocCount=287
DEBUG 2025/12/17 17:12:00   Bucket[18]: Key=虎尾高中, DocCount=284
DEBUG 2025/12/17 17:12:00   Bucket[19]: Key=新港藝高, DocCount=259
DEBUG 2025/12/17 17:12:00   Bucket[20]: Key=內埔農工, DocCount=258
DEBUG 2025/12/17 17:12:00   Bucket[21]: Key=清華附小, DocCount=257
DEBUG 2025/12/17 17:12:00   Bucket[22]: Key=玉里高中, DocCount=254
DEBUG 2025/12/17 17:12:00   Bucket[23]: Key=花蓮高商, DocCount=245
DEBUG 2025/12/17 17:12:00   Bucket[24]: Key=蘇澳海事, DocCount=231
DEBUG 2025/12/17 17:12:00   Bucket[25]: Key=竹南高中, DocCount=216
DEBUG 2025/12/17 17:12:00   Bucket[26]: Key=關山工商, DocCount=208
DEBUG 2025/12/17 17:12:00   Bucket[27]: Key=苗栗農工, DocCount=195
DEBUG 2025/12/17 17:12:00   Bucket[28]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:12:00   Bucket[29]: Key=屏東女中, DocCount=186
DEBUG 2025/12/17 17:12:00   Bucket[30]: Key=花蓮高中, DocCount=185
DEBUG 2025/12/17 17:12:00   Bucket[31]: Key=後壁高中, DocCount=168
DEBUG 2025/12/17 17:12:00   Bucket[32]: Key=東港海事, DocCount=159
DEBUG 2025/12/17 17:12:00   Bucket[33]: Key=南投特教, DocCount=151
DEBUG 2025/12/17 17:12:00   Bucket[34]: Key=彰師附工, DocCount=148
DEBUG 2025/12/17 17:12:00   Bucket[35]: Key=南大附中, DocCount=139
DEBUG 2025/12/17 17:12:00   Bucket[36]: Key=新化高工, DocCount=138
DEBUG 2025/12/17 17:12:00   Bucket[37]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:12:00   Bucket[38]: Key=北教大實小, DocCount=115
DEBUG 2025/12/17 17:12:00   Bucket[39]: Key=師大附中高中部, DocCount=112
DEBUG 2025/12/17 17:12:00   Bucket[40]: Key=新化高中, DocCount=110
DEBUG 2025/12/17 17:12:00   Bucket[41]: Key=鳳山高中, DocCount=108
DEBUG 2025/12/17 17:12:00   Bucket[42]: Key=成大南工, DocCount=107
DEBUG 2025/12/17 17:12:00   Bucket[43]: Key=北斗家商, DocCount=104
DEBUG 2025/12/17 17:12:00   Bucket[44]: Key=員林家商, DocCount=103
DEBUG 2025/12/17 17:12:00   Bucket[45]: Key=嘉科實中, DocCount=100
DEBUG 2025/12/17 17:12:00   Bucket[46]: Key=花蓮高工, DocCount=100
DEBUG 2025/12/17 17:12:00   Bucket[47]: Key=南投高中, DocCount=98
DEBUG 2025/12/17 17:12:00   Bucket[48]: Key=新營高工, DocCount=95
DEBUG 2025/12/17 17:12:00   Bucket[49]: Key=秀水高工, DocCount=93
DEBUG 2025/12/17 17:12:00   Bucket[50]: Key=暨大附中, DocCount=92
DEBUG 2025/12/17 17:12:00   Bucket[51]: Key=草屯商工, DocCount=92
DEBUG 2025/12/17 17:12:00   Bucket[52]: Key=彰化高商, DocCount=89
DEBUG 2025/12/17 17:12:00   Bucket[53]: Key=員林農工, DocCount=87
DEBUG 2025/12/17 17:12:00   Bucket[54]: Key=屏東高工, DocCount=87
DEBUG 2025/12/17 17:12:00   Bucket[55]: Key=嘉義高商, DocCount=85
DEBUG 2025/12/17 17:12:00   Bucket[56]: Key=頭城家商, DocCount=85
DEBUG 2025/12/17 17:12:00   Bucket[57]: Key=臺南高商, DocCount=84
DEBUG 2025/12/17 17:12:00   Bucket[58]: Key=雲林特教, DocCount=81
DEBUG 2025/12/17 17:12:00   Bucket[59]: Key=苗栗高中, DocCount=80
DEBUG 2025/12/17 17:12:00   Bucket[60]: Key=屏科實中, DocCount=79
DEBUG 2025/12/17 17:12:00   Bucket[61]: Key=崇實高工, DocCount=77
DEBUG 2025/12/17 17:12:00   Bucket[62]: Key=嘉義高中, DocCount=76
DEBUG 2025/12/17 17:12:00   Bucket[63]: Key=永靖高工, DocCount=76
DEBUG 2025/12/17 17:12:00   Bucket[64]: Key=臺南一中, DocCount=72
DEBUG 2025/12/17 17:12:00   Bucket[65]: Key=新營高中, DocCount=71
DEBUG 2025/12/17 17:12:00   Bucket[66]: Key=新竹高中, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[67]: Key=水里商工, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[68]: Key=竹山高中, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[69]: Key=曾文農工, DocCount=69
DEBUG 2025/12/17 17:12:00   Bucket[70]: Key=中興高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[71]: Key=宜蘭高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[72]: Key=屏東高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[73]: Key=臺東高商, DocCount=66
DEBUG 2025/12/17 17:12:00   Bucket[74]: Key=苗栗高商, DocCount=63
DEBUG 2025/12/17 17:12:00   Bucket[75]: Key=北港高中, DocCount=59
DEBUG 2025/12/17 17:12:00   Bucket[76]: Key=佳冬高農, DocCount=58
DEBUG 2025/12/17 17:12:00   Bucket[77]: Key=竹東高中, DocCount=58
DEBUG 2025/12/17 17:12:00   Bucket[78]: Key=東石高中, DocCount=57
DEBUG 2025/12/17 17:12:00   Bucket[79]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:12:00   Bucket[80]: Key=新竹高工, DocCount=56
DEBUG 2025/12/17 17:12:00   Bucket[81]: Key=善化高中, DocCount=55
DEBUG 2025/12/17 17:12:00   Bucket[82]: Key=埔里高工, DocCount=55
DEBUG 2025/12/17 17:12:00   Bucket[83]: Key=二林工商, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[84]: Key=北港農工, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[85]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[86]: Key=南大附小, DocCount=50
DEBUG 2025/12/17 17:12:00   Bucket[87]: Key=羅東高工, DocCount=50
DEBUG 2025/12/17 17:12:00   Bucket[88]: Key=興大附農, DocCount=49
DEBUG 2025/12/17 17:12:00   Bucket[89]: Key=嘉義家職, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[90]: Key=基隆商工, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[91]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[92]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 17:12:00   Bucket[93]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:12:00   Bucket[94]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 17:12:00   Bucket[95]: Key=新豐高中, DocCount=43
DEBUG 2025/12/17 17:12:00   Bucket[96]: Key=新竹高商, DocCount=41
DEBUG 2025/12/17 17:12:00   Bucket[97]: Key=成功商水, DocCount=40
DEBUG 2025/12/17 17:12:00   Bucket[98]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:12:00   Bucket[99]: Key=屏北高中, DocCount=39
DEBUG 2025/12/17 17:12:00 ========================================================
INFO 2025/12/17 17:12:03 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:12:08 ✅ Successfully flushed 5/5 history records to TimescaleDB
INFO 2025/12/17 17:12:10 Processing 15 offline devices
INFO 2025/12/17 17:12:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:12:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:12:10 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:12:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:12:10 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:12:11 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:12:11 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:12:11 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:12:11 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:12:13 ✅ Successfully flushed 34/34 history records to TimescaleDB
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:12:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:12:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:12:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:12:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:12:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:12:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:12:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:12:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:12:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:12:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:12:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:12:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:12:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:12:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:12:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.57% (threshold: 80.00%)
INFO 2025/12/17 17:12:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:12:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:12:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:12:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:12:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:12:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:12:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:12:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:13:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:13:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:13:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:13:00 Field: school_name.keyword
DEBUG 2025/12/17 17:13:00 Time From: 2025-12-17T17:12:00.000+08:00
DEBUG 2025/12/17 17:13:00 Time To: 2025-12-17T17:13:00.000+08:00
DEBUG 2025/12/17 17:13:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:12:00.000+08:00",
					"lte": "2025-12-17T17:13:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:13:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:13:00 ES Response IsError: false
DEBUG 2025/12/17 17:13:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":451,"buckets":[{"key":"黑快馬主機","doc_count":1360},{"key":"花蓮高農","doc_count":746},{"key":"新竹女中","doc_count":683},{"key":"金門農工","doc_count":658},{"key":"仁愛高農","doc_count":545},{"key":"金門高中","doc_count":536},{"key":"虎尾高中","doc_count":456},{"key":"宜蘭高商","doc_count":439},{"key":"旗美高中","doc_count":432},{"key":"北門高中","doc_count":425},{"key":"臺東高中","doc_count":409},{"key":"竹北高中","doc_count":405},{"key":"華僑高中","doc_count":382},{"key":"鳳山高中","doc_count":355},{"key":"花蓮高商","doc_count":312},{"key":"興大附中","doc_count":299},{"key":"玉里高中","doc_count":297},{"key":"新港藝高","doc_count":282},{"key":"政大附中","doc_count":279},{"key":"清華附小","doc_count":274},{"key":"關西高中","doc_count":274},{"key":"斗六家商","doc_count":267},{"key":"竹南高中","doc_count":264},{"key":"南投高商","doc_count":254},{"key":"新化高中","doc_count":244},{"key":"內埔農工","doc_count":242},{"key":"蘇澳海事","doc_count":224},{"key":"屏東女中","doc_count":199},{"key":"後壁高中","doc_count":198},{"key":"關山工商","doc_count":196},{"key":"中大壢中","doc_count":195},{"key":"澎湖海事","doc_count":187},{"key":"新化高工","doc_count":185},{"key":"彰師附工","doc_count":180},{"key":"苗栗農工","doc_count":169},{"key":"南投特教","doc_count":143},{"key":"嘉義高中","doc_count":133},{"key":"彰化高商","doc_count":127},{"key":"嘉義高商","doc_count":118},{"key":"南投高中","doc_count":117},{"key":"嘉科實中","doc_count":115},{"key":"東港海事","doc_count":112},{"key":"溪湖高中","doc_count":112},{"key":"花蓮高中","doc_count":111},{"key":"新營高工","doc_count":104},{"key":"北教大實小","doc_count":102},{"key":"員林家商","doc_count":100},{"key":"南大附聰","doc_count":98},{"key":"師大附中高中部","doc_count":97},{"key":"成大南工","doc_count":95},{"key":"苗栗高中","doc_count":94},{"key":"北斗家商","doc_count":93},{"key":"草屯商工","doc_count":93},{"key":"屏東高工","doc_count":91},{"key":"南大附中","doc_count":89},{"key":"羅東高商","doc_count":86},{"key":"暨大附中","doc_count":84},{"key":"北港高中","doc_count":82},{"key":"屏科實中","doc_count":82},{"key":"員林農工","doc_count":81},{"key":"臺南高商","doc_count":81},{"key":"水里商工","doc_count":78},{"key":"北港農工","doc_count":75},{"key":"新營高中","doc_count":73},{"key":"新竹高中","doc_count":72},{"key":"苗栗高商","doc_count":72},{"key":"嘉義家職","doc_count":63},{"key":"永靖高工","doc_count":63},{"key":"新竹高工","doc_count":62},{"key":"崇實高工","doc_count":61},{"key":"潮州高中","doc_count":61},{"key":"海大附中","doc_count":57},{"key":"高餐大附中","doc_count":55},{"key":"中興高中","doc_count":54},{"key":"二林工商","doc_count":54},{"key":"新竹高商","doc_count":53},{"key":"秀水高工","doc_count":53},{"key":"竹山高中","doc_count":53},{"key":"臺南一中","doc_count":53},{"key":"竹東高中","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"雲林特教","doc_count":50},{"key":"基隆商工","doc_count":49},{"key":"頭城家商","doc_count":48},{"key":"土庫商工","doc_count":47},{"key":"宜蘭高中","doc_count":46},{"key":"埔里高工","doc_count":45},{"key":"善化高中","doc_count":44},{"key":"嘉義高工","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"曾文農工","doc_count":39},{"key":"蘭陽女中","doc_count":38},{"key":"華南高商","doc_count":37},{"key":"家齊高中","doc_count":36},{"key":"東石高中","doc_count":36},{"key":"玉井工商","doc_count":36},{"key":"師大附中國中部","doc_count":35},{"key":"旗山農工","doc_count":35},{"key":"屏東高中","doc_count":34},{"key":"羅東高工","doc_count":34}]}}}
DEBUG 2025/12/17 17:13:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:13:00   Bucket[0]: Key=黑快馬主機, DocCount=1360
DEBUG 2025/12/17 17:13:00   Bucket[1]: Key=花蓮高農, DocCount=746
DEBUG 2025/12/17 17:13:00   Bucket[2]: Key=新竹女中, DocCount=683
DEBUG 2025/12/17 17:13:00   Bucket[3]: Key=金門農工, DocCount=658
DEBUG 2025/12/17 17:13:00   Bucket[4]: Key=仁愛高農, DocCount=545
DEBUG 2025/12/17 17:13:00   Bucket[5]: Key=金門高中, DocCount=536
DEBUG 2025/12/17 17:13:00   Bucket[6]: Key=虎尾高中, DocCount=456
DEBUG 2025/12/17 17:13:00   Bucket[7]: Key=宜蘭高商, DocCount=439
DEBUG 2025/12/17 17:13:00   Bucket[8]: Key=旗美高中, DocCount=432
DEBUG 2025/12/17 17:13:00   Bucket[9]: Key=北門高中, DocCount=425
DEBUG 2025/12/17 17:13:00   Bucket[10]: Key=臺東高中, DocCount=409
DEBUG 2025/12/17 17:13:00   Bucket[11]: Key=竹北高中, DocCount=405
DEBUG 2025/12/17 17:13:00   Bucket[12]: Key=華僑高中, DocCount=382
DEBUG 2025/12/17 17:13:00   Bucket[13]: Key=鳳山高中, DocCount=355
DEBUG 2025/12/17 17:13:00   Bucket[14]: Key=花蓮高商, DocCount=312
DEBUG 2025/12/17 17:13:00   Bucket[15]: Key=興大附中, DocCount=299
DEBUG 2025/12/17 17:13:00   Bucket[16]: Key=玉里高中, DocCount=297
DEBUG 2025/12/17 17:13:00   Bucket[17]: Key=新港藝高, DocCount=282
DEBUG 2025/12/17 17:13:00   Bucket[18]: Key=政大附中, DocCount=279
DEBUG 2025/12/17 17:13:00   Bucket[19]: Key=清華附小, DocCount=274
DEBUG 2025/12/17 17:13:00   Bucket[20]: Key=關西高中, DocCount=274
DEBUG 2025/12/17 17:13:00   Bucket[21]: Key=斗六家商, DocCount=267
DEBUG 2025/12/17 17:13:00   Bucket[22]: Key=竹南高中, DocCount=264
DEBUG 2025/12/17 17:13:00   Bucket[23]: Key=南投高商, DocCount=254
DEBUG 2025/12/17 17:13:00   Bucket[24]: Key=新化高中, DocCount=244
DEBUG 2025/12/17 17:13:00   Bucket[25]: Key=內埔農工, DocCount=242
DEBUG 2025/12/17 17:13:00   Bucket[26]: Key=蘇澳海事, DocCount=224
DEBUG 2025/12/17 17:13:00   Bucket[27]: Key=屏東女中, DocCount=199
DEBUG 2025/12/17 17:13:00   Bucket[28]: Key=後壁高中, DocCount=198
DEBUG 2025/12/17 17:13:00   Bucket[29]: Key=關山工商, DocCount=196
DEBUG 2025/12/17 17:13:00   Bucket[30]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:13:00   Bucket[31]: Key=澎湖海事, DocCount=187
DEBUG 2025/12/17 17:13:00   Bucket[32]: Key=新化高工, DocCount=185
DEBUG 2025/12/17 17:13:00   Bucket[33]: Key=彰師附工, DocCount=180
DEBUG 2025/12/17 17:13:00   Bucket[34]: Key=苗栗農工, DocCount=169
DEBUG 2025/12/17 17:13:00   Bucket[35]: Key=南投特教, DocCount=143
DEBUG 2025/12/17 17:13:00   Bucket[36]: Key=嘉義高中, DocCount=133
DEBUG 2025/12/17 17:13:00   Bucket[37]: Key=彰化高商, DocCount=127
DEBUG 2025/12/17 17:13:00   Bucket[38]: Key=嘉義高商, DocCount=118
DEBUG 2025/12/17 17:13:00   Bucket[39]: Key=南投高中, DocCount=117
DEBUG 2025/12/17 17:13:00   Bucket[40]: Key=嘉科實中, DocCount=115
DEBUG 2025/12/17 17:13:00   Bucket[41]: Key=東港海事, DocCount=112
DEBUG 2025/12/17 17:13:00   Bucket[42]: Key=溪湖高中, DocCount=112
DEBUG 2025/12/17 17:13:00   Bucket[43]: Key=花蓮高中, DocCount=111
DEBUG 2025/12/17 17:13:00   Bucket[44]: Key=新營高工, DocCount=104
DEBUG 2025/12/17 17:13:00   Bucket[45]: Key=北教大實小, DocCount=102
DEBUG 2025/12/17 17:13:00   Bucket[46]: Key=員林家商, DocCount=100
DEBUG 2025/12/17 17:13:00   Bucket[47]: Key=南大附聰, DocCount=98
DEBUG 2025/12/17 17:13:00   Bucket[48]: Key=師大附中高中部, DocCount=97
DEBUG 2025/12/17 17:13:00   Bucket[49]: Key=成大南工, DocCount=95
DEBUG 2025/12/17 17:13:00   Bucket[50]: Key=苗栗高中, DocCount=94
DEBUG 2025/12/17 17:13:00   Bucket[51]: Key=北斗家商, DocCount=93
DEBUG 2025/12/17 17:13:00   Bucket[52]: Key=草屯商工, DocCount=93
DEBUG 2025/12/17 17:13:00   Bucket[53]: Key=屏東高工, DocCount=91
DEBUG 2025/12/17 17:13:00   Bucket[54]: Key=南大附中, DocCount=89
DEBUG 2025/12/17 17:13:00   Bucket[55]: Key=羅東高商, DocCount=86
DEBUG 2025/12/17 17:13:00   Bucket[56]: Key=暨大附中, DocCount=84
DEBUG 2025/12/17 17:13:00   Bucket[57]: Key=北港高中, DocCount=82
DEBUG 2025/12/17 17:13:00   Bucket[58]: Key=屏科實中, DocCount=82
DEBUG 2025/12/17 17:13:00   Bucket[59]: Key=員林農工, DocCount=81
DEBUG 2025/12/17 17:13:00   Bucket[60]: Key=臺南高商, DocCount=81
DEBUG 2025/12/17 17:13:00   Bucket[61]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 17:13:00   Bucket[62]: Key=北港農工, DocCount=75
DEBUG 2025/12/17 17:13:00   Bucket[63]: Key=新營高中, DocCount=73
DEBUG 2025/12/17 17:13:00   Bucket[64]: Key=新竹高中, DocCount=72
DEBUG 2025/12/17 17:13:00   Bucket[65]: Key=苗栗高商, DocCount=72
DEBUG 2025/12/17 17:13:00   Bucket[66]: Key=嘉義家職, DocCount=63
DEBUG 2025/12/17 17:13:00   Bucket[67]: Key=永靖高工, DocCount=63
DEBUG 2025/12/17 17:13:00   Bucket[68]: Key=新竹高工, DocCount=62
DEBUG 2025/12/17 17:13:00   Bucket[69]: Key=崇實高工, DocCount=61
DEBUG 2025/12/17 17:13:00   Bucket[70]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:13:00   Bucket[71]: Key=海大附中, DocCount=57
DEBUG 2025/12/17 17:13:00   Bucket[72]: Key=高餐大附中, DocCount=55
DEBUG 2025/12/17 17:13:00   Bucket[73]: Key=中興高中, DocCount=54
DEBUG 2025/12/17 17:13:00   Bucket[74]: Key=二林工商, DocCount=54
DEBUG 2025/12/17 17:13:00   Bucket[75]: Key=新竹高商, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[76]: Key=秀水高工, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[77]: Key=竹山高中, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[78]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[79]: Key=竹東高中, DocCount=52
DEBUG 2025/12/17 17:13:00   Bucket[80]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:13:00   Bucket[81]: Key=雲林特教, DocCount=50
DEBUG 2025/12/17 17:13:00   Bucket[82]: Key=基隆商工, DocCount=49
DEBUG 2025/12/17 17:13:00   Bucket[83]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 17:13:00   Bucket[84]: Key=土庫商工, DocCount=47
DEBUG 2025/12/17 17:13:00   Bucket[85]: Key=宜蘭高中, DocCount=46
DEBUG 2025/12/17 17:13:00   Bucket[86]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:13:00   Bucket[87]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:13:00   Bucket[88]: Key=嘉義高工, DocCount=42
DEBUG 2025/12/17 17:13:00   Bucket[89]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:13:00   Bucket[90]: Key=曾文農工, DocCount=39
DEBUG 2025/12/17 17:13:00   Bucket[91]: Key=蘭陽女中, DocCount=38
DEBUG 2025/12/17 17:13:00   Bucket[92]: Key=華南高商, DocCount=37
DEBUG 2025/12/17 17:13:00   Bucket[93]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[94]: Key=東石高中, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[95]: Key=玉井工商, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[96]: Key=師大附中國中部, DocCount=35
DEBUG 2025/12/17 17:13:00   Bucket[97]: Key=旗山農工, DocCount=35
DEBUG 2025/12/17 17:13:00   Bucket[98]: Key=屏東高中, DocCount=34
DEBUG 2025/12/17 17:13:00   Bucket[99]: Key=羅東高工, DocCount=34
DEBUG 2025/12/17 17:13:00 ========================================================
INFO 2025/12/17 17:13:03 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:13:08 ✅ Successfully flushed 11/11 history records to TimescaleDB
INFO 2025/12/17 17:13:08 Processing 15 offline devices
INFO 2025/12/17 17:13:08 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:13:08 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:13:08 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:13:08 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:13:08 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:13:08 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:13:08 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:13:08 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:13:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:13:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:13:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:13:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:13:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:13:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:13:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:13:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:13:09 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:13:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:13:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:13:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:13:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:13:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:13:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:13:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:13:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:13:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:13:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:13:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:13:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:13:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:13:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.02% (threshold: 80.00%)
WARN 2025/12/17 17:13:45 ES Alert Created [high][capacity]: Disk usage high: 93.40% (threshold: 85.00%)
WARN 2025/12/17 17:13:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:13:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:13:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:13:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:13:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:13:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:14:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:14:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:14:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:14:00 Field: school_name.keyword
DEBUG 2025/12/17 17:14:00 Time From: 2025-12-17T17:13:00.000+08:00
DEBUG 2025/12/17 17:14:00 Time To: 2025-12-17T17:14:00.000+08:00
DEBUG 2025/12/17 17:14:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:13:00.000+08:00",
					"lte": "2025-12-17T17:14:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:14:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:14:00 ES Response IsError: false
DEBUG 2025/12/17 17:14:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":473,"buckets":[{"key":"黑快馬主機","doc_count":1534},{"key":"花蓮高農","doc_count":797},{"key":"新竹女中","doc_count":752},{"key":"金門高中","doc_count":671},{"key":"仁愛高農","doc_count":598},{"key":"金門農工","doc_count":530},{"key":"宜蘭高商","doc_count":451},{"key":"北門高中","doc_count":416},{"key":"竹北高中","doc_count":405},{"key":"臺東高中","doc_count":402},{"key":"新港藝高","doc_count":396},{"key":"華僑高中","doc_count":386},{"key":"興大附中","doc_count":348},{"key":"旗美高中","doc_count":321},{"key":"新化高工","doc_count":317},{"key":"清華附小","doc_count":312},{"key":"花蓮高商","doc_count":293},{"key":"新化高中","doc_count":291},{"key":"草屯商工","doc_count":291},{"key":"南投高商","doc_count":288},{"key":"內埔農工","doc_count":283},{"key":"蘇澳海事","doc_count":283},{"key":"關西高中","doc_count":247},{"key":"竹南高中","doc_count":238},{"key":"斗六家商","doc_count":208},{"key":"屏東女中","doc_count":206},{"key":"關山工商","doc_count":195},{"key":"澎湖海事","doc_count":191},{"key":"後壁高中","doc_count":170},{"key":"玉里高中","doc_count":168},{"key":"南大附聰","doc_count":159},{"key":"嘉義高商","doc_count":157},{"key":"虎尾高中","doc_count":153},{"key":"南投特教","doc_count":152},{"key":"中大壢中","doc_count":147},{"key":"苗栗農工","doc_count":140},{"key":"暨大附中","doc_count":133},{"key":"秀水高工","doc_count":129},{"key":"彰師附工","doc_count":123},{"key":"嘉義高中","doc_count":122},{"key":"土庫商工","doc_count":122},{"key":"師大附中高中部","doc_count":121},{"key":"宜蘭高中","doc_count":120},{"key":"中興高中","doc_count":112},{"key":"東港海事","doc_count":108},{"key":"南大附中","doc_count":106},{"key":"新營高工","doc_count":104},{"key":"羅東高商","doc_count":104},{"key":"鳳山高中","doc_count":104},{"key":"員林家商","doc_count":102},{"key":"潮州高中","doc_count":98},{"key":"彰化高商","doc_count":97},{"key":"水里商工","doc_count":97},{"key":"基隆商工","doc_count":94},{"key":"北港農工","doc_count":92},{"key":"成大南工","doc_count":91},{"key":"嘉義家職","doc_count":87},{"key":"南投高中","doc_count":84},{"key":"屏科實中","doc_count":83},{"key":"永靖高工","doc_count":83},{"key":"嘉科實中","doc_count":80},{"key":"員林農工","doc_count":75},{"key":"北教大實小","doc_count":73},{"key":"新營高中","doc_count":69},{"key":"北斗家商","doc_count":66},{"key":"曾文農工","doc_count":66},{"key":"北港高中","doc_count":64},{"key":"崇實高工","doc_count":62},{"key":"新竹高中","doc_count":62},{"key":"屏東高工","doc_count":61},{"key":"苗栗高商","doc_count":61},{"key":"屏東高中","doc_count":60},{"key":"臺南一中","doc_count":60},{"key":"花蓮高工","doc_count":58},{"key":"埔里高工","doc_count":57},{"key":"東石高中","doc_count":54},{"key":"嘉義高工","doc_count":52},{"key":"新竹高工","doc_count":52},{"key":"臺南高商","doc_count":52},{"key":"華南高商","doc_count":49},{"key":"政大附中","doc_count":47},{"key":"二林工商","doc_count":46},{"key":"溪湖高中","doc_count":46},{"key":"花蓮特教","doc_count":46},{"key":"雲林特教","doc_count":46},{"key":"員林高中","doc_count":45},{"key":"臺東女中","doc_count":44},{"key":"興大附農","doc_count":44},{"key":"花蓮高中","doc_count":43},{"key":"新竹高商","doc_count":42},{"key":"南大附小","doc_count":40},{"key":"屏東特教","doc_count":40},{"key":"旗山農工","doc_count":40},{"key":"苗栗高中","doc_count":40},{"key":"高餐大附中","doc_count":40},{"key":"佳冬高農","doc_count":38},{"key":"新豐高中","doc_count":38},{"key":"海大附中","doc_count":38},{"key":"白河商工","doc_count":38},{"key":"臺東高商","doc_count":38}]}}}
DEBUG 2025/12/17 17:14:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:14:00   Bucket[0]: Key=黑快馬主機, DocCount=1534
DEBUG 2025/12/17 17:14:00   Bucket[1]: Key=花蓮高農, DocCount=797
DEBUG 2025/12/17 17:14:00   Bucket[2]: Key=新竹女中, DocCount=752
DEBUG 2025/12/17 17:14:00   Bucket[3]: Key=金門高中, DocCount=671
DEBUG 2025/12/17 17:14:00   Bucket[4]: Key=仁愛高農, DocCount=598
DEBUG 2025/12/17 17:14:00   Bucket[5]: Key=金門農工, DocCount=530
DEBUG 2025/12/17 17:14:00   Bucket[6]: Key=宜蘭高商, DocCount=451
DEBUG 2025/12/17 17:14:00   Bucket[7]: Key=北門高中, DocCount=416
DEBUG 2025/12/17 17:14:00   Bucket[8]: Key=竹北高中, DocCount=405
DEBUG 2025/12/17 17:14:00   Bucket[9]: Key=臺東高中, DocCount=402
DEBUG 2025/12/17 17:14:00   Bucket[10]: Key=新港藝高, DocCount=396
DEBUG 2025/12/17 17:14:00   Bucket[11]: Key=華僑高中, DocCount=386
DEBUG 2025/12/17 17:14:00   Bucket[12]: Key=興大附中, DocCount=348
DEBUG 2025/12/17 17:14:00   Bucket[13]: Key=旗美高中, DocCount=321
DEBUG 2025/12/17 17:14:00   Bucket[14]: Key=新化高工, DocCount=317
DEBUG 2025/12/17 17:14:00   Bucket[15]: Key=清華附小, DocCount=312
DEBUG 2025/12/17 17:14:00   Bucket[16]: Key=花蓮高商, DocCount=293
DEBUG 2025/12/17 17:14:00   Bucket[17]: Key=新化高中, DocCount=291
DEBUG 2025/12/17 17:14:00   Bucket[18]: Key=草屯商工, DocCount=291
DEBUG 2025/12/17 17:14:00   Bucket[19]: Key=南投高商, DocCount=288
DEBUG 2025/12/17 17:14:00   Bucket[20]: Key=內埔農工, DocCount=283
DEBUG 2025/12/17 17:14:00   Bucket[21]: Key=蘇澳海事, DocCount=283
DEBUG 2025/12/17 17:14:00   Bucket[22]: Key=關西高中, DocCount=247
DEBUG 2025/12/17 17:14:00   Bucket[23]: Key=竹南高中, DocCount=238
DEBUG 2025/12/17 17:14:00   Bucket[24]: Key=斗六家商, DocCount=208
DEBUG 2025/12/17 17:14:00   Bucket[25]: Key=屏東女中, DocCount=206
DEBUG 2025/12/17 17:14:00   Bucket[26]: Key=關山工商, DocCount=195
DEBUG 2025/12/17 17:14:00   Bucket[27]: Key=澎湖海事, DocCount=191
DEBUG 2025/12/17 17:14:00   Bucket[28]: Key=後壁高中, DocCount=170
DEBUG 2025/12/17 17:14:00   Bucket[29]: Key=玉里高中, DocCount=168
DEBUG 2025/12/17 17:14:00   Bucket[30]: Key=南大附聰, DocCount=159
DEBUG 2025/12/17 17:14:00   Bucket[31]: Key=嘉義高商, DocCount=157
DEBUG 2025/12/17 17:14:00   Bucket[32]: Key=虎尾高中, DocCount=153
DEBUG 2025/12/17 17:14:00   Bucket[33]: Key=南投特教, DocCount=152
DEBUG 2025/12/17 17:14:00   Bucket[34]: Key=中大壢中, DocCount=147
DEBUG 2025/12/17 17:14:00   Bucket[35]: Key=苗栗農工, DocCount=140
DEBUG 2025/12/17 17:14:00   Bucket[36]: Key=暨大附中, DocCount=133
DEBUG 2025/12/17 17:14:00   Bucket[37]: Key=秀水高工, DocCount=129
DEBUG 2025/12/17 17:14:00   Bucket[38]: Key=彰師附工, DocCount=123
DEBUG 2025/12/17 17:14:00   Bucket[39]: Key=嘉義高中, DocCount=122
DEBUG 2025/12/17 17:14:00   Bucket[40]: Key=土庫商工, DocCount=122
DEBUG 2025/12/17 17:14:00   Bucket[41]: Key=師大附中高中部, DocCount=121
DEBUG 2025/12/17 17:14:00   Bucket[42]: Key=宜蘭高中, DocCount=120
DEBUG 2025/12/17 17:14:00   Bucket[43]: Key=中興高中, DocCount=112
DEBUG 2025/12/17 17:14:00   Bucket[44]: Key=東港海事, DocCount=108
DEBUG 2025/12/17 17:14:00   Bucket[45]: Key=南大附中, DocCount=106
DEBUG 2025/12/17 17:14:00   Bucket[46]: Key=新營高工, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[47]: Key=羅東高商, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[48]: Key=鳳山高中, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[49]: Key=員林家商, DocCount=102
DEBUG 2025/12/17 17:14:00   Bucket[50]: Key=潮州高中, DocCount=98
DEBUG 2025/12/17 17:14:00   Bucket[51]: Key=彰化高商, DocCount=97
DEBUG 2025/12/17 17:14:00   Bucket[52]: Key=水里商工, DocCount=97
DEBUG 2025/12/17 17:14:00   Bucket[53]: Key=基隆商工, DocCount=94
DEBUG 2025/12/17 17:14:00   Bucket[54]: Key=北港農工, DocCount=92
DEBUG 2025/12/17 17:14:00   Bucket[55]: Key=成大南工, DocCount=91
DEBUG 2025/12/17 17:14:00   Bucket[56]: Key=嘉義家職, DocCount=87
DEBUG 2025/12/17 17:14:00   Bucket[57]: Key=南投高中, DocCount=84
DEBUG 2025/12/17 17:14:00   Bucket[58]: Key=屏科實中, DocCount=83
DEBUG 2025/12/17 17:14:00   Bucket[59]: Key=永靖高工, DocCount=83
DEBUG 2025/12/17 17:14:00   Bucket[60]: Key=嘉科實中, DocCount=80
DEBUG 2025/12/17 17:14:00   Bucket[61]: Key=員林農工, DocCount=75
DEBUG 2025/12/17 17:14:00   Bucket[62]: Key=北教大實小, DocCount=73
DEBUG 2025/12/17 17:14:00   Bucket[63]: Key=新營高中, DocCount=69
DEBUG 2025/12/17 17:14:00   Bucket[64]: Key=北斗家商, DocCount=66
DEBUG 2025/12/17 17:14:00   Bucket[65]: Key=曾文農工, DocCount=66
DEBUG 2025/12/17 17:14:00   Bucket[66]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:14:00   Bucket[67]: Key=崇實高工, DocCount=62
DEBUG 2025/12/17 17:14:00   Bucket[68]: Key=新竹高中, DocCount=62
DEBUG 2025/12/17 17:14:00   Bucket[69]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 17:14:00   Bucket[70]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:14:00   Bucket[71]: Key=屏東高中, DocCount=60
DEBUG 2025/12/17 17:14:00   Bucket[72]: Key=臺南一中, DocCount=60
DEBUG 2025/12/17 17:14:00   Bucket[73]: Key=花蓮高工, DocCount=58
DEBUG 2025/12/17 17:14:00   Bucket[74]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:14:00   Bucket[75]: Key=東石高中, DocCount=54
DEBUG 2025/12/17 17:14:00   Bucket[76]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[77]: Key=新竹高工, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[78]: Key=臺南高商, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[79]: Key=華南高商, DocCount=49
DEBUG 2025/12/17 17:14:00   Bucket[80]: Key=政大附中, DocCount=47
DEBUG 2025/12/17 17:14:00   Bucket[81]: Key=二林工商, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[82]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[83]: Key=花蓮特教, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[84]: Key=雲林特教, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[85]: Key=員林高中, DocCount=45
DEBUG 2025/12/17 17:14:00   Bucket[86]: Key=臺東女中, DocCount=44
DEBUG 2025/12/17 17:14:00   Bucket[87]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 17:14:00   Bucket[88]: Key=花蓮高中, DocCount=43
DEBUG 2025/12/17 17:14:00   Bucket[89]: Key=新竹高商, DocCount=42
DEBUG 2025/12/17 17:14:00   Bucket[90]: Key=南大附小, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[91]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[92]: Key=旗山農工, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[93]: Key=苗栗高中, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[94]: Key=高餐大附中, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[95]: Key=佳冬高農, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[96]: Key=新豐高中, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[97]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[98]: Key=白河商工, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[99]: Key=臺東高商, DocCount=38
DEBUG 2025/12/17 17:14:00 ========================================================
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:14:08 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:14:09 Processing 15 offline devices
INFO 2025/12/17 17:14:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:14:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:14:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:14:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:14:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:14:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:14:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:14:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:14:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:14:10 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:14:10 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:14:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:14:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:14:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:14:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:14:13 ✅ Successfully flushed 33/33 history records to TimescaleDB
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:14:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:14:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:14:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:14:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:14:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:14:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:14:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:14:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:14:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:14:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:14:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:14:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:14:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:14:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:14:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:14:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:14:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:14:45 ES Alert Created [high][performance]: Memory usage high: 88.88% (threshold: 80.00%)
INFO 2025/12/17 17:14:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.43% (threshold: 85.00%)
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:14:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:14:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:14:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:14:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:15:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:15:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:15:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:15:00 Field: school_name.keyword
DEBUG 2025/12/17 17:15:00 Time From: 2025-12-17T17:14:00.000+08:00
DEBUG 2025/12/17 17:15:00 Time To: 2025-12-17T17:15:00.000+08:00
DEBUG 2025/12/17 17:15:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:14:00.000+08:00",
					"lte": "2025-12-17T17:15:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:15:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:15:00 ES Response IsError: false
DEBUG 2025/12/17 17:15:00 ES Response Body:
{"took":81,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":502,"buckets":[{"key":"黑快馬主機","doc_count":2041},{"key":"新港藝高","doc_count":1529},{"key":"花蓮高農","doc_count":749},{"key":"仁愛高農","doc_count":657},{"key":"新竹女中","doc_count":630},{"key":"金門高中","doc_count":612},{"key":"竹北高中","doc_count":566},{"key":"金門農工","doc_count":540},{"key":"北門高中","doc_count":458},{"key":"華僑高中","doc_count":418},{"key":"宜蘭高商","doc_count":367},{"key":"臺東高中","doc_count":367},{"key":"旗美高中","doc_count":331},{"key":"花蓮高商","doc_count":319},{"key":"南投高商","doc_count":295},{"key":"嘉義高商","doc_count":288},{"key":"蘇澳海事","doc_count":280},{"key":"興大附中","doc_count":279},{"key":"清華附小","doc_count":274},{"key":"關西高中","doc_count":266},{"key":"嘉科實中","doc_count":259},{"key":"內埔農工","doc_count":256},{"key":"關山工商","doc_count":231},{"key":"員林家商","doc_count":221},{"key":"屏東女中","doc_count":219},{"key":"斗六家商","doc_count":206},{"key":"中大壢中","doc_count":195},{"key":"竹南高中","doc_count":194},{"key":"後壁高中","doc_count":188},{"key":"虎尾高中","doc_count":186},{"key":"玉里高中","doc_count":181},{"key":"苗栗農工","doc_count":181},{"key":"南投高中","doc_count":172},{"key":"東港海事","doc_count":166},{"key":"新營高工","doc_count":165},{"key":"南投特教","doc_count":163},{"key":"新竹高中","doc_count":161},{"key":"員林農工","doc_count":157},{"key":"澎湖海事","doc_count":156},{"key":"新化高工","doc_count":151},{"key":"南大附聰","doc_count":149},{"key":"彰師附工","doc_count":147},{"key":"新化高中","doc_count":138},{"key":"鳳山高中","doc_count":136},{"key":"南大附中","doc_count":133},{"key":"水里商工","doc_count":126},{"key":"北斗家商","doc_count":109},{"key":"師大附中國中部","doc_count":109},{"key":"師大附中高中部","doc_count":98},{"key":"彰化高商","doc_count":95},{"key":"旗山農工","doc_count":95},{"key":"嘉義高中","doc_count":94},{"key":"屏科實中","doc_count":93},{"key":"屏東高中","doc_count":89},{"key":"興大附農","doc_count":89},{"key":"新竹高工","doc_count":87},{"key":"中興高中","doc_count":86},{"key":"高餐大附中","doc_count":83},{"key":"苗栗高商","doc_count":80},{"key":"善化高中","doc_count":79},{"key":"新營高中","doc_count":73},{"key":"花蓮特教","doc_count":73},{"key":"新豐高中","doc_count":71},{"key":"溪湖高中","doc_count":71},{"key":"草屯商工","doc_count":66},{"key":"成大南工","doc_count":65},{"key":"羅東高商","doc_count":65},{"key":"新竹高商","doc_count":63},{"key":"臺南高商","doc_count":63},{"key":"南大附小","doc_count":62},{"key":"永靖高工","doc_count":62},{"key":"潮州高中","doc_count":61},{"key":"雲林特教","doc_count":61},{"key":"北教大實小","doc_count":59},{"key":"基隆商工","doc_count":57},{"key":"屏東高工","doc_count":55},{"key":"員林高中","doc_count":54},{"key":"屏東特教","doc_count":54},{"key":"二林工商","doc_count":53},{"key":"臺南一中","doc_count":53},{"key":"埔里高工","doc_count":52},{"key":"政大附中","doc_count":51},{"key":"暨大附中","doc_count":51},{"key":"宜蘭高中","doc_count":50},{"key":"北港高中","doc_count":49},{"key":"海大附中","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"嘉義家職","doc_count":47},{"key":"東石高中","doc_count":47},{"key":"竹東高中","doc_count":47},{"key":"北港農工","doc_count":46},{"key":"曾文農工","doc_count":45},{"key":"秀水高工","doc_count":45},{"key":"嘉義高工","doc_count":43},{"key":"白河商工","doc_count":43},{"key":"花蓮高中","doc_count":42},{"key":"玉井工商","doc_count":41},{"key":"臺東高商","doc_count":41},{"key":"花蓮高工","doc_count":40}]}}}
DEBUG 2025/12/17 17:15:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:15:00   Bucket[0]: Key=黑快馬主機, DocCount=2041
DEBUG 2025/12/17 17:15:00   Bucket[1]: Key=新港藝高, DocCount=1529
DEBUG 2025/12/17 17:15:00   Bucket[2]: Key=花蓮高農, DocCount=749
DEBUG 2025/12/17 17:15:00   Bucket[3]: Key=仁愛高農, DocCount=657
DEBUG 2025/12/17 17:15:00   Bucket[4]: Key=新竹女中, DocCount=630
DEBUG 2025/12/17 17:15:00   Bucket[5]: Key=金門高中, DocCount=612
DEBUG 2025/12/17 17:15:00   Bucket[6]: Key=竹北高中, DocCount=566
DEBUG 2025/12/17 17:15:00   Bucket[7]: Key=金門農工, DocCount=540
DEBUG 2025/12/17 17:15:00   Bucket[8]: Key=北門高中, DocCount=458
DEBUG 2025/12/17 17:15:00   Bucket[9]: Key=華僑高中, DocCount=418
DEBUG 2025/12/17 17:15:00   Bucket[10]: Key=宜蘭高商, DocCount=367
DEBUG 2025/12/17 17:15:00   Bucket[11]: Key=臺東高中, DocCount=367
DEBUG 2025/12/17 17:15:00   Bucket[12]: Key=旗美高中, DocCount=331
DEBUG 2025/12/17 17:15:00   Bucket[13]: Key=花蓮高商, DocCount=319
DEBUG 2025/12/17 17:15:00   Bucket[14]: Key=南投高商, DocCount=295
DEBUG 2025/12/17 17:15:00   Bucket[15]: Key=嘉義高商, DocCount=288
DEBUG 2025/12/17 17:15:00   Bucket[16]: Key=蘇澳海事, DocCount=280
DEBUG 2025/12/17 17:15:00   Bucket[17]: Key=興大附中, DocCount=279
DEBUG 2025/12/17 17:15:00   Bucket[18]: Key=清華附小, DocCount=274
DEBUG 2025/12/17 17:15:00   Bucket[19]: Key=關西高中, DocCount=266
DEBUG 2025/12/17 17:15:00   Bucket[20]: Key=嘉科實中, DocCount=259
DEBUG 2025/12/17 17:15:00   Bucket[21]: Key=內埔農工, DocCount=256
DEBUG 2025/12/17 17:15:00   Bucket[22]: Key=關山工商, DocCount=231
DEBUG 2025/12/17 17:15:00   Bucket[23]: Key=員林家商, DocCount=221
DEBUG 2025/12/17 17:15:00   Bucket[24]: Key=屏東女中, DocCount=219
DEBUG 2025/12/17 17:15:00   Bucket[25]: Key=斗六家商, DocCount=206
DEBUG 2025/12/17 17:15:00   Bucket[26]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:15:00   Bucket[27]: Key=竹南高中, DocCount=194
DEBUG 2025/12/17 17:15:00   Bucket[28]: Key=後壁高中, DocCount=188
DEBUG 2025/12/17 17:15:00   Bucket[29]: Key=虎尾高中, DocCount=186
DEBUG 2025/12/17 17:15:00   Bucket[30]: Key=玉里高中, DocCount=181
DEBUG 2025/12/17 17:15:00   Bucket[31]: Key=苗栗農工, DocCount=181
DEBUG 2025/12/17 17:15:00   Bucket[32]: Key=南投高中, DocCount=172
DEBUG 2025/12/17 17:15:00   Bucket[33]: Key=東港海事, DocCount=166
DEBUG 2025/12/17 17:15:00   Bucket[34]: Key=新營高工, DocCount=165
DEBUG 2025/12/17 17:15:00   Bucket[35]: Key=南投特教, DocCount=163
DEBUG 2025/12/17 17:15:00   Bucket[36]: Key=新竹高中, DocCount=161
DEBUG 2025/12/17 17:15:00   Bucket[37]: Key=員林農工, DocCount=157
DEBUG 2025/12/17 17:15:00   Bucket[38]: Key=澎湖海事, DocCount=156
DEBUG 2025/12/17 17:15:00   Bucket[39]: Key=新化高工, DocCount=151
DEBUG 2025/12/17 17:15:00   Bucket[40]: Key=南大附聰, DocCount=149
DEBUG 2025/12/17 17:15:00   Bucket[41]: Key=彰師附工, DocCount=147
DEBUG 2025/12/17 17:15:00   Bucket[42]: Key=新化高中, DocCount=138
DEBUG 2025/12/17 17:15:00   Bucket[43]: Key=鳳山高中, DocCount=136
DEBUG 2025/12/17 17:15:00   Bucket[44]: Key=南大附中, DocCount=133
DEBUG 2025/12/17 17:15:00   Bucket[45]: Key=水里商工, DocCount=126
DEBUG 2025/12/17 17:15:00   Bucket[46]: Key=北斗家商, DocCount=109
DEBUG 2025/12/17 17:15:00   Bucket[47]: Key=師大附中國中部, DocCount=109
DEBUG 2025/12/17 17:15:00   Bucket[48]: Key=師大附中高中部, DocCount=98
DEBUG 2025/12/17 17:15:00   Bucket[49]: Key=彰化高商, DocCount=95
DEBUG 2025/12/17 17:15:00   Bucket[50]: Key=旗山農工, DocCount=95
DEBUG 2025/12/17 17:15:00   Bucket[51]: Key=嘉義高中, DocCount=94
DEBUG 2025/12/17 17:15:00   Bucket[52]: Key=屏科實中, DocCount=93
DEBUG 2025/12/17 17:15:00   Bucket[53]: Key=屏東高中, DocCount=89
DEBUG 2025/12/17 17:15:00   Bucket[54]: Key=興大附農, DocCount=89
DEBUG 2025/12/17 17:15:00   Bucket[55]: Key=新竹高工, DocCount=87
DEBUG 2025/12/17 17:15:00   Bucket[56]: Key=中興高中, DocCount=86
DEBUG 2025/12/17 17:15:00   Bucket[57]: Key=高餐大附中, DocCount=83
DEBUG 2025/12/17 17:15:00   Bucket[58]: Key=苗栗高商, DocCount=80
DEBUG 2025/12/17 17:15:00   Bucket[59]: Key=善化高中, DocCount=79
DEBUG 2025/12/17 17:15:00   Bucket[60]: Key=新營高中, DocCount=73
DEBUG 2025/12/17 17:15:00   Bucket[61]: Key=花蓮特教, DocCount=73
DEBUG 2025/12/17 17:15:00   Bucket[62]: Key=新豐高中, DocCount=71
DEBUG 2025/12/17 17:15:00   Bucket[63]: Key=溪湖高中, DocCount=71
DEBUG 2025/12/17 17:15:00   Bucket[64]: Key=草屯商工, DocCount=66
DEBUG 2025/12/17 17:15:00   Bucket[65]: Key=成大南工, DocCount=65
DEBUG 2025/12/17 17:15:00   Bucket[66]: Key=羅東高商, DocCount=65
DEBUG 2025/12/17 17:15:00   Bucket[67]: Key=新竹高商, DocCount=63
DEBUG 2025/12/17 17:15:00   Bucket[68]: Key=臺南高商, DocCount=63
DEBUG 2025/12/17 17:15:00   Bucket[69]: Key=南大附小, DocCount=62
DEBUG 2025/12/17 17:15:00   Bucket[70]: Key=永靖高工, DocCount=62
DEBUG 2025/12/17 17:15:00   Bucket[71]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:15:00   Bucket[72]: Key=雲林特教, DocCount=61
DEBUG 2025/12/17 17:15:00   Bucket[73]: Key=北教大實小, DocCount=59
DEBUG 2025/12/17 17:15:00   Bucket[74]: Key=基隆商工, DocCount=57
DEBUG 2025/12/17 17:15:00   Bucket[75]: Key=屏東高工, DocCount=55
DEBUG 2025/12/17 17:15:00   Bucket[76]: Key=員林高中, DocCount=54
DEBUG 2025/12/17 17:15:00   Bucket[77]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 17:15:00   Bucket[78]: Key=二林工商, DocCount=53
DEBUG 2025/12/17 17:15:00   Bucket[79]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:15:00   Bucket[80]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:15:00   Bucket[81]: Key=政大附中, DocCount=51
DEBUG 2025/12/17 17:15:00   Bucket[82]: Key=暨大附中, DocCount=51
DEBUG 2025/12/17 17:15:00   Bucket[83]: Key=宜蘭高中, DocCount=50
DEBUG 2025/12/17 17:15:00   Bucket[84]: Key=北港高中, DocCount=49
DEBUG 2025/12/17 17:15:00   Bucket[85]: Key=海大附中, DocCount=49
DEBUG 2025/12/17 17:15:00   Bucket[86]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:15:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:15:00   Bucket[88]: Key=嘉義家職, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[89]: Key=東石高中, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[90]: Key=竹東高中, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[91]: Key=北港農工, DocCount=46
DEBUG 2025/12/17 17:15:00   Bucket[92]: Key=曾文農工, DocCount=45
DEBUG 2025/12/17 17:15:00   Bucket[93]: Key=秀水高工, DocCount=45
DEBUG 2025/12/17 17:15:00   Bucket[94]: Key=嘉義高工, DocCount=43
DEBUG 2025/12/17 17:15:00   Bucket[95]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:15:00   Bucket[96]: Key=花蓮高中, DocCount=42
DEBUG 2025/12/17 17:15:00   Bucket[97]: Key=玉井工商, DocCount=41
DEBUG 2025/12/17 17:15:00   Bucket[98]: Key=臺東高商, DocCount=41
DEBUG 2025/12/17 17:15:00   Bucket[99]: Key=花蓮高工, DocCount=40
DEBUG 2025/12/17 17:15:00 ========================================================
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:15:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 17:15:08 Processing 15 offline devices
INFO 2025/12/17 17:15:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:15:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:15:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:15:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:15:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:15:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:15:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:15:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:15:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:15:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:15:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:15:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:15:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:15:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:15:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:15:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:15:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:15:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:15:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:15:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:15:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:15:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:15:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:15:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:15:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:15:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:15:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:15:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:15:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:15:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:15:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:15:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:15:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.52% (threshold: 80.00%)
INFO 2025/12/17 17:15:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.47% (threshold: 85.00%)
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:15:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:15:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:15:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:15:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:16:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:16:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:16:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:16:00 Field: school_name.keyword
DEBUG 2025/12/17 17:16:00 Time From: 2025-12-17T17:15:00.000+08:00
DEBUG 2025/12/17 17:16:00 Time To: 2025-12-17T17:16:00.000+08:00
DEBUG 2025/12/17 17:16:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:15:00.000+08:00",
					"lte": "2025-12-17T17:16:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:16:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:16:00 ES Response IsError: false
DEBUG 2025/12/17 17:16:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":488,"buckets":[{"key":"黑快馬主機","doc_count":910},{"key":"花蓮高農","doc_count":781},{"key":"金門農工","doc_count":603},{"key":"金門高中","doc_count":598},{"key":"新港藝高","doc_count":589},{"key":"仁愛高農","doc_count":544},{"key":"新竹女中","doc_count":544},{"key":"華僑高中","doc_count":437},{"key":"北門高中","doc_count":408},{"key":"宜蘭高商","doc_count":406},{"key":"臺東高中","doc_count":393},{"key":"竹北高中","doc_count":350},{"key":"興大附中","doc_count":340},{"key":"嘉科實中","doc_count":335},{"key":"南投高商","doc_count":320},{"key":"內埔農工","doc_count":300},{"key":"旗美高中","doc_count":294},{"key":"蘇澳海事","doc_count":291},{"key":"新化高工","doc_count":281},{"key":"玉里高中","doc_count":272},{"key":"清華附小","doc_count":270},{"key":"花蓮高商","doc_count":247},{"key":"關西高中","doc_count":238},{"key":"彰師附工","doc_count":212},{"key":"中大壢中","doc_count":211},{"key":"關山工商","doc_count":197},{"key":"斗六家商","doc_count":187},{"key":"後壁高中","doc_count":184},{"key":"嘉義高商","doc_count":176},{"key":"苗栗農工","doc_count":176},{"key":"竹南高中","doc_count":174},{"key":"屏東女中","doc_count":161},{"key":"新化高中","doc_count":152},{"key":"南投特教","doc_count":146},{"key":"虎尾高中","doc_count":146},{"key":"員林家商","doc_count":145},{"key":"南投高中","doc_count":135},{"key":"東港海事","doc_count":133},{"key":"中興高中","doc_count":132},{"key":"羅東高商","doc_count":131},{"key":"員林農工","doc_count":123},{"key":"基隆商工","doc_count":121},{"key":"南大附聰","doc_count":120},{"key":"新營高工","doc_count":117},{"key":"新營高中","doc_count":112},{"key":"屏東高中","doc_count":111},{"key":"北教大實小","doc_count":101},{"key":"嘉義高中","doc_count":97},{"key":"南大附中","doc_count":93},{"key":"新竹高中","doc_count":92},{"key":"臺南一中","doc_count":92},{"key":"成大南工","doc_count":90},{"key":"鳳山高中","doc_count":90},{"key":"暨大附中","doc_count":89},{"key":"溪湖高中","doc_count":85},{"key":"潮州高中","doc_count":82},{"key":"新竹高商","doc_count":79},{"key":"雲林特教","doc_count":75},{"key":"新豐高中","doc_count":74},{"key":"臺南高商","doc_count":74},{"key":"彰化高商","doc_count":73},{"key":"師大附中高中部","doc_count":71},{"key":"新竹高工","doc_count":71},{"key":"水里商工","doc_count":71},{"key":"嘉義家職","doc_count":70},{"key":"苗栗高商","doc_count":70},{"key":"北斗家商","doc_count":68},{"key":"屏科實中","doc_count":67},{"key":"澎湖海事","doc_count":63},{"key":"草屯商工","doc_count":63},{"key":"東石高中","doc_count":59},{"key":"二林工商","doc_count":57},{"key":"海大附中","doc_count":55},{"key":"竹東高中","doc_count":55},{"key":"旗山農工","doc_count":54},{"key":"秀水高工","doc_count":54},{"key":"北港農工","doc_count":53},{"key":"善化高中","doc_count":53},{"key":"埔里高工","doc_count":53},{"key":"蘭陽女中","doc_count":53},{"key":"嘉義高工","doc_count":52},{"key":"北港高中","doc_count":51},{"key":"屏東特教","doc_count":51},{"key":"政大附中","doc_count":51},{"key":"竹山高中","doc_count":51},{"key":"高餐大附中","doc_count":50},{"key":"佳冬高農","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":46},{"key":"屏東高工","doc_count":45},{"key":"臺東高商","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"花蓮高工","doc_count":44},{"key":"玉井工商","doc_count":43},{"key":"崇實高工","doc_count":42},{"key":"曾文農工","doc_count":42},{"key":"白河商工","doc_count":42},{"key":"屏北高中","doc_count":41},{"key":"宜蘭高中","doc_count":40},{"key":"臺東女中","doc_count":40}]}}}
DEBUG 2025/12/17 17:16:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:16:00   Bucket[0]: Key=黑快馬主機, DocCount=910
DEBUG 2025/12/17 17:16:00   Bucket[1]: Key=花蓮高農, DocCount=781
DEBUG 2025/12/17 17:16:00   Bucket[2]: Key=金門農工, DocCount=603
DEBUG 2025/12/17 17:16:00   Bucket[3]: Key=金門高中, DocCount=598
DEBUG 2025/12/17 17:16:00   Bucket[4]: Key=新港藝高, DocCount=589
DEBUG 2025/12/17 17:16:00   Bucket[5]: Key=仁愛高農, DocCount=544
DEBUG 2025/12/17 17:16:00   Bucket[6]: Key=新竹女中, DocCount=544
DEBUG 2025/12/17 17:16:00   Bucket[7]: Key=華僑高中, DocCount=437
DEBUG 2025/12/17 17:16:00   Bucket[8]: Key=北門高中, DocCount=408
DEBUG 2025/12/17 17:16:00   Bucket[9]: Key=宜蘭高商, DocCount=406
DEBUG 2025/12/17 17:16:00   Bucket[10]: Key=臺東高中, DocCount=393
DEBUG 2025/12/17 17:16:00   Bucket[11]: Key=竹北高中, DocCount=350
DEBUG 2025/12/17 17:16:00   Bucket[12]: Key=興大附中, DocCount=340
DEBUG 2025/12/17 17:16:00   Bucket[13]: Key=嘉科實中, DocCount=335
DEBUG 2025/12/17 17:16:00   Bucket[14]: Key=南投高商, DocCount=320
DEBUG 2025/12/17 17:16:00   Bucket[15]: Key=內埔農工, DocCount=300
DEBUG 2025/12/17 17:16:00   Bucket[16]: Key=旗美高中, DocCount=294
DEBUG 2025/12/17 17:16:00   Bucket[17]: Key=蘇澳海事, DocCount=291
DEBUG 2025/12/17 17:16:00   Bucket[18]: Key=新化高工, DocCount=281
DEBUG 2025/12/17 17:16:00   Bucket[19]: Key=玉里高中, DocCount=272
DEBUG 2025/12/17 17:16:00   Bucket[20]: Key=清華附小, DocCount=270
DEBUG 2025/12/17 17:16:00   Bucket[21]: Key=花蓮高商, DocCount=247
DEBUG 2025/12/17 17:16:00   Bucket[22]: Key=關西高中, DocCount=238
DEBUG 2025/12/17 17:16:00   Bucket[23]: Key=彰師附工, DocCount=212
DEBUG 2025/12/17 17:16:00   Bucket[24]: Key=中大壢中, DocCount=211
DEBUG 2025/12/17 17:16:00   Bucket[25]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 17:16:00   Bucket[26]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:16:00   Bucket[27]: Key=後壁高中, DocCount=184
DEBUG 2025/12/17 17:16:00   Bucket[28]: Key=嘉義高商, DocCount=176
DEBUG 2025/12/17 17:16:00   Bucket[29]: Key=苗栗農工, DocCount=176
DEBUG 2025/12/17 17:16:00   Bucket[30]: Key=竹南高中, DocCount=174
DEBUG 2025/12/17 17:16:00   Bucket[31]: Key=屏東女中, DocCount=161
DEBUG 2025/12/17 17:16:00   Bucket[32]: Key=新化高中, DocCount=152
DEBUG 2025/12/17 17:16:00   Bucket[33]: Key=南投特教, DocCount=146
DEBUG 2025/12/17 17:16:00   Bucket[34]: Key=虎尾高中, DocCount=146
DEBUG 2025/12/17 17:16:00   Bucket[35]: Key=員林家商, DocCount=145
DEBUG 2025/12/17 17:16:00   Bucket[36]: Key=南投高中, DocCount=135
DEBUG 2025/12/17 17:16:00   Bucket[37]: Key=東港海事, DocCount=133
DEBUG 2025/12/17 17:16:00   Bucket[38]: Key=中興高中, DocCount=132
DEBUG 2025/12/17 17:16:00   Bucket[39]: Key=羅東高商, DocCount=131
DEBUG 2025/12/17 17:16:00   Bucket[40]: Key=員林農工, DocCount=123
DEBUG 2025/12/17 17:16:00   Bucket[41]: Key=基隆商工, DocCount=121
DEBUG 2025/12/17 17:16:00   Bucket[42]: Key=南大附聰, DocCount=120
DEBUG 2025/12/17 17:16:00   Bucket[43]: Key=新營高工, DocCount=117
DEBUG 2025/12/17 17:16:00   Bucket[44]: Key=新營高中, DocCount=112
DEBUG 2025/12/17 17:16:00   Bucket[45]: Key=屏東高中, DocCount=111
DEBUG 2025/12/17 17:16:00   Bucket[46]: Key=北教大實小, DocCount=101
DEBUG 2025/12/17 17:16:00   Bucket[47]: Key=嘉義高中, DocCount=97
DEBUG 2025/12/17 17:16:00   Bucket[48]: Key=南大附中, DocCount=93
DEBUG 2025/12/17 17:16:00   Bucket[49]: Key=新竹高中, DocCount=92
DEBUG 2025/12/17 17:16:00   Bucket[50]: Key=臺南一中, DocCount=92
DEBUG 2025/12/17 17:16:00   Bucket[51]: Key=成大南工, DocCount=90
DEBUG 2025/12/17 17:16:00   Bucket[52]: Key=鳳山高中, DocCount=90
DEBUG 2025/12/17 17:16:00   Bucket[53]: Key=暨大附中, DocCount=89
DEBUG 2025/12/17 17:16:00   Bucket[54]: Key=溪湖高中, DocCount=85
DEBUG 2025/12/17 17:16:00   Bucket[55]: Key=潮州高中, DocCount=82
DEBUG 2025/12/17 17:16:00   Bucket[56]: Key=新竹高商, DocCount=79
DEBUG 2025/12/17 17:16:00   Bucket[57]: Key=雲林特教, DocCount=75
DEBUG 2025/12/17 17:16:00   Bucket[58]: Key=新豐高中, DocCount=74
DEBUG 2025/12/17 17:16:00   Bucket[59]: Key=臺南高商, DocCount=74
DEBUG 2025/12/17 17:16:00   Bucket[60]: Key=彰化高商, DocCount=73
DEBUG 2025/12/17 17:16:00   Bucket[61]: Key=師大附中高中部, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[62]: Key=新竹高工, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[63]: Key=水里商工, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[64]: Key=嘉義家職, DocCount=70
DEBUG 2025/12/17 17:16:00   Bucket[65]: Key=苗栗高商, DocCount=70
DEBUG 2025/12/17 17:16:00   Bucket[66]: Key=北斗家商, DocCount=68
DEBUG 2025/12/17 17:16:00   Bucket[67]: Key=屏科實中, DocCount=67
DEBUG 2025/12/17 17:16:00   Bucket[68]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 17:16:00   Bucket[69]: Key=草屯商工, DocCount=63
DEBUG 2025/12/17 17:16:00   Bucket[70]: Key=東石高中, DocCount=59
DEBUG 2025/12/17 17:16:00   Bucket[71]: Key=二林工商, DocCount=57
DEBUG 2025/12/17 17:16:00   Bucket[72]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:16:00   Bucket[73]: Key=竹東高中, DocCount=55
DEBUG 2025/12/17 17:16:00   Bucket[74]: Key=旗山農工, DocCount=54
DEBUG 2025/12/17 17:16:00   Bucket[75]: Key=秀水高工, DocCount=54
DEBUG 2025/12/17 17:16:00   Bucket[76]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[77]: Key=善化高中, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[78]: Key=埔里高工, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[79]: Key=蘭陽女中, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[80]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:16:00   Bucket[81]: Key=北港高中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[82]: Key=屏東特教, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[83]: Key=政大附中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[84]: Key=竹山高中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[85]: Key=高餐大附中, DocCount=50
DEBUG 2025/12/17 17:16:00   Bucket[86]: Key=佳冬高農, DocCount=49
DEBUG 2025/12/17 17:16:00   Bucket[87]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:16:00   Bucket[88]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:16:00   Bucket[89]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:16:00   Bucket[90]: Key=臺東高商, DocCount=45
DEBUG 2025/12/17 17:16:00   Bucket[91]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:16:00   Bucket[92]: Key=花蓮高工, DocCount=44
DEBUG 2025/12/17 17:16:00   Bucket[93]: Key=玉井工商, DocCount=43
DEBUG 2025/12/17 17:16:00   Bucket[94]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[95]: Key=曾文農工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[96]: Key=白河商工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[97]: Key=屏北高中, DocCount=41
DEBUG 2025/12/17 17:16:00   Bucket[98]: Key=宜蘭高中, DocCount=40
DEBUG 2025/12/17 17:16:00   Bucket[99]: Key=臺東女中, DocCount=40
DEBUG 2025/12/17 17:16:00 ========================================================
INFO 2025/12/17 17:16:03 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:16:08 ✅ Successfully flushed 23/23 history records to TimescaleDB
INFO 2025/12/17 17:16:08 Processing 15 offline devices
INFO 2025/12/17 17:16:08 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:16:08 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:16:08 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:16:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:16:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:16:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:16:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:16:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:16:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:16:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:16:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:16:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:16:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:16:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:16:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:16:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:16:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:16:09 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:16:09 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:16:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:16:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:16:09 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:16:09 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:16:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:16:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:16:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:16:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:16:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:16:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:16:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:16:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:16:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:16:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:16:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:16:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:16:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:16:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:16:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:16:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:16:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:16:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:16:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:16:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:16:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:16:45 ES Alert Created [critical][performance]: Memory usage critical: 90.76% (threshold: 90.00%)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.50% (threshold: 85.00%)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:16:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:16:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:16:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:16:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:17:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:17:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:17:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:17:00 Field: school_name.keyword
DEBUG 2025/12/17 17:17:00 Time From: 2025-12-17T17:16:00.000+08:00
DEBUG 2025/12/17 17:17:00 Time To: 2025-12-17T17:17:00.000+08:00
DEBUG 2025/12/17 17:17:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:16:00.000+08:00",
					"lte": "2025-12-17T17:17:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:17:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:17:00 ES Response IsError: false
DEBUG 2025/12/17 17:17:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":563,"buckets":[{"key":"黑快馬主機","doc_count":2022},{"key":"花蓮高農","doc_count":770},{"key":"新竹女中","doc_count":587},{"key":"仁愛高農","doc_count":582},{"key":"金門高中","doc_count":564},{"key":"金門農工","doc_count":548},{"key":"玉里高中","doc_count":531},{"key":"竹北高中","doc_count":480},{"key":"華僑高中","doc_count":464},{"key":"北門高中","doc_count":452},{"key":"新港藝高","doc_count":415},{"key":"臺東高中","doc_count":408},{"key":"旗美高中","doc_count":400},{"key":"南投高商","doc_count":398},{"key":"宜蘭高商","doc_count":379},{"key":"內埔農工","doc_count":332},{"key":"蘇澳海事","doc_count":326},{"key":"興大附中","doc_count":312},{"key":"清華附小","doc_count":257},{"key":"新化高工","doc_count":232},{"key":"關西高中","doc_count":225},{"key":"竹南高中","doc_count":215},{"key":"斗六家商","doc_count":204},{"key":"中大壢中","doc_count":202},{"key":"花蓮高商","doc_count":201},{"key":"苗栗農工","doc_count":200},{"key":"後壁高中","doc_count":190},{"key":"關山工商","doc_count":173},{"key":"花蓮高中","doc_count":168},{"key":"新化高中","doc_count":165},{"key":"新營高中","doc_count":163},{"key":"師大附中高中部","doc_count":157},{"key":"南投特教","doc_count":155},{"key":"東港海事","doc_count":149},{"key":"嘉義高商","doc_count":137},{"key":"屏東女中","doc_count":137},{"key":"彰師附工","doc_count":135},{"key":"虎尾高中","doc_count":126},{"key":"中興高中","doc_count":120},{"key":"水里商工","doc_count":118},{"key":"嘉義高中","doc_count":114},{"key":"新竹高工","doc_count":113},{"key":"成大南工","doc_count":112},{"key":"花蓮高工","doc_count":112},{"key":"彰化高商","doc_count":111},{"key":"苗栗高中","doc_count":110},{"key":"草屯商工","doc_count":110},{"key":"新營高工","doc_count":108},{"key":"南投高中","doc_count":106},{"key":"新竹高商","doc_count":105},{"key":"南大附聰","doc_count":104},{"key":"員林家商","doc_count":104},{"key":"曾文農工","doc_count":104},{"key":"嘉科實中","doc_count":101},{"key":"新竹高中","doc_count":101},{"key":"宜蘭高中","doc_count":95},{"key":"員林農工","doc_count":91},{"key":"員林高中","doc_count":89},{"key":"屏科實中","doc_count":88},{"key":"旗山農工","doc_count":87},{"key":"蘭陽女中","doc_count":82},{"key":"高餐大附中","doc_count":82},{"key":"善化高中","doc_count":80},{"key":"北斗家商","doc_count":78},{"key":"秀水高工","doc_count":78},{"key":"北教大實小","doc_count":76},{"key":"成功商水","doc_count":76},{"key":"崇實高工","doc_count":75},{"key":"雲林特教","doc_count":74},{"key":"臺東高商","doc_count":71},{"key":"屏東高中","doc_count":68},{"key":"潮州高中","doc_count":68},{"key":"鳳山高中","doc_count":66},{"key":"東石高中","doc_count":65},{"key":"白河商工","doc_count":64},{"key":"北港農工","doc_count":62},{"key":"羅東高工","doc_count":62},{"key":"羅東高商","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"屏東高工","doc_count":59},{"key":"土庫商工","doc_count":58},{"key":"臺南一中","doc_count":56},{"key":"暨大附中","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"頭城家商","doc_count":54},{"key":"南大附中","doc_count":53},{"key":"屏東特教","doc_count":52},{"key":"竹山高中","doc_count":52},{"key":"北港高中","doc_count":51},{"key":"竹東高中","doc_count":51},{"key":"二林工商","doc_count":50},{"key":"苗栗高商","doc_count":49},{"key":"澎湖海事","doc_count":48},{"key":"屏北高中","doc_count":47},{"key":"玉井工商","doc_count":47},{"key":"華南高商","doc_count":47},{"key":"永靖高工","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"埔里高工","doc_count":45},{"key":"臺東女中","doc_count":45}]}}}
DEBUG 2025/12/17 17:17:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:17:00   Bucket[0]: Key=黑快馬主機, DocCount=2022
DEBUG 2025/12/17 17:17:00   Bucket[1]: Key=花蓮高農, DocCount=770
DEBUG 2025/12/17 17:17:00   Bucket[2]: Key=新竹女中, DocCount=587
DEBUG 2025/12/17 17:17:00   Bucket[3]: Key=仁愛高農, DocCount=582
DEBUG 2025/12/17 17:17:00   Bucket[4]: Key=金門高中, DocCount=564
DEBUG 2025/12/17 17:17:00   Bucket[5]: Key=金門農工, DocCount=548
DEBUG 2025/12/17 17:17:00   Bucket[6]: Key=玉里高中, DocCount=531
DEBUG 2025/12/17 17:17:00   Bucket[7]: Key=竹北高中, DocCount=480
DEBUG 2025/12/17 17:17:00   Bucket[8]: Key=華僑高中, DocCount=464
DEBUG 2025/12/17 17:17:00   Bucket[9]: Key=北門高中, DocCount=452
DEBUG 2025/12/17 17:17:00   Bucket[10]: Key=新港藝高, DocCount=415
DEBUG 2025/12/17 17:17:00   Bucket[11]: Key=臺東高中, DocCount=408
DEBUG 2025/12/17 17:17:00   Bucket[12]: Key=旗美高中, DocCount=400
DEBUG 2025/12/17 17:17:00   Bucket[13]: Key=南投高商, DocCount=398
DEBUG 2025/12/17 17:17:00   Bucket[14]: Key=宜蘭高商, DocCount=379
DEBUG 2025/12/17 17:17:00   Bucket[15]: Key=內埔農工, DocCount=332
DEBUG 2025/12/17 17:17:00   Bucket[16]: Key=蘇澳海事, DocCount=326
DEBUG 2025/12/17 17:17:00   Bucket[17]: Key=興大附中, DocCount=312
DEBUG 2025/12/17 17:17:00   Bucket[18]: Key=清華附小, DocCount=257
DEBUG 2025/12/17 17:17:00   Bucket[19]: Key=新化高工, DocCount=232
DEBUG 2025/12/17 17:17:00   Bucket[20]: Key=關西高中, DocCount=225
DEBUG 2025/12/17 17:17:00   Bucket[21]: Key=竹南高中, DocCount=215
DEBUG 2025/12/17 17:17:00   Bucket[22]: Key=斗六家商, DocCount=204
DEBUG 2025/12/17 17:17:00   Bucket[23]: Key=中大壢中, DocCount=202
DEBUG 2025/12/17 17:17:00   Bucket[24]: Key=花蓮高商, DocCount=201
DEBUG 2025/12/17 17:17:00   Bucket[25]: Key=苗栗農工, DocCount=200
DEBUG 2025/12/17 17:17:00   Bucket[26]: Key=後壁高中, DocCount=190
DEBUG 2025/12/17 17:17:00   Bucket[27]: Key=關山工商, DocCount=173
DEBUG 2025/12/17 17:17:00   Bucket[28]: Key=花蓮高中, DocCount=168
DEBUG 2025/12/17 17:17:00   Bucket[29]: Key=新化高中, DocCount=165
DEBUG 2025/12/17 17:17:00   Bucket[30]: Key=新營高中, DocCount=163
DEBUG 2025/12/17 17:17:00   Bucket[31]: Key=師大附中高中部, DocCount=157
DEBUG 2025/12/17 17:17:00   Bucket[32]: Key=南投特教, DocCount=155
DEBUG 2025/12/17 17:17:00   Bucket[33]: Key=東港海事, DocCount=149
DEBUG 2025/12/17 17:17:00   Bucket[34]: Key=嘉義高商, DocCount=137
DEBUG 2025/12/17 17:17:00   Bucket[35]: Key=屏東女中, DocCount=137
DEBUG 2025/12/17 17:17:00   Bucket[36]: Key=彰師附工, DocCount=135
DEBUG 2025/12/17 17:17:00   Bucket[37]: Key=虎尾高中, DocCount=126
DEBUG 2025/12/17 17:17:00   Bucket[38]: Key=中興高中, DocCount=120
DEBUG 2025/12/17 17:17:00   Bucket[39]: Key=水里商工, DocCount=118
DEBUG 2025/12/17 17:17:00   Bucket[40]: Key=嘉義高中, DocCount=114
DEBUG 2025/12/17 17:17:00   Bucket[41]: Key=新竹高工, DocCount=113
DEBUG 2025/12/17 17:17:00   Bucket[42]: Key=成大南工, DocCount=112
DEBUG 2025/12/17 17:17:00   Bucket[43]: Key=花蓮高工, DocCount=112
DEBUG 2025/12/17 17:17:00   Bucket[44]: Key=彰化高商, DocCount=111
DEBUG 2025/12/17 17:17:00   Bucket[45]: Key=苗栗高中, DocCount=110
DEBUG 2025/12/17 17:17:00   Bucket[46]: Key=草屯商工, DocCount=110
DEBUG 2025/12/17 17:17:00   Bucket[47]: Key=新營高工, DocCount=108
DEBUG 2025/12/17 17:17:00   Bucket[48]: Key=南投高中, DocCount=106
DEBUG 2025/12/17 17:17:00   Bucket[49]: Key=新竹高商, DocCount=105
DEBUG 2025/12/17 17:17:00   Bucket[50]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[51]: Key=員林家商, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[52]: Key=曾文農工, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[53]: Key=嘉科實中, DocCount=101
DEBUG 2025/12/17 17:17:00   Bucket[54]: Key=新竹高中, DocCount=101
DEBUG 2025/12/17 17:17:00   Bucket[55]: Key=宜蘭高中, DocCount=95
DEBUG 2025/12/17 17:17:00   Bucket[56]: Key=員林農工, DocCount=91
DEBUG 2025/12/17 17:17:00   Bucket[57]: Key=員林高中, DocCount=89
DEBUG 2025/12/17 17:17:00   Bucket[58]: Key=屏科實中, DocCount=88
DEBUG 2025/12/17 17:17:00   Bucket[59]: Key=旗山農工, DocCount=87
DEBUG 2025/12/17 17:17:00   Bucket[60]: Key=蘭陽女中, DocCount=82
DEBUG 2025/12/17 17:17:00   Bucket[61]: Key=高餐大附中, DocCount=82
DEBUG 2025/12/17 17:17:00   Bucket[62]: Key=善化高中, DocCount=80
DEBUG 2025/12/17 17:17:00   Bucket[63]: Key=北斗家商, DocCount=78
DEBUG 2025/12/17 17:17:00   Bucket[64]: Key=秀水高工, DocCount=78
DEBUG 2025/12/17 17:17:00   Bucket[65]: Key=北教大實小, DocCount=76
DEBUG 2025/12/17 17:17:00   Bucket[66]: Key=成功商水, DocCount=76
DEBUG 2025/12/17 17:17:00   Bucket[67]: Key=崇實高工, DocCount=75
DEBUG 2025/12/17 17:17:00   Bucket[68]: Key=雲林特教, DocCount=74
DEBUG 2025/12/17 17:17:00   Bucket[69]: Key=臺東高商, DocCount=71
DEBUG 2025/12/17 17:17:00   Bucket[70]: Key=屏東高中, DocCount=68
DEBUG 2025/12/17 17:17:00   Bucket[71]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:17:00   Bucket[72]: Key=鳳山高中, DocCount=66
DEBUG 2025/12/17 17:17:00   Bucket[73]: Key=東石高中, DocCount=65
DEBUG 2025/12/17 17:17:00   Bucket[74]: Key=白河商工, DocCount=64
DEBUG 2025/12/17 17:17:00   Bucket[75]: Key=北港農工, DocCount=62
DEBUG 2025/12/17 17:17:00   Bucket[76]: Key=羅東高工, DocCount=62
DEBUG 2025/12/17 17:17:00   Bucket[77]: Key=羅東高商, DocCount=61
DEBUG 2025/12/17 17:17:00   Bucket[78]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 17:17:00   Bucket[79]: Key=屏東高工, DocCount=59
DEBUG 2025/12/17 17:17:00   Bucket[80]: Key=土庫商工, DocCount=58
DEBUG 2025/12/17 17:17:00   Bucket[81]: Key=臺南一中, DocCount=56
DEBUG 2025/12/17 17:17:00   Bucket[82]: Key=暨大附中, DocCount=55
DEBUG 2025/12/17 17:17:00   Bucket[83]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:17:00   Bucket[84]: Key=頭城家商, DocCount=54
DEBUG 2025/12/17 17:17:00   Bucket[85]: Key=南大附中, DocCount=53
DEBUG 2025/12/17 17:17:00   Bucket[86]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 17:17:00   Bucket[87]: Key=竹山高中, DocCount=52
DEBUG 2025/12/17 17:17:00   Bucket[88]: Key=北港高中, DocCount=51
DEBUG 2025/12/17 17:17:00   Bucket[89]: Key=竹東高中, DocCount=51
DEBUG 2025/12/17 17:17:00   Bucket[90]: Key=二林工商, DocCount=50
DEBUG 2025/12/17 17:17:00   Bucket[91]: Key=苗栗高商, DocCount=49
DEBUG 2025/12/17 17:17:00   Bucket[92]: Key=澎湖海事, DocCount=48
DEBUG 2025/12/17 17:17:00   Bucket[93]: Key=屏北高中, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[94]: Key=玉井工商, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[95]: Key=華南高商, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[96]: Key=永靖高工, DocCount=46
DEBUG 2025/12/17 17:17:00   Bucket[97]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:17:00   Bucket[98]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:17:00   Bucket[99]: Key=臺東女中, DocCount=45
DEBUG 2025/12/17 17:17:00 ========================================================
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 50/54 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:17:13 Processing 15 offline devices
INFO 2025/12/17 17:17:13 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:17:13 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:17:13 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:17:13 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:17:13 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:17:13 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:17:13 ✅ Successfully flushed 44/44 history records to TimescaleDB
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:17:13 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:17:13 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:17:13 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:17:13 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:17:13 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:17:13 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:17:13 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:17:13 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:17:14 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:17:14 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:17:14 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:17:14 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:17:14 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:17:14 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:17:14 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:17:14 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:17:14 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:17:14 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:17:18 ✅ Successfully flushed 13/13 history records to TimescaleDB
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:17:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:17:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:17:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:17:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:17:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:17:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:17:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:17:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:17:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:17:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:17:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:17:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:17:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:17:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:17:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:17:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.86% (threshold: 80.00%)
INFO 2025/12/17 17:17:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.53% (threshold: 85.00%)
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:17:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:17:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:17:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:17:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:18:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:18:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:18:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:18:00 Field: school_name.keyword
DEBUG 2025/12/17 17:18:00 Time From: 2025-12-17T17:17:00.000+08:00
DEBUG 2025/12/17 17:18:00 Time To: 2025-12-17T17:18:00.000+08:00
DEBUG 2025/12/17 17:18:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:17:00.000+08:00",
					"lte": "2025-12-17T17:18:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:18:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:18:00 ES Response IsError: false
DEBUG 2025/12/17 17:18:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"黑快馬主機","doc_count":982},{"key":"花蓮高農","doc_count":783},{"key":"金門農工","doc_count":741},{"key":"金門高中","doc_count":552},{"key":"仁愛高農","doc_count":550},{"key":"竹北高中","doc_count":505},{"key":"新竹女中","doc_count":465},{"key":"北門高中","doc_count":428},{"key":"華僑高中","doc_count":422},{"key":"中大壢中","doc_count":395},{"key":"旗美高中","doc_count":370},{"key":"臺東高中","doc_count":349},{"key":"宜蘭高商","doc_count":343},{"key":"內埔農工","doc_count":327},{"key":"南投高商","doc_count":327},{"key":"花蓮高商","doc_count":269},{"key":"新化高中","doc_count":262},{"key":"蘇澳海事","doc_count":258},{"key":"後壁高中","doc_count":253},{"key":"興大附中","doc_count":253},{"key":"新港藝高","doc_count":248},{"key":"清華附小","doc_count":219},{"key":"斗六家商","doc_count":218},{"key":"關山工商","doc_count":189},{"key":"關西高中","doc_count":184},{"key":"玉里高中","doc_count":176},{"key":"中興高中","doc_count":175},{"key":"竹南高中","doc_count":172},{"key":"苗栗農工","doc_count":167},{"key":"員林家商","doc_count":166},{"key":"旗山農工","doc_count":157},{"key":"南投特教","doc_count":153},{"key":"東港海事","doc_count":153},{"key":"屏東女中","doc_count":151},{"key":"成大南工","doc_count":145},{"key":"新營高中","doc_count":134},{"key":"嘉義高商","doc_count":128},{"key":"政大附中","doc_count":126},{"key":"新營高工","doc_count":124},{"key":"南大附聰","doc_count":118},{"key":"師大附中國中部","doc_count":114},{"key":"彰師附工","doc_count":113},{"key":"新化高工","doc_count":112},{"key":"虎尾高中","doc_count":112},{"key":"永靖高工","doc_count":98},{"key":"南投高中","doc_count":96},{"key":"屏科實中","doc_count":89},{"key":"新竹高工","doc_count":86},{"key":"臺東高商","doc_count":85},{"key":"師大附中高中部","doc_count":83},{"key":"高餐大附中","doc_count":83},{"key":"曾文農工","doc_count":82},{"key":"北教大實小","doc_count":81},{"key":"鳳山高中","doc_count":80},{"key":"彰化高商","doc_count":79},{"key":"苗栗高中","doc_count":78},{"key":"嘉義高中","doc_count":77},{"key":"屏東高工","doc_count":75},{"key":"臺南一中","doc_count":74},{"key":"員林高中","doc_count":70},{"key":"屏東高中","doc_count":70},{"key":"嘉科實中","doc_count":65},{"key":"澎湖海事","doc_count":65},{"key":"北港農工","doc_count":64},{"key":"南大附小","doc_count":63},{"key":"成功商水","doc_count":63},{"key":"北港高中","doc_count":61},{"key":"土庫商工","doc_count":61},{"key":"基隆商工","doc_count":61},{"key":"華南高商","doc_count":61},{"key":"新竹高中","doc_count":59},{"key":"新竹高商","doc_count":59},{"key":"雲林特教","doc_count":59},{"key":"善化高中","doc_count":58},{"key":"埔里高工","doc_count":57},{"key":"暨大附中","doc_count":57},{"key":"竹東高中","doc_count":57},{"key":"花蓮高工","doc_count":57},{"key":"員林農工","doc_count":55},{"key":"蘭陽女中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"屏東特教","doc_count":54},{"key":"苗栗高商","doc_count":53},{"key":"海大附中","doc_count":52},{"key":"秀水高工","doc_count":52},{"key":"草屯商工","doc_count":52},{"key":"北斗家商","doc_count":49},{"key":"溪湖高中","doc_count":49},{"key":"興大附農","doc_count":49},{"key":"花蓮高中","doc_count":49},{"key":"臺南高商","doc_count":48},{"key":"二林工商","doc_count":47},{"key":"佳冬高農","doc_count":46},{"key":"水里商工","doc_count":45},{"key":"嘉義家職","doc_count":42},{"key":"臺東女中","doc_count":42},{"key":"白河商工","doc_count":41},{"key":"嘉義高工","doc_count":39},{"key":"潮州高中","doc_count":39},{"key":"宜蘭高中","doc_count":37}]}}}
DEBUG 2025/12/17 17:18:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:18:00   Bucket[0]: Key=黑快馬主機, DocCount=982
DEBUG 2025/12/17 17:18:00   Bucket[1]: Key=花蓮高農, DocCount=783
DEBUG 2025/12/17 17:18:00   Bucket[2]: Key=金門農工, DocCount=741
DEBUG 2025/12/17 17:18:00   Bucket[3]: Key=金門高中, DocCount=552
DEBUG 2025/12/17 17:18:00   Bucket[4]: Key=仁愛高農, DocCount=550
DEBUG 2025/12/17 17:18:00   Bucket[5]: Key=竹北高中, DocCount=505
DEBUG 2025/12/17 17:18:00   Bucket[6]: Key=新竹女中, DocCount=465
DEBUG 2025/12/17 17:18:00   Bucket[7]: Key=北門高中, DocCount=428
DEBUG 2025/12/17 17:18:00   Bucket[8]: Key=華僑高中, DocCount=422
DEBUG 2025/12/17 17:18:00   Bucket[9]: Key=中大壢中, DocCount=395
DEBUG 2025/12/17 17:18:00   Bucket[10]: Key=旗美高中, DocCount=370
DEBUG 2025/12/17 17:18:00   Bucket[11]: Key=臺東高中, DocCount=349
DEBUG 2025/12/17 17:18:00   Bucket[12]: Key=宜蘭高商, DocCount=343
DEBUG 2025/12/17 17:18:00   Bucket[13]: Key=內埔農工, DocCount=327
DEBUG 2025/12/17 17:18:00   Bucket[14]: Key=南投高商, DocCount=327
DEBUG 2025/12/17 17:18:00   Bucket[15]: Key=花蓮高商, DocCount=269
DEBUG 2025/12/17 17:18:00   Bucket[16]: Key=新化高中, DocCount=262
DEBUG 2025/12/17 17:18:00   Bucket[17]: Key=蘇澳海事, DocCount=258
DEBUG 2025/12/17 17:18:00   Bucket[18]: Key=後壁高中, DocCount=253
DEBUG 2025/12/17 17:18:00   Bucket[19]: Key=興大附中, DocCount=253
DEBUG 2025/12/17 17:18:00   Bucket[20]: Key=新港藝高, DocCount=248
DEBUG 2025/12/17 17:18:00   Bucket[21]: Key=清華附小, DocCount=219
DEBUG 2025/12/17 17:18:00   Bucket[22]: Key=斗六家商, DocCount=218
DEBUG 2025/12/17 17:18:00   Bucket[23]: Key=關山工商, DocCount=189
DEBUG 2025/12/17 17:18:00   Bucket[24]: Key=關西高中, DocCount=184
DEBUG 2025/12/17 17:18:00   Bucket[25]: Key=玉里高中, DocCount=176
DEBUG 2025/12/17 17:18:00   Bucket[26]: Key=中興高中, DocCount=175
DEBUG 2025/12/17 17:18:00   Bucket[27]: Key=竹南高中, DocCount=172
DEBUG 2025/12/17 17:18:00   Bucket[28]: Key=苗栗農工, DocCount=167
DEBUG 2025/12/17 17:18:00   Bucket[29]: Key=員林家商, DocCount=166
DEBUG 2025/12/17 17:18:00   Bucket[30]: Key=旗山農工, DocCount=157
DEBUG 2025/12/17 17:18:00   Bucket[31]: Key=南投特教, DocCount=153
DEBUG 2025/12/17 17:18:00   Bucket[32]: Key=東港海事, DocCount=153
DEBUG 2025/12/17 17:18:00   Bucket[33]: Key=屏東女中, DocCount=151
DEBUG 2025/12/17 17:18:00   Bucket[34]: Key=成大南工, DocCount=145
DEBUG 2025/12/17 17:18:00   Bucket[35]: Key=新營高中, DocCount=134
DEBUG 2025/12/17 17:18:00   Bucket[36]: Key=嘉義高商, DocCount=128
DEBUG 2025/12/17 17:18:00   Bucket[37]: Key=政大附中, DocCount=126
DEBUG 2025/12/17 17:18:00   Bucket[38]: Key=新營高工, DocCount=124
DEBUG 2025/12/17 17:18:00   Bucket[39]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:18:00   Bucket[40]: Key=師大附中國中部, DocCount=114
DEBUG 2025/12/17 17:18:00   Bucket[41]: Key=彰師附工, DocCount=113
DEBUG 2025/12/17 17:18:00   Bucket[42]: Key=新化高工, DocCount=112
DEBUG 2025/12/17 17:18:00   Bucket[43]: Key=虎尾高中, DocCount=112
DEBUG 2025/12/17 17:18:00   Bucket[44]: Key=永靖高工, DocCount=98
DEBUG 2025/12/17 17:18:00   Bucket[45]: Key=南投高中, DocCount=96
DEBUG 2025/12/17 17:18:00   Bucket[46]: Key=屏科實中, DocCount=89
DEBUG 2025/12/17 17:18:00   Bucket[47]: Key=新竹高工, DocCount=86
DEBUG 2025/12/17 17:18:00   Bucket[48]: Key=臺東高商, DocCount=85
DEBUG 2025/12/17 17:18:00   Bucket[49]: Key=師大附中高中部, DocCount=83
DEBUG 2025/12/17 17:18:00   Bucket[50]: Key=高餐大附中, DocCount=83
DEBUG 2025/12/17 17:18:00   Bucket[51]: Key=曾文農工, DocCount=82
DEBUG 2025/12/17 17:18:00   Bucket[52]: Key=北教大實小, DocCount=81
DEBUG 2025/12/17 17:18:00   Bucket[53]: Key=鳳山高中, DocCount=80
DEBUG 2025/12/17 17:18:00   Bucket[54]: Key=彰化高商, DocCount=79
DEBUG 2025/12/17 17:18:00   Bucket[55]: Key=苗栗高中, DocCount=78
DEBUG 2025/12/17 17:18:00   Bucket[56]: Key=嘉義高中, DocCount=77
DEBUG 2025/12/17 17:18:00   Bucket[57]: Key=屏東高工, DocCount=75
DEBUG 2025/12/17 17:18:00   Bucket[58]: Key=臺南一中, DocCount=74
DEBUG 2025/12/17 17:18:00   Bucket[59]: Key=員林高中, DocCount=70
DEBUG 2025/12/17 17:18:00   Bucket[60]: Key=屏東高中, DocCount=70
DEBUG 2025/12/17 17:18:00   Bucket[61]: Key=嘉科實中, DocCount=65
DEBUG 2025/12/17 17:18:00   Bucket[62]: Key=澎湖海事, DocCount=65
DEBUG 2025/12/17 17:18:00   Bucket[63]: Key=北港農工, DocCount=64
DEBUG 2025/12/17 17:18:00   Bucket[64]: Key=南大附小, DocCount=63
DEBUG 2025/12/17 17:18:00   Bucket[65]: Key=成功商水, DocCount=63
DEBUG 2025/12/17 17:18:00   Bucket[66]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[67]: Key=土庫商工, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[68]: Key=基隆商工, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[69]: Key=華南高商, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[70]: Key=新竹高中, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[71]: Key=新竹高商, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[72]: Key=雲林特教, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[73]: Key=善化高中, DocCount=58
DEBUG 2025/12/17 17:18:00   Bucket[74]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[75]: Key=暨大附中, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[76]: Key=竹東高中, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[77]: Key=花蓮高工, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[78]: Key=員林農工, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[79]: Key=蘭陽女中, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[80]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[81]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 17:18:00   Bucket[82]: Key=苗栗高商, DocCount=53
DEBUG 2025/12/17 17:18:00   Bucket[83]: Key=海大附中, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[84]: Key=秀水高工, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[85]: Key=草屯商工, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[86]: Key=北斗家商, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[87]: Key=溪湖高中, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[88]: Key=興大附農, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[89]: Key=花蓮高中, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[90]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 17:18:00   Bucket[91]: Key=二林工商, DocCount=47
DEBUG 2025/12/17 17:18:00   Bucket[92]: Key=佳冬高農, DocCount=46
DEBUG 2025/12/17 17:18:00   Bucket[93]: Key=水里商工, DocCount=45
DEBUG 2025/12/17 17:18:00   Bucket[94]: Key=嘉義家職, DocCount=42
DEBUG 2025/12/17 17:18:00   Bucket[95]: Key=臺東女中, DocCount=42
DEBUG 2025/12/17 17:18:00   Bucket[96]: Key=白河商工, DocCount=41
DEBUG 2025/12/17 17:18:00   Bucket[97]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:18:00   Bucket[98]: Key=潮州高中, DocCount=39
DEBUG 2025/12/17 17:18:00   Bucket[99]: Key=宜蘭高中, DocCount=37
DEBUG 2025/12/17 17:18:00 ========================================================
INFO 2025/12/17 17:18:03 ✅ Successfully flushed 10/10 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:18:08 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 17:18:09 Processing 15 offline devices
INFO 2025/12/17 17:18:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:18:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:18:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:18:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:18:09 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:18:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:18:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:18:10 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:18:10 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:18:10 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:18:10 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:18:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:18:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:18:10 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:18:10 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:18:13 ✅ Successfully flushed 31/31 history records to TimescaleDB
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:18:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:18:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:18:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:18:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:18:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:18:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:18:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:18:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:18:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:18:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:18:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:18:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:18:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:18:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:18:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:18:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.52% (threshold: 80.00%)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.34% (threshold: 85.00%)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
INFO 2025/12/17 17:18:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:18:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:18:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:18:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:18:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:18:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:18:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:19:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:19:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:19:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:19:00 Field: school_name.keyword
DEBUG 2025/12/17 17:19:00 Time From: 2025-12-17T17:18:00.000+08:00
DEBUG 2025/12/17 17:19:00 Time To: 2025-12-17T17:19:00.000+08:00
DEBUG 2025/12/17 17:19:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:18:00.000+08:00",
					"lte": "2025-12-17T17:19:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:19:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:19:00 ES Response IsError: false
DEBUG 2025/12/17 17:19:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":516,"buckets":[{"key":"黑快馬主機","doc_count":1247},{"key":"花蓮高農","doc_count":733},{"key":"仁愛高農","doc_count":610},{"key":"金門農工","doc_count":572},{"key":"金門高中","doc_count":546},{"key":"新竹女中","doc_count":522},{"key":"竹北高中","doc_count":465},{"key":"北門高中","doc_count":429},{"key":"南投高商","doc_count":428},{"key":"華僑高中","doc_count":426},{"key":"臺東高中","doc_count":416},{"key":"宜蘭高商","doc_count":387},{"key":"旗美高中","doc_count":377},{"key":"花蓮高商","doc_count":314},{"key":"內埔農工","doc_count":308},{"key":"蘇澳海事","doc_count":289},{"key":"興大附中","doc_count":276},{"key":"斗六家商","doc_count":255},{"key":"屏東女中","doc_count":249},{"key":"清華附小","doc_count":247},{"key":"新港藝高","doc_count":235},{"key":"關西高中","doc_count":216},{"key":"後壁高中","doc_count":210},{"key":"新化高中","doc_count":196},{"key":"中大壢中","doc_count":194},{"key":"彰師附工","doc_count":189},{"key":"關山工商","doc_count":189},{"key":"虎尾高中","doc_count":179},{"key":"員林家商","doc_count":177},{"key":"竹南高中","doc_count":177},{"key":"玉里高中","doc_count":169},{"key":"苗栗農工","doc_count":169},{"key":"東港海事","doc_count":163},{"key":"南投特教","doc_count":156},{"key":"新竹高工","doc_count":155},{"key":"新化高工","doc_count":140},{"key":"新竹高商","doc_count":126},{"key":"嘉義家職","doc_count":122},{"key":"新營高工","doc_count":120},{"key":"嘉義高商","doc_count":108},{"key":"新營高中","doc_count":108},{"key":"鳳山高中","doc_count":105},{"key":"北港農工","doc_count":101},{"key":"南大附聰","doc_count":100},{"key":"臺東高商","doc_count":100},{"key":"屏東高工","doc_count":93},{"key":"師大附中高中部","doc_count":88},{"key":"南大附小","doc_count":87},{"key":"屏科實中","doc_count":87},{"key":"北教大實小","doc_count":86},{"key":"中興高中","doc_count":85},{"key":"員林高中","doc_count":85},{"key":"北斗家商","doc_count":82},{"key":"花蓮高中","doc_count":82},{"key":"屏東高中","doc_count":80},{"key":"政大附中","doc_count":80},{"key":"臺南一中","doc_count":80},{"key":"海大附中","doc_count":78},{"key":"水里商工","doc_count":77},{"key":"苗栗高中","doc_count":77},{"key":"北港高中","doc_count":76},{"key":"成大南工","doc_count":74},{"key":"草屯商工","doc_count":74},{"key":"羅東高商","doc_count":72},{"key":"員林農工","doc_count":71},{"key":"秀水高工","doc_count":69},{"key":"興大附農","doc_count":69},{"key":"宜蘭高中","doc_count":68},{"key":"潮州高中","doc_count":68},{"key":"佳冬高農","doc_count":66},{"key":"旗山農工","doc_count":65},{"key":"永靖高工","doc_count":65},{"key":"嘉義高中","doc_count":63},{"key":"南投高中","doc_count":62},{"key":"頭城家商","doc_count":62},{"key":"高餐大附中","doc_count":61},{"key":"澎湖海事","doc_count":59},{"key":"彰化高商","doc_count":58},{"key":"竹山高中","doc_count":58},{"key":"羅東高工","doc_count":58},{"key":"苗栗高商","doc_count":58},{"key":"屏北高中","doc_count":56},{"key":"東石高中","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"南大附中","doc_count":53},{"key":"嘉義特教","doc_count":50},{"key":"竹東高中","doc_count":50},{"key":"善化高中","doc_count":49},{"key":"土庫商工","doc_count":48},{"key":"雲林特教","doc_count":48},{"key":"白河商工","doc_count":46},{"key":"花蓮高工","doc_count":45},{"key":"蘭陽女中","doc_count":45},{"key":"嘉科實中","doc_count":44},{"key":"新竹高中","doc_count":44},{"key":"曾文農工","doc_count":44},{"key":"溪湖高中","doc_count":44},{"key":"臺東女中","doc_count":44},{"key":"二林工商","doc_count":43},{"key":"屏東特教","doc_count":42}]}}}
DEBUG 2025/12/17 17:19:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:19:00   Bucket[0]: Key=黑快馬主機, DocCount=1247
DEBUG 2025/12/17 17:19:00   Bucket[1]: Key=花蓮高農, DocCount=733
DEBUG 2025/12/17 17:19:00   Bucket[2]: Key=仁愛高農, DocCount=610
DEBUG 2025/12/17 17:19:00   Bucket[3]: Key=金門農工, DocCount=572
DEBUG 2025/12/17 17:19:00   Bucket[4]: Key=金門高中, DocCount=546
DEBUG 2025/12/17 17:19:00   Bucket[5]: Key=新竹女中, DocCount=522
DEBUG 2025/12/17 17:19:00   Bucket[6]: Key=竹北高中, DocCount=465
DEBUG 2025/12/17 17:19:00   Bucket[7]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 17:19:00   Bucket[8]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:19:00   Bucket[9]: Key=華僑高中, DocCount=426
DEBUG 2025/12/17 17:19:00   Bucket[10]: Key=臺東高中, DocCount=416
DEBUG 2025/12/17 17:19:00   Bucket[11]: Key=宜蘭高商, DocCount=387
DEBUG 2025/12/17 17:19:00   Bucket[12]: Key=旗美高中, DocCount=377
DEBUG 2025/12/17 17:19:00   Bucket[13]: Key=花蓮高商, DocCount=314
DEBUG 2025/12/17 17:19:00   Bucket[14]: Key=內埔農工, DocCount=308
DEBUG 2025/12/17 17:19:00   Bucket[15]: Key=蘇澳海事, DocCount=289
DEBUG 2025/12/17 17:19:00   Bucket[16]: Key=興大附中, DocCount=276
DEBUG 2025/12/17 17:19:00   Bucket[17]: Key=斗六家商, DocCount=255
DEBUG 2025/12/17 17:19:00   Bucket[18]: Key=屏東女中, DocCount=249
DEBUG 2025/12/17 17:19:00   Bucket[19]: Key=清華附小, DocCount=247
DEBUG 2025/12/17 17:19:00   Bucket[20]: Key=新港藝高, DocCount=235
DEBUG 2025/12/17 17:19:00   Bucket[21]: Key=關西高中, DocCount=216
DEBUG 2025/12/17 17:19:00   Bucket[22]: Key=後壁高中, DocCount=210
DEBUG 2025/12/17 17:19:00   Bucket[23]: Key=新化高中, DocCount=196
DEBUG 2025/12/17 17:19:00   Bucket[24]: Key=中大壢中, DocCount=194
DEBUG 2025/12/17 17:19:00   Bucket[25]: Key=彰師附工, DocCount=189
DEBUG 2025/12/17 17:19:00   Bucket[26]: Key=關山工商, DocCount=189
DEBUG 2025/12/17 17:19:00   Bucket[27]: Key=虎尾高中, DocCount=179
DEBUG 2025/12/17 17:19:00   Bucket[28]: Key=員林家商, DocCount=177
DEBUG 2025/12/17 17:19:00   Bucket[29]: Key=竹南高中, DocCount=177
DEBUG 2025/12/17 17:19:00   Bucket[30]: Key=玉里高中, DocCount=169
DEBUG 2025/12/17 17:19:00   Bucket[31]: Key=苗栗農工, DocCount=169
DEBUG 2025/12/17 17:19:00   Bucket[32]: Key=東港海事, DocCount=163
DEBUG 2025/12/17 17:19:00   Bucket[33]: Key=南投特教, DocCount=156
DEBUG 2025/12/17 17:19:00   Bucket[34]: Key=新竹高工, DocCount=155
DEBUG 2025/12/17 17:19:00   Bucket[35]: Key=新化高工, DocCount=140
DEBUG 2025/12/17 17:19:00   Bucket[36]: Key=新竹高商, DocCount=126
DEBUG 2025/12/17 17:19:00   Bucket[37]: Key=嘉義家職, DocCount=122
DEBUG 2025/12/17 17:19:00   Bucket[38]: Key=新營高工, DocCount=120
DEBUG 2025/12/17 17:19:00   Bucket[39]: Key=嘉義高商, DocCount=108
DEBUG 2025/12/17 17:19:00   Bucket[40]: Key=新營高中, DocCount=108
DEBUG 2025/12/17 17:19:00   Bucket[41]: Key=鳳山高中, DocCount=105
DEBUG 2025/12/17 17:19:00   Bucket[42]: Key=北港農工, DocCount=101
DEBUG 2025/12/17 17:19:00   Bucket[43]: Key=南大附聰, DocCount=100
DEBUG 2025/12/17 17:19:00   Bucket[44]: Key=臺東高商, DocCount=100
DEBUG 2025/12/17 17:19:00   Bucket[45]: Key=屏東高工, DocCount=93
DEBUG 2025/12/17 17:19:00   Bucket[46]: Key=師大附中高中部, DocCount=88
DEBUG 2025/12/17 17:19:00   Bucket[47]: Key=南大附小, DocCount=87
DEBUG 2025/12/17 17:19:00   Bucket[48]: Key=屏科實中, DocCount=87
DEBUG 2025/12/17 17:19:00   Bucket[49]: Key=北教大實小, DocCount=86
DEBUG 2025/12/17 17:19:00   Bucket[50]: Key=中興高中, DocCount=85
DEBUG 2025/12/17 17:19:00   Bucket[51]: Key=員林高中, DocCount=85
DEBUG 2025/12/17 17:19:00   Bucket[52]: Key=北斗家商, DocCount=82
DEBUG 2025/12/17 17:19:00   Bucket[53]: Key=花蓮高中, DocCount=82
DEBUG 2025/12/17 17:19:00   Bucket[54]: Key=屏東高中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[55]: Key=政大附中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[56]: Key=臺南一中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[57]: Key=海大附中, DocCount=78
DEBUG 2025/12/17 17:19:00   Bucket[58]: Key=水里商工, DocCount=77
DEBUG 2025/12/17 17:19:00   Bucket[59]: Key=苗栗高中, DocCount=77
DEBUG 2025/12/17 17:19:00   Bucket[60]: Key=北港高中, DocCount=76
DEBUG 2025/12/17 17:19:00   Bucket[61]: Key=成大南工, DocCount=74
DEBUG 2025/12/17 17:19:00   Bucket[62]: Key=草屯商工, DocCount=74
DEBUG 2025/12/17 17:19:00   Bucket[63]: Key=羅東高商, DocCount=72
DEBUG 2025/12/17 17:19:00   Bucket[64]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:19:00   Bucket[65]: Key=秀水高工, DocCount=69
DEBUG 2025/12/17 17:19:00   Bucket[66]: Key=興大附農, DocCount=69
DEBUG 2025/12/17 17:19:00   Bucket[67]: Key=宜蘭高中, DocCount=68
DEBUG 2025/12/17 17:19:00   Bucket[68]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:19:00   Bucket[69]: Key=佳冬高農, DocCount=66
DEBUG 2025/12/17 17:19:00   Bucket[70]: Key=旗山農工, DocCount=65
DEBUG 2025/12/17 17:19:00   Bucket[71]: Key=永靖高工, DocCount=65
DEBUG 2025/12/17 17:19:00   Bucket[72]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 17:19:00   Bucket[73]: Key=南投高中, DocCount=62
DEBUG 2025/12/17 17:19:00   Bucket[74]: Key=頭城家商, DocCount=62
DEBUG 2025/12/17 17:19:00   Bucket[75]: Key=高餐大附中, DocCount=61
DEBUG 2025/12/17 17:19:00   Bucket[76]: Key=澎湖海事, DocCount=59
DEBUG 2025/12/17 17:19:00   Bucket[77]: Key=彰化高商, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[78]: Key=竹山高中, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[79]: Key=羅東高工, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[80]: Key=苗栗高商, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[81]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[82]: Key=東石高中, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[83]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[84]: Key=南大附中, DocCount=53
DEBUG 2025/12/17 17:19:00   Bucket[85]: Key=嘉義特教, DocCount=50
DEBUG 2025/12/17 17:19:00   Bucket[86]: Key=竹東高中, DocCount=50
DEBUG 2025/12/17 17:19:00   Bucket[87]: Key=善化高中, DocCount=49
DEBUG 2025/12/17 17:19:00   Bucket[88]: Key=土庫商工, DocCount=48
DEBUG 2025/12/17 17:19:00   Bucket[89]: Key=雲林特教, DocCount=48
DEBUG 2025/12/17 17:19:00   Bucket[90]: Key=白河商工, DocCount=46
DEBUG 2025/12/17 17:19:00   Bucket[91]: Key=花蓮高工, DocCount=45
DEBUG 2025/12/17 17:19:00   Bucket[92]: Key=蘭陽女中, DocCount=45
DEBUG 2025/12/17 17:19:00   Bucket[93]: Key=嘉科實中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[94]: Key=新竹高中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[95]: Key=曾文農工, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[96]: Key=溪湖高中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[97]: Key=臺東女中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[98]: Key=二林工商, DocCount=43
DEBUG 2025/12/17 17:19:00   Bucket[99]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:19:00 ========================================================
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 51/58 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 2/0 history records to TimescaleDB
INFO 2025/12/17 17:19:10 Processing 15 offline devices
INFO 2025/12/17 17:19:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:19:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:19:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:19:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:19:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:19:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:19:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:19:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:19:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:19:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:19:10 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:19:10 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:19:10 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:19:10 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:19:11 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:19:11 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:19:11 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:19:11 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:19:11 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:19:11 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:19:11 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:19:11 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:19:13 ✅ Successfully flushed 49/49 history records to TimescaleDB
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:19:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:19:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:19:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:19:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:19:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:19:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:19:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:19:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:19:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:19:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:19:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:19:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:19:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.37% (threshold: 80.00%)
INFO 2025/12/17 17:19:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:19:45 ES Alert Created [high][capacity]: Disk usage high: 93.34% (threshold: 85.00%)
WARN 2025/12/17 17:19:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:19:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:19:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:19:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:19:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:19:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:20:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:20:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:20:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:20:00 Field: school_name.keyword
DEBUG 2025/12/17 17:20:00 Time From: 2025-12-17T17:19:00.000+08:00
DEBUG 2025/12/17 17:20:00 Time To: 2025-12-17T17:20:00.000+08:00
DEBUG 2025/12/17 17:20:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:19:00.000+08:00",
					"lte": "2025-12-17T17:20:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:20:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:20:00 ES Response IsError: false
DEBUG 2025/12/17 17:20:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":472,"buckets":[{"key":"黑快馬主機","doc_count":1014},{"key":"花蓮高農","doc_count":797},{"key":"新竹女中","doc_count":627},{"key":"仁愛高農","doc_count":571},{"key":"金門農工","doc_count":518},{"key":"金門高中","doc_count":514},{"key":"華僑高中","doc_count":485},{"key":"臺東高中","doc_count":410},{"key":"竹北高中","doc_count":382},{"key":"北門高中","doc_count":377},{"key":"花蓮高商","doc_count":376},{"key":"宜蘭高商","doc_count":369},{"key":"南投高商","doc_count":362},{"key":"蘇澳海事","doc_count":300},{"key":"關西高中","doc_count":294},{"key":"興大附中","doc_count":280},{"key":"虎尾高中","doc_count":262},{"key":"彰師附工","doc_count":254},{"key":"旗美高中","doc_count":253},{"key":"清華附小","doc_count":249},{"key":"斗六家商","doc_count":229},{"key":"內埔農工","doc_count":228},{"key":"屏東女中","doc_count":223},{"key":"新化高中","doc_count":221},{"key":"後壁高中","doc_count":209},{"key":"竹南高中","doc_count":209},{"key":"中大壢中","doc_count":203},{"key":"南投特教","doc_count":201},{"key":"新港藝高","doc_count":195},{"key":"嘉義高商","doc_count":192},{"key":"政大附中","doc_count":181},{"key":"員林家商","doc_count":176},{"key":"關山工商","doc_count":175},{"key":"永靖高工","doc_count":170},{"key":"苗栗農工","doc_count":168},{"key":"玉里高中","doc_count":153},{"key":"臺東高商","doc_count":145},{"key":"屏北高中","doc_count":136},{"key":"臺南一中","doc_count":135},{"key":"新營高工","doc_count":125},{"key":"新化高工","doc_count":121},{"key":"新營高中","doc_count":113},{"key":"埔里高工","doc_count":106},{"key":"東港海事","doc_count":105},{"key":"南投高中","doc_count":101},{"key":"二林工商","doc_count":100},{"key":"新竹高工","doc_count":100},{"key":"草屯商工","doc_count":100},{"key":"嘉義高中","doc_count":97},{"key":"曾文農工","doc_count":97},{"key":"秀水高工","doc_count":97},{"key":"嘉義家職","doc_count":96},{"key":"水里商工","doc_count":96},{"key":"鳳山高中","doc_count":93},{"key":"中興高中","doc_count":91},{"key":"屏科實中","doc_count":91},{"key":"溪湖高中","doc_count":88},{"key":"成大南工","doc_count":86},{"key":"宜蘭高中","doc_count":84},{"key":"花蓮高工","doc_count":84},{"key":"南大附聰","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"北斗家商","doc_count":77},{"key":"高餐大附中","doc_count":76},{"key":"臺南高商","doc_count":73},{"key":"海大附中","doc_count":72},{"key":"頭城家商","doc_count":72},{"key":"旗山農工","doc_count":70},{"key":"臺東女中","doc_count":70},{"key":"北港高中","doc_count":69},{"key":"雲林特教","doc_count":68},{"key":"基隆商工","doc_count":67},{"key":"師大附中高中部","doc_count":66},{"key":"新竹高商","doc_count":66},{"key":"苗栗高商","doc_count":66},{"key":"潮州高中","doc_count":65},{"key":"北教大實小","doc_count":64},{"key":"北港農工","doc_count":63},{"key":"南大附中","doc_count":62},{"key":"崇實高工","doc_count":59},{"key":"彰化高商","doc_count":57},{"key":"嘉科實中","doc_count":51},{"key":"嘉義高工","doc_count":50},{"key":"竹山高中","doc_count":50},{"key":"花蓮特教","doc_count":50},{"key":"新豐高中","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"屏東特教","doc_count":47},{"key":"澎湖海事","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"善化高中","doc_count":44},{"key":"苗栗高中","doc_count":43},{"key":"土庫商工","doc_count":42},{"key":"新竹高中","doc_count":41},{"key":"東石高中","doc_count":40},{"key":"羅東高商","doc_count":40},{"key":"家齊高中","doc_count":39},{"key":"蘭陽女中","doc_count":39},{"key":"花蓮高中","doc_count":38}]}}}
DEBUG 2025/12/17 17:20:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:20:00   Bucket[0]: Key=黑快馬主機, DocCount=1014
DEBUG 2025/12/17 17:20:00   Bucket[1]: Key=花蓮高農, DocCount=797
DEBUG 2025/12/17 17:20:00   Bucket[2]: Key=新竹女中, DocCount=627
DEBUG 2025/12/17 17:20:00   Bucket[3]: Key=仁愛高農, DocCount=571
DEBUG 2025/12/17 17:20:00   Bucket[4]: Key=金門農工, DocCount=518
DEBUG 2025/12/17 17:20:00   Bucket[5]: Key=金門高中, DocCount=514
DEBUG 2025/12/17 17:20:00   Bucket[6]: Key=華僑高中, DocCount=485
DEBUG 2025/12/17 17:20:00   Bucket[7]: Key=臺東高中, DocCount=410
DEBUG 2025/12/17 17:20:00   Bucket[8]: Key=竹北高中, DocCount=382
DEBUG 2025/12/17 17:20:00   Bucket[9]: Key=北門高中, DocCount=377
DEBUG 2025/12/17 17:20:00   Bucket[10]: Key=花蓮高商, DocCount=376
DEBUG 2025/12/17 17:20:00   Bucket[11]: Key=宜蘭高商, DocCount=369
DEBUG 2025/12/17 17:20:00   Bucket[12]: Key=南投高商, DocCount=362
DEBUG 2025/12/17 17:20:00   Bucket[13]: Key=蘇澳海事, DocCount=300
DEBUG 2025/12/17 17:20:00   Bucket[14]: Key=關西高中, DocCount=294
DEBUG 2025/12/17 17:20:00   Bucket[15]: Key=興大附中, DocCount=280
DEBUG 2025/12/17 17:20:00   Bucket[16]: Key=虎尾高中, DocCount=262
DEBUG 2025/12/17 17:20:00   Bucket[17]: Key=彰師附工, DocCount=254
DEBUG 2025/12/17 17:20:00   Bucket[18]: Key=旗美高中, DocCount=253
DEBUG 2025/12/17 17:20:00   Bucket[19]: Key=清華附小, DocCount=249
DEBUG 2025/12/17 17:20:00   Bucket[20]: Key=斗六家商, DocCount=229
DEBUG 2025/12/17 17:20:00   Bucket[21]: Key=內埔農工, DocCount=228
DEBUG 2025/12/17 17:20:00   Bucket[22]: Key=屏東女中, DocCount=223
DEBUG 2025/12/17 17:20:00   Bucket[23]: Key=新化高中, DocCount=221
DEBUG 2025/12/17 17:20:00   Bucket[24]: Key=後壁高中, DocCount=209
DEBUG 2025/12/17 17:20:00   Bucket[25]: Key=竹南高中, DocCount=209
DEBUG 2025/12/17 17:20:00   Bucket[26]: Key=中大壢中, DocCount=203
DEBUG 2025/12/17 17:20:00   Bucket[27]: Key=南投特教, DocCount=201
DEBUG 2025/12/17 17:20:00   Bucket[28]: Key=新港藝高, DocCount=195
DEBUG 2025/12/17 17:20:00   Bucket[29]: Key=嘉義高商, DocCount=192
DEBUG 2025/12/17 17:20:00   Bucket[30]: Key=政大附中, DocCount=181
DEBUG 2025/12/17 17:20:00   Bucket[31]: Key=員林家商, DocCount=176
DEBUG 2025/12/17 17:20:00   Bucket[32]: Key=關山工商, DocCount=175
DEBUG 2025/12/17 17:20:00   Bucket[33]: Key=永靖高工, DocCount=170
DEBUG 2025/12/17 17:20:00   Bucket[34]: Key=苗栗農工, DocCount=168
DEBUG 2025/12/17 17:20:00   Bucket[35]: Key=玉里高中, DocCount=153
DEBUG 2025/12/17 17:20:00   Bucket[36]: Key=臺東高商, DocCount=145
DEBUG 2025/12/17 17:20:00   Bucket[37]: Key=屏北高中, DocCount=136
DEBUG 2025/12/17 17:20:00   Bucket[38]: Key=臺南一中, DocCount=135
DEBUG 2025/12/17 17:20:00   Bucket[39]: Key=新營高工, DocCount=125
DEBUG 2025/12/17 17:20:00   Bucket[40]: Key=新化高工, DocCount=121
DEBUG 2025/12/17 17:20:00   Bucket[41]: Key=新營高中, DocCount=113
DEBUG 2025/12/17 17:20:00   Bucket[42]: Key=埔里高工, DocCount=106
DEBUG 2025/12/17 17:20:00   Bucket[43]: Key=東港海事, DocCount=105
DEBUG 2025/12/17 17:20:00   Bucket[44]: Key=南投高中, DocCount=101
DEBUG 2025/12/17 17:20:00   Bucket[45]: Key=二林工商, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[46]: Key=新竹高工, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[47]: Key=草屯商工, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[48]: Key=嘉義高中, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[49]: Key=曾文農工, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[50]: Key=秀水高工, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[51]: Key=嘉義家職, DocCount=96
DEBUG 2025/12/17 17:20:00   Bucket[52]: Key=水里商工, DocCount=96
DEBUG 2025/12/17 17:20:00   Bucket[53]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:20:00   Bucket[54]: Key=中興高中, DocCount=91
DEBUG 2025/12/17 17:20:00   Bucket[55]: Key=屏科實中, DocCount=91
DEBUG 2025/12/17 17:20:00   Bucket[56]: Key=溪湖高中, DocCount=88
DEBUG 2025/12/17 17:20:00   Bucket[57]: Key=成大南工, DocCount=86
DEBUG 2025/12/17 17:20:00   Bucket[58]: Key=宜蘭高中, DocCount=84
DEBUG 2025/12/17 17:20:00   Bucket[59]: Key=花蓮高工, DocCount=84
DEBUG 2025/12/17 17:20:00   Bucket[60]: Key=南大附聰, DocCount=82
DEBUG 2025/12/17 17:20:00   Bucket[61]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:20:00   Bucket[62]: Key=北斗家商, DocCount=77
DEBUG 2025/12/17 17:20:00   Bucket[63]: Key=高餐大附中, DocCount=76
DEBUG 2025/12/17 17:20:00   Bucket[64]: Key=臺南高商, DocCount=73
DEBUG 2025/12/17 17:20:00   Bucket[65]: Key=海大附中, DocCount=72
DEBUG 2025/12/17 17:20:00   Bucket[66]: Key=頭城家商, DocCount=72
DEBUG 2025/12/17 17:20:00   Bucket[67]: Key=旗山農工, DocCount=70
DEBUG 2025/12/17 17:20:00   Bucket[68]: Key=臺東女中, DocCount=70
DEBUG 2025/12/17 17:20:00   Bucket[69]: Key=北港高中, DocCount=69
DEBUG 2025/12/17 17:20:00   Bucket[70]: Key=雲林特教, DocCount=68
DEBUG 2025/12/17 17:20:00   Bucket[71]: Key=基隆商工, DocCount=67
DEBUG 2025/12/17 17:20:00   Bucket[72]: Key=師大附中高中部, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[73]: Key=新竹高商, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[74]: Key=苗栗高商, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[75]: Key=潮州高中, DocCount=65
DEBUG 2025/12/17 17:20:00   Bucket[76]: Key=北教大實小, DocCount=64
DEBUG 2025/12/17 17:20:00   Bucket[77]: Key=北港農工, DocCount=63
DEBUG 2025/12/17 17:20:00   Bucket[78]: Key=南大附中, DocCount=62
DEBUG 2025/12/17 17:20:00   Bucket[79]: Key=崇實高工, DocCount=59
DEBUG 2025/12/17 17:20:00   Bucket[80]: Key=彰化高商, DocCount=57
DEBUG 2025/12/17 17:20:00   Bucket[81]: Key=嘉科實中, DocCount=51
DEBUG 2025/12/17 17:20:00   Bucket[82]: Key=嘉義高工, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[83]: Key=竹山高中, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[84]: Key=花蓮特教, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[85]: Key=新豐高中, DocCount=49
DEBUG 2025/12/17 17:20:00   Bucket[86]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:20:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:20:00   Bucket[88]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:20:00   Bucket[89]: Key=澎湖海事, DocCount=45
DEBUG 2025/12/17 17:20:00   Bucket[90]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:20:00   Bucket[91]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:20:00   Bucket[92]: Key=苗栗高中, DocCount=43
DEBUG 2025/12/17 17:20:00   Bucket[93]: Key=土庫商工, DocCount=42
DEBUG 2025/12/17 17:20:00   Bucket[94]: Key=新竹高中, DocCount=41
DEBUG 2025/12/17 17:20:00   Bucket[95]: Key=東石高中, DocCount=40
DEBUG 2025/12/17 17:20:00   Bucket[96]: Key=羅東高商, DocCount=40
DEBUG 2025/12/17 17:20:00   Bucket[97]: Key=家齊高中, DocCount=39
DEBUG 2025/12/17 17:20:00   Bucket[98]: Key=蘭陽女中, DocCount=39
DEBUG 2025/12/17 17:20:00   Bucket[99]: Key=花蓮高中, DocCount=38
DEBUG 2025/12/17 17:20:00 ========================================================
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:20:08 ✅ Successfully flushed 24/24 history records to TimescaleDB
INFO 2025/12/17 17:20:09 Processing 15 offline devices
INFO 2025/12/17 17:20:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:20:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:20:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:20:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:20:09 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:20:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:20:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:20:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:20:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:20:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:20:13 ✅ Successfully flushed 26/26 history records to TimescaleDB
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:20:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:20:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:20:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:20:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:20:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:20:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:20:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:20:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:20:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:20:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:20:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:20:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:20:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:20:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.41% (threshold: 90.00%)
INFO 2025/12/17 17:20:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.14% (threshold: 85.00%)
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:20:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:20:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:20:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:20:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:21:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:21:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:21:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:21:00 Field: school_name.keyword
DEBUG 2025/12/17 17:21:00 Time From: 2025-12-17T17:20:00.000+08:00
DEBUG 2025/12/17 17:21:00 Time To: 2025-12-17T17:21:00.000+08:00
DEBUG 2025/12/17 17:21:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:20:00.000+08:00",
					"lte": "2025-12-17T17:21:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:21:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:21:00 ES Response IsError: false
DEBUG 2025/12/17 17:21:00 ES Response Body:
{"took":187,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":421,"buckets":[{"key":"黑快馬主機","doc_count":790},{"key":"花蓮高農","doc_count":787},{"key":"新竹女中","doc_count":658},{"key":"仁愛高農","doc_count":559},{"key":"金門高中","doc_count":545},{"key":"金門農工","doc_count":504},{"key":"北門高中","doc_count":434},{"key":"竹北高中","doc_count":428},{"key":"華僑高中","doc_count":404},{"key":"南投高商","doc_count":388},{"key":"臺東高中","doc_count":380},{"key":"花蓮高商","doc_count":360},{"key":"蘇澳海事","doc_count":330},{"key":"關西高中","doc_count":317},{"key":"宜蘭高商","doc_count":312},{"key":"興大附中","doc_count":265},{"key":"清華附小","doc_count":239},{"key":"新港藝高","doc_count":229},{"key":"旗美高中","doc_count":227},{"key":"後壁高中","doc_count":220},{"key":"關山工商","doc_count":190},{"key":"玉里高中","doc_count":188},{"key":"斗六家商","doc_count":185},{"key":"虎尾高中","doc_count":174},{"key":"中大壢中","doc_count":169},{"key":"南投特教","doc_count":161},{"key":"內埔農工","doc_count":159},{"key":"政大附中","doc_count":153},{"key":"竹南高中","doc_count":150},{"key":"苗栗農工","doc_count":149},{"key":"中興高中","doc_count":143},{"key":"基隆商工","doc_count":143},{"key":"屏東女中","doc_count":142},{"key":"嘉義高商","doc_count":139},{"key":"新營高工","doc_count":139},{"key":"旗山農工","doc_count":138},{"key":"新化高工","doc_count":132},{"key":"員林家商","doc_count":131},{"key":"水里商工","doc_count":126},{"key":"新竹高工","doc_count":122},{"key":"彰師附工","doc_count":121},{"key":"北教大實小","doc_count":120},{"key":"宜蘭高中","doc_count":109},{"key":"北港高中","doc_count":107},{"key":"南大附中","doc_count":107},{"key":"屏科實中","doc_count":104},{"key":"南投高中","doc_count":102},{"key":"東港海事","doc_count":102},{"key":"新化高中","doc_count":98},{"key":"新營高中","doc_count":96},{"key":"北港農工","doc_count":95},{"key":"成大南工","doc_count":93},{"key":"南大附聰","doc_count":90},{"key":"鳳山高中","doc_count":87},{"key":"臺東高商","doc_count":85},{"key":"師大附中高中部","doc_count":82},{"key":"北斗家商","doc_count":80},{"key":"嘉義高中","doc_count":79},{"key":"溪湖高中","doc_count":78},{"key":"員林農工","doc_count":71},{"key":"秀水高工","doc_count":71},{"key":"蘭陽女中","doc_count":69},{"key":"高餐大附中","doc_count":69},{"key":"新竹高中","doc_count":68},{"key":"竹山高中","doc_count":68},{"key":"花蓮高工","doc_count":68},{"key":"草屯商工","doc_count":62},{"key":"雲林特教","doc_count":62},{"key":"嘉義家職","doc_count":61},{"key":"二林工商","doc_count":60},{"key":"潮州高中","doc_count":59},{"key":"羅東高商","doc_count":59},{"key":"員林高中","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"頭城家商","doc_count":57},{"key":"嘉科實中","doc_count":56},{"key":"新豐高中","doc_count":56},{"key":"南大附小","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"東石高中","doc_count":53},{"key":"彰化高商","doc_count":52},{"key":"臺南一中","doc_count":52},{"key":"苗栗高中","doc_count":52},{"key":"臺東女中","doc_count":50},{"key":"興大附農","doc_count":50},{"key":"苗栗高商","doc_count":50},{"key":"屏東高工","doc_count":49},{"key":"白河商工","doc_count":49},{"key":"善化高中","doc_count":47},{"key":"土庫商工","doc_count":47},{"key":"羅東高工","doc_count":47},{"key":"竹東高中","doc_count":46},{"key":"佳冬高農","doc_count":44},{"key":"埔里高工","doc_count":44},{"key":"屏東特教","doc_count":44},{"key":"臺南高商","doc_count":43},{"key":"新竹高商","doc_count":41},{"key":"華南高商","doc_count":37},{"key":"家齊高中","doc_count":36},{"key":"曾文農工","doc_count":35}]}}}
DEBUG 2025/12/17 17:21:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:21:00   Bucket[0]: Key=黑快馬主機, DocCount=790
DEBUG 2025/12/17 17:21:00   Bucket[1]: Key=花蓮高農, DocCount=787
DEBUG 2025/12/17 17:21:00   Bucket[2]: Key=新竹女中, DocCount=658
DEBUG 2025/12/17 17:21:00   Bucket[3]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:21:00   Bucket[4]: Key=金門高中, DocCount=545
DEBUG 2025/12/17 17:21:00   Bucket[5]: Key=金門農工, DocCount=504
DEBUG 2025/12/17 17:21:00   Bucket[6]: Key=北門高中, DocCount=434
DEBUG 2025/12/17 17:21:00   Bucket[7]: Key=竹北高中, DocCount=428
DEBUG 2025/12/17 17:21:00   Bucket[8]: Key=華僑高中, DocCount=404
DEBUG 2025/12/17 17:21:00   Bucket[9]: Key=南投高商, DocCount=388
DEBUG 2025/12/17 17:21:00   Bucket[10]: Key=臺東高中, DocCount=380
DEBUG 2025/12/17 17:21:00   Bucket[11]: Key=花蓮高商, DocCount=360
DEBUG 2025/12/17 17:21:00   Bucket[12]: Key=蘇澳海事, DocCount=330
DEBUG 2025/12/17 17:21:00   Bucket[13]: Key=關西高中, DocCount=317
DEBUG 2025/12/17 17:21:00   Bucket[14]: Key=宜蘭高商, DocCount=312
DEBUG 2025/12/17 17:21:00   Bucket[15]: Key=興大附中, DocCount=265
DEBUG 2025/12/17 17:21:00   Bucket[16]: Key=清華附小, DocCount=239
DEBUG 2025/12/17 17:21:00   Bucket[17]: Key=新港藝高, DocCount=229
DEBUG 2025/12/17 17:21:00   Bucket[18]: Key=旗美高中, DocCount=227
DEBUG 2025/12/17 17:21:00   Bucket[19]: Key=後壁高中, DocCount=220
DEBUG 2025/12/17 17:21:00   Bucket[20]: Key=關山工商, DocCount=190
DEBUG 2025/12/17 17:21:00   Bucket[21]: Key=玉里高中, DocCount=188
DEBUG 2025/12/17 17:21:00   Bucket[22]: Key=斗六家商, DocCount=185
DEBUG 2025/12/17 17:21:00   Bucket[23]: Key=虎尾高中, DocCount=174
DEBUG 2025/12/17 17:21:00   Bucket[24]: Key=中大壢中, DocCount=169
DEBUG 2025/12/17 17:21:00   Bucket[25]: Key=南投特教, DocCount=161
DEBUG 2025/12/17 17:21:00   Bucket[26]: Key=內埔農工, DocCount=159
DEBUG 2025/12/17 17:21:00   Bucket[27]: Key=政大附中, DocCount=153
DEBUG 2025/12/17 17:21:00   Bucket[28]: Key=竹南高中, DocCount=150
DEBUG 2025/12/17 17:21:00   Bucket[29]: Key=苗栗農工, DocCount=149
DEBUG 2025/12/17 17:21:00   Bucket[30]: Key=中興高中, DocCount=143
DEBUG 2025/12/17 17:21:00   Bucket[31]: Key=基隆商工, DocCount=143
DEBUG 2025/12/17 17:21:00   Bucket[32]: Key=屏東女中, DocCount=142
DEBUG 2025/12/17 17:21:00   Bucket[33]: Key=嘉義高商, DocCount=139
DEBUG 2025/12/17 17:21:00   Bucket[34]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:21:00   Bucket[35]: Key=旗山農工, DocCount=138
DEBUG 2025/12/17 17:21:00   Bucket[36]: Key=新化高工, DocCount=132
DEBUG 2025/12/17 17:21:00   Bucket[37]: Key=員林家商, DocCount=131
DEBUG 2025/12/17 17:21:00   Bucket[38]: Key=水里商工, DocCount=126
DEBUG 2025/12/17 17:21:00   Bucket[39]: Key=新竹高工, DocCount=122
DEBUG 2025/12/17 17:21:00   Bucket[40]: Key=彰師附工, DocCount=121
DEBUG 2025/12/17 17:21:00   Bucket[41]: Key=北教大實小, DocCount=120
DEBUG 2025/12/17 17:21:00   Bucket[42]: Key=宜蘭高中, DocCount=109
DEBUG 2025/12/17 17:21:00   Bucket[43]: Key=北港高中, DocCount=107
DEBUG 2025/12/17 17:21:00   Bucket[44]: Key=南大附中, DocCount=107
DEBUG 2025/12/17 17:21:00   Bucket[45]: Key=屏科實中, DocCount=104
DEBUG 2025/12/17 17:21:00   Bucket[46]: Key=南投高中, DocCount=102
DEBUG 2025/12/17 17:21:00   Bucket[47]: Key=東港海事, DocCount=102
DEBUG 2025/12/17 17:21:00   Bucket[48]: Key=新化高中, DocCount=98
DEBUG 2025/12/17 17:21:00   Bucket[49]: Key=新營高中, DocCount=96
DEBUG 2025/12/17 17:21:00   Bucket[50]: Key=北港農工, DocCount=95
DEBUG 2025/12/17 17:21:00   Bucket[51]: Key=成大南工, DocCount=93
DEBUG 2025/12/17 17:21:00   Bucket[52]: Key=南大附聰, DocCount=90
DEBUG 2025/12/17 17:21:00   Bucket[53]: Key=鳳山高中, DocCount=87
DEBUG 2025/12/17 17:21:00   Bucket[54]: Key=臺東高商, DocCount=85
DEBUG 2025/12/17 17:21:00   Bucket[55]: Key=師大附中高中部, DocCount=82
DEBUG 2025/12/17 17:21:00   Bucket[56]: Key=北斗家商, DocCount=80
DEBUG 2025/12/17 17:21:00   Bucket[57]: Key=嘉義高中, DocCount=79
DEBUG 2025/12/17 17:21:00   Bucket[58]: Key=溪湖高中, DocCount=78
DEBUG 2025/12/17 17:21:00   Bucket[59]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:21:00   Bucket[60]: Key=秀水高工, DocCount=71
DEBUG 2025/12/17 17:21:00   Bucket[61]: Key=蘭陽女中, DocCount=69
DEBUG 2025/12/17 17:21:00   Bucket[62]: Key=高餐大附中, DocCount=69
DEBUG 2025/12/17 17:21:00   Bucket[63]: Key=新竹高中, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[64]: Key=竹山高中, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[65]: Key=花蓮高工, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[66]: Key=草屯商工, DocCount=62
DEBUG 2025/12/17 17:21:00   Bucket[67]: Key=雲林特教, DocCount=62
DEBUG 2025/12/17 17:21:00   Bucket[68]: Key=嘉義家職, DocCount=61
DEBUG 2025/12/17 17:21:00   Bucket[69]: Key=二林工商, DocCount=60
DEBUG 2025/12/17 17:21:00   Bucket[70]: Key=潮州高中, DocCount=59
DEBUG 2025/12/17 17:21:00   Bucket[71]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:21:00   Bucket[72]: Key=員林高中, DocCount=58
DEBUG 2025/12/17 17:21:00   Bucket[73]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 17:21:00   Bucket[74]: Key=頭城家商, DocCount=57
DEBUG 2025/12/17 17:21:00   Bucket[75]: Key=嘉科實中, DocCount=56
DEBUG 2025/12/17 17:21:00   Bucket[76]: Key=新豐高中, DocCount=56
DEBUG 2025/12/17 17:21:00   Bucket[77]: Key=南大附小, DocCount=55
DEBUG 2025/12/17 17:21:00   Bucket[78]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:21:00   Bucket[79]: Key=東石高中, DocCount=53
DEBUG 2025/12/17 17:21:00   Bucket[80]: Key=彰化高商, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[81]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[82]: Key=苗栗高中, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[83]: Key=臺東女中, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[84]: Key=興大附農, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[85]: Key=苗栗高商, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[86]: Key=屏東高工, DocCount=49
DEBUG 2025/12/17 17:21:00   Bucket[87]: Key=白河商工, DocCount=49
DEBUG 2025/12/17 17:21:00   Bucket[88]: Key=善化高中, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[89]: Key=土庫商工, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[90]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[91]: Key=竹東高中, DocCount=46
DEBUG 2025/12/17 17:21:00   Bucket[92]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[93]: Key=埔里高工, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[94]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[95]: Key=臺南高商, DocCount=43
DEBUG 2025/12/17 17:21:00   Bucket[96]: Key=新竹高商, DocCount=41
DEBUG 2025/12/17 17:21:00   Bucket[97]: Key=華南高商, DocCount=37
DEBUG 2025/12/17 17:21:00   Bucket[98]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:21:00   Bucket[99]: Key=曾文農工, DocCount=35
DEBUG 2025/12/17 17:21:00 ========================================================
INFO 2025/12/17 17:21:03 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 50/60 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:21:08 Processing 15 offline devices
INFO 2025/12/17 17:21:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:21:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:21:08 ✅ Successfully flushed 14/14 history records to TimescaleDB
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:21:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 屏東高中
INFO 2025/12/17 17:21:08 About to add history to batch for device: 屏東高中
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 17:21:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:21:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:21:08 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:21:08 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:21:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:21:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:21:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:21:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:21:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:21:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:21:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:21:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:21:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:21:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:21:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:21:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:21:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:21:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:21:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:21:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:21:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:21:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:21:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:21:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:21:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:21:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:21:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:21:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:21:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:21:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:21:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:21:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:21:45 ES Alert Created [high][performance]: Memory usage high: 88.23% (threshold: 80.00%)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.17% (threshold: 85.00%)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:21:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:21:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:21:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:21:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:22:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:22:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:22:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:22:00 Field: school_name.keyword
DEBUG 2025/12/17 17:22:00 Time From: 2025-12-17T17:21:00.000+08:00
DEBUG 2025/12/17 17:22:00 Time To: 2025-12-17T17:22:00.000+08:00
DEBUG 2025/12/17 17:22:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:21:00.000+08:00",
					"lte": "2025-12-17T17:22:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:22:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:22:00 ES Response IsError: false
DEBUG 2025/12/17 17:22:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":494,"buckets":[{"key":"花蓮高農","doc_count":746},{"key":"仁愛高農","doc_count":675},{"key":"黑快馬主機","doc_count":660},{"key":"金門農工","doc_count":573},{"key":"新竹女中","doc_count":546},{"key":"金門高中","doc_count":504},{"key":"竹北高中","doc_count":480},{"key":"北門高中","doc_count":431},{"key":"臺東高中","doc_count":395},{"key":"華僑高中","doc_count":349},{"key":"宜蘭高商","doc_count":340},{"key":"蘇澳海事","doc_count":336},{"key":"花蓮高商","doc_count":278},{"key":"南投高商","doc_count":274},{"key":"新化高工","doc_count":268},{"key":"興大附中","doc_count":262},{"key":"清華附小","doc_count":258},{"key":"關山工商","doc_count":221},{"key":"新港藝高","doc_count":218},{"key":"竹南高中","doc_count":215},{"key":"斗六家商","doc_count":202},{"key":"關西高中","doc_count":202},{"key":"中大壢中","doc_count":200},{"key":"後壁高中","doc_count":200},{"key":"旗美高中","doc_count":194},{"key":"苗栗農工","doc_count":182},{"key":"新營高中","doc_count":174},{"key":"南投特教","doc_count":171},{"key":"新化高中","doc_count":168},{"key":"內埔農工","doc_count":165},{"key":"虎尾高中","doc_count":155},{"key":"玉里高中","doc_count":151},{"key":"嘉義高商","doc_count":149},{"key":"南大附中","doc_count":144},{"key":"屏東女中","doc_count":138},{"key":"北教大實小","doc_count":132},{"key":"東港海事","doc_count":130},{"key":"新營高工","doc_count":126},{"key":"宜蘭高中","doc_count":116},{"key":"新竹高商","doc_count":113},{"key":"北斗家商","doc_count":111},{"key":"北港高中","doc_count":111},{"key":"員林家商","doc_count":109},{"key":"苗栗高中","doc_count":109},{"key":"彰師附工","doc_count":104},{"key":"南大附聰","doc_count":96},{"key":"新竹高工","doc_count":96},{"key":"員林高中","doc_count":95},{"key":"鳳山高中","doc_count":93},{"key":"彰化高商","doc_count":91},{"key":"旗山農工","doc_count":89},{"key":"嘉義高中","doc_count":87},{"key":"屏科實中","doc_count":85},{"key":"永靖高工","doc_count":85},{"key":"政大附中","doc_count":84},{"key":"師大附中高中部","doc_count":83},{"key":"蘭陽女中","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"水里商工","doc_count":79},{"key":"中興高中","doc_count":78},{"key":"嘉科實中","doc_count":77},{"key":"南投高中","doc_count":76},{"key":"花蓮高工","doc_count":73},{"key":"新竹高中","doc_count":71},{"key":"臺南一中","doc_count":71},{"key":"草屯商工","doc_count":70},{"key":"員林農工","doc_count":69},{"key":"基隆商工","doc_count":69},{"key":"白河商工","doc_count":69},{"key":"興大附農","doc_count":69},{"key":"潮州高中","doc_count":68},{"key":"高餐大附中","doc_count":64},{"key":"秀水高工","doc_count":63},{"key":"臺東高商","doc_count":63},{"key":"苗栗高商","doc_count":61},{"key":"羅東高商","doc_count":59},{"key":"嘉義家職","doc_count":58},{"key":"東石高中","doc_count":57},{"key":"土庫商工","doc_count":56},{"key":"雲林特教","doc_count":54},{"key":"成大南工","doc_count":53},{"key":"海大附中","doc_count":53},{"key":"家齊高中","doc_count":52},{"key":"頭城家商","doc_count":50},{"key":"屏東特教","doc_count":49},{"key":"羅東高工","doc_count":47},{"key":"新竹特教","doc_count":46},{"key":"屏東高中","doc_count":44},{"key":"師大附中國中部","doc_count":44},{"key":"臺南高商","doc_count":44},{"key":"屏北高中","doc_count":42},{"key":"崇實高工","doc_count":42},{"key":"佳冬高農","doc_count":41},{"key":"南大附小","doc_count":40},{"key":"善化高中","doc_count":40},{"key":"埔里高工","doc_count":39},{"key":"北港農工","doc_count":38},{"key":"嘉義高工","doc_count":38},{"key":"溪湖高中","doc_count":38},{"key":"澎湖海事","doc_count":38}]}}}
DEBUG 2025/12/17 17:22:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:22:00   Bucket[0]: Key=花蓮高農, DocCount=746
DEBUG 2025/12/17 17:22:00   Bucket[1]: Key=仁愛高農, DocCount=675
DEBUG 2025/12/17 17:22:00   Bucket[2]: Key=黑快馬主機, DocCount=660
DEBUG 2025/12/17 17:22:00   Bucket[3]: Key=金門農工, DocCount=573
DEBUG 2025/12/17 17:22:00   Bucket[4]: Key=新竹女中, DocCount=546
DEBUG 2025/12/17 17:22:00   Bucket[5]: Key=金門高中, DocCount=504
DEBUG 2025/12/17 17:22:00   Bucket[6]: Key=竹北高中, DocCount=480
DEBUG 2025/12/17 17:22:00   Bucket[7]: Key=北門高中, DocCount=431
DEBUG 2025/12/17 17:22:00   Bucket[8]: Key=臺東高中, DocCount=395
DEBUG 2025/12/17 17:22:00   Bucket[9]: Key=華僑高中, DocCount=349
DEBUG 2025/12/17 17:22:00   Bucket[10]: Key=宜蘭高商, DocCount=340
DEBUG 2025/12/17 17:22:00   Bucket[11]: Key=蘇澳海事, DocCount=336
DEBUG 2025/12/17 17:22:00   Bucket[12]: Key=花蓮高商, DocCount=278
DEBUG 2025/12/17 17:22:00   Bucket[13]: Key=南投高商, DocCount=274
DEBUG 2025/12/17 17:22:00   Bucket[14]: Key=新化高工, DocCount=268
DEBUG 2025/12/17 17:22:00   Bucket[15]: Key=興大附中, DocCount=262
DEBUG 2025/12/17 17:22:00   Bucket[16]: Key=清華附小, DocCount=258
DEBUG 2025/12/17 17:22:00   Bucket[17]: Key=關山工商, DocCount=221
DEBUG 2025/12/17 17:22:00   Bucket[18]: Key=新港藝高, DocCount=218
DEBUG 2025/12/17 17:22:00   Bucket[19]: Key=竹南高中, DocCount=215
DEBUG 2025/12/17 17:22:00   Bucket[20]: Key=斗六家商, DocCount=202
DEBUG 2025/12/17 17:22:00   Bucket[21]: Key=關西高中, DocCount=202
DEBUG 2025/12/17 17:22:00   Bucket[22]: Key=中大壢中, DocCount=200
DEBUG 2025/12/17 17:22:00   Bucket[23]: Key=後壁高中, DocCount=200
DEBUG 2025/12/17 17:22:00   Bucket[24]: Key=旗美高中, DocCount=194
DEBUG 2025/12/17 17:22:00   Bucket[25]: Key=苗栗農工, DocCount=182
DEBUG 2025/12/17 17:22:00   Bucket[26]: Key=新營高中, DocCount=174
DEBUG 2025/12/17 17:22:00   Bucket[27]: Key=南投特教, DocCount=171
DEBUG 2025/12/17 17:22:00   Bucket[28]: Key=新化高中, DocCount=168
DEBUG 2025/12/17 17:22:00   Bucket[29]: Key=內埔農工, DocCount=165
DEBUG 2025/12/17 17:22:00   Bucket[30]: Key=虎尾高中, DocCount=155
DEBUG 2025/12/17 17:22:00   Bucket[31]: Key=玉里高中, DocCount=151
DEBUG 2025/12/17 17:22:00   Bucket[32]: Key=嘉義高商, DocCount=149
DEBUG 2025/12/17 17:22:00   Bucket[33]: Key=南大附中, DocCount=144
DEBUG 2025/12/17 17:22:00   Bucket[34]: Key=屏東女中, DocCount=138
DEBUG 2025/12/17 17:22:00   Bucket[35]: Key=北教大實小, DocCount=132
DEBUG 2025/12/17 17:22:00   Bucket[36]: Key=東港海事, DocCount=130
DEBUG 2025/12/17 17:22:00   Bucket[37]: Key=新營高工, DocCount=126
DEBUG 2025/12/17 17:22:00   Bucket[38]: Key=宜蘭高中, DocCount=116
DEBUG 2025/12/17 17:22:00   Bucket[39]: Key=新竹高商, DocCount=113
DEBUG 2025/12/17 17:22:00   Bucket[40]: Key=北斗家商, DocCount=111
DEBUG 2025/12/17 17:22:00   Bucket[41]: Key=北港高中, DocCount=111
DEBUG 2025/12/17 17:22:00   Bucket[42]: Key=員林家商, DocCount=109
DEBUG 2025/12/17 17:22:00   Bucket[43]: Key=苗栗高中, DocCount=109
DEBUG 2025/12/17 17:22:00   Bucket[44]: Key=彰師附工, DocCount=104
DEBUG 2025/12/17 17:22:00   Bucket[45]: Key=南大附聰, DocCount=96
DEBUG 2025/12/17 17:22:00   Bucket[46]: Key=新竹高工, DocCount=96
DEBUG 2025/12/17 17:22:00   Bucket[47]: Key=員林高中, DocCount=95
DEBUG 2025/12/17 17:22:00   Bucket[48]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:22:00   Bucket[49]: Key=彰化高商, DocCount=91
DEBUG 2025/12/17 17:22:00   Bucket[50]: Key=旗山農工, DocCount=89
DEBUG 2025/12/17 17:22:00   Bucket[51]: Key=嘉義高中, DocCount=87
DEBUG 2025/12/17 17:22:00   Bucket[52]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:22:00   Bucket[53]: Key=永靖高工, DocCount=85
DEBUG 2025/12/17 17:22:00   Bucket[54]: Key=政大附中, DocCount=84
DEBUG 2025/12/17 17:22:00   Bucket[55]: Key=師大附中高中部, DocCount=83
DEBUG 2025/12/17 17:22:00   Bucket[56]: Key=蘭陽女中, DocCount=82
DEBUG 2025/12/17 17:22:00   Bucket[57]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:22:00   Bucket[58]: Key=水里商工, DocCount=79
DEBUG 2025/12/17 17:22:00   Bucket[59]: Key=中興高中, DocCount=78
DEBUG 2025/12/17 17:22:00   Bucket[60]: Key=嘉科實中, DocCount=77
DEBUG 2025/12/17 17:22:00   Bucket[61]: Key=南投高中, DocCount=76
DEBUG 2025/12/17 17:22:00   Bucket[62]: Key=花蓮高工, DocCount=73
DEBUG 2025/12/17 17:22:00   Bucket[63]: Key=新竹高中, DocCount=71
DEBUG 2025/12/17 17:22:00   Bucket[64]: Key=臺南一中, DocCount=71
DEBUG 2025/12/17 17:22:00   Bucket[65]: Key=草屯商工, DocCount=70
DEBUG 2025/12/17 17:22:00   Bucket[66]: Key=員林農工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[67]: Key=基隆商工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[68]: Key=白河商工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[69]: Key=興大附農, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[70]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:22:00   Bucket[71]: Key=高餐大附中, DocCount=64
DEBUG 2025/12/17 17:22:00   Bucket[72]: Key=秀水高工, DocCount=63
DEBUG 2025/12/17 17:22:00   Bucket[73]: Key=臺東高商, DocCount=63
DEBUG 2025/12/17 17:22:00   Bucket[74]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:22:00   Bucket[75]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:22:00   Bucket[76]: Key=嘉義家職, DocCount=58
DEBUG 2025/12/17 17:22:00   Bucket[77]: Key=東石高中, DocCount=57
DEBUG 2025/12/17 17:22:00   Bucket[78]: Key=土庫商工, DocCount=56
DEBUG 2025/12/17 17:22:00   Bucket[79]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:22:00   Bucket[80]: Key=成大南工, DocCount=53
DEBUG 2025/12/17 17:22:00   Bucket[81]: Key=海大附中, DocCount=53
DEBUG 2025/12/17 17:22:00   Bucket[82]: Key=家齊高中, DocCount=52
DEBUG 2025/12/17 17:22:00   Bucket[83]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:22:00   Bucket[84]: Key=屏東特教, DocCount=49
DEBUG 2025/12/17 17:22:00   Bucket[85]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:22:00   Bucket[86]: Key=新竹特教, DocCount=46
DEBUG 2025/12/17 17:22:00   Bucket[87]: Key=屏東高中, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[88]: Key=師大附中國中部, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[89]: Key=臺南高商, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[90]: Key=屏北高中, DocCount=42
DEBUG 2025/12/17 17:22:00   Bucket[91]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:22:00   Bucket[92]: Key=佳冬高農, DocCount=41
DEBUG 2025/12/17 17:22:00   Bucket[93]: Key=南大附小, DocCount=40
DEBUG 2025/12/17 17:22:00   Bucket[94]: Key=善化高中, DocCount=40
DEBUG 2025/12/17 17:22:00   Bucket[95]: Key=埔里高工, DocCount=39
DEBUG 2025/12/17 17:22:00   Bucket[96]: Key=北港農工, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[97]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[98]: Key=溪湖高中, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[99]: Key=澎湖海事, DocCount=38
DEBUG 2025/12/17 17:22:00 ========================================================
INFO 2025/12/17 17:22:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:22:08 ✅ Successfully flushed 25/25 history records to TimescaleDB
INFO 2025/12/17 17:22:10 Processing 15 offline devices
INFO 2025/12/17 17:22:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:22:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:22:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:22:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:22:10 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:22:10 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:22:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:22:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:22:10 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:22:10 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:22:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:22:11 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:22:11 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:22:11 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:22:11 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:22:11 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:22:11 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:22:11 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:22:11 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:22:11 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:22:11 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:22:13 ✅ Successfully flushed 27/27 history records to TimescaleDB
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:22:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:22:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:22:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:22:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:22:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:22:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:22:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:22:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:22:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:22:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:22:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:22:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:22:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:22:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:22:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:22:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:22:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:22:45 ES Alert Created [critical][performance]: Memory usage critical: 90.93% (threshold: 90.00%)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.21% (threshold: 85.00%)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:22:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:22:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:22:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:22:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:23:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:23:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:23:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:23:00 Field: school_name.keyword
DEBUG 2025/12/17 17:23:00 Time From: 2025-12-17T17:22:00.000+08:00
DEBUG 2025/12/17 17:23:00 Time To: 2025-12-17T17:23:00.000+08:00
DEBUG 2025/12/17 17:23:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:22:00.000+08:00",
					"lte": "2025-12-17T17:23:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:23:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:23:00 ES Response IsError: false
DEBUG 2025/12/17 17:23:00 ES Response Body:
{"took":181,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"花蓮高農","doc_count":831},{"key":"仁愛高農","doc_count":618},{"key":"新竹女中","doc_count":596},{"key":"竹北高中","doc_count":525},{"key":"金門高中","doc_count":520},{"key":"金門農工","doc_count":470},{"key":"北門高中","doc_count":465},{"key":"黑快馬主機","doc_count":448},{"key":"臺東高中","doc_count":393},{"key":"蘇澳海事","doc_count":341},{"key":"興大附中","doc_count":338},{"key":"花蓮高商","doc_count":316},{"key":"宜蘭高商","doc_count":313},{"key":"南投高商","doc_count":312},{"key":"華僑高中","doc_count":292},{"key":"清華附小","doc_count":266},{"key":"關西高中","doc_count":239},{"key":"新化高工","doc_count":221},{"key":"玉里高中","doc_count":217},{"key":"竹南高中","doc_count":210},{"key":"南投特教","doc_count":207},{"key":"後壁高中","doc_count":206},{"key":"關山工商","doc_count":205},{"key":"內埔農工","doc_count":201},{"key":"員林家商","doc_count":196},{"key":"斗六家商","doc_count":195},{"key":"北教大實小","doc_count":180},{"key":"成大南工","doc_count":177},{"key":"新港藝高","doc_count":177},{"key":"旗美高中","doc_count":174},{"key":"永靖高工","doc_count":173},{"key":"屏東高工","doc_count":166},{"key":"東港海事","doc_count":165},{"key":"政大附中","doc_count":155},{"key":"虎尾高中","doc_count":154},{"key":"新竹高工","doc_count":152},{"key":"苗栗農工","doc_count":149},{"key":"中大壢中","doc_count":145},{"key":"嘉義高商","doc_count":142},{"key":"新營高中","doc_count":140},{"key":"師大附中高中部","doc_count":137},{"key":"彰師附工","doc_count":128},{"key":"員林高中","doc_count":126},{"key":"新化高中","doc_count":125},{"key":"屏東女中","doc_count":124},{"key":"新營高工","doc_count":116},{"key":"北港高中","doc_count":108},{"key":"南投高中","doc_count":99},{"key":"基隆商工","doc_count":99},{"key":"高餐大附中","doc_count":98},{"key":"溪湖高中","doc_count":95},{"key":"屏科實中","doc_count":93},{"key":"南大附聰","doc_count":92},{"key":"鳳山高中","doc_count":92},{"key":"潮州高中","doc_count":91},{"key":"南大附中","doc_count":88},{"key":"北斗家商","doc_count":85},{"key":"彰化高商","doc_count":83},{"key":"二林工商","doc_count":78},{"key":"草屯商工","doc_count":76},{"key":"頭城家商","doc_count":75},{"key":"中興高中","doc_count":70},{"key":"苗栗高商","doc_count":65},{"key":"佳冬高農","doc_count":64},{"key":"嘉義高中","doc_count":64},{"key":"屏東高中","doc_count":64},{"key":"北港農工","doc_count":63},{"key":"水里商工","doc_count":63},{"key":"竹山高中","doc_count":62},{"key":"臺南一中","doc_count":60},{"key":"雲林特教","doc_count":58},{"key":"秀水高工","doc_count":56},{"key":"土庫商工","doc_count":54},{"key":"新竹特教","doc_count":53},{"key":"蘭陽女中","doc_count":53},{"key":"東石高中","doc_count":52},{"key":"羅東高工","doc_count":51},{"key":"宜蘭高中","doc_count":50},{"key":"興大附農","doc_count":50},{"key":"花蓮高中","doc_count":50},{"key":"崇實高工","doc_count":49},{"key":"員林農工","doc_count":48},{"key":"嘉科實中","doc_count":48},{"key":"暨大附中","doc_count":48},{"key":"臺南高商","doc_count":48},{"key":"新竹高商","doc_count":47},{"key":"花蓮高工","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"師大附中國中部","doc_count":44},{"key":"屏東特教","doc_count":42},{"key":"華南高商","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"曾文農工","doc_count":40},{"key":"海大附中","doc_count":40},{"key":"白河商工","doc_count":40},{"key":"善化高中","doc_count":38},{"key":"新竹高中","doc_count":38},{"key":"花蓮特教","doc_count":38},{"key":"屏北高中","doc_count":37},{"key":"臺東高商","doc_count":37}]}}}
DEBUG 2025/12/17 17:23:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:23:00   Bucket[0]: Key=花蓮高農, DocCount=831
DEBUG 2025/12/17 17:23:00   Bucket[1]: Key=仁愛高農, DocCount=618
DEBUG 2025/12/17 17:23:00   Bucket[2]: Key=新竹女中, DocCount=596
DEBUG 2025/12/17 17:23:00   Bucket[3]: Key=竹北高中, DocCount=525
DEBUG 2025/12/17 17:23:00   Bucket[4]: Key=金門高中, DocCount=520
DEBUG 2025/12/17 17:23:00   Bucket[5]: Key=金門農工, DocCount=470
DEBUG 2025/12/17 17:23:00   Bucket[6]: Key=北門高中, DocCount=465
DEBUG 2025/12/17 17:23:00   Bucket[7]: Key=黑快馬主機, DocCount=448
DEBUG 2025/12/17 17:23:00   Bucket[8]: Key=臺東高中, DocCount=393
DEBUG 2025/12/17 17:23:00   Bucket[9]: Key=蘇澳海事, DocCount=341
DEBUG 2025/12/17 17:23:00   Bucket[10]: Key=興大附中, DocCount=338
DEBUG 2025/12/17 17:23:00   Bucket[11]: Key=花蓮高商, DocCount=316
DEBUG 2025/12/17 17:23:00   Bucket[12]: Key=宜蘭高商, DocCount=313
DEBUG 2025/12/17 17:23:00   Bucket[13]: Key=南投高商, DocCount=312
DEBUG 2025/12/17 17:23:00   Bucket[14]: Key=華僑高中, DocCount=292
DEBUG 2025/12/17 17:23:00   Bucket[15]: Key=清華附小, DocCount=266
DEBUG 2025/12/17 17:23:00   Bucket[16]: Key=關西高中, DocCount=239
DEBUG 2025/12/17 17:23:00   Bucket[17]: Key=新化高工, DocCount=221
DEBUG 2025/12/17 17:23:00   Bucket[18]: Key=玉里高中, DocCount=217
DEBUG 2025/12/17 17:23:00   Bucket[19]: Key=竹南高中, DocCount=210
DEBUG 2025/12/17 17:23:00   Bucket[20]: Key=南投特教, DocCount=207
DEBUG 2025/12/17 17:23:00   Bucket[21]: Key=後壁高中, DocCount=206
DEBUG 2025/12/17 17:23:00   Bucket[22]: Key=關山工商, DocCount=205
DEBUG 2025/12/17 17:23:00   Bucket[23]: Key=內埔農工, DocCount=201
DEBUG 2025/12/17 17:23:00   Bucket[24]: Key=員林家商, DocCount=196
DEBUG 2025/12/17 17:23:00   Bucket[25]: Key=斗六家商, DocCount=195
DEBUG 2025/12/17 17:23:00   Bucket[26]: Key=北教大實小, DocCount=180
DEBUG 2025/12/17 17:23:00   Bucket[27]: Key=成大南工, DocCount=177
DEBUG 2025/12/17 17:23:00   Bucket[28]: Key=新港藝高, DocCount=177
DEBUG 2025/12/17 17:23:00   Bucket[29]: Key=旗美高中, DocCount=174
DEBUG 2025/12/17 17:23:00   Bucket[30]: Key=永靖高工, DocCount=173
DEBUG 2025/12/17 17:23:00   Bucket[31]: Key=屏東高工, DocCount=166
DEBUG 2025/12/17 17:23:00   Bucket[32]: Key=東港海事, DocCount=165
DEBUG 2025/12/17 17:23:00   Bucket[33]: Key=政大附中, DocCount=155
DEBUG 2025/12/17 17:23:00   Bucket[34]: Key=虎尾高中, DocCount=154
DEBUG 2025/12/17 17:23:00   Bucket[35]: Key=新竹高工, DocCount=152
DEBUG 2025/12/17 17:23:00   Bucket[36]: Key=苗栗農工, DocCount=149
DEBUG 2025/12/17 17:23:00   Bucket[37]: Key=中大壢中, DocCount=145
DEBUG 2025/12/17 17:23:00   Bucket[38]: Key=嘉義高商, DocCount=142
DEBUG 2025/12/17 17:23:00   Bucket[39]: Key=新營高中, DocCount=140
DEBUG 2025/12/17 17:23:00   Bucket[40]: Key=師大附中高中部, DocCount=137
DEBUG 2025/12/17 17:23:00   Bucket[41]: Key=彰師附工, DocCount=128
DEBUG 2025/12/17 17:23:00   Bucket[42]: Key=員林高中, DocCount=126
DEBUG 2025/12/17 17:23:00   Bucket[43]: Key=新化高中, DocCount=125
DEBUG 2025/12/17 17:23:00   Bucket[44]: Key=屏東女中, DocCount=124
DEBUG 2025/12/17 17:23:00   Bucket[45]: Key=新營高工, DocCount=116
DEBUG 2025/12/17 17:23:00   Bucket[46]: Key=北港高中, DocCount=108
DEBUG 2025/12/17 17:23:00   Bucket[47]: Key=南投高中, DocCount=99
DEBUG 2025/12/17 17:23:00   Bucket[48]: Key=基隆商工, DocCount=99
DEBUG 2025/12/17 17:23:00   Bucket[49]: Key=高餐大附中, DocCount=98
DEBUG 2025/12/17 17:23:00   Bucket[50]: Key=溪湖高中, DocCount=95
DEBUG 2025/12/17 17:23:00   Bucket[51]: Key=屏科實中, DocCount=93
DEBUG 2025/12/17 17:23:00   Bucket[52]: Key=南大附聰, DocCount=92
DEBUG 2025/12/17 17:23:00   Bucket[53]: Key=鳳山高中, DocCount=92
DEBUG 2025/12/17 17:23:00   Bucket[54]: Key=潮州高中, DocCount=91
DEBUG 2025/12/17 17:23:00   Bucket[55]: Key=南大附中, DocCount=88
DEBUG 2025/12/17 17:23:00   Bucket[56]: Key=北斗家商, DocCount=85
DEBUG 2025/12/17 17:23:00   Bucket[57]: Key=彰化高商, DocCount=83
DEBUG 2025/12/17 17:23:00   Bucket[58]: Key=二林工商, DocCount=78
DEBUG 2025/12/17 17:23:00   Bucket[59]: Key=草屯商工, DocCount=76
DEBUG 2025/12/17 17:23:00   Bucket[60]: Key=頭城家商, DocCount=75
DEBUG 2025/12/17 17:23:00   Bucket[61]: Key=中興高中, DocCount=70
DEBUG 2025/12/17 17:23:00   Bucket[62]: Key=苗栗高商, DocCount=65
DEBUG 2025/12/17 17:23:00   Bucket[63]: Key=佳冬高農, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[64]: Key=嘉義高中, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[65]: Key=屏東高中, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[66]: Key=北港農工, DocCount=63
DEBUG 2025/12/17 17:23:00   Bucket[67]: Key=水里商工, DocCount=63
DEBUG 2025/12/17 17:23:00   Bucket[68]: Key=竹山高中, DocCount=62
DEBUG 2025/12/17 17:23:00   Bucket[69]: Key=臺南一中, DocCount=60
DEBUG 2025/12/17 17:23:00   Bucket[70]: Key=雲林特教, DocCount=58
DEBUG 2025/12/17 17:23:00   Bucket[71]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 17:23:00   Bucket[72]: Key=土庫商工, DocCount=54
DEBUG 2025/12/17 17:23:00   Bucket[73]: Key=新竹特教, DocCount=53
DEBUG 2025/12/17 17:23:00   Bucket[74]: Key=蘭陽女中, DocCount=53
DEBUG 2025/12/17 17:23:00   Bucket[75]: Key=東石高中, DocCount=52
DEBUG 2025/12/17 17:23:00   Bucket[76]: Key=羅東高工, DocCount=51
DEBUG 2025/12/17 17:23:00   Bucket[77]: Key=宜蘭高中, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[78]: Key=興大附農, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[79]: Key=花蓮高中, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[80]: Key=崇實高工, DocCount=49
DEBUG 2025/12/17 17:23:00   Bucket[81]: Key=員林農工, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[82]: Key=嘉科實中, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[83]: Key=暨大附中, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[84]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[85]: Key=新竹高商, DocCount=47
DEBUG 2025/12/17 17:23:00   Bucket[86]: Key=花蓮高工, DocCount=46
DEBUG 2025/12/17 17:23:00   Bucket[87]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:23:00   Bucket[88]: Key=師大附中國中部, DocCount=44
DEBUG 2025/12/17 17:23:00   Bucket[89]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:23:00   Bucket[90]: Key=華南高商, DocCount=42
DEBUG 2025/12/17 17:23:00   Bucket[91]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:23:00   Bucket[92]: Key=曾文農工, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[93]: Key=海大附中, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[94]: Key=白河商工, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[95]: Key=善化高中, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[96]: Key=新竹高中, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[97]: Key=花蓮特教, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[98]: Key=屏北高中, DocCount=37
DEBUG 2025/12/17 17:23:00   Bucket[99]: Key=臺東高商, DocCount=37
DEBUG 2025/12/17 17:23:00 ========================================================
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 59/0 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 2/2 history records to TimescaleDB
INFO 2025/12/17 17:23:09 Processing 15 offline devices
INFO 2025/12/17 17:23:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:23:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:23:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:23:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:23:09 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:23:09 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:23:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:23:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:23:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:23:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:23:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:23:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:23:10 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:23:10 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:23:10 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:23:10 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:23:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:23:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:23:10 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:23:10 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:23:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:23:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:23:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:23:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:23:10 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:23:10 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:23:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:23:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:23:10 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:23:10 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:23:13 ✅ Successfully flushed 43/43 history records to TimescaleDB
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:23:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:23:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:23:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:23:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:23:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:23:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:23:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:23:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:23:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:23:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:23:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:23:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:23:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:23:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.51% (threshold: 90.00%)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.24% (threshold: 85.00%)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:23:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:23:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:23:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:23:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:23:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:23:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:24:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:24:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:24:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:24:00 Field: school_name.keyword
DEBUG 2025/12/17 17:24:00 Time From: 2025-12-17T17:23:00.000+08:00
DEBUG 2025/12/17 17:24:00 Time To: 2025-12-17T17:24:00.000+08:00
DEBUG 2025/12/17 17:24:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:23:00.000+08:00",
					"lte": "2025-12-17T17:24:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:24:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:24:00 ES Response IsError: false
DEBUG 2025/12/17 17:24:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":449,"buckets":[{"key":"黑快馬主機","doc_count":1797},{"key":"花蓮高農","doc_count":889},{"key":"仁愛高農","doc_count":599},{"key":"新竹女中","doc_count":560},{"key":"金門農工","doc_count":490},{"key":"金門高中","doc_count":483},{"key":"北門高中","doc_count":447},{"key":"玉里高中","doc_count":439},{"key":"竹北高中","doc_count":385},{"key":"南投高商","doc_count":338},{"key":"臺東高中","doc_count":337},{"key":"宜蘭高商","doc_count":323},{"key":"蘇澳海事","doc_count":321},{"key":"華僑高中","doc_count":314},{"key":"興大附中","doc_count":278},{"key":"中大壢中","doc_count":262},{"key":"旗美高中","doc_count":259},{"key":"清華附小","doc_count":251},{"key":"新港藝高","doc_count":236},{"key":"南投特教","doc_count":217},{"key":"屏東女中","doc_count":210},{"key":"關西高中","doc_count":204},{"key":"竹南高中","doc_count":202},{"key":"關山工商","doc_count":191},{"key":"新竹高工","doc_count":181},{"key":"後壁高中","doc_count":180},{"key":"花蓮高商","doc_count":180},{"key":"員林家商","doc_count":177},{"key":"內埔農工","doc_count":175},{"key":"新營高中","doc_count":175},{"key":"斗六家商","doc_count":170},{"key":"嘉義高商","doc_count":162},{"key":"新化高工","doc_count":159},{"key":"虎尾高中","doc_count":149},{"key":"苗栗農工","doc_count":145},{"key":"新竹高中","doc_count":132},{"key":"成大南工","doc_count":126},{"key":"東港海事","doc_count":125},{"key":"東石高中","doc_count":115},{"key":"高餐大附中","doc_count":108},{"key":"新營高工","doc_count":103},{"key":"北教大實小","doc_count":102},{"key":"草屯商工","doc_count":101},{"key":"鳳山高中","doc_count":95},{"key":"新化高中","doc_count":94},{"key":"南投高中","doc_count":91},{"key":"北斗家商","doc_count":90},{"key":"屏科實中","doc_count":90},{"key":"師大附中高中部","doc_count":86},{"key":"土庫商工","doc_count":85},{"key":"佳冬高農","doc_count":84},{"key":"崇實高工","doc_count":81},{"key":"彰化高商","doc_count":81},{"key":"彰師附工","doc_count":81},{"key":"屏東高工","doc_count":78},{"key":"潮州高中","doc_count":78},{"key":"臺東高商","doc_count":77},{"key":"新竹高商","doc_count":76},{"key":"秀水高工","doc_count":74},{"key":"永靖高工","doc_count":72},{"key":"南大附聰","doc_count":71},{"key":"北港高中","doc_count":68},{"key":"嘉科實中","doc_count":67},{"key":"水里商工","doc_count":66},{"key":"澎湖海事","doc_count":62},{"key":"臺南高商","doc_count":62},{"key":"苗栗高商","doc_count":61},{"key":"屏北高中","doc_count":59},{"key":"新豐高中","doc_count":57},{"key":"羅東高工","doc_count":56},{"key":"頭城家商","doc_count":56},{"key":"臺南一中","doc_count":54},{"key":"家齊高中","doc_count":53},{"key":"員林農工","doc_count":52},{"key":"善化高中","doc_count":52},{"key":"白河商工","doc_count":50},{"key":"羅東高商","doc_count":49},{"key":"成功商水","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"嘉義高中","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"旗山農工","doc_count":45},{"key":"南大附小","doc_count":43},{"key":"員林高中","doc_count":43},{"key":"屏東特教","doc_count":43},{"key":"曾文農工","doc_count":43},{"key":"雲林特教","doc_count":41},{"key":"中興高中","doc_count":40},{"key":"屏東高中","doc_count":40},{"key":"興大附農","doc_count":40},{"key":"二林工商","doc_count":39},{"key":"埔里高工","doc_count":39},{"key":"暨大附中","doc_count":38},{"key":"海大附中","doc_count":38},{"key":"南大附中","doc_count":37},{"key":"政大附中","doc_count":37},{"key":"嘉義高工","doc_count":36},{"key":"臺東女中","doc_count":36},{"key":"花蓮高工","doc_count":36},{"key":"宜蘭高中","doc_count":35}]}}}
DEBUG 2025/12/17 17:24:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:24:00   Bucket[0]: Key=黑快馬主機, DocCount=1797
DEBUG 2025/12/17 17:24:00   Bucket[1]: Key=花蓮高農, DocCount=889
DEBUG 2025/12/17 17:24:00   Bucket[2]: Key=仁愛高農, DocCount=599
DEBUG 2025/12/17 17:24:00   Bucket[3]: Key=新竹女中, DocCount=560
DEBUG 2025/12/17 17:24:00   Bucket[4]: Key=金門農工, DocCount=490
DEBUG 2025/12/17 17:24:00   Bucket[5]: Key=金門高中, DocCount=483
DEBUG 2025/12/17 17:24:00   Bucket[6]: Key=北門高中, DocCount=447
DEBUG 2025/12/17 17:24:00   Bucket[7]: Key=玉里高中, DocCount=439
DEBUG 2025/12/17 17:24:00   Bucket[8]: Key=竹北高中, DocCount=385
DEBUG 2025/12/17 17:24:00   Bucket[9]: Key=南投高商, DocCount=338
DEBUG 2025/12/17 17:24:00   Bucket[10]: Key=臺東高中, DocCount=337
DEBUG 2025/12/17 17:24:00   Bucket[11]: Key=宜蘭高商, DocCount=323
DEBUG 2025/12/17 17:24:00   Bucket[12]: Key=蘇澳海事, DocCount=321
DEBUG 2025/12/17 17:24:00   Bucket[13]: Key=華僑高中, DocCount=314
DEBUG 2025/12/17 17:24:00   Bucket[14]: Key=興大附中, DocCount=278
DEBUG 2025/12/17 17:24:00   Bucket[15]: Key=中大壢中, DocCount=262
DEBUG 2025/12/17 17:24:00   Bucket[16]: Key=旗美高中, DocCount=259
DEBUG 2025/12/17 17:24:00   Bucket[17]: Key=清華附小, DocCount=251
DEBUG 2025/12/17 17:24:00   Bucket[18]: Key=新港藝高, DocCount=236
DEBUG 2025/12/17 17:24:00   Bucket[19]: Key=南投特教, DocCount=217
DEBUG 2025/12/17 17:24:00   Bucket[20]: Key=屏東女中, DocCount=210
DEBUG 2025/12/17 17:24:00   Bucket[21]: Key=關西高中, DocCount=204
DEBUG 2025/12/17 17:24:00   Bucket[22]: Key=竹南高中, DocCount=202
DEBUG 2025/12/17 17:24:00   Bucket[23]: Key=關山工商, DocCount=191
DEBUG 2025/12/17 17:24:00   Bucket[24]: Key=新竹高工, DocCount=181
DEBUG 2025/12/17 17:24:00   Bucket[25]: Key=後壁高中, DocCount=180
DEBUG 2025/12/17 17:24:00   Bucket[26]: Key=花蓮高商, DocCount=180
DEBUG 2025/12/17 17:24:00   Bucket[27]: Key=員林家商, DocCount=177
DEBUG 2025/12/17 17:24:00   Bucket[28]: Key=內埔農工, DocCount=175
DEBUG 2025/12/17 17:24:00   Bucket[29]: Key=新營高中, DocCount=175
DEBUG 2025/12/17 17:24:00   Bucket[30]: Key=斗六家商, DocCount=170
DEBUG 2025/12/17 17:24:00   Bucket[31]: Key=嘉義高商, DocCount=162
DEBUG 2025/12/17 17:24:00   Bucket[32]: Key=新化高工, DocCount=159
DEBUG 2025/12/17 17:24:00   Bucket[33]: Key=虎尾高中, DocCount=149
DEBUG 2025/12/17 17:24:00   Bucket[34]: Key=苗栗農工, DocCount=145
DEBUG 2025/12/17 17:24:00   Bucket[35]: Key=新竹高中, DocCount=132
DEBUG 2025/12/17 17:24:00   Bucket[36]: Key=成大南工, DocCount=126
DEBUG 2025/12/17 17:24:00   Bucket[37]: Key=東港海事, DocCount=125
DEBUG 2025/12/17 17:24:00   Bucket[38]: Key=東石高中, DocCount=115
DEBUG 2025/12/17 17:24:00   Bucket[39]: Key=高餐大附中, DocCount=108
DEBUG 2025/12/17 17:24:00   Bucket[40]: Key=新營高工, DocCount=103
DEBUG 2025/12/17 17:24:00   Bucket[41]: Key=北教大實小, DocCount=102
DEBUG 2025/12/17 17:24:00   Bucket[42]: Key=草屯商工, DocCount=101
DEBUG 2025/12/17 17:24:00   Bucket[43]: Key=鳳山高中, DocCount=95
DEBUG 2025/12/17 17:24:00   Bucket[44]: Key=新化高中, DocCount=94
DEBUG 2025/12/17 17:24:00   Bucket[45]: Key=南投高中, DocCount=91
DEBUG 2025/12/17 17:24:00   Bucket[46]: Key=北斗家商, DocCount=90
DEBUG 2025/12/17 17:24:00   Bucket[47]: Key=屏科實中, DocCount=90
DEBUG 2025/12/17 17:24:00   Bucket[48]: Key=師大附中高中部, DocCount=86
DEBUG 2025/12/17 17:24:00   Bucket[49]: Key=土庫商工, DocCount=85
DEBUG 2025/12/17 17:24:00   Bucket[50]: Key=佳冬高農, DocCount=84
DEBUG 2025/12/17 17:24:00   Bucket[51]: Key=崇實高工, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[52]: Key=彰化高商, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[53]: Key=彰師附工, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[54]: Key=屏東高工, DocCount=78
DEBUG 2025/12/17 17:24:00   Bucket[55]: Key=潮州高中, DocCount=78
DEBUG 2025/12/17 17:24:00   Bucket[56]: Key=臺東高商, DocCount=77
DEBUG 2025/12/17 17:24:00   Bucket[57]: Key=新竹高商, DocCount=76
DEBUG 2025/12/17 17:24:00   Bucket[58]: Key=秀水高工, DocCount=74
DEBUG 2025/12/17 17:24:00   Bucket[59]: Key=永靖高工, DocCount=72
DEBUG 2025/12/17 17:24:00   Bucket[60]: Key=南大附聰, DocCount=71
DEBUG 2025/12/17 17:24:00   Bucket[61]: Key=北港高中, DocCount=68
DEBUG 2025/12/17 17:24:00   Bucket[62]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:24:00   Bucket[63]: Key=水里商工, DocCount=66
DEBUG 2025/12/17 17:24:00   Bucket[64]: Key=澎湖海事, DocCount=62
DEBUG 2025/12/17 17:24:00   Bucket[65]: Key=臺南高商, DocCount=62
DEBUG 2025/12/17 17:24:00   Bucket[66]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:24:00   Bucket[67]: Key=屏北高中, DocCount=59
DEBUG 2025/12/17 17:24:00   Bucket[68]: Key=新豐高中, DocCount=57
DEBUG 2025/12/17 17:24:00   Bucket[69]: Key=羅東高工, DocCount=56
DEBUG 2025/12/17 17:24:00   Bucket[70]: Key=頭城家商, DocCount=56
DEBUG 2025/12/17 17:24:00   Bucket[71]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 17:24:00   Bucket[72]: Key=家齊高中, DocCount=53
DEBUG 2025/12/17 17:24:00   Bucket[73]: Key=員林農工, DocCount=52
DEBUG 2025/12/17 17:24:00   Bucket[74]: Key=善化高中, DocCount=52
DEBUG 2025/12/17 17:24:00   Bucket[75]: Key=白河商工, DocCount=50
DEBUG 2025/12/17 17:24:00   Bucket[76]: Key=羅東高商, DocCount=49
DEBUG 2025/12/17 17:24:00   Bucket[77]: Key=成功商水, DocCount=48
DEBUG 2025/12/17 17:24:00   Bucket[78]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:24:00   Bucket[79]: Key=嘉義高中, DocCount=47
DEBUG 2025/12/17 17:24:00   Bucket[80]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:24:00   Bucket[81]: Key=旗山農工, DocCount=45
DEBUG 2025/12/17 17:24:00   Bucket[82]: Key=南大附小, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[83]: Key=員林高中, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[84]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[85]: Key=曾文農工, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[86]: Key=雲林特教, DocCount=41
DEBUG 2025/12/17 17:24:00   Bucket[87]: Key=中興高中, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[88]: Key=屏東高中, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[89]: Key=興大附農, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[90]: Key=二林工商, DocCount=39
DEBUG 2025/12/17 17:24:00   Bucket[91]: Key=埔里高工, DocCount=39
DEBUG 2025/12/17 17:24:00   Bucket[92]: Key=暨大附中, DocCount=38
DEBUG 2025/12/17 17:24:00   Bucket[93]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:24:00   Bucket[94]: Key=南大附中, DocCount=37
DEBUG 2025/12/17 17:24:00   Bucket[95]: Key=政大附中, DocCount=37
DEBUG 2025/12/17 17:24:00   Bucket[96]: Key=嘉義高工, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[97]: Key=臺東女中, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[98]: Key=花蓮高工, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[99]: Key=宜蘭高中, DocCount=35
DEBUG 2025/12/17 17:24:00 ========================================================
INFO 2025/12/17 17:24:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:24:08 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:24:08 Processing 15 offline devices
INFO 2025/12/17 17:24:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:24:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:24:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:24:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:24:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:24:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:24:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:24:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:24:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:24:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:24:09 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:24:09 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:24:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:24:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:24:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:24:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:24:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 17:24:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:24:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:24:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:24:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:24:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:24:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:24:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:24:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:24:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:24:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:24:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:24:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:24:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:24:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:24:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:24:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:24:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:24:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:24:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:24:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:24:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:24:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:24:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.37% (threshold: 80.00%)
INFO 2025/12/17 17:24:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:24:45 ES Alert Created [high][capacity]: Disk usage high: 93.27% (threshold: 85.00%)
WARN 2025/12/17 17:24:45 ES Alert Created [high][health]: Unassigned shards detected: 36
DEBUG 2025/12/17 17:24:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:24:45 ES monitor check completed for: NTU, status: warning
WARN 2025/12/17 17:24:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:24:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:24:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:24:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:25:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:25:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:25:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:25:00 Field: school_name.keyword
DEBUG 2025/12/17 17:25:00 Time From: 2025-12-17T17:24:00.000+08:00
DEBUG 2025/12/17 17:25:00 Time To: 2025-12-17T17:25:00.000+08:00
DEBUG 2025/12/17 17:25:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:24:00.000+08:00",
					"lte": "2025-12-17T17:25:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:25:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:25:00 ES Response IsError: false
DEBUG 2025/12/17 17:25:00 ES Response Body:
{"took":72,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":497,"buckets":[{"key":"黑快馬主機","doc_count":1030},{"key":"花蓮高農","doc_count":877},{"key":"仁愛高農","doc_count":597},{"key":"新竹女中","doc_count":576},{"key":"金門農工","doc_count":567},{"key":"金門高中","doc_count":511},{"key":"北門高中","doc_count":464},{"key":"南投高商","doc_count":368},{"key":"蘇澳海事","doc_count":354},{"key":"華僑高中","doc_count":349},{"key":"竹北高中","doc_count":343},{"key":"臺東高中","doc_count":325},{"key":"清華附小","doc_count":307},{"key":"宜蘭高商","doc_count":295},{"key":"興大附中","doc_count":292},{"key":"旗美高中","doc_count":276},{"key":"虎尾高中","doc_count":249},{"key":"嘉義高商","doc_count":237},{"key":"玉里高中","doc_count":228},{"key":"新化高工","doc_count":223},{"key":"竹南高中","doc_count":222},{"key":"屏東女中","doc_count":220},{"key":"關西高中","doc_count":211},{"key":"新港藝高","doc_count":207},{"key":"後壁高中","doc_count":185},{"key":"花蓮高商","doc_count":184},{"key":"基隆商工","doc_count":180},{"key":"內埔農工","doc_count":179},{"key":"南投特教","doc_count":179},{"key":"中大壢中","doc_count":178},{"key":"關山工商","doc_count":178},{"key":"苗栗農工","doc_count":175},{"key":"東港海事","doc_count":174},{"key":"新營高中","doc_count":162},{"key":"斗六家商","doc_count":152},{"key":"員林家商","doc_count":143},{"key":"師大附中高中部","doc_count":141},{"key":"新營高工","doc_count":117},{"key":"臺南一中","doc_count":111},{"key":"新豐高中","doc_count":110},{"key":"南投高中","doc_count":107},{"key":"屏科實中","doc_count":106},{"key":"成大南工","doc_count":96},{"key":"北港高中","doc_count":94},{"key":"北教大實小","doc_count":93},{"key":"彰師附工","doc_count":92},{"key":"新竹高商","doc_count":89},{"key":"中興高中","doc_count":88},{"key":"南大附聰","doc_count":87},{"key":"彰化高商","doc_count":87},{"key":"永靖高工","doc_count":86},{"key":"竹山高中","doc_count":86},{"key":"員林農工","doc_count":84},{"key":"苗栗高中","doc_count":84},{"key":"鳳山高中","doc_count":84},{"key":"新化高中","doc_count":83},{"key":"東石高中","doc_count":83},{"key":"潮州高中","doc_count":83},{"key":"高餐大附中","doc_count":78},{"key":"苗栗高商","doc_count":77},{"key":"草屯商工","doc_count":76},{"key":"二林工商","doc_count":70},{"key":"員林高中","doc_count":70},{"key":"新竹高工","doc_count":69},{"key":"水里商工","doc_count":69},{"key":"北斗家商","doc_count":68},{"key":"花蓮高工","doc_count":68},{"key":"嘉科實中","doc_count":67},{"key":"土庫商工","doc_count":64},{"key":"屏東高工","doc_count":63},{"key":"海大附中","doc_count":60},{"key":"屏東高中","doc_count":57},{"key":"白河商工","doc_count":55},{"key":"竹東高中","doc_count":55},{"key":"善化高中","doc_count":54},{"key":"花蓮高中","doc_count":54},{"key":"宜蘭高中","doc_count":53},{"key":"新竹高中","doc_count":53},{"key":"華南高商","doc_count":52},{"key":"頭城家商","doc_count":52},{"key":"臺南高商","doc_count":51},{"key":"北港農工","doc_count":50},{"key":"雲林特教","doc_count":50},{"key":"曾文農工","doc_count":49},{"key":"佳冬高農","doc_count":47},{"key":"花蓮特教","doc_count":47},{"key":"師大附中國中部","doc_count":46},{"key":"羅東高商","doc_count":46},{"key":"臺東女中","doc_count":45},{"key":"屏東特教","doc_count":44},{"key":"澎湖海事","doc_count":44},{"key":"羅東高工","doc_count":44},{"key":"嘉義高中","doc_count":43},{"key":"家齊高中","doc_count":43},{"key":"屏北高中","doc_count":43},{"key":"興大附農","doc_count":43},{"key":"南大附中","doc_count":42},{"key":"秀水高工","doc_count":42},{"key":"政大附中","doc_count":41},{"key":"溪湖高中","doc_count":41}]}}}
DEBUG 2025/12/17 17:25:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:25:00   Bucket[0]: Key=黑快馬主機, DocCount=1030
DEBUG 2025/12/17 17:25:00   Bucket[1]: Key=花蓮高農, DocCount=877
DEBUG 2025/12/17 17:25:00   Bucket[2]: Key=仁愛高農, DocCount=597
DEBUG 2025/12/17 17:25:00   Bucket[3]: Key=新竹女中, DocCount=576
DEBUG 2025/12/17 17:25:00   Bucket[4]: Key=金門農工, DocCount=567
DEBUG 2025/12/17 17:25:00   Bucket[5]: Key=金門高中, DocCount=511
DEBUG 2025/12/17 17:25:00   Bucket[6]: Key=北門高中, DocCount=464
DEBUG 2025/12/17 17:25:00   Bucket[7]: Key=南投高商, DocCount=368
DEBUG 2025/12/17 17:25:00   Bucket[8]: Key=蘇澳海事, DocCount=354
DEBUG 2025/12/17 17:25:00   Bucket[9]: Key=華僑高中, DocCount=349
DEBUG 2025/12/17 17:25:00   Bucket[10]: Key=竹北高中, DocCount=343
DEBUG 2025/12/17 17:25:00   Bucket[11]: Key=臺東高中, DocCount=325
DEBUG 2025/12/17 17:25:00   Bucket[12]: Key=清華附小, DocCount=307
DEBUG 2025/12/17 17:25:00   Bucket[13]: Key=宜蘭高商, DocCount=295
DEBUG 2025/12/17 17:25:00   Bucket[14]: Key=興大附中, DocCount=292
DEBUG 2025/12/17 17:25:00   Bucket[15]: Key=旗美高中, DocCount=276
DEBUG 2025/12/17 17:25:00   Bucket[16]: Key=虎尾高中, DocCount=249
DEBUG 2025/12/17 17:25:00   Bucket[17]: Key=嘉義高商, DocCount=237
DEBUG 2025/12/17 17:25:00   Bucket[18]: Key=玉里高中, DocCount=228
DEBUG 2025/12/17 17:25:00   Bucket[19]: Key=新化高工, DocCount=223
DEBUG 2025/12/17 17:25:00   Bucket[20]: Key=竹南高中, DocCount=222
DEBUG 2025/12/17 17:25:00   Bucket[21]: Key=屏東女中, DocCount=220
DEBUG 2025/12/17 17:25:00   Bucket[22]: Key=關西高中, DocCount=211
DEBUG 2025/12/17 17:25:00   Bucket[23]: Key=新港藝高, DocCount=207
DEBUG 2025/12/17 17:25:00   Bucket[24]: Key=後壁高中, DocCount=185
DEBUG 2025/12/17 17:25:00   Bucket[25]: Key=花蓮高商, DocCount=184
DEBUG 2025/12/17 17:25:00   Bucket[26]: Key=基隆商工, DocCount=180
DEBUG 2025/12/17 17:25:00   Bucket[27]: Key=內埔農工, DocCount=179
DEBUG 2025/12/17 17:25:00   Bucket[28]: Key=南投特教, DocCount=179
DEBUG 2025/12/17 17:25:00   Bucket[29]: Key=中大壢中, DocCount=178
DEBUG 2025/12/17 17:25:00   Bucket[30]: Key=關山工商, DocCount=178
DEBUG 2025/12/17 17:25:00   Bucket[31]: Key=苗栗農工, DocCount=175
DEBUG 2025/12/17 17:25:00   Bucket[32]: Key=東港海事, DocCount=174
DEBUG 2025/12/17 17:25:00   Bucket[33]: Key=新營高中, DocCount=162
DEBUG 2025/12/17 17:25:00   Bucket[34]: Key=斗六家商, DocCount=152
DEBUG 2025/12/17 17:25:00   Bucket[35]: Key=員林家商, DocCount=143
DEBUG 2025/12/17 17:25:00   Bucket[36]: Key=師大附中高中部, DocCount=141
DEBUG 2025/12/17 17:25:00   Bucket[37]: Key=新營高工, DocCount=117
DEBUG 2025/12/17 17:25:00   Bucket[38]: Key=臺南一中, DocCount=111
DEBUG 2025/12/17 17:25:00   Bucket[39]: Key=新豐高中, DocCount=110
DEBUG 2025/12/17 17:25:00   Bucket[40]: Key=南投高中, DocCount=107
DEBUG 2025/12/17 17:25:00   Bucket[41]: Key=屏科實中, DocCount=106
DEBUG 2025/12/17 17:25:00   Bucket[42]: Key=成大南工, DocCount=96
DEBUG 2025/12/17 17:25:00   Bucket[43]: Key=北港高中, DocCount=94
DEBUG 2025/12/17 17:25:00   Bucket[44]: Key=北教大實小, DocCount=93
DEBUG 2025/12/17 17:25:00   Bucket[45]: Key=彰師附工, DocCount=92
DEBUG 2025/12/17 17:25:00   Bucket[46]: Key=新竹高商, DocCount=89
DEBUG 2025/12/17 17:25:00   Bucket[47]: Key=中興高中, DocCount=88
DEBUG 2025/12/17 17:25:00   Bucket[48]: Key=南大附聰, DocCount=87
DEBUG 2025/12/17 17:25:00   Bucket[49]: Key=彰化高商, DocCount=87
DEBUG 2025/12/17 17:25:00   Bucket[50]: Key=永靖高工, DocCount=86
DEBUG 2025/12/17 17:25:00   Bucket[51]: Key=竹山高中, DocCount=86
DEBUG 2025/12/17 17:25:00   Bucket[52]: Key=員林農工, DocCount=84
DEBUG 2025/12/17 17:25:00   Bucket[53]: Key=苗栗高中, DocCount=84
DEBUG 2025/12/17 17:25:00   Bucket[54]: Key=鳳山高中, DocCount=84
DEBUG 2025/12/17 17:25:00   Bucket[55]: Key=新化高中, DocCount=83
DEBUG 2025/12/17 17:25:00   Bucket[56]: Key=東石高中, DocCount=83
DEBUG 2025/12/17 17:25:00   Bucket[57]: Key=潮州高中, DocCount=83
DEBUG 2025/12/17 17:25:00   Bucket[58]: Key=高餐大附中, DocCount=78
DEBUG 2025/12/17 17:25:00   Bucket[59]: Key=苗栗高商, DocCount=77
DEBUG 2025/12/17 17:25:00   Bucket[60]: Key=草屯商工, DocCount=76
DEBUG 2025/12/17 17:25:00   Bucket[61]: Key=二林工商, DocCount=70
DEBUG 2025/12/17 17:25:00   Bucket[62]: Key=員林高中, DocCount=70
DEBUG 2025/12/17 17:25:00   Bucket[63]: Key=新竹高工, DocCount=69
DEBUG 2025/12/17 17:25:00   Bucket[64]: Key=水里商工, DocCount=69
DEBUG 2025/12/17 17:25:00   Bucket[65]: Key=北斗家商, DocCount=68
DEBUG 2025/12/17 17:25:00   Bucket[66]: Key=花蓮高工, DocCount=68
DEBUG 2025/12/17 17:25:00   Bucket[67]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:25:00   Bucket[68]: Key=土庫商工, DocCount=64
DEBUG 2025/12/17 17:25:00   Bucket[69]: Key=屏東高工, DocCount=63
DEBUG 2025/12/17 17:25:00   Bucket[70]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:25:00   Bucket[71]: Key=屏東高中, DocCount=57
DEBUG 2025/12/17 17:25:00   Bucket[72]: Key=白河商工, DocCount=55
DEBUG 2025/12/17 17:25:00   Bucket[73]: Key=竹東高中, DocCount=55
DEBUG 2025/12/17 17:25:00   Bucket[74]: Key=善化高中, DocCount=54
DEBUG 2025/12/17 17:25:00   Bucket[75]: Key=花蓮高中, DocCount=54
DEBUG 2025/12/17 17:25:00   Bucket[76]: Key=宜蘭高中, DocCount=53
DEBUG 2025/12/17 17:25:00   Bucket[77]: Key=新竹高中, DocCount=53
DEBUG 2025/12/17 17:25:00   Bucket[78]: Key=華南高商, DocCount=52
DEBUG 2025/12/17 17:25:00   Bucket[79]: Key=頭城家商, DocCount=52
DEBUG 2025/12/17 17:25:00   Bucket[80]: Key=臺南高商, DocCount=51
DEBUG 2025/12/17 17:25:00   Bucket[81]: Key=北港農工, DocCount=50
DEBUG 2025/12/17 17:25:00   Bucket[82]: Key=雲林特教, DocCount=50
DEBUG 2025/12/17 17:25:00   Bucket[83]: Key=曾文農工, DocCount=49
DEBUG 2025/12/17 17:25:00   Bucket[84]: Key=佳冬高農, DocCount=47
DEBUG 2025/12/17 17:25:00   Bucket[85]: Key=花蓮特教, DocCount=47
DEBUG 2025/12/17 17:25:00   Bucket[86]: Key=師大附中國中部, DocCount=46
DEBUG 2025/12/17 17:25:00   Bucket[87]: Key=羅東高商, DocCount=46
DEBUG 2025/12/17 17:25:00   Bucket[88]: Key=臺東女中, DocCount=45
DEBUG 2025/12/17 17:25:00   Bucket[89]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 17:25:00   Bucket[90]: Key=澎湖海事, DocCount=44
DEBUG 2025/12/17 17:25:00   Bucket[91]: Key=羅東高工, DocCount=44
DEBUG 2025/12/17 17:25:00   Bucket[92]: Key=嘉義高中, DocCount=43
DEBUG 2025/12/17 17:25:00   Bucket[93]: Key=家齊高中, DocCount=43
DEBUG 2025/12/17 17:25:00   Bucket[94]: Key=屏北高中, DocCount=43
DEBUG 2025/12/17 17:25:00   Bucket[95]: Key=興大附農, DocCount=43
DEBUG 2025/12/17 17:25:00   Bucket[96]: Key=南大附中, DocCount=42
DEBUG 2025/12/17 17:25:00   Bucket[97]: Key=秀水高工, DocCount=42
DEBUG 2025/12/17 17:25:00   Bucket[98]: Key=政大附中, DocCount=41
DEBUG 2025/12/17 17:25:00   Bucket[99]: Key=溪湖高中, DocCount=41
DEBUG 2025/12/17 17:25:00 ========================================================
INFO 2025/12/17 17:25:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:25:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:25:08 ✅ Successfully flushed 6/6 history records to TimescaleDB
INFO 2025/12/17 17:25:09 Processing 15 offline devices
INFO 2025/12/17 17:25:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:25:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:25:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:25:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:25:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:25:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:25:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:25:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:25:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:25:09 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:25:09 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:25:10 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:25:10 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:25:10 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:25:10 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:25:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:25:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:25:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:25:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:25:10 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:25:10 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:25:10 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:25:10 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:25:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:25:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:25:10 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:25:10 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:25:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:25:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:25:10 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:25:10 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:25:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:25:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:25:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:25:13 ✅ Successfully flushed 42/42 history records to TimescaleDB
DEBUG 2025/12/17 17:25:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:25:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:25:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:25:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:25:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:25:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 17:25:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:25:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:25:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:25:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:25:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:25:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:25:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:25:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:25:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:25:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:25:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:25:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
WARN 2025/12/17 17:25:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:25:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:25:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.02% (threshold: 80.00%)
DEBUG 2025/12/17 17:25:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:25:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.31% (threshold: 85.00%)
DEBUG 2025/12/17 17:25:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:25:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
INFO 2025/12/17 17:25:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:25:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:25:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:25:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:25:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:25:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:25:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:26:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:26:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:26:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:26:00 Field: school_name.keyword
DEBUG 2025/12/17 17:26:00 Time From: 2025-12-17T17:25:00.000+08:00
DEBUG 2025/12/17 17:26:00 Time To: 2025-12-17T17:26:00.000+08:00
DEBUG 2025/12/17 17:26:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:25:00.000+08:00",
					"lte": "2025-12-17T17:26:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:26:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:26:00 ES Response IsError: false
DEBUG 2025/12/17 17:26:00 ES Response Body:
{"took":71,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":456,"buckets":[{"key":"黑快馬主機","doc_count":1244},{"key":"花蓮高農","doc_count":861},{"key":"金門高中","doc_count":618},{"key":"仁愛高農","doc_count":568},{"key":"新竹女中","doc_count":545},{"key":"金門農工","doc_count":501},{"key":"北門高中","doc_count":440},{"key":"南投高商","doc_count":399},{"key":"中大壢中","doc_count":367},{"key":"華僑高中","doc_count":361},{"key":"興大附中","doc_count":359},{"key":"蘇澳海事","doc_count":356},{"key":"竹北高中","doc_count":337},{"key":"臺東高中","doc_count":301},{"key":"宜蘭高商","doc_count":291},{"key":"竹南高中","doc_count":286},{"key":"新化高工","doc_count":241},{"key":"旗美高中","doc_count":232},{"key":"關西高中","doc_count":227},{"key":"清華附小","doc_count":218},{"key":"新港藝高","doc_count":203},{"key":"彰化高商","doc_count":201},{"key":"玉里高中","doc_count":197},{"key":"後壁高中","doc_count":193},{"key":"花蓮高商","doc_count":172},{"key":"內埔農工","doc_count":165},{"key":"虎尾高中","doc_count":164},{"key":"關山工商","doc_count":160},{"key":"東港海事","doc_count":157},{"key":"南投特教","doc_count":155},{"key":"苗栗農工","doc_count":154},{"key":"斗六家商","doc_count":152},{"key":"屏東女中","doc_count":147},{"key":"新竹高工","doc_count":145},{"key":"土庫商工","doc_count":121},{"key":"員林家商","doc_count":120},{"key":"新營高工","doc_count":120},{"key":"師大附中高中部","doc_count":113},{"key":"新營高中","doc_count":110},{"key":"新竹高中","doc_count":106},{"key":"苗栗高商","doc_count":105},{"key":"鳳山高中","doc_count":102},{"key":"屏北高中","doc_count":101},{"key":"彰師附工","doc_count":100},{"key":"臺東高商","doc_count":98},{"key":"屏科實中","doc_count":96},{"key":"新豐高中","doc_count":94},{"key":"潮州高中","doc_count":92},{"key":"嘉義高商","doc_count":91},{"key":"北港高中","doc_count":88},{"key":"臺東女中","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"新化高中","doc_count":80},{"key":"北教大實小","doc_count":78},{"key":"新竹高商","doc_count":76},{"key":"南大附聰","doc_count":75},{"key":"成大南工","doc_count":72},{"key":"草屯商工","doc_count":69},{"key":"北斗家商","doc_count":68},{"key":"曾文農工","doc_count":68},{"key":"水里商工","doc_count":68},{"key":"華南高商","doc_count":66},{"key":"埔里高工","doc_count":65},{"key":"嘉科實中","doc_count":64},{"key":"羅東高商","doc_count":60},{"key":"員林農工","doc_count":59},{"key":"嘉義高中","doc_count":58},{"key":"東石高中","doc_count":58},{"key":"秀水高工","doc_count":56},{"key":"永靖高工","doc_count":55},{"key":"屏東高中","doc_count":53},{"key":"澎湖海事","doc_count":53},{"key":"苗栗高中","doc_count":53},{"key":"二林工商","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"基隆商工","doc_count":51},{"key":"海大附中","doc_count":51},{"key":"高餐大附中","doc_count":49},{"key":"善化高中","doc_count":48},{"key":"臺南高商","doc_count":48},{"key":"北港農工","doc_count":47},{"key":"嘉義家職","doc_count":46},{"key":"宜蘭高中","doc_count":45},{"key":"白河商工","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"頭城家商","doc_count":45},{"key":"屏東特教","doc_count":44},{"key":"南大附中","doc_count":43},{"key":"竹山高中","doc_count":42},{"key":"花蓮高中","doc_count":42},{"key":"雲林特教","doc_count":42},{"key":"南投高中","doc_count":41},{"key":"嘉義特教","doc_count":40},{"key":"溪湖高中","doc_count":40},{"key":"政大附中","doc_count":39},{"key":"竹東高中","doc_count":39},{"key":"中興高中","doc_count":38},{"key":"南大附小","doc_count":38},{"key":"家齊高中","doc_count":38},{"key":"崇實高工","doc_count":38}]}}}
DEBUG 2025/12/17 17:26:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:26:00   Bucket[0]: Key=黑快馬主機, DocCount=1244
DEBUG 2025/12/17 17:26:00   Bucket[1]: Key=花蓮高農, DocCount=861
DEBUG 2025/12/17 17:26:00   Bucket[2]: Key=金門高中, DocCount=618
DEBUG 2025/12/17 17:26:00   Bucket[3]: Key=仁愛高農, DocCount=568
DEBUG 2025/12/17 17:26:00   Bucket[4]: Key=新竹女中, DocCount=545
DEBUG 2025/12/17 17:26:00   Bucket[5]: Key=金門農工, DocCount=501
DEBUG 2025/12/17 17:26:00   Bucket[6]: Key=北門高中, DocCount=440
DEBUG 2025/12/17 17:26:00   Bucket[7]: Key=南投高商, DocCount=399
DEBUG 2025/12/17 17:26:00   Bucket[8]: Key=中大壢中, DocCount=367
DEBUG 2025/12/17 17:26:00   Bucket[9]: Key=華僑高中, DocCount=361
DEBUG 2025/12/17 17:26:00   Bucket[10]: Key=興大附中, DocCount=359
DEBUG 2025/12/17 17:26:00   Bucket[11]: Key=蘇澳海事, DocCount=356
DEBUG 2025/12/17 17:26:00   Bucket[12]: Key=竹北高中, DocCount=337
DEBUG 2025/12/17 17:26:00   Bucket[13]: Key=臺東高中, DocCount=301
DEBUG 2025/12/17 17:26:00   Bucket[14]: Key=宜蘭高商, DocCount=291
DEBUG 2025/12/17 17:26:00   Bucket[15]: Key=竹南高中, DocCount=286
DEBUG 2025/12/17 17:26:00   Bucket[16]: Key=新化高工, DocCount=241
DEBUG 2025/12/17 17:26:00   Bucket[17]: Key=旗美高中, DocCount=232
DEBUG 2025/12/17 17:26:00   Bucket[18]: Key=關西高中, DocCount=227
DEBUG 2025/12/17 17:26:00   Bucket[19]: Key=清華附小, DocCount=218
DEBUG 2025/12/17 17:26:00   Bucket[20]: Key=新港藝高, DocCount=203
DEBUG 2025/12/17 17:26:00   Bucket[21]: Key=彰化高商, DocCount=201
DEBUG 2025/12/17 17:26:00   Bucket[22]: Key=玉里高中, DocCount=197
DEBUG 2025/12/17 17:26:00   Bucket[23]: Key=後壁高中, DocCount=193
DEBUG 2025/12/17 17:26:00   Bucket[24]: Key=花蓮高商, DocCount=172
DEBUG 2025/12/17 17:26:00   Bucket[25]: Key=內埔農工, DocCount=165
DEBUG 2025/12/17 17:26:00   Bucket[26]: Key=虎尾高中, DocCount=164
DEBUG 2025/12/17 17:26:00   Bucket[27]: Key=關山工商, DocCount=160
DEBUG 2025/12/17 17:26:00   Bucket[28]: Key=東港海事, DocCount=157
DEBUG 2025/12/17 17:26:00   Bucket[29]: Key=南投特教, DocCount=155
DEBUG 2025/12/17 17:26:00   Bucket[30]: Key=苗栗農工, DocCount=154
DEBUG 2025/12/17 17:26:00   Bucket[31]: Key=斗六家商, DocCount=152
DEBUG 2025/12/17 17:26:00   Bucket[32]: Key=屏東女中, DocCount=147
DEBUG 2025/12/17 17:26:00   Bucket[33]: Key=新竹高工, DocCount=145
DEBUG 2025/12/17 17:26:00   Bucket[34]: Key=土庫商工, DocCount=121
DEBUG 2025/12/17 17:26:00   Bucket[35]: Key=員林家商, DocCount=120
DEBUG 2025/12/17 17:26:00   Bucket[36]: Key=新營高工, DocCount=120
DEBUG 2025/12/17 17:26:00   Bucket[37]: Key=師大附中高中部, DocCount=113
DEBUG 2025/12/17 17:26:00   Bucket[38]: Key=新營高中, DocCount=110
DEBUG 2025/12/17 17:26:00   Bucket[39]: Key=新竹高中, DocCount=106
DEBUG 2025/12/17 17:26:00   Bucket[40]: Key=苗栗高商, DocCount=105
DEBUG 2025/12/17 17:26:00   Bucket[41]: Key=鳳山高中, DocCount=102
DEBUG 2025/12/17 17:26:00   Bucket[42]: Key=屏北高中, DocCount=101
DEBUG 2025/12/17 17:26:00   Bucket[43]: Key=彰師附工, DocCount=100
DEBUG 2025/12/17 17:26:00   Bucket[44]: Key=臺東高商, DocCount=98
DEBUG 2025/12/17 17:26:00   Bucket[45]: Key=屏科實中, DocCount=96
DEBUG 2025/12/17 17:26:00   Bucket[46]: Key=新豐高中, DocCount=94
DEBUG 2025/12/17 17:26:00   Bucket[47]: Key=潮州高中, DocCount=92
DEBUG 2025/12/17 17:26:00   Bucket[48]: Key=嘉義高商, DocCount=91
DEBUG 2025/12/17 17:26:00   Bucket[49]: Key=北港高中, DocCount=88
DEBUG 2025/12/17 17:26:00   Bucket[50]: Key=臺東女中, DocCount=82
DEBUG 2025/12/17 17:26:00   Bucket[51]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:26:00   Bucket[52]: Key=新化高中, DocCount=80
DEBUG 2025/12/17 17:26:00   Bucket[53]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 17:26:00   Bucket[54]: Key=新竹高商, DocCount=76
DEBUG 2025/12/17 17:26:00   Bucket[55]: Key=南大附聰, DocCount=75
DEBUG 2025/12/17 17:26:00   Bucket[56]: Key=成大南工, DocCount=72
DEBUG 2025/12/17 17:26:00   Bucket[57]: Key=草屯商工, DocCount=69
DEBUG 2025/12/17 17:26:00   Bucket[58]: Key=北斗家商, DocCount=68
DEBUG 2025/12/17 17:26:00   Bucket[59]: Key=曾文農工, DocCount=68
DEBUG 2025/12/17 17:26:00   Bucket[60]: Key=水里商工, DocCount=68
DEBUG 2025/12/17 17:26:00   Bucket[61]: Key=華南高商, DocCount=66
DEBUG 2025/12/17 17:26:00   Bucket[62]: Key=埔里高工, DocCount=65
DEBUG 2025/12/17 17:26:00   Bucket[63]: Key=嘉科實中, DocCount=64
DEBUG 2025/12/17 17:26:00   Bucket[64]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 17:26:00   Bucket[65]: Key=員林農工, DocCount=59
DEBUG 2025/12/17 17:26:00   Bucket[66]: Key=嘉義高中, DocCount=58
DEBUG 2025/12/17 17:26:00   Bucket[67]: Key=東石高中, DocCount=58
DEBUG 2025/12/17 17:26:00   Bucket[68]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 17:26:00   Bucket[69]: Key=永靖高工, DocCount=55
DEBUG 2025/12/17 17:26:00   Bucket[70]: Key=屏東高中, DocCount=53
DEBUG 2025/12/17 17:26:00   Bucket[71]: Key=澎湖海事, DocCount=53
DEBUG 2025/12/17 17:26:00   Bucket[72]: Key=苗栗高中, DocCount=53
DEBUG 2025/12/17 17:26:00   Bucket[73]: Key=二林工商, DocCount=52
DEBUG 2025/12/17 17:26:00   Bucket[74]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:26:00   Bucket[75]: Key=基隆商工, DocCount=51
DEBUG 2025/12/17 17:26:00   Bucket[76]: Key=海大附中, DocCount=51
DEBUG 2025/12/17 17:26:00   Bucket[77]: Key=高餐大附中, DocCount=49
DEBUG 2025/12/17 17:26:00   Bucket[78]: Key=善化高中, DocCount=48
DEBUG 2025/12/17 17:26:00   Bucket[79]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 17:26:00   Bucket[80]: Key=北港農工, DocCount=47
DEBUG 2025/12/17 17:26:00   Bucket[81]: Key=嘉義家職, DocCount=46
DEBUG 2025/12/17 17:26:00   Bucket[82]: Key=宜蘭高中, DocCount=45
DEBUG 2025/12/17 17:26:00   Bucket[83]: Key=白河商工, DocCount=45
DEBUG 2025/12/17 17:26:00   Bucket[84]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 17:26:00   Bucket[85]: Key=頭城家商, DocCount=45
DEBUG 2025/12/17 17:26:00   Bucket[86]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 17:26:00   Bucket[87]: Key=南大附中, DocCount=43
DEBUG 2025/12/17 17:26:00   Bucket[88]: Key=竹山高中, DocCount=42
DEBUG 2025/12/17 17:26:00   Bucket[89]: Key=花蓮高中, DocCount=42
DEBUG 2025/12/17 17:26:00   Bucket[90]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:26:00   Bucket[91]: Key=南投高中, DocCount=41
DEBUG 2025/12/17 17:26:00   Bucket[92]: Key=嘉義特教, DocCount=40
DEBUG 2025/12/17 17:26:00   Bucket[93]: Key=溪湖高中, DocCount=40
DEBUG 2025/12/17 17:26:00   Bucket[94]: Key=政大附中, DocCount=39
DEBUG 2025/12/17 17:26:00   Bucket[95]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 17:26:00   Bucket[96]: Key=中興高中, DocCount=38
DEBUG 2025/12/17 17:26:00   Bucket[97]: Key=南大附小, DocCount=38
DEBUG 2025/12/17 17:26:00   Bucket[98]: Key=家齊高中, DocCount=38
DEBUG 2025/12/17 17:26:00   Bucket[99]: Key=崇實高工, DocCount=38
DEBUG 2025/12/17 17:26:00 ========================================================
INFO 2025/12/17 17:26:03 ✅ Successfully flushed 1/1 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:26:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:26:08 Processing 15 offline devices
INFO 2025/12/17 17:26:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:26:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:26:08 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:26:08 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:26:08 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:26:08 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:26:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:26:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:26:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:26:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:26:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:26:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:26:08 ✅ Successfully flushed 36/36 history records to TimescaleDB
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:26:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:26:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:26:08 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:26:08 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:26:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:26:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:26:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:26:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:26:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:26:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:26:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:26:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:26:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:26:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:26:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:26:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:26:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:26:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:26:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:26:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:26:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:26:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:26:13 ✅ Successfully flushed 10/10 history records to TimescaleDB
DEBUG 2025/12/17 17:26:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:26:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:26:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:26:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:26:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:26:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:26:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:26:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:26:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:26:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:26:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:26:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:26:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:26:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:26:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:26:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:26:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:26:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:26:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:26:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:26:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:26:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.29% (threshold: 90.00%)
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.31% (threshold: 85.00%)
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:26:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:26:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:26:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:26:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:26:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:27:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:27:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:27:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:27:00 Field: school_name.keyword
DEBUG 2025/12/17 17:27:00 Time From: 2025-12-17T17:26:00.000+08:00
DEBUG 2025/12/17 17:27:00 Time To: 2025-12-17T17:27:00.000+08:00
DEBUG 2025/12/17 17:27:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:26:00.000+08:00",
					"lte": "2025-12-17T17:27:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:27:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:27:00 ES Response IsError: false
DEBUG 2025/12/17 17:27:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":454,"buckets":[{"key":"黑快馬主機","doc_count":1432},{"key":"花蓮高農","doc_count":829},{"key":"仁愛高農","doc_count":564},{"key":"金門農工","doc_count":534},{"key":"金門高中","doc_count":524},{"key":"新竹女中","doc_count":471},{"key":"中大壢中","doc_count":445},{"key":"臺東高中","doc_count":434},{"key":"北門高中","doc_count":405},{"key":"竹北高中","doc_count":371},{"key":"蘇澳海事","doc_count":352},{"key":"華僑高中","doc_count":340},{"key":"南投高商","doc_count":313},{"key":"竹南高中","doc_count":284},{"key":"宜蘭高商","doc_count":280},{"key":"興大附中","doc_count":269},{"key":"新港藝高","doc_count":260},{"key":"虎尾高中","doc_count":254},{"key":"旗美高中","doc_count":240},{"key":"關西高中","doc_count":217},{"key":"清華附小","doc_count":214},{"key":"後壁高中","doc_count":213},{"key":"斗六家商","doc_count":205},{"key":"內埔農工","doc_count":197},{"key":"苗栗農工","doc_count":193},{"key":"花蓮高商","doc_count":190},{"key":"關山工商","doc_count":179},{"key":"彰化高商","doc_count":154},{"key":"屏東女中","doc_count":140},{"key":"北港高中","doc_count":137},{"key":"南投特教","doc_count":137},{"key":"玉里高中","doc_count":137},{"key":"東港海事","doc_count":134},{"key":"彰師附工","doc_count":128},{"key":"鳳山高中","doc_count":128},{"key":"屏東高工","doc_count":127},{"key":"水里商工","doc_count":126},{"key":"師大附中高中部","doc_count":125},{"key":"新化高工","doc_count":124},{"key":"新化高中","doc_count":119},{"key":"苗栗高商","doc_count":119},{"key":"南投高中","doc_count":111},{"key":"新營高工","doc_count":109},{"key":"員林家商","doc_count":106},{"key":"嘉義高中","doc_count":99},{"key":"嘉義高商","doc_count":97},{"key":"草屯商工","doc_count":94},{"key":"南大附聰","doc_count":92},{"key":"屏科實中","doc_count":91},{"key":"新竹高工","doc_count":91},{"key":"新豐高中","doc_count":90},{"key":"溪湖高中","doc_count":90},{"key":"臺南高商","doc_count":87},{"key":"東石高中","doc_count":85},{"key":"南大附中","doc_count":83},{"key":"北教大實小","doc_count":76},{"key":"嘉科實中","doc_count":76},{"key":"新營高中","doc_count":76},{"key":"土庫商工","doc_count":73},{"key":"白河商工","doc_count":71},{"key":"曾文農工","doc_count":69},{"key":"員林高中","doc_count":66},{"key":"臺東高商","doc_count":66},{"key":"旗山農工","doc_count":63},{"key":"臺東女中","doc_count":62},{"key":"政大附中","doc_count":61},{"key":"新竹高商","doc_count":61},{"key":"善化高中","doc_count":60},{"key":"家齊高中","doc_count":58},{"key":"新竹高中","doc_count":58},{"key":"成大南工","doc_count":57},{"key":"頭城家商","doc_count":57},{"key":"海大附中","doc_count":56},{"key":"臺南一中","doc_count":54},{"key":"澎湖海事","doc_count":53},{"key":"竹山高中","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"北斗家商","doc_count":51},{"key":"嘉義家職","doc_count":51},{"key":"屏東特教","doc_count":51},{"key":"興大附農","doc_count":51},{"key":"宜蘭高中","doc_count":50},{"key":"羅東高工","doc_count":50},{"key":"員林農工","doc_count":49},{"key":"嘉義特教","doc_count":47},{"key":"永靖高工","doc_count":46},{"key":"潮州高中","doc_count":46},{"key":"暨大附中","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"北港農工","doc_count":44},{"key":"羅東高商","doc_count":44},{"key":"中興高中","doc_count":43},{"key":"屏北高中","doc_count":43},{"key":"崇實高工","doc_count":42},{"key":"華南高商","doc_count":42},{"key":"佳冬高農","doc_count":39},{"key":"嘉義高工","doc_count":38},{"key":"玉井工商","doc_count":36},{"key":"雲林特教","doc_count":36},{"key":"二林工商","doc_count":34}]}}}
DEBUG 2025/12/17 17:27:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:27:00   Bucket[0]: Key=黑快馬主機, DocCount=1432
DEBUG 2025/12/17 17:27:00   Bucket[1]: Key=花蓮高農, DocCount=829
DEBUG 2025/12/17 17:27:00   Bucket[2]: Key=仁愛高農, DocCount=564
DEBUG 2025/12/17 17:27:00   Bucket[3]: Key=金門農工, DocCount=534
DEBUG 2025/12/17 17:27:00   Bucket[4]: Key=金門高中, DocCount=524
DEBUG 2025/12/17 17:27:00   Bucket[5]: Key=新竹女中, DocCount=471
DEBUG 2025/12/17 17:27:00   Bucket[6]: Key=中大壢中, DocCount=445
DEBUG 2025/12/17 17:27:00   Bucket[7]: Key=臺東高中, DocCount=434
DEBUG 2025/12/17 17:27:00   Bucket[8]: Key=北門高中, DocCount=405
DEBUG 2025/12/17 17:27:00   Bucket[9]: Key=竹北高中, DocCount=371
DEBUG 2025/12/17 17:27:00   Bucket[10]: Key=蘇澳海事, DocCount=352
DEBUG 2025/12/17 17:27:00   Bucket[11]: Key=華僑高中, DocCount=340
DEBUG 2025/12/17 17:27:00   Bucket[12]: Key=南投高商, DocCount=313
DEBUG 2025/12/17 17:27:00   Bucket[13]: Key=竹南高中, DocCount=284
DEBUG 2025/12/17 17:27:00   Bucket[14]: Key=宜蘭高商, DocCount=280
DEBUG 2025/12/17 17:27:00   Bucket[15]: Key=興大附中, DocCount=269
DEBUG 2025/12/17 17:27:00   Bucket[16]: Key=新港藝高, DocCount=260
DEBUG 2025/12/17 17:27:00   Bucket[17]: Key=虎尾高中, DocCount=254
DEBUG 2025/12/17 17:27:00   Bucket[18]: Key=旗美高中, DocCount=240
DEBUG 2025/12/17 17:27:00   Bucket[19]: Key=關西高中, DocCount=217
DEBUG 2025/12/17 17:27:00   Bucket[20]: Key=清華附小, DocCount=214
DEBUG 2025/12/17 17:27:00   Bucket[21]: Key=後壁高中, DocCount=213
DEBUG 2025/12/17 17:27:00   Bucket[22]: Key=斗六家商, DocCount=205
DEBUG 2025/12/17 17:27:00   Bucket[23]: Key=內埔農工, DocCount=197
DEBUG 2025/12/17 17:27:00   Bucket[24]: Key=苗栗農工, DocCount=193
DEBUG 2025/12/17 17:27:00   Bucket[25]: Key=花蓮高商, DocCount=190
DEBUG 2025/12/17 17:27:00   Bucket[26]: Key=關山工商, DocCount=179
DEBUG 2025/12/17 17:27:00   Bucket[27]: Key=彰化高商, DocCount=154
DEBUG 2025/12/17 17:27:00   Bucket[28]: Key=屏東女中, DocCount=140
DEBUG 2025/12/17 17:27:00   Bucket[29]: Key=北港高中, DocCount=137
DEBUG 2025/12/17 17:27:00   Bucket[30]: Key=南投特教, DocCount=137
DEBUG 2025/12/17 17:27:00   Bucket[31]: Key=玉里高中, DocCount=137
DEBUG 2025/12/17 17:27:00   Bucket[32]: Key=東港海事, DocCount=134
DEBUG 2025/12/17 17:27:00   Bucket[33]: Key=彰師附工, DocCount=128
DEBUG 2025/12/17 17:27:00   Bucket[34]: Key=鳳山高中, DocCount=128
DEBUG 2025/12/17 17:27:00   Bucket[35]: Key=屏東高工, DocCount=127
DEBUG 2025/12/17 17:27:00   Bucket[36]: Key=水里商工, DocCount=126
DEBUG 2025/12/17 17:27:00   Bucket[37]: Key=師大附中高中部, DocCount=125
DEBUG 2025/12/17 17:27:00   Bucket[38]: Key=新化高工, DocCount=124
DEBUG 2025/12/17 17:27:00   Bucket[39]: Key=新化高中, DocCount=119
DEBUG 2025/12/17 17:27:00   Bucket[40]: Key=苗栗高商, DocCount=119
DEBUG 2025/12/17 17:27:00   Bucket[41]: Key=南投高中, DocCount=111
DEBUG 2025/12/17 17:27:00   Bucket[42]: Key=新營高工, DocCount=109
DEBUG 2025/12/17 17:27:00   Bucket[43]: Key=員林家商, DocCount=106
DEBUG 2025/12/17 17:27:00   Bucket[44]: Key=嘉義高中, DocCount=99
DEBUG 2025/12/17 17:27:00   Bucket[45]: Key=嘉義高商, DocCount=97
DEBUG 2025/12/17 17:27:00   Bucket[46]: Key=草屯商工, DocCount=94
DEBUG 2025/12/17 17:27:00   Bucket[47]: Key=南大附聰, DocCount=92
DEBUG 2025/12/17 17:27:00   Bucket[48]: Key=屏科實中, DocCount=91
DEBUG 2025/12/17 17:27:00   Bucket[49]: Key=新竹高工, DocCount=91
DEBUG 2025/12/17 17:27:00   Bucket[50]: Key=新豐高中, DocCount=90
DEBUG 2025/12/17 17:27:00   Bucket[51]: Key=溪湖高中, DocCount=90
DEBUG 2025/12/17 17:27:00   Bucket[52]: Key=臺南高商, DocCount=87
DEBUG 2025/12/17 17:27:00   Bucket[53]: Key=東石高中, DocCount=85
DEBUG 2025/12/17 17:27:00   Bucket[54]: Key=南大附中, DocCount=83
DEBUG 2025/12/17 17:27:00   Bucket[55]: Key=北教大實小, DocCount=76
DEBUG 2025/12/17 17:27:00   Bucket[56]: Key=嘉科實中, DocCount=76
DEBUG 2025/12/17 17:27:00   Bucket[57]: Key=新營高中, DocCount=76
DEBUG 2025/12/17 17:27:00   Bucket[58]: Key=土庫商工, DocCount=73
DEBUG 2025/12/17 17:27:00   Bucket[59]: Key=白河商工, DocCount=71
DEBUG 2025/12/17 17:27:00   Bucket[60]: Key=曾文農工, DocCount=69
DEBUG 2025/12/17 17:27:00   Bucket[61]: Key=員林高中, DocCount=66
DEBUG 2025/12/17 17:27:00   Bucket[62]: Key=臺東高商, DocCount=66
DEBUG 2025/12/17 17:27:00   Bucket[63]: Key=旗山農工, DocCount=63
DEBUG 2025/12/17 17:27:00   Bucket[64]: Key=臺東女中, DocCount=62
DEBUG 2025/12/17 17:27:00   Bucket[65]: Key=政大附中, DocCount=61
DEBUG 2025/12/17 17:27:00   Bucket[66]: Key=新竹高商, DocCount=61
DEBUG 2025/12/17 17:27:00   Bucket[67]: Key=善化高中, DocCount=60
DEBUG 2025/12/17 17:27:00   Bucket[68]: Key=家齊高中, DocCount=58
DEBUG 2025/12/17 17:27:00   Bucket[69]: Key=新竹高中, DocCount=58
DEBUG 2025/12/17 17:27:00   Bucket[70]: Key=成大南工, DocCount=57
DEBUG 2025/12/17 17:27:00   Bucket[71]: Key=頭城家商, DocCount=57
DEBUG 2025/12/17 17:27:00   Bucket[72]: Key=海大附中, DocCount=56
DEBUG 2025/12/17 17:27:00   Bucket[73]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 17:27:00   Bucket[74]: Key=澎湖海事, DocCount=53
DEBUG 2025/12/17 17:27:00   Bucket[75]: Key=竹山高中, DocCount=52
DEBUG 2025/12/17 17:27:00   Bucket[76]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:27:00   Bucket[77]: Key=北斗家商, DocCount=51
DEBUG 2025/12/17 17:27:00   Bucket[78]: Key=嘉義家職, DocCount=51
DEBUG 2025/12/17 17:27:00   Bucket[79]: Key=屏東特教, DocCount=51
DEBUG 2025/12/17 17:27:00   Bucket[80]: Key=興大附農, DocCount=51
DEBUG 2025/12/17 17:27:00   Bucket[81]: Key=宜蘭高中, DocCount=50
DEBUG 2025/12/17 17:27:00   Bucket[82]: Key=羅東高工, DocCount=50
DEBUG 2025/12/17 17:27:00   Bucket[83]: Key=員林農工, DocCount=49
DEBUG 2025/12/17 17:27:00   Bucket[84]: Key=嘉義特教, DocCount=47
DEBUG 2025/12/17 17:27:00   Bucket[85]: Key=永靖高工, DocCount=46
DEBUG 2025/12/17 17:27:00   Bucket[86]: Key=潮州高中, DocCount=46
DEBUG 2025/12/17 17:27:00   Bucket[87]: Key=暨大附中, DocCount=45
DEBUG 2025/12/17 17:27:00   Bucket[88]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:27:00   Bucket[89]: Key=北港農工, DocCount=44
DEBUG 2025/12/17 17:27:00   Bucket[90]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 17:27:00   Bucket[91]: Key=中興高中, DocCount=43
DEBUG 2025/12/17 17:27:00   Bucket[92]: Key=屏北高中, DocCount=43
DEBUG 2025/12/17 17:27:00   Bucket[93]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:27:00   Bucket[94]: Key=華南高商, DocCount=42
DEBUG 2025/12/17 17:27:00   Bucket[95]: Key=佳冬高農, DocCount=39
DEBUG 2025/12/17 17:27:00   Bucket[96]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:27:00   Bucket[97]: Key=玉井工商, DocCount=36
DEBUG 2025/12/17 17:27:00   Bucket[98]: Key=雲林特教, DocCount=36
DEBUG 2025/12/17 17:27:00   Bucket[99]: Key=二林工商, DocCount=34
DEBUG 2025/12/17 17:27:00 ========================================================
INFO 2025/12/17 17:27:08 ✅ Successfully flushed 50/50 history records to TimescaleDB
INFO 2025/12/17 17:27:08 ✅ Successfully flushed 50/0 history records to TimescaleDB
INFO 2025/12/17 17:27:13 ✅ Successfully flushed 46/46 history records to TimescaleDB
INFO 2025/12/17 17:27:14 Processing 15 offline devices
INFO 2025/12/17 17:27:14 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:27:14 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:27:14 Creating history record for offline device: 屏東高中
INFO 2025/12/17 17:27:14 About to add history to batch for device: 屏東高中
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 17:27:14 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:27:14 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:27:14 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:27:14 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:27:14 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:27:14 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:27:14 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:27:14 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:27:14 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:27:14 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:27:14 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:27:14 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:27:14 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:27:15 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:27:15 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:27:15 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:27:15 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:27:15 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:27:15 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:27:15 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:27:15 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:27:15 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:27:15 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:27:15 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:27:15 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:27:15 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:27:15 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:27:15 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:27:16 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:27:18 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:27:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:27:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:27:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:27:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:27:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:27:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:27:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:27:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:27:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:27:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:27:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:27:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:27:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:27:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:27:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:27:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:27:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:27:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:27:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:27:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:27:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:27:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:27:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:27:45 ES Alert Created [high][performance]: Memory usage high: 89.19% (threshold: 80.00%)
DEBUG 2025/12/17 17:27:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.34% (threshold: 85.00%)
DEBUG 2025/12/17 17:27:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:27:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:27:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:27:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:27:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:27:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:27:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:28:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:28:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:28:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:28:00 Field: school_name.keyword
DEBUG 2025/12/17 17:28:00 Time From: 2025-12-17T17:27:00.000+08:00
DEBUG 2025/12/17 17:28:00 Time To: 2025-12-17T17:28:00.000+08:00
DEBUG 2025/12/17 17:28:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:27:00.000+08:00",
					"lte": "2025-12-17T17:28:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:28:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:28:00 ES Response IsError: false
DEBUG 2025/12/17 17:28:00 ES Response Body:
{"took":71,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":445,"buckets":[{"key":"花蓮高農","doc_count":674},{"key":"黑快馬主機","doc_count":651},{"key":"仁愛高農","doc_count":500},{"key":"金門高中","doc_count":479},{"key":"金門農工","doc_count":473},{"key":"新竹女中","doc_count":434},{"key":"北門高中","doc_count":394},{"key":"臺東高中","doc_count":381},{"key":"竹北高中","doc_count":362},{"key":"蘇澳海事","doc_count":352},{"key":"華僑高中","doc_count":316},{"key":"宜蘭高商","doc_count":304},{"key":"中大壢中","doc_count":290},{"key":"旗美高中","doc_count":287},{"key":"玉里高中","doc_count":286},{"key":"南投高商","doc_count":254},{"key":"內埔農工","doc_count":248},{"key":"後壁高中","doc_count":221},{"key":"關西高中","doc_count":214},{"key":"虎尾高中","doc_count":208},{"key":"清華附小","doc_count":200},{"key":"興大附中","doc_count":192},{"key":"花蓮高商","doc_count":178},{"key":"彰師附工","doc_count":173},{"key":"新港藝高","doc_count":171},{"key":"斗六家商","doc_count":161},{"key":"關山工商","doc_count":159},{"key":"新化高工","doc_count":158},{"key":"竹南高中","doc_count":153},{"key":"南投特教","doc_count":150},{"key":"東港海事","doc_count":148},{"key":"南投高中","doc_count":145},{"key":"屏東女中","doc_count":144},{"key":"水里商工","doc_count":144},{"key":"東石高中","doc_count":134},{"key":"員林家商","doc_count":130},{"key":"政大附中","doc_count":128},{"key":"師大附中高中部","doc_count":119},{"key":"新營高工","doc_count":119},{"key":"北教大實小","doc_count":117},{"key":"彰化高商","doc_count":116},{"key":"鳳山高中","doc_count":116},{"key":"北港高中","doc_count":112},{"key":"新竹高工","doc_count":104},{"key":"潮州高中","doc_count":104},{"key":"苗栗農工","doc_count":103},{"key":"屏科實中","doc_count":102},{"key":"成大南工","doc_count":102},{"key":"新化高中","doc_count":86},{"key":"草屯商工","doc_count":83},{"key":"善化高中","doc_count":82},{"key":"海大附中","doc_count":82},{"key":"新竹高中","doc_count":78},{"key":"屏東高工","doc_count":77},{"key":"新營高中","doc_count":77},{"key":"嘉義高中","doc_count":73},{"key":"成功商水","doc_count":72},{"key":"北港農工","doc_count":71},{"key":"員林高中","doc_count":71},{"key":"臺東女中","doc_count":71},{"key":"埔里高工","doc_count":70},{"key":"花蓮特教","doc_count":68},{"key":"頭城家商","doc_count":67},{"key":"嘉科實中","doc_count":64},{"key":"羅東高商","doc_count":64},{"key":"花蓮高工","doc_count":64},{"key":"嘉義高商","doc_count":63},{"key":"北斗家商","doc_count":62},{"key":"南大附聰","doc_count":60},{"key":"苗栗高中","doc_count":60},{"key":"中興高中","doc_count":57},{"key":"佳冬高農","doc_count":54},{"key":"溪湖高中","doc_count":53},{"key":"花蓮高中","doc_count":53},{"key":"永靖高工","doc_count":50},{"key":"華南高商","doc_count":50},{"key":"宜蘭高中","doc_count":49},{"key":"土庫商工","doc_count":48},{"key":"屏東特教","doc_count":48},{"key":"興大附農","doc_count":48},{"key":"竹東高中","doc_count":47},{"key":"崇實高工","doc_count":46},{"key":"白河商工","doc_count":46},{"key":"臺東高商","doc_count":44},{"key":"高餐大附中","doc_count":44},{"key":"臺南高商","doc_count":43},{"key":"蘭陽女中","doc_count":43},{"key":"臺南一中","doc_count":42},{"key":"員林農工","doc_count":39},{"key":"屏北高中","doc_count":39},{"key":"屏東高中","doc_count":39},{"key":"新竹高商","doc_count":39},{"key":"旗山農工","doc_count":39},{"key":"竹山高中","doc_count":39},{"key":"苗栗高商","doc_count":39},{"key":"新豐高中","doc_count":38},{"key":"羅東高工","doc_count":38},{"key":"曾文農工","doc_count":37},{"key":"澎湖海事","doc_count":37},{"key":"雲林特教","doc_count":37}]}}}
DEBUG 2025/12/17 17:28:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:28:00   Bucket[0]: Key=花蓮高農, DocCount=674
DEBUG 2025/12/17 17:28:00   Bucket[1]: Key=黑快馬主機, DocCount=651
DEBUG 2025/12/17 17:28:00   Bucket[2]: Key=仁愛高農, DocCount=500
DEBUG 2025/12/17 17:28:00   Bucket[3]: Key=金門高中, DocCount=479
DEBUG 2025/12/17 17:28:00   Bucket[4]: Key=金門農工, DocCount=473
DEBUG 2025/12/17 17:28:00   Bucket[5]: Key=新竹女中, DocCount=434
DEBUG 2025/12/17 17:28:00   Bucket[6]: Key=北門高中, DocCount=394
DEBUG 2025/12/17 17:28:00   Bucket[7]: Key=臺東高中, DocCount=381
DEBUG 2025/12/17 17:28:00   Bucket[8]: Key=竹北高中, DocCount=362
DEBUG 2025/12/17 17:28:00   Bucket[9]: Key=蘇澳海事, DocCount=352
DEBUG 2025/12/17 17:28:00   Bucket[10]: Key=華僑高中, DocCount=316
DEBUG 2025/12/17 17:28:00   Bucket[11]: Key=宜蘭高商, DocCount=304
DEBUG 2025/12/17 17:28:00   Bucket[12]: Key=中大壢中, DocCount=290
DEBUG 2025/12/17 17:28:00   Bucket[13]: Key=旗美高中, DocCount=287
DEBUG 2025/12/17 17:28:00   Bucket[14]: Key=玉里高中, DocCount=286
DEBUG 2025/12/17 17:28:00   Bucket[15]: Key=南投高商, DocCount=254
DEBUG 2025/12/17 17:28:00   Bucket[16]: Key=內埔農工, DocCount=248
DEBUG 2025/12/17 17:28:00   Bucket[17]: Key=後壁高中, DocCount=221
DEBUG 2025/12/17 17:28:00   Bucket[18]: Key=關西高中, DocCount=214
DEBUG 2025/12/17 17:28:00   Bucket[19]: Key=虎尾高中, DocCount=208
DEBUG 2025/12/17 17:28:00   Bucket[20]: Key=清華附小, DocCount=200
DEBUG 2025/12/17 17:28:00   Bucket[21]: Key=興大附中, DocCount=192
DEBUG 2025/12/17 17:28:00   Bucket[22]: Key=花蓮高商, DocCount=178
DEBUG 2025/12/17 17:28:00   Bucket[23]: Key=彰師附工, DocCount=173
DEBUG 2025/12/17 17:28:00   Bucket[24]: Key=新港藝高, DocCount=171
DEBUG 2025/12/17 17:28:00   Bucket[25]: Key=斗六家商, DocCount=161
DEBUG 2025/12/17 17:28:00   Bucket[26]: Key=關山工商, DocCount=159
DEBUG 2025/12/17 17:28:00   Bucket[27]: Key=新化高工, DocCount=158
DEBUG 2025/12/17 17:28:00   Bucket[28]: Key=竹南高中, DocCount=153
DEBUG 2025/12/17 17:28:00   Bucket[29]: Key=南投特教, DocCount=150
DEBUG 2025/12/17 17:28:00   Bucket[30]: Key=東港海事, DocCount=148
DEBUG 2025/12/17 17:28:00   Bucket[31]: Key=南投高中, DocCount=145
DEBUG 2025/12/17 17:28:00   Bucket[32]: Key=屏東女中, DocCount=144
DEBUG 2025/12/17 17:28:00   Bucket[33]: Key=水里商工, DocCount=144
DEBUG 2025/12/17 17:28:00   Bucket[34]: Key=東石高中, DocCount=134
DEBUG 2025/12/17 17:28:00   Bucket[35]: Key=員林家商, DocCount=130
DEBUG 2025/12/17 17:28:00   Bucket[36]: Key=政大附中, DocCount=128
DEBUG 2025/12/17 17:28:00   Bucket[37]: Key=師大附中高中部, DocCount=119
DEBUG 2025/12/17 17:28:00   Bucket[38]: Key=新營高工, DocCount=119
DEBUG 2025/12/17 17:28:00   Bucket[39]: Key=北教大實小, DocCount=117
DEBUG 2025/12/17 17:28:00   Bucket[40]: Key=彰化高商, DocCount=116
DEBUG 2025/12/17 17:28:00   Bucket[41]: Key=鳳山高中, DocCount=116
DEBUG 2025/12/17 17:28:00   Bucket[42]: Key=北港高中, DocCount=112
DEBUG 2025/12/17 17:28:00   Bucket[43]: Key=新竹高工, DocCount=104
DEBUG 2025/12/17 17:28:00   Bucket[44]: Key=潮州高中, DocCount=104
DEBUG 2025/12/17 17:28:00   Bucket[45]: Key=苗栗農工, DocCount=103
DEBUG 2025/12/17 17:28:00   Bucket[46]: Key=屏科實中, DocCount=102
DEBUG 2025/12/17 17:28:00   Bucket[47]: Key=成大南工, DocCount=102
DEBUG 2025/12/17 17:28:00   Bucket[48]: Key=新化高中, DocCount=86
DEBUG 2025/12/17 17:28:00   Bucket[49]: Key=草屯商工, DocCount=83
DEBUG 2025/12/17 17:28:00   Bucket[50]: Key=善化高中, DocCount=82
DEBUG 2025/12/17 17:28:00   Bucket[51]: Key=海大附中, DocCount=82
DEBUG 2025/12/17 17:28:00   Bucket[52]: Key=新竹高中, DocCount=78
DEBUG 2025/12/17 17:28:00   Bucket[53]: Key=屏東高工, DocCount=77
DEBUG 2025/12/17 17:28:00   Bucket[54]: Key=新營高中, DocCount=77
DEBUG 2025/12/17 17:28:00   Bucket[55]: Key=嘉義高中, DocCount=73
DEBUG 2025/12/17 17:28:00   Bucket[56]: Key=成功商水, DocCount=72
DEBUG 2025/12/17 17:28:00   Bucket[57]: Key=北港農工, DocCount=71
DEBUG 2025/12/17 17:28:00   Bucket[58]: Key=員林高中, DocCount=71
DEBUG 2025/12/17 17:28:00   Bucket[59]: Key=臺東女中, DocCount=71
DEBUG 2025/12/17 17:28:00   Bucket[60]: Key=埔里高工, DocCount=70
DEBUG 2025/12/17 17:28:00   Bucket[61]: Key=花蓮特教, DocCount=68
DEBUG 2025/12/17 17:28:00   Bucket[62]: Key=頭城家商, DocCount=67
DEBUG 2025/12/17 17:28:00   Bucket[63]: Key=嘉科實中, DocCount=64
DEBUG 2025/12/17 17:28:00   Bucket[64]: Key=羅東高商, DocCount=64
DEBUG 2025/12/17 17:28:00   Bucket[65]: Key=花蓮高工, DocCount=64
DEBUG 2025/12/17 17:28:00   Bucket[66]: Key=嘉義高商, DocCount=63
DEBUG 2025/12/17 17:28:00   Bucket[67]: Key=北斗家商, DocCount=62
DEBUG 2025/12/17 17:28:00   Bucket[68]: Key=南大附聰, DocCount=60
DEBUG 2025/12/17 17:28:00   Bucket[69]: Key=苗栗高中, DocCount=60
DEBUG 2025/12/17 17:28:00   Bucket[70]: Key=中興高中, DocCount=57
DEBUG 2025/12/17 17:28:00   Bucket[71]: Key=佳冬高農, DocCount=54
DEBUG 2025/12/17 17:28:00   Bucket[72]: Key=溪湖高中, DocCount=53
DEBUG 2025/12/17 17:28:00   Bucket[73]: Key=花蓮高中, DocCount=53
DEBUG 2025/12/17 17:28:00   Bucket[74]: Key=永靖高工, DocCount=50
DEBUG 2025/12/17 17:28:00   Bucket[75]: Key=華南高商, DocCount=50
DEBUG 2025/12/17 17:28:00   Bucket[76]: Key=宜蘭高中, DocCount=49
DEBUG 2025/12/17 17:28:00   Bucket[77]: Key=土庫商工, DocCount=48
DEBUG 2025/12/17 17:28:00   Bucket[78]: Key=屏東特教, DocCount=48
DEBUG 2025/12/17 17:28:00   Bucket[79]: Key=興大附農, DocCount=48
DEBUG 2025/12/17 17:28:00   Bucket[80]: Key=竹東高中, DocCount=47
DEBUG 2025/12/17 17:28:00   Bucket[81]: Key=崇實高工, DocCount=46
DEBUG 2025/12/17 17:28:00   Bucket[82]: Key=白河商工, DocCount=46
DEBUG 2025/12/17 17:28:00   Bucket[83]: Key=臺東高商, DocCount=44
DEBUG 2025/12/17 17:28:00   Bucket[84]: Key=高餐大附中, DocCount=44
DEBUG 2025/12/17 17:28:00   Bucket[85]: Key=臺南高商, DocCount=43
DEBUG 2025/12/17 17:28:00   Bucket[86]: Key=蘭陽女中, DocCount=43
DEBUG 2025/12/17 17:28:00   Bucket[87]: Key=臺南一中, DocCount=42
DEBUG 2025/12/17 17:28:00   Bucket[88]: Key=員林農工, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[89]: Key=屏北高中, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[90]: Key=屏東高中, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[91]: Key=新竹高商, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[92]: Key=旗山農工, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[93]: Key=竹山高中, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[94]: Key=苗栗高商, DocCount=39
DEBUG 2025/12/17 17:28:00   Bucket[95]: Key=新豐高中, DocCount=38
DEBUG 2025/12/17 17:28:00   Bucket[96]: Key=羅東高工, DocCount=38
DEBUG 2025/12/17 17:28:00   Bucket[97]: Key=曾文農工, DocCount=37
DEBUG 2025/12/17 17:28:00   Bucket[98]: Key=澎湖海事, DocCount=37
DEBUG 2025/12/17 17:28:00   Bucket[99]: Key=雲林特教, DocCount=37
DEBUG 2025/12/17 17:28:00 ========================================================
INFO 2025/12/17 17:28:03 ✅ Successfully flushed 15/15 history records to TimescaleDB
INFO 2025/12/17 17:28:07 ✅ Successfully flushed 50/52 history records to TimescaleDB
INFO 2025/12/17 17:28:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:28:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:28:08 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:28:09 Processing 15 offline devices
INFO 2025/12/17 17:28:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:28:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:28:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:28:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:28:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:28:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:28:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:28:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:28:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:28:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:28:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:28:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:28:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:28:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:28:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:28:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:28:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:28:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:28:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:28:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:28:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:28:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:28:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:28:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:28:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:28:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:28:10 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:28:10 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:28:10 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:28:10 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:28:10 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:28:10 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:28:10 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:28:10 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:28:10 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:28:13 ✅ Successfully flushed 35/35 history records to TimescaleDB
DEBUG 2025/12/17 17:28:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:28:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:28:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:28:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:28:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:28:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:28:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:28:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:28:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:28:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:28:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:28:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:28:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:28:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:28:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:28:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:28:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:28:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:28:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:28:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:28:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.71% (threshold: 80.00%)
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.38% (threshold: 85.00%)
INFO 2025/12/17 17:28:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:28:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:28:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:28:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:28:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:28:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:29:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:29:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:29:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:29:00 Field: school_name.keyword
DEBUG 2025/12/17 17:29:00 Time From: 2025-12-17T17:28:00.000+08:00
DEBUG 2025/12/17 17:29:00 Time To: 2025-12-17T17:29:00.000+08:00
DEBUG 2025/12/17 17:29:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:28:00.000+08:00",
					"lte": "2025-12-17T17:29:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:29:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:29:00 ES Response IsError: false
DEBUG 2025/12/17 17:29:00 ES Response Body:
{"took":81,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":437,"buckets":[{"key":"黑快馬主機","doc_count":1018},{"key":"花蓮高農","doc_count":787},{"key":"仁愛高農","doc_count":560},{"key":"金門高中","doc_count":537},{"key":"金門農工","doc_count":498},{"key":"新竹女中","doc_count":490},{"key":"臺東高中","doc_count":394},{"key":"北門高中","doc_count":387},{"key":"華僑高中","doc_count":342},{"key":"竹北高中","doc_count":333},{"key":"蘇澳海事","doc_count":313},{"key":"宜蘭高商","doc_count":306},{"key":"旗美高中","doc_count":294},{"key":"南投高商","doc_count":263},{"key":"中大壢中","doc_count":260},{"key":"興大附中","doc_count":238},{"key":"關西高中","doc_count":223},{"key":"新港藝高","doc_count":222},{"key":"玉里高中","doc_count":217},{"key":"虎尾高中","doc_count":203},{"key":"斗六家商","doc_count":195},{"key":"內埔農工","doc_count":179},{"key":"新化高工","doc_count":178},{"key":"清華附小","doc_count":178},{"key":"後壁高中","doc_count":175},{"key":"屏東女中","doc_count":172},{"key":"花蓮高商","doc_count":172},{"key":"關山工商","doc_count":168},{"key":"員林家商","doc_count":154},{"key":"南投特教","doc_count":149},{"key":"竹南高中","doc_count":144},{"key":"屏東高工","doc_count":142},{"key":"苗栗農工","doc_count":141},{"key":"師大附中高中部","doc_count":129},{"key":"東港海事","doc_count":129},{"key":"鳳山高中","doc_count":123},{"key":"新營高工","doc_count":121},{"key":"彰師附工","doc_count":119},{"key":"政大附中","doc_count":116},{"key":"水里商工","doc_count":111},{"key":"秀水高工","doc_count":111},{"key":"苗栗高中","doc_count":107},{"key":"埔里高工","doc_count":98},{"key":"花蓮特教","doc_count":95},{"key":"嘉義高中","doc_count":94},{"key":"白河商工","doc_count":94},{"key":"中興高中","doc_count":91},{"key":"永靖高工","doc_count":91},{"key":"臺南高商","doc_count":89},{"key":"新營高中","doc_count":85},{"key":"新竹高工","doc_count":84},{"key":"北教大實小","doc_count":83},{"key":"新化高中","doc_count":83},{"key":"南大附聰","doc_count":82},{"key":"南投高中","doc_count":81},{"key":"嘉科實中","doc_count":78},{"key":"屏科實中","doc_count":78},{"key":"宜蘭高中","doc_count":77},{"key":"東石高中","doc_count":75},{"key":"南大附中","doc_count":73},{"key":"蘭陽女中","doc_count":72},{"key":"新竹高中","doc_count":69},{"key":"成大南工","doc_count":66},{"key":"北斗家商","doc_count":64},{"key":"彰化高商","doc_count":64},{"key":"崇實高工","doc_count":63},{"key":"苗栗高商","doc_count":62},{"key":"北港高中","doc_count":61},{"key":"屏東高中","doc_count":59},{"key":"海大附中","doc_count":58},{"key":"雲林特教","doc_count":54},{"key":"羅東高商","doc_count":53},{"key":"臺南一中","doc_count":53},{"key":"二林工商","doc_count":52},{"key":"土庫商工","doc_count":52},{"key":"新竹高商","doc_count":52},{"key":"興大附農","doc_count":52},{"key":"華南高商","doc_count":51},{"key":"北港農工","doc_count":48},{"key":"南大附小","doc_count":48},{"key":"嘉義高商","doc_count":47},{"key":"師大附中國中部","doc_count":46},{"key":"新竹特教","doc_count":46},{"key":"曾文農工","doc_count":46},{"key":"基隆商工","doc_count":45},{"key":"潮州高中","doc_count":45},{"key":"善化高中","doc_count":43},{"key":"臺東女中","doc_count":43},{"key":"員林農工","doc_count":42},{"key":"高餐大附中","doc_count":42},{"key":"羅東高工","doc_count":41},{"key":"嘉義特教","doc_count":40},{"key":"新豐高中","doc_count":40},{"key":"澎湖海事","doc_count":40},{"key":"草屯商工","doc_count":40},{"key":"屏東特教","doc_count":39},{"key":"臺東高商","doc_count":39},{"key":"花蓮高工","doc_count":38},{"key":"員林高中","doc_count":37},{"key":"竹山高中","doc_count":37}]}}}
DEBUG 2025/12/17 17:29:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:29:00   Bucket[0]: Key=黑快馬主機, DocCount=1018
DEBUG 2025/12/17 17:29:00   Bucket[1]: Key=花蓮高農, DocCount=787
DEBUG 2025/12/17 17:29:00   Bucket[2]: Key=仁愛高農, DocCount=560
DEBUG 2025/12/17 17:29:00   Bucket[3]: Key=金門高中, DocCount=537
DEBUG 2025/12/17 17:29:00   Bucket[4]: Key=金門農工, DocCount=498
DEBUG 2025/12/17 17:29:00   Bucket[5]: Key=新竹女中, DocCount=490
DEBUG 2025/12/17 17:29:00   Bucket[6]: Key=臺東高中, DocCount=394
DEBUG 2025/12/17 17:29:00   Bucket[7]: Key=北門高中, DocCount=387
DEBUG 2025/12/17 17:29:00   Bucket[8]: Key=華僑高中, DocCount=342
DEBUG 2025/12/17 17:29:00   Bucket[9]: Key=竹北高中, DocCount=333
DEBUG 2025/12/17 17:29:00   Bucket[10]: Key=蘇澳海事, DocCount=313
DEBUG 2025/12/17 17:29:00   Bucket[11]: Key=宜蘭高商, DocCount=306
DEBUG 2025/12/17 17:29:00   Bucket[12]: Key=旗美高中, DocCount=294
DEBUG 2025/12/17 17:29:00   Bucket[13]: Key=南投高商, DocCount=263
DEBUG 2025/12/17 17:29:00   Bucket[14]: Key=中大壢中, DocCount=260
DEBUG 2025/12/17 17:29:00   Bucket[15]: Key=興大附中, DocCount=238
DEBUG 2025/12/17 17:29:00   Bucket[16]: Key=關西高中, DocCount=223
DEBUG 2025/12/17 17:29:00   Bucket[17]: Key=新港藝高, DocCount=222
DEBUG 2025/12/17 17:29:00   Bucket[18]: Key=玉里高中, DocCount=217
DEBUG 2025/12/17 17:29:00   Bucket[19]: Key=虎尾高中, DocCount=203
DEBUG 2025/12/17 17:29:00   Bucket[20]: Key=斗六家商, DocCount=195
DEBUG 2025/12/17 17:29:00   Bucket[21]: Key=內埔農工, DocCount=179
DEBUG 2025/12/17 17:29:00   Bucket[22]: Key=新化高工, DocCount=178
DEBUG 2025/12/17 17:29:00   Bucket[23]: Key=清華附小, DocCount=178
DEBUG 2025/12/17 17:29:00   Bucket[24]: Key=後壁高中, DocCount=175
DEBUG 2025/12/17 17:29:00   Bucket[25]: Key=屏東女中, DocCount=172
DEBUG 2025/12/17 17:29:00   Bucket[26]: Key=花蓮高商, DocCount=172
DEBUG 2025/12/17 17:29:00   Bucket[27]: Key=關山工商, DocCount=168
DEBUG 2025/12/17 17:29:00   Bucket[28]: Key=員林家商, DocCount=154
DEBUG 2025/12/17 17:29:00   Bucket[29]: Key=南投特教, DocCount=149
DEBUG 2025/12/17 17:29:00   Bucket[30]: Key=竹南高中, DocCount=144
DEBUG 2025/12/17 17:29:00   Bucket[31]: Key=屏東高工, DocCount=142
DEBUG 2025/12/17 17:29:00   Bucket[32]: Key=苗栗農工, DocCount=141
DEBUG 2025/12/17 17:29:00   Bucket[33]: Key=師大附中高中部, DocCount=129
DEBUG 2025/12/17 17:29:00   Bucket[34]: Key=東港海事, DocCount=129
DEBUG 2025/12/17 17:29:00   Bucket[35]: Key=鳳山高中, DocCount=123
DEBUG 2025/12/17 17:29:00   Bucket[36]: Key=新營高工, DocCount=121
DEBUG 2025/12/17 17:29:00   Bucket[37]: Key=彰師附工, DocCount=119
DEBUG 2025/12/17 17:29:00   Bucket[38]: Key=政大附中, DocCount=116
DEBUG 2025/12/17 17:29:00   Bucket[39]: Key=水里商工, DocCount=111
DEBUG 2025/12/17 17:29:00   Bucket[40]: Key=秀水高工, DocCount=111
DEBUG 2025/12/17 17:29:00   Bucket[41]: Key=苗栗高中, DocCount=107
DEBUG 2025/12/17 17:29:00   Bucket[42]: Key=埔里高工, DocCount=98
DEBUG 2025/12/17 17:29:00   Bucket[43]: Key=花蓮特教, DocCount=95
DEBUG 2025/12/17 17:29:00   Bucket[44]: Key=嘉義高中, DocCount=94
DEBUG 2025/12/17 17:29:00   Bucket[45]: Key=白河商工, DocCount=94
DEBUG 2025/12/17 17:29:00   Bucket[46]: Key=中興高中, DocCount=91
DEBUG 2025/12/17 17:29:00   Bucket[47]: Key=永靖高工, DocCount=91
DEBUG 2025/12/17 17:29:00   Bucket[48]: Key=臺南高商, DocCount=89
DEBUG 2025/12/17 17:29:00   Bucket[49]: Key=新營高中, DocCount=85
DEBUG 2025/12/17 17:29:00   Bucket[50]: Key=新竹高工, DocCount=84
DEBUG 2025/12/17 17:29:00   Bucket[51]: Key=北教大實小, DocCount=83
DEBUG 2025/12/17 17:29:00   Bucket[52]: Key=新化高中, DocCount=83
DEBUG 2025/12/17 17:29:00   Bucket[53]: Key=南大附聰, DocCount=82
DEBUG 2025/12/17 17:29:00   Bucket[54]: Key=南投高中, DocCount=81
DEBUG 2025/12/17 17:29:00   Bucket[55]: Key=嘉科實中, DocCount=78
DEBUG 2025/12/17 17:29:00   Bucket[56]: Key=屏科實中, DocCount=78
DEBUG 2025/12/17 17:29:00   Bucket[57]: Key=宜蘭高中, DocCount=77
DEBUG 2025/12/17 17:29:00   Bucket[58]: Key=東石高中, DocCount=75
DEBUG 2025/12/17 17:29:00   Bucket[59]: Key=南大附中, DocCount=73
DEBUG 2025/12/17 17:29:00   Bucket[60]: Key=蘭陽女中, DocCount=72
DEBUG 2025/12/17 17:29:00   Bucket[61]: Key=新竹高中, DocCount=69
DEBUG 2025/12/17 17:29:00   Bucket[62]: Key=成大南工, DocCount=66
DEBUG 2025/12/17 17:29:00   Bucket[63]: Key=北斗家商, DocCount=64
DEBUG 2025/12/17 17:29:00   Bucket[64]: Key=彰化高商, DocCount=64
DEBUG 2025/12/17 17:29:00   Bucket[65]: Key=崇實高工, DocCount=63
DEBUG 2025/12/17 17:29:00   Bucket[66]: Key=苗栗高商, DocCount=62
DEBUG 2025/12/17 17:29:00   Bucket[67]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:29:00   Bucket[68]: Key=屏東高中, DocCount=59
DEBUG 2025/12/17 17:29:00   Bucket[69]: Key=海大附中, DocCount=58
DEBUG 2025/12/17 17:29:00   Bucket[70]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:29:00   Bucket[71]: Key=羅東高商, DocCount=53
DEBUG 2025/12/17 17:29:00   Bucket[72]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:29:00   Bucket[73]: Key=二林工商, DocCount=52
DEBUG 2025/12/17 17:29:00   Bucket[74]: Key=土庫商工, DocCount=52
DEBUG 2025/12/17 17:29:00   Bucket[75]: Key=新竹高商, DocCount=52
DEBUG 2025/12/17 17:29:00   Bucket[76]: Key=興大附農, DocCount=52
DEBUG 2025/12/17 17:29:00   Bucket[77]: Key=華南高商, DocCount=51
DEBUG 2025/12/17 17:29:00   Bucket[78]: Key=北港農工, DocCount=48
DEBUG 2025/12/17 17:29:00   Bucket[79]: Key=南大附小, DocCount=48
DEBUG 2025/12/17 17:29:00   Bucket[80]: Key=嘉義高商, DocCount=47
DEBUG 2025/12/17 17:29:00   Bucket[81]: Key=師大附中國中部, DocCount=46
DEBUG 2025/12/17 17:29:00   Bucket[82]: Key=新竹特教, DocCount=46
DEBUG 2025/12/17 17:29:00   Bucket[83]: Key=曾文農工, DocCount=46
DEBUG 2025/12/17 17:29:00   Bucket[84]: Key=基隆商工, DocCount=45
DEBUG 2025/12/17 17:29:00   Bucket[85]: Key=潮州高中, DocCount=45
DEBUG 2025/12/17 17:29:00   Bucket[86]: Key=善化高中, DocCount=43
DEBUG 2025/12/17 17:29:00   Bucket[87]: Key=臺東女中, DocCount=43
DEBUG 2025/12/17 17:29:00   Bucket[88]: Key=員林農工, DocCount=42
DEBUG 2025/12/17 17:29:00   Bucket[89]: Key=高餐大附中, DocCount=42
DEBUG 2025/12/17 17:29:00   Bucket[90]: Key=羅東高工, DocCount=41
DEBUG 2025/12/17 17:29:00   Bucket[91]: Key=嘉義特教, DocCount=40
DEBUG 2025/12/17 17:29:00   Bucket[92]: Key=新豐高中, DocCount=40
DEBUG 2025/12/17 17:29:00   Bucket[93]: Key=澎湖海事, DocCount=40
DEBUG 2025/12/17 17:29:00   Bucket[94]: Key=草屯商工, DocCount=40
DEBUG 2025/12/17 17:29:00   Bucket[95]: Key=屏東特教, DocCount=39
DEBUG 2025/12/17 17:29:00   Bucket[96]: Key=臺東高商, DocCount=39
DEBUG 2025/12/17 17:29:00   Bucket[97]: Key=花蓮高工, DocCount=38
DEBUG 2025/12/17 17:29:00   Bucket[98]: Key=員林高中, DocCount=37
DEBUG 2025/12/17 17:29:00   Bucket[99]: Key=竹山高中, DocCount=37
DEBUG 2025/12/17 17:29:00 ========================================================
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:29:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:29:08 Processing 15 offline devices
INFO 2025/12/17 17:29:08 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:29:08 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:29:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:29:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:29:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:29:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:29:08 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:29:08 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:29:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:29:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:29:08 ✅ Successfully flushed 36/36 history records to TimescaleDB
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:29:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:29:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:29:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:29:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:29:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:29:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:29:08 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:29:08 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:29:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:29:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:29:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:29:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:29:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:29:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:29:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:29:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:29:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:29:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:29:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:29:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:29:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:29:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:29:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:29:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:29:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:29:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:29:13 ✅ Successfully flushed 11/11 history records to TimescaleDB
DEBUG 2025/12/17 17:29:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:29:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:29:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:29:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:29:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:29:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:29:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:29:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:29:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:29:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:29:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:29:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:29:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:29:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:29:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:29:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:29:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:29:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:29:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:29:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:29:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:29:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:29:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:29:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.02% (threshold: 80.00%)
WARN 2025/12/17 17:29:45 ES Alert Created [high][capacity]: Disk usage high: 93.41% (threshold: 85.00%)
WARN 2025/12/17 17:29:45 ES Alert Created [high][health]: Unassigned shards detected: 36
INFO 2025/12/17 17:29:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:29:45 ES Alert Created [high][health]: Unassigned shards detected: 8
WARN 2025/12/17 17:29:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:29:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:29:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:29:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:29:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:30:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:30:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:30:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:30:00 Field: school_name.keyword
DEBUG 2025/12/17 17:30:00 Time From: 2025-12-17T17:29:00.000+08:00
DEBUG 2025/12/17 17:30:00 Time To: 2025-12-17T17:30:00.000+08:00
DEBUG 2025/12/17 17:30:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:29:00.000+08:00",
					"lte": "2025-12-17T17:30:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:30:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:30:00 ES Response IsError: false
DEBUG 2025/12/17 17:30:00 ES Response Body:
{"took":67,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":398,"buckets":[{"key":"員林高中","doc_count":1817},{"key":"黑快馬主機","doc_count":750},{"key":"花蓮高農","doc_count":698},{"key":"仁愛高農","doc_count":502},{"key":"新竹女中","doc_count":499},{"key":"金門高中","doc_count":440},{"key":"金門農工","doc_count":398},{"key":"北門高中","doc_count":371},{"key":"臺東高中","doc_count":340},{"key":"華僑高中","doc_count":329},{"key":"竹北高中","doc_count":301},{"key":"蘇澳海事","doc_count":275},{"key":"宜蘭高商","doc_count":272},{"key":"中大壢中","doc_count":267},{"key":"南投高商","doc_count":245},{"key":"興大附中","doc_count":233},{"key":"關西高中","doc_count":201},{"key":"新港藝高","doc_count":196},{"key":"虎尾高中","doc_count":191},{"key":"內埔農工","doc_count":189},{"key":"後壁高中","doc_count":180},{"key":"花蓮高商","doc_count":180},{"key":"旗美高中","doc_count":178},{"key":"清華附小","doc_count":174},{"key":"斗六家商","doc_count":173},{"key":"竹南高中","doc_count":171},{"key":"關山工商","doc_count":152},{"key":"政大附中","doc_count":142},{"key":"苗栗農工","doc_count":142},{"key":"宜蘭高中","doc_count":138},{"key":"彰師附工","doc_count":132},{"key":"屏東女中","doc_count":127},{"key":"玉里高中","doc_count":127},{"key":"新營高中","doc_count":126},{"key":"嘉義高商","doc_count":124},{"key":"蘭陽女中","doc_count":123},{"key":"永靖高工","doc_count":122},{"key":"南投特教","doc_count":117},{"key":"土庫商工","doc_count":114},{"key":"員林家商","doc_count":111},{"key":"新化高中","doc_count":109},{"key":"東港海事","doc_count":106},{"key":"新化高工","doc_count":98},{"key":"新營高工","doc_count":97},{"key":"嘉義高中","doc_count":95},{"key":"南投高中","doc_count":93},{"key":"成大南工","doc_count":88},{"key":"南大附聰","doc_count":85},{"key":"臺東高商","doc_count":83},{"key":"師大附中高中部","doc_count":82},{"key":"鳳山高中","doc_count":82},{"key":"北教大實小","doc_count":78},{"key":"屏東高中","doc_count":77},{"key":"新竹高工","doc_count":73},{"key":"屏科實中","doc_count":71},{"key":"員林農工","doc_count":70},{"key":"屏東高工","doc_count":70},{"key":"基隆商工","doc_count":68},{"key":"興大附農","doc_count":68},{"key":"彰化高商","doc_count":65},{"key":"暨大附中","doc_count":65},{"key":"頭城家商","doc_count":61},{"key":"花蓮特教","doc_count":60},{"key":"海大附中","doc_count":59},{"key":"臺東女中","doc_count":59},{"key":"南大附中","doc_count":57},{"key":"嘉科實中","doc_count":55},{"key":"臺南一中","doc_count":55},{"key":"北斗家商","doc_count":54},{"key":"雲林特教","doc_count":54},{"key":"埔里高工","doc_count":53},{"key":"屏東特教","doc_count":52},{"key":"澎湖海事","doc_count":49},{"key":"東石高中","doc_count":47},{"key":"曾文農工","doc_count":46},{"key":"臺南高商","doc_count":46},{"key":"苗栗高商","doc_count":44},{"key":"崇實高工","doc_count":42},{"key":"華南高商","doc_count":42},{"key":"水里商工","doc_count":41},{"key":"北港高中","doc_count":39},{"key":"竹東高中","doc_count":39},{"key":"新竹特教","doc_count":38},{"key":"潮州高中","doc_count":38},{"key":"二林工商","doc_count":36},{"key":"佳冬高農","doc_count":35},{"key":"旗山農工","doc_count":35},{"key":"白河商工","doc_count":35},{"key":"中興高中","doc_count":34},{"key":"師大附中國中部","doc_count":34},{"key":"溪湖高中","doc_count":34},{"key":"苗栗高中","doc_count":34},{"key":"草屯商工","doc_count":34},{"key":"高餐大附中","doc_count":34},{"key":"善化高中","doc_count":33},{"key":"嘉義高工","doc_count":33},{"key":"新竹高商","doc_count":33},{"key":"秀水高工","doc_count":33},{"key":"嘉義特教","doc_count":32},{"key":"北港農工","doc_count":31}]}}}
DEBUG 2025/12/17 17:30:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:30:00   Bucket[0]: Key=員林高中, DocCount=1817
DEBUG 2025/12/17 17:30:00   Bucket[1]: Key=黑快馬主機, DocCount=750
DEBUG 2025/12/17 17:30:00   Bucket[2]: Key=花蓮高農, DocCount=698
DEBUG 2025/12/17 17:30:00   Bucket[3]: Key=仁愛高農, DocCount=502
DEBUG 2025/12/17 17:30:00   Bucket[4]: Key=新竹女中, DocCount=499
DEBUG 2025/12/17 17:30:00   Bucket[5]: Key=金門高中, DocCount=440
DEBUG 2025/12/17 17:30:00   Bucket[6]: Key=金門農工, DocCount=398
DEBUG 2025/12/17 17:30:00   Bucket[7]: Key=北門高中, DocCount=371
DEBUG 2025/12/17 17:30:00   Bucket[8]: Key=臺東高中, DocCount=340
DEBUG 2025/12/17 17:30:00   Bucket[9]: Key=華僑高中, DocCount=329
DEBUG 2025/12/17 17:30:00   Bucket[10]: Key=竹北高中, DocCount=301
DEBUG 2025/12/17 17:30:00   Bucket[11]: Key=蘇澳海事, DocCount=275
DEBUG 2025/12/17 17:30:00   Bucket[12]: Key=宜蘭高商, DocCount=272
DEBUG 2025/12/17 17:30:00   Bucket[13]: Key=中大壢中, DocCount=267
DEBUG 2025/12/17 17:30:00   Bucket[14]: Key=南投高商, DocCount=245
DEBUG 2025/12/17 17:30:00   Bucket[15]: Key=興大附中, DocCount=233
DEBUG 2025/12/17 17:30:00   Bucket[16]: Key=關西高中, DocCount=201
DEBUG 2025/12/17 17:30:00   Bucket[17]: Key=新港藝高, DocCount=196
DEBUG 2025/12/17 17:30:00   Bucket[18]: Key=虎尾高中, DocCount=191
DEBUG 2025/12/17 17:30:00   Bucket[19]: Key=內埔農工, DocCount=189
DEBUG 2025/12/17 17:30:00   Bucket[20]: Key=後壁高中, DocCount=180
DEBUG 2025/12/17 17:30:00   Bucket[21]: Key=花蓮高商, DocCount=180
DEBUG 2025/12/17 17:30:00   Bucket[22]: Key=旗美高中, DocCount=178
DEBUG 2025/12/17 17:30:00   Bucket[23]: Key=清華附小, DocCount=174
DEBUG 2025/12/17 17:30:00   Bucket[24]: Key=斗六家商, DocCount=173
DEBUG 2025/12/17 17:30:00   Bucket[25]: Key=竹南高中, DocCount=171
DEBUG 2025/12/17 17:30:00   Bucket[26]: Key=關山工商, DocCount=152
DEBUG 2025/12/17 17:30:00   Bucket[27]: Key=政大附中, DocCount=142
DEBUG 2025/12/17 17:30:00   Bucket[28]: Key=苗栗農工, DocCount=142
DEBUG 2025/12/17 17:30:00   Bucket[29]: Key=宜蘭高中, DocCount=138
DEBUG 2025/12/17 17:30:00   Bucket[30]: Key=彰師附工, DocCount=132
DEBUG 2025/12/17 17:30:00   Bucket[31]: Key=屏東女中, DocCount=127
DEBUG 2025/12/17 17:30:00   Bucket[32]: Key=玉里高中, DocCount=127
DEBUG 2025/12/17 17:30:00   Bucket[33]: Key=新營高中, DocCount=126
DEBUG 2025/12/17 17:30:00   Bucket[34]: Key=嘉義高商, DocCount=124
DEBUG 2025/12/17 17:30:00   Bucket[35]: Key=蘭陽女中, DocCount=123
DEBUG 2025/12/17 17:30:00   Bucket[36]: Key=永靖高工, DocCount=122
DEBUG 2025/12/17 17:30:00   Bucket[37]: Key=南投特教, DocCount=117
DEBUG 2025/12/17 17:30:00   Bucket[38]: Key=土庫商工, DocCount=114
DEBUG 2025/12/17 17:30:00   Bucket[39]: Key=員林家商, DocCount=111
DEBUG 2025/12/17 17:30:00   Bucket[40]: Key=新化高中, DocCount=109
DEBUG 2025/12/17 17:30:00   Bucket[41]: Key=東港海事, DocCount=106
DEBUG 2025/12/17 17:30:00   Bucket[42]: Key=新化高工, DocCount=98
DEBUG 2025/12/17 17:30:00   Bucket[43]: Key=新營高工, DocCount=97
DEBUG 2025/12/17 17:30:00   Bucket[44]: Key=嘉義高中, DocCount=95
DEBUG 2025/12/17 17:30:00   Bucket[45]: Key=南投高中, DocCount=93
DEBUG 2025/12/17 17:30:00   Bucket[46]: Key=成大南工, DocCount=88
DEBUG 2025/12/17 17:30:00   Bucket[47]: Key=南大附聰, DocCount=85
DEBUG 2025/12/17 17:30:00   Bucket[48]: Key=臺東高商, DocCount=83
DEBUG 2025/12/17 17:30:00   Bucket[49]: Key=師大附中高中部, DocCount=82
DEBUG 2025/12/17 17:30:00   Bucket[50]: Key=鳳山高中, DocCount=82
DEBUG 2025/12/17 17:30:00   Bucket[51]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 17:30:00   Bucket[52]: Key=屏東高中, DocCount=77
DEBUG 2025/12/17 17:30:00   Bucket[53]: Key=新竹高工, DocCount=73
DEBUG 2025/12/17 17:30:00   Bucket[54]: Key=屏科實中, DocCount=71
DEBUG 2025/12/17 17:30:00   Bucket[55]: Key=員林農工, DocCount=70
DEBUG 2025/12/17 17:30:00   Bucket[56]: Key=屏東高工, DocCount=70
DEBUG 2025/12/17 17:30:00   Bucket[57]: Key=基隆商工, DocCount=68
DEBUG 2025/12/17 17:30:00   Bucket[58]: Key=興大附農, DocCount=68
DEBUG 2025/12/17 17:30:00   Bucket[59]: Key=彰化高商, DocCount=65
DEBUG 2025/12/17 17:30:00   Bucket[60]: Key=暨大附中, DocCount=65
DEBUG 2025/12/17 17:30:00   Bucket[61]: Key=頭城家商, DocCount=61
DEBUG 2025/12/17 17:30:00   Bucket[62]: Key=花蓮特教, DocCount=60
DEBUG 2025/12/17 17:30:00   Bucket[63]: Key=海大附中, DocCount=59
DEBUG 2025/12/17 17:30:00   Bucket[64]: Key=臺東女中, DocCount=59
DEBUG 2025/12/17 17:30:00   Bucket[65]: Key=南大附中, DocCount=57
DEBUG 2025/12/17 17:30:00   Bucket[66]: Key=嘉科實中, DocCount=55
DEBUG 2025/12/17 17:30:00   Bucket[67]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:30:00   Bucket[68]: Key=北斗家商, DocCount=54
DEBUG 2025/12/17 17:30:00   Bucket[69]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:30:00   Bucket[70]: Key=埔里高工, DocCount=53
DEBUG 2025/12/17 17:30:00   Bucket[71]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 17:30:00   Bucket[72]: Key=澎湖海事, DocCount=49
DEBUG 2025/12/17 17:30:00   Bucket[73]: Key=東石高中, DocCount=47
DEBUG 2025/12/17 17:30:00   Bucket[74]: Key=曾文農工, DocCount=46
DEBUG 2025/12/17 17:30:00   Bucket[75]: Key=臺南高商, DocCount=46
DEBUG 2025/12/17 17:30:00   Bucket[76]: Key=苗栗高商, DocCount=44
DEBUG 2025/12/17 17:30:00   Bucket[77]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:30:00   Bucket[78]: Key=華南高商, DocCount=42
DEBUG 2025/12/17 17:30:00   Bucket[79]: Key=水里商工, DocCount=41
DEBUG 2025/12/17 17:30:00   Bucket[80]: Key=北港高中, DocCount=39
DEBUG 2025/12/17 17:30:00   Bucket[81]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 17:30:00   Bucket[82]: Key=新竹特教, DocCount=38
DEBUG 2025/12/17 17:30:00   Bucket[83]: Key=潮州高中, DocCount=38
DEBUG 2025/12/17 17:30:00   Bucket[84]: Key=二林工商, DocCount=36
DEBUG 2025/12/17 17:30:00   Bucket[85]: Key=佳冬高農, DocCount=35
DEBUG 2025/12/17 17:30:00   Bucket[86]: Key=旗山農工, DocCount=35
DEBUG 2025/12/17 17:30:00   Bucket[87]: Key=白河商工, DocCount=35
DEBUG 2025/12/17 17:30:00   Bucket[88]: Key=中興高中, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[89]: Key=師大附中國中部, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[90]: Key=溪湖高中, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[91]: Key=苗栗高中, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[92]: Key=草屯商工, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[93]: Key=高餐大附中, DocCount=34
DEBUG 2025/12/17 17:30:00   Bucket[94]: Key=善化高中, DocCount=33
DEBUG 2025/12/17 17:30:00   Bucket[95]: Key=嘉義高工, DocCount=33
DEBUG 2025/12/17 17:30:00   Bucket[96]: Key=新竹高商, DocCount=33
DEBUG 2025/12/17 17:30:00   Bucket[97]: Key=秀水高工, DocCount=33
DEBUG 2025/12/17 17:30:00   Bucket[98]: Key=嘉義特教, DocCount=32
DEBUG 2025/12/17 17:30:00   Bucket[99]: Key=北港農工, DocCount=31
DEBUG 2025/12/17 17:30:00 ========================================================
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:30:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:30:07 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:30:08 ✅ Successfully flushed 31/31 history records to TimescaleDB
INFO 2025/12/17 17:30:08 Processing 15 offline devices
INFO 2025/12/17 17:30:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:30:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:30:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:30:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:30:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:30:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:30:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:30:09 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:30:09 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:30:09 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:30:09 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:30:09 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:30:09 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:30:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:30:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:30:09 Creating history record for offline device: 花蓮高工
INFO 2025/12/17 17:30:09 About to add history to batch for device: 花蓮高工
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 花蓮高工
INFO 2025/12/17 17:30:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:30:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:30:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:30:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:30:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:30:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:30:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:30:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:30:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:30:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:30:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:30:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:30:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:30:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:30:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:30:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:30:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:30:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:30:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:30:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:30:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:30:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:30:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:30:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:30:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:30:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:30:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:30:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:30:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:30:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:30:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:30:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:30:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:30:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:30:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:30:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:30:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:30:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:30:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:30:45 ES Alert Created [critical][performance]: Memory usage critical: 90.22% (threshold: 90.00%)
DEBUG 2025/12/17 17:30:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.44% (threshold: 85.00%)
DEBUG 2025/12/17 17:30:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:30:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:30:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:30:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:30:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:30:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:30:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:31:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:31:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:31:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:31:00 Field: school_name.keyword
DEBUG 2025/12/17 17:31:00 Time From: 2025-12-17T17:30:00.000+08:00
DEBUG 2025/12/17 17:31:00 Time To: 2025-12-17T17:31:00.000+08:00
DEBUG 2025/12/17 17:31:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:30:00.000+08:00",
					"lte": "2025-12-17T17:31:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:31:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:31:00 ES Response IsError: false
DEBUG 2025/12/17 17:31:00 ES Response Body:
{"took":73,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":372,"buckets":[{"key":"黑快馬主機","doc_count":847},{"key":"花蓮高農","doc_count":710},{"key":"仁愛高農","doc_count":575},{"key":"新竹女中","doc_count":559},{"key":"金門高中","doc_count":463},{"key":"南投高商","doc_count":403},{"key":"金門農工","doc_count":403},{"key":"華僑高中","doc_count":388},{"key":"北門高中","doc_count":373},{"key":"竹北高中","doc_count":312},{"key":"興大附中","doc_count":298},{"key":"虎尾高中","doc_count":264},{"key":"宜蘭高商","doc_count":250},{"key":"蘇澳海事","doc_count":242},{"key":"臺東高中","doc_count":239},{"key":"花蓮高商","doc_count":216},{"key":"內埔農工","doc_count":212},{"key":"苗栗農工","doc_count":210},{"key":"員林高中","doc_count":204},{"key":"竹南高中","doc_count":185},{"key":"旗美高中","doc_count":181},{"key":"中大壢中","doc_count":173},{"key":"清華附小","doc_count":168},{"key":"關山工商","doc_count":167},{"key":"斗六家商","doc_count":166},{"key":"關西高中","doc_count":161},{"key":"後壁高中","doc_count":159},{"key":"南投特教","doc_count":156},{"key":"新港藝高","doc_count":153},{"key":"玉里高中","doc_count":129},{"key":"南投高中","doc_count":124},{"key":"宜蘭高中","doc_count":118},{"key":"屏東特教","doc_count":112},{"key":"新營高工","doc_count":112},{"key":"南大附聰","doc_count":111},{"key":"屏東高工","doc_count":109},{"key":"嘉義高商","doc_count":107},{"key":"嘉科實中","doc_count":104},{"key":"屏東女中","doc_count":102},{"key":"臺東女中","doc_count":100},{"key":"員林家商","doc_count":99},{"key":"新化高工","doc_count":97},{"key":"興大附農","doc_count":97},{"key":"彰師附工","doc_count":91},{"key":"政大附中","doc_count":91},{"key":"海大附中","doc_count":91},{"key":"花蓮高工","doc_count":90},{"key":"中興高中","doc_count":88},{"key":"師大附中高中部","doc_count":84},{"key":"土庫商工","doc_count":82},{"key":"新竹高中","doc_count":78},{"key":"新化高中","doc_count":77},{"key":"東港海事","doc_count":75},{"key":"臺東高商","doc_count":73},{"key":"新竹高工","doc_count":72},{"key":"基隆商工","doc_count":70},{"key":"屏科實中","doc_count":70},{"key":"苗栗高中","doc_count":69},{"key":"鳳山高中","doc_count":68},{"key":"新營高中","doc_count":66},{"key":"雲林特教","doc_count":66},{"key":"嘉義高中","doc_count":62},{"key":"屏東高中","doc_count":60},{"key":"新竹高商","doc_count":60},{"key":"水里商工","doc_count":60},{"key":"曾文農工","doc_count":57},{"key":"澎湖海事","doc_count":57},{"key":"苗栗高商","doc_count":57},{"key":"嘉義家職","doc_count":56},{"key":"蘭陽女中","doc_count":56},{"key":"溪湖高中","doc_count":55},{"key":"臺南一中","doc_count":55},{"key":"新豐高中","doc_count":54},{"key":"潮州高中","doc_count":54},{"key":"北教大實小","doc_count":53},{"key":"臺南高商","doc_count":51},{"key":"北斗家商","doc_count":49},{"key":"花蓮高中","doc_count":48},{"key":"白河商工","doc_count":47},{"key":"高餐大附中","doc_count":47},{"key":"崇實高工","doc_count":46},{"key":"成大南工","doc_count":46},{"key":"彰化高商","doc_count":45},{"key":"羅東高商","doc_count":45},{"key":"華南高商","doc_count":45},{"key":"竹東高中","doc_count":44},{"key":"北港高中","doc_count":43},{"key":"員林農工","doc_count":43},{"key":"東石高中","doc_count":43},{"key":"竹山高中","doc_count":41},{"key":"善化高中","doc_count":40},{"key":"秀水高工","doc_count":40},{"key":"花蓮特教","doc_count":40},{"key":"永靖高工","doc_count":38},{"key":"埔里高工","doc_count":37},{"key":"佳冬高農","doc_count":36},{"key":"北港農工","doc_count":36},{"key":"頭城家商","doc_count":31},{"key":"南大附中","doc_count":28},{"key":"師大附中國中部","doc_count":28}]}}}
DEBUG 2025/12/17 17:31:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:31:00   Bucket[0]: Key=黑快馬主機, DocCount=847
DEBUG 2025/12/17 17:31:00   Bucket[1]: Key=花蓮高農, DocCount=710
DEBUG 2025/12/17 17:31:00   Bucket[2]: Key=仁愛高農, DocCount=575
DEBUG 2025/12/17 17:31:00   Bucket[3]: Key=新竹女中, DocCount=559
DEBUG 2025/12/17 17:31:00   Bucket[4]: Key=金門高中, DocCount=463
DEBUG 2025/12/17 17:31:00   Bucket[5]: Key=南投高商, DocCount=403
DEBUG 2025/12/17 17:31:00   Bucket[6]: Key=金門農工, DocCount=403
DEBUG 2025/12/17 17:31:00   Bucket[7]: Key=華僑高中, DocCount=388
DEBUG 2025/12/17 17:31:00   Bucket[8]: Key=北門高中, DocCount=373
DEBUG 2025/12/17 17:31:00   Bucket[9]: Key=竹北高中, DocCount=312
DEBUG 2025/12/17 17:31:00   Bucket[10]: Key=興大附中, DocCount=298
DEBUG 2025/12/17 17:31:00   Bucket[11]: Key=虎尾高中, DocCount=264
DEBUG 2025/12/17 17:31:00   Bucket[12]: Key=宜蘭高商, DocCount=250
DEBUG 2025/12/17 17:31:00   Bucket[13]: Key=蘇澳海事, DocCount=242
DEBUG 2025/12/17 17:31:00   Bucket[14]: Key=臺東高中, DocCount=239
DEBUG 2025/12/17 17:31:00   Bucket[15]: Key=花蓮高商, DocCount=216
DEBUG 2025/12/17 17:31:00   Bucket[16]: Key=內埔農工, DocCount=212
DEBUG 2025/12/17 17:31:00   Bucket[17]: Key=苗栗農工, DocCount=210
DEBUG 2025/12/17 17:31:00   Bucket[18]: Key=員林高中, DocCount=204
DEBUG 2025/12/17 17:31:00   Bucket[19]: Key=竹南高中, DocCount=185
DEBUG 2025/12/17 17:31:00   Bucket[20]: Key=旗美高中, DocCount=181
DEBUG 2025/12/17 17:31:00   Bucket[21]: Key=中大壢中, DocCount=173
DEBUG 2025/12/17 17:31:00   Bucket[22]: Key=清華附小, DocCount=168
DEBUG 2025/12/17 17:31:00   Bucket[23]: Key=關山工商, DocCount=167
DEBUG 2025/12/17 17:31:00   Bucket[24]: Key=斗六家商, DocCount=166
DEBUG 2025/12/17 17:31:00   Bucket[25]: Key=關西高中, DocCount=161
DEBUG 2025/12/17 17:31:00   Bucket[26]: Key=後壁高中, DocCount=159
DEBUG 2025/12/17 17:31:00   Bucket[27]: Key=南投特教, DocCount=156
DEBUG 2025/12/17 17:31:00   Bucket[28]: Key=新港藝高, DocCount=153
DEBUG 2025/12/17 17:31:00   Bucket[29]: Key=玉里高中, DocCount=129
DEBUG 2025/12/17 17:31:00   Bucket[30]: Key=南投高中, DocCount=124
DEBUG 2025/12/17 17:31:00   Bucket[31]: Key=宜蘭高中, DocCount=118
DEBUG 2025/12/17 17:31:00   Bucket[32]: Key=屏東特教, DocCount=112
DEBUG 2025/12/17 17:31:00   Bucket[33]: Key=新營高工, DocCount=112
DEBUG 2025/12/17 17:31:00   Bucket[34]: Key=南大附聰, DocCount=111
DEBUG 2025/12/17 17:31:00   Bucket[35]: Key=屏東高工, DocCount=109
DEBUG 2025/12/17 17:31:00   Bucket[36]: Key=嘉義高商, DocCount=107
DEBUG 2025/12/17 17:31:00   Bucket[37]: Key=嘉科實中, DocCount=104
DEBUG 2025/12/17 17:31:00   Bucket[38]: Key=屏東女中, DocCount=102
DEBUG 2025/12/17 17:31:00   Bucket[39]: Key=臺東女中, DocCount=100
DEBUG 2025/12/17 17:31:00   Bucket[40]: Key=員林家商, DocCount=99
DEBUG 2025/12/17 17:31:00   Bucket[41]: Key=新化高工, DocCount=97
DEBUG 2025/12/17 17:31:00   Bucket[42]: Key=興大附農, DocCount=97
DEBUG 2025/12/17 17:31:00   Bucket[43]: Key=彰師附工, DocCount=91
DEBUG 2025/12/17 17:31:00   Bucket[44]: Key=政大附中, DocCount=91
DEBUG 2025/12/17 17:31:00   Bucket[45]: Key=海大附中, DocCount=91
DEBUG 2025/12/17 17:31:00   Bucket[46]: Key=花蓮高工, DocCount=90
DEBUG 2025/12/17 17:31:00   Bucket[47]: Key=中興高中, DocCount=88
DEBUG 2025/12/17 17:31:00   Bucket[48]: Key=師大附中高中部, DocCount=84
DEBUG 2025/12/17 17:31:00   Bucket[49]: Key=土庫商工, DocCount=82
DEBUG 2025/12/17 17:31:00   Bucket[50]: Key=新竹高中, DocCount=78
DEBUG 2025/12/17 17:31:00   Bucket[51]: Key=新化高中, DocCount=77
DEBUG 2025/12/17 17:31:00   Bucket[52]: Key=東港海事, DocCount=75
DEBUG 2025/12/17 17:31:00   Bucket[53]: Key=臺東高商, DocCount=73
DEBUG 2025/12/17 17:31:00   Bucket[54]: Key=新竹高工, DocCount=72
DEBUG 2025/12/17 17:31:00   Bucket[55]: Key=基隆商工, DocCount=70
DEBUG 2025/12/17 17:31:00   Bucket[56]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:31:00   Bucket[57]: Key=苗栗高中, DocCount=69
DEBUG 2025/12/17 17:31:00   Bucket[58]: Key=鳳山高中, DocCount=68
DEBUG 2025/12/17 17:31:00   Bucket[59]: Key=新營高中, DocCount=66
DEBUG 2025/12/17 17:31:00   Bucket[60]: Key=雲林特教, DocCount=66
DEBUG 2025/12/17 17:31:00   Bucket[61]: Key=嘉義高中, DocCount=62
DEBUG 2025/12/17 17:31:00   Bucket[62]: Key=屏東高中, DocCount=60
DEBUG 2025/12/17 17:31:00   Bucket[63]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:31:00   Bucket[64]: Key=水里商工, DocCount=60
DEBUG 2025/12/17 17:31:00   Bucket[65]: Key=曾文農工, DocCount=57
DEBUG 2025/12/17 17:31:00   Bucket[66]: Key=澎湖海事, DocCount=57
DEBUG 2025/12/17 17:31:00   Bucket[67]: Key=苗栗高商, DocCount=57
DEBUG 2025/12/17 17:31:00   Bucket[68]: Key=嘉義家職, DocCount=56
DEBUG 2025/12/17 17:31:00   Bucket[69]: Key=蘭陽女中, DocCount=56
DEBUG 2025/12/17 17:31:00   Bucket[70]: Key=溪湖高中, DocCount=55
DEBUG 2025/12/17 17:31:00   Bucket[71]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:31:00   Bucket[72]: Key=新豐高中, DocCount=54
DEBUG 2025/12/17 17:31:00   Bucket[73]: Key=潮州高中, DocCount=54
DEBUG 2025/12/17 17:31:00   Bucket[74]: Key=北教大實小, DocCount=53
DEBUG 2025/12/17 17:31:00   Bucket[75]: Key=臺南高商, DocCount=51
DEBUG 2025/12/17 17:31:00   Bucket[76]: Key=北斗家商, DocCount=49
DEBUG 2025/12/17 17:31:00   Bucket[77]: Key=花蓮高中, DocCount=48
DEBUG 2025/12/17 17:31:00   Bucket[78]: Key=白河商工, DocCount=47
DEBUG 2025/12/17 17:31:00   Bucket[79]: Key=高餐大附中, DocCount=47
DEBUG 2025/12/17 17:31:00   Bucket[80]: Key=崇實高工, DocCount=46
DEBUG 2025/12/17 17:31:00   Bucket[81]: Key=成大南工, DocCount=46
DEBUG 2025/12/17 17:31:00   Bucket[82]: Key=彰化高商, DocCount=45
DEBUG 2025/12/17 17:31:00   Bucket[83]: Key=羅東高商, DocCount=45
DEBUG 2025/12/17 17:31:00   Bucket[84]: Key=華南高商, DocCount=45
DEBUG 2025/12/17 17:31:00   Bucket[85]: Key=竹東高中, DocCount=44
DEBUG 2025/12/17 17:31:00   Bucket[86]: Key=北港高中, DocCount=43
DEBUG 2025/12/17 17:31:00   Bucket[87]: Key=員林農工, DocCount=43
DEBUG 2025/12/17 17:31:00   Bucket[88]: Key=東石高中, DocCount=43
DEBUG 2025/12/17 17:31:00   Bucket[89]: Key=竹山高中, DocCount=41
DEBUG 2025/12/17 17:31:00   Bucket[90]: Key=善化高中, DocCount=40
DEBUG 2025/12/17 17:31:00   Bucket[91]: Key=秀水高工, DocCount=40
DEBUG 2025/12/17 17:31:00   Bucket[92]: Key=花蓮特教, DocCount=40
DEBUG 2025/12/17 17:31:00   Bucket[93]: Key=永靖高工, DocCount=38
DEBUG 2025/12/17 17:31:00   Bucket[94]: Key=埔里高工, DocCount=37
DEBUG 2025/12/17 17:31:00   Bucket[95]: Key=佳冬高農, DocCount=36
DEBUG 2025/12/17 17:31:00   Bucket[96]: Key=北港農工, DocCount=36
DEBUG 2025/12/17 17:31:00   Bucket[97]: Key=頭城家商, DocCount=31
DEBUG 2025/12/17 17:31:00   Bucket[98]: Key=南大附中, DocCount=28
DEBUG 2025/12/17 17:31:00   Bucket[99]: Key=師大附中國中部, DocCount=28
DEBUG 2025/12/17 17:31:00 ========================================================
INFO 2025/12/17 17:31:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:31:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:31:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:31:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:31:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:31:08 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:31:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:31:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:31:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:31:08 ✅ Successfully flushed 5/5 history records to TimescaleDB
INFO 2025/12/17 17:31:09 Processing 15 offline devices
INFO 2025/12/17 17:31:09 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:31:09 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:31:09 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:31:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:31:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:31:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:31:09 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:31:09 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:31:09 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:31:09 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:31:09 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:31:09 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:31:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:31:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:31:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:31:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:31:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:31:10 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:31:10 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:31:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:31:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:31:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:31:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:31:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:31:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:31:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:31:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:31:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:31:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:31:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:31:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:31:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:31:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:31:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:31:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:31:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:31:13 ✅ Successfully flushed 43/43 history records to TimescaleDB
DEBUG 2025/12/17 17:31:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:31:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:31:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:31:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:31:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:31:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:31:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:31:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:31:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:31:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:31:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:31:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:31:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:31:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:31:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:31:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:31:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:31:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:31:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:31:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:31:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:31:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:31:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:31:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.63% (threshold: 80.00%)
DEBUG 2025/12/17 17:31:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.48% (threshold: 85.00%)
DEBUG 2025/12/17 17:31:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:31:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:31:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:31:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:31:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:31:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:31:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:32:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:32:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:32:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:32:00 Field: school_name.keyword
DEBUG 2025/12/17 17:32:00 Time From: 2025-12-17T17:31:00.000+08:00
DEBUG 2025/12/17 17:32:00 Time To: 2025-12-17T17:32:00.000+08:00
DEBUG 2025/12/17 17:32:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:31:00.000+08:00",
					"lte": "2025-12-17T17:32:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:32:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:32:00 ES Response IsError: false
DEBUG 2025/12/17 17:32:00 ES Response Body:
{"took":71,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":422,"buckets":[{"key":"黑快馬主機","doc_count":1752},{"key":"花蓮高農","doc_count":677},{"key":"仁愛高農","doc_count":635},{"key":"新竹女中","doc_count":515},{"key":"金門高中","doc_count":488},{"key":"金門農工","doc_count":478},{"key":"北門高中","doc_count":421},{"key":"玉里高中","doc_count":417},{"key":"華僑高中","doc_count":365},{"key":"南投高商","doc_count":343},{"key":"宜蘭高商","doc_count":291},{"key":"竹北高中","doc_count":290},{"key":"蘇澳海事","doc_count":283},{"key":"臺東高中","doc_count":253},{"key":"興大附中","doc_count":245},{"key":"新港藝高","doc_count":214},{"key":"內埔農工","doc_count":202},{"key":"清華附小","doc_count":194},{"key":"新竹高工","doc_count":193},{"key":"關山工商","doc_count":193},{"key":"關西高中","doc_count":191},{"key":"虎尾高中","doc_count":186},{"key":"南投高中","doc_count":169},{"key":"屏東特教","doc_count":169},{"key":"竹南高中","doc_count":169},{"key":"苗栗農工","doc_count":161},{"key":"嘉義高商","doc_count":155},{"key":"旗美高中","doc_count":146},{"key":"後壁高中","doc_count":145},{"key":"斗六家商","doc_count":143},{"key":"花蓮高商","doc_count":142},{"key":"花蓮高工","doc_count":141},{"key":"南投特教","doc_count":132},{"key":"新營高工","doc_count":127},{"key":"新化高工","doc_count":122},{"key":"員林農工","doc_count":119},{"key":"屏東女中","doc_count":116},{"key":"中大壢中","doc_count":112},{"key":"員林家商","doc_count":110},{"key":"新化高中","doc_count":109},{"key":"嘉義高中","doc_count":106},{"key":"南大附聰","doc_count":105},{"key":"永靖高工","doc_count":105},{"key":"宜蘭高中","doc_count":98},{"key":"師大附中高中部","doc_count":98},{"key":"鳳山高中","doc_count":97},{"key":"臺東高商","doc_count":95},{"key":"彰師附工","doc_count":94},{"key":"東港海事","doc_count":91},{"key":"新竹高商","doc_count":90},{"key":"彰化高商","doc_count":89},{"key":"新營高中","doc_count":87},{"key":"崇實高工","doc_count":86},{"key":"屏科實中","doc_count":78},{"key":"成大南工","doc_count":74},{"key":"北港高中","doc_count":71},{"key":"臺東女中","doc_count":71},{"key":"潮州高中","doc_count":70},{"key":"北教大實小","doc_count":69},{"key":"臺南高商","doc_count":69},{"key":"水里商工","doc_count":65},{"key":"嘉義家職","doc_count":64},{"key":"苗栗高商","doc_count":64},{"key":"頭城家商","doc_count":64},{"key":"嘉科實中","doc_count":62},{"key":"蘭陽女中","doc_count":60},{"key":"屏東高工","doc_count":58},{"key":"東石高中","doc_count":58},{"key":"高餐大附中","doc_count":57},{"key":"竹山高中","doc_count":55},{"key":"羅東高商","doc_count":55},{"key":"北港農工","doc_count":53},{"key":"華南高商","doc_count":51},{"key":"興大附農","doc_count":50},{"key":"苗栗高中","doc_count":50},{"key":"雲林特教","doc_count":50},{"key":"屏東高中","doc_count":49},{"key":"暨大附中","doc_count":49},{"key":"曾文農工","doc_count":46},{"key":"北斗家商","doc_count":45},{"key":"家齊高中","doc_count":45},{"key":"新竹高中","doc_count":45},{"key":"海大附中","doc_count":45},{"key":"善化高中","doc_count":44},{"key":"基隆商工","doc_count":44},{"key":"臺南一中","doc_count":44},{"key":"師大附中國中部","doc_count":43},{"key":"溪湖高中","doc_count":42},{"key":"澎湖海事","doc_count":39},{"key":"竹東高中","doc_count":39},{"key":"屏北高中","doc_count":38},{"key":"中興高中","doc_count":37},{"key":"秀水高工","doc_count":37},{"key":"花蓮特教","doc_count":37},{"key":"南大附小","doc_count":36},{"key":"玉井工商","doc_count":36},{"key":"白河商工","doc_count":36},{"key":"旗山農工","doc_count":35},{"key":"羅東高工","doc_count":35},{"key":"花蓮高中","doc_count":35}]}}}
DEBUG 2025/12/17 17:32:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:32:00   Bucket[0]: Key=黑快馬主機, DocCount=1752
DEBUG 2025/12/17 17:32:00   Bucket[1]: Key=花蓮高農, DocCount=677
DEBUG 2025/12/17 17:32:00   Bucket[2]: Key=仁愛高農, DocCount=635
DEBUG 2025/12/17 17:32:00   Bucket[3]: Key=新竹女中, DocCount=515
DEBUG 2025/12/17 17:32:00   Bucket[4]: Key=金門高中, DocCount=488
DEBUG 2025/12/17 17:32:00   Bucket[5]: Key=金門農工, DocCount=478
DEBUG 2025/12/17 17:32:00   Bucket[6]: Key=北門高中, DocCount=421
DEBUG 2025/12/17 17:32:00   Bucket[7]: Key=玉里高中, DocCount=417
DEBUG 2025/12/17 17:32:00   Bucket[8]: Key=華僑高中, DocCount=365
DEBUG 2025/12/17 17:32:00   Bucket[9]: Key=南投高商, DocCount=343
DEBUG 2025/12/17 17:32:00   Bucket[10]: Key=宜蘭高商, DocCount=291
DEBUG 2025/12/17 17:32:00   Bucket[11]: Key=竹北高中, DocCount=290
DEBUG 2025/12/17 17:32:00   Bucket[12]: Key=蘇澳海事, DocCount=283
DEBUG 2025/12/17 17:32:00   Bucket[13]: Key=臺東高中, DocCount=253
DEBUG 2025/12/17 17:32:00   Bucket[14]: Key=興大附中, DocCount=245
DEBUG 2025/12/17 17:32:00   Bucket[15]: Key=新港藝高, DocCount=214
DEBUG 2025/12/17 17:32:00   Bucket[16]: Key=內埔農工, DocCount=202
DEBUG 2025/12/17 17:32:00   Bucket[17]: Key=清華附小, DocCount=194
DEBUG 2025/12/17 17:32:00   Bucket[18]: Key=新竹高工, DocCount=193
DEBUG 2025/12/17 17:32:00   Bucket[19]: Key=關山工商, DocCount=193
DEBUG 2025/12/17 17:32:00   Bucket[20]: Key=關西高中, DocCount=191
DEBUG 2025/12/17 17:32:00   Bucket[21]: Key=虎尾高中, DocCount=186
DEBUG 2025/12/17 17:32:00   Bucket[22]: Key=南投高中, DocCount=169
DEBUG 2025/12/17 17:32:00   Bucket[23]: Key=屏東特教, DocCount=169
DEBUG 2025/12/17 17:32:00   Bucket[24]: Key=竹南高中, DocCount=169
DEBUG 2025/12/17 17:32:00   Bucket[25]: Key=苗栗農工, DocCount=161
DEBUG 2025/12/17 17:32:00   Bucket[26]: Key=嘉義高商, DocCount=155
DEBUG 2025/12/17 17:32:00   Bucket[27]: Key=旗美高中, DocCount=146
DEBUG 2025/12/17 17:32:00   Bucket[28]: Key=後壁高中, DocCount=145
DEBUG 2025/12/17 17:32:00   Bucket[29]: Key=斗六家商, DocCount=143
DEBUG 2025/12/17 17:32:00   Bucket[30]: Key=花蓮高商, DocCount=142
DEBUG 2025/12/17 17:32:00   Bucket[31]: Key=花蓮高工, DocCount=141
DEBUG 2025/12/17 17:32:00   Bucket[32]: Key=南投特教, DocCount=132
DEBUG 2025/12/17 17:32:00   Bucket[33]: Key=新營高工, DocCount=127
DEBUG 2025/12/17 17:32:00   Bucket[34]: Key=新化高工, DocCount=122
DEBUG 2025/12/17 17:32:00   Bucket[35]: Key=員林農工, DocCount=119
DEBUG 2025/12/17 17:32:00   Bucket[36]: Key=屏東女中, DocCount=116
DEBUG 2025/12/17 17:32:00   Bucket[37]: Key=中大壢中, DocCount=112
DEBUG 2025/12/17 17:32:00   Bucket[38]: Key=員林家商, DocCount=110
DEBUG 2025/12/17 17:32:00   Bucket[39]: Key=新化高中, DocCount=109
DEBUG 2025/12/17 17:32:00   Bucket[40]: Key=嘉義高中, DocCount=106
DEBUG 2025/12/17 17:32:00   Bucket[41]: Key=南大附聰, DocCount=105
DEBUG 2025/12/17 17:32:00   Bucket[42]: Key=永靖高工, DocCount=105
DEBUG 2025/12/17 17:32:00   Bucket[43]: Key=宜蘭高中, DocCount=98
DEBUG 2025/12/17 17:32:00   Bucket[44]: Key=師大附中高中部, DocCount=98
DEBUG 2025/12/17 17:32:00   Bucket[45]: Key=鳳山高中, DocCount=97
DEBUG 2025/12/17 17:32:00   Bucket[46]: Key=臺東高商, DocCount=95
DEBUG 2025/12/17 17:32:00   Bucket[47]: Key=彰師附工, DocCount=94
DEBUG 2025/12/17 17:32:00   Bucket[48]: Key=東港海事, DocCount=91
DEBUG 2025/12/17 17:32:00   Bucket[49]: Key=新竹高商, DocCount=90
DEBUG 2025/12/17 17:32:00   Bucket[50]: Key=彰化高商, DocCount=89
DEBUG 2025/12/17 17:32:00   Bucket[51]: Key=新營高中, DocCount=87
DEBUG 2025/12/17 17:32:00   Bucket[52]: Key=崇實高工, DocCount=86
DEBUG 2025/12/17 17:32:00   Bucket[53]: Key=屏科實中, DocCount=78
DEBUG 2025/12/17 17:32:00   Bucket[54]: Key=成大南工, DocCount=74
DEBUG 2025/12/17 17:32:00   Bucket[55]: Key=北港高中, DocCount=71
DEBUG 2025/12/17 17:32:00   Bucket[56]: Key=臺東女中, DocCount=71
DEBUG 2025/12/17 17:32:00   Bucket[57]: Key=潮州高中, DocCount=70
DEBUG 2025/12/17 17:32:00   Bucket[58]: Key=北教大實小, DocCount=69
DEBUG 2025/12/17 17:32:00   Bucket[59]: Key=臺南高商, DocCount=69
DEBUG 2025/12/17 17:32:00   Bucket[60]: Key=水里商工, DocCount=65
DEBUG 2025/12/17 17:32:00   Bucket[61]: Key=嘉義家職, DocCount=64
DEBUG 2025/12/17 17:32:00   Bucket[62]: Key=苗栗高商, DocCount=64
DEBUG 2025/12/17 17:32:00   Bucket[63]: Key=頭城家商, DocCount=64
DEBUG 2025/12/17 17:32:00   Bucket[64]: Key=嘉科實中, DocCount=62
DEBUG 2025/12/17 17:32:00   Bucket[65]: Key=蘭陽女中, DocCount=60
DEBUG 2025/12/17 17:32:00   Bucket[66]: Key=屏東高工, DocCount=58
DEBUG 2025/12/17 17:32:00   Bucket[67]: Key=東石高中, DocCount=58
DEBUG 2025/12/17 17:32:00   Bucket[68]: Key=高餐大附中, DocCount=57
DEBUG 2025/12/17 17:32:00   Bucket[69]: Key=竹山高中, DocCount=55
DEBUG 2025/12/17 17:32:00   Bucket[70]: Key=羅東高商, DocCount=55
DEBUG 2025/12/17 17:32:00   Bucket[71]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:32:00   Bucket[72]: Key=華南高商, DocCount=51
DEBUG 2025/12/17 17:32:00   Bucket[73]: Key=興大附農, DocCount=50
DEBUG 2025/12/17 17:32:00   Bucket[74]: Key=苗栗高中, DocCount=50
DEBUG 2025/12/17 17:32:00   Bucket[75]: Key=雲林特教, DocCount=50
DEBUG 2025/12/17 17:32:00   Bucket[76]: Key=屏東高中, DocCount=49
DEBUG 2025/12/17 17:32:00   Bucket[77]: Key=暨大附中, DocCount=49
DEBUG 2025/12/17 17:32:00   Bucket[78]: Key=曾文農工, DocCount=46
DEBUG 2025/12/17 17:32:00   Bucket[79]: Key=北斗家商, DocCount=45
DEBUG 2025/12/17 17:32:00   Bucket[80]: Key=家齊高中, DocCount=45
DEBUG 2025/12/17 17:32:00   Bucket[81]: Key=新竹高中, DocCount=45
DEBUG 2025/12/17 17:32:00   Bucket[82]: Key=海大附中, DocCount=45
DEBUG 2025/12/17 17:32:00   Bucket[83]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:32:00   Bucket[84]: Key=基隆商工, DocCount=44
DEBUG 2025/12/17 17:32:00   Bucket[85]: Key=臺南一中, DocCount=44
DEBUG 2025/12/17 17:32:00   Bucket[86]: Key=師大附中國中部, DocCount=43
DEBUG 2025/12/17 17:32:00   Bucket[87]: Key=溪湖高中, DocCount=42
DEBUG 2025/12/17 17:32:00   Bucket[88]: Key=澎湖海事, DocCount=39
DEBUG 2025/12/17 17:32:00   Bucket[89]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 17:32:00   Bucket[90]: Key=屏北高中, DocCount=38
DEBUG 2025/12/17 17:32:00   Bucket[91]: Key=中興高中, DocCount=37
DEBUG 2025/12/17 17:32:00   Bucket[92]: Key=秀水高工, DocCount=37
DEBUG 2025/12/17 17:32:00   Bucket[93]: Key=花蓮特教, DocCount=37
DEBUG 2025/12/17 17:32:00   Bucket[94]: Key=南大附小, DocCount=36
DEBUG 2025/12/17 17:32:00   Bucket[95]: Key=玉井工商, DocCount=36
DEBUG 2025/12/17 17:32:00   Bucket[96]: Key=白河商工, DocCount=36
DEBUG 2025/12/17 17:32:00   Bucket[97]: Key=旗山農工, DocCount=35
DEBUG 2025/12/17 17:32:00   Bucket[98]: Key=羅東高工, DocCount=35
DEBUG 2025/12/17 17:32:00   Bucket[99]: Key=花蓮高中, DocCount=35
DEBUG 2025/12/17 17:32:00 ========================================================
INFO 2025/12/17 17:32:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:32:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:32:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:32:08 ✅ Successfully flushed 2/2 history records to TimescaleDB
INFO 2025/12/17 17:32:10 Processing 15 offline devices
INFO 2025/12/17 17:32:10 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:32:10 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:32:10 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:32:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:32:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:32:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:32:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:32:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:32:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:32:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:32:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:32:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:32:10 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:32:10 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:32:11 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:32:11 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:32:11 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:32:11 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:32:11 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:32:11 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:32:11 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:32:11 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:32:11 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:32:11 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:32:11 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:32:11 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:32:11 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:32:11 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:32:11 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:32:11 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:32:11 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:32:11 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:32:11 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:32:11 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:32:11 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:32:13 ✅ Successfully flushed 48/48 history records to TimescaleDB
DEBUG 2025/12/17 17:32:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:32:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:32:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:32:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:32:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:32:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:32:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:32:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:32:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:32:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:32:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:32:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:32:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:32:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:32:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:32:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:32:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:32:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:32:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:32:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.73% (threshold: 80.00%)
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.51% (threshold: 85.00%)
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:32:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:32:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:32:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:32:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:32:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:32:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:32:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:33:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:33:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:33:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:33:00 Field: school_name.keyword
DEBUG 2025/12/17 17:33:00 Time From: 2025-12-17T17:32:00.000+08:00
DEBUG 2025/12/17 17:33:00 Time To: 2025-12-17T17:33:00.000+08:00
DEBUG 2025/12/17 17:33:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:32:00.000+08:00",
					"lte": "2025-12-17T17:33:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:33:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:33:00 ES Response IsError: false
DEBUG 2025/12/17 17:33:00 ES Response Body:
{"took":59,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":402,"buckets":[{"key":"黑快馬主機","doc_count":1005},{"key":"花蓮高農","doc_count":742},{"key":"金門農工","doc_count":555},{"key":"仁愛高農","doc_count":550},{"key":"金門高中","doc_count":529},{"key":"新竹女中","doc_count":493},{"key":"華僑高中","doc_count":452},{"key":"南投高商","doc_count":449},{"key":"北門高中","doc_count":368},{"key":"宜蘭高商","doc_count":312},{"key":"臺東高中","doc_count":261},{"key":"蘇澳海事","doc_count":245},{"key":"後壁高中","doc_count":238},{"key":"竹北高中","doc_count":237},{"key":"嘉義高商","doc_count":231},{"key":"興大附中","doc_count":227},{"key":"斗六家商","doc_count":208},{"key":"新港藝高","doc_count":202},{"key":"內埔農工","doc_count":182},{"key":"清華附小","doc_count":182},{"key":"苗栗高中","doc_count":176},{"key":"關山工商","doc_count":176},{"key":"竹南高中","doc_count":174},{"key":"新竹高工","doc_count":165},{"key":"關西高中","doc_count":162},{"key":"新化高工","doc_count":156},{"key":"花蓮高商","doc_count":156},{"key":"旗美高中","doc_count":145},{"key":"中大壢中","doc_count":143},{"key":"政大附中","doc_count":138},{"key":"南投特教","doc_count":137},{"key":"玉里高中","doc_count":131},{"key":"苗栗農工","doc_count":128},{"key":"新營高工","doc_count":121},{"key":"員林農工","doc_count":120},{"key":"宜蘭高中","doc_count":118},{"key":"員林家商","doc_count":115},{"key":"虎尾高中","doc_count":115},{"key":"新化高中","doc_count":114},{"key":"屏東女中","doc_count":113},{"key":"南大附聰","doc_count":107},{"key":"北教大實小","doc_count":105},{"key":"花蓮高工","doc_count":98},{"key":"草屯商工","doc_count":93},{"key":"新營高中","doc_count":87},{"key":"東港海事","doc_count":87},{"key":"鳳山高中","doc_count":87},{"key":"嘉義家職","doc_count":85},{"key":"師大附中高中部","doc_count":85},{"key":"彰化高商","doc_count":85},{"key":"彰師附工","doc_count":85},{"key":"興大附農","doc_count":84},{"key":"中興高中","doc_count":83},{"key":"屏科實中","doc_count":80},{"key":"臺南一中","doc_count":80},{"key":"屏東高中","doc_count":77},{"key":"北港高中","doc_count":73},{"key":"苗栗高商","doc_count":73},{"key":"南投高中","doc_count":67},{"key":"崇實高工","doc_count":65},{"key":"竹東高中","doc_count":64},{"key":"潮州高中","doc_count":62},{"key":"嘉義高中","doc_count":61},{"key":"高餐大附中","doc_count":59},{"key":"嘉義高工","doc_count":58},{"key":"屏東特教","doc_count":55},{"key":"海大附中","doc_count":54},{"key":"蘭陽女中","doc_count":54},{"key":"花蓮高中","doc_count":53},{"key":"二林工商","doc_count":52},{"key":"曾文農工","doc_count":52},{"key":"東石高中","doc_count":52},{"key":"羅東高商","doc_count":50},{"key":"華南高商","doc_count":50},{"key":"屏東高工","doc_count":49},{"key":"臺南高商","doc_count":49},{"key":"嘉科實中","doc_count":48},{"key":"新豐高中","doc_count":48},{"key":"澎湖海事","doc_count":48},{"key":"白河商工","doc_count":48},{"key":"雲林特教","doc_count":48},{"key":"新竹高商","doc_count":47},{"key":"臺東女中","doc_count":46},{"key":"水里商工","doc_count":45},{"key":"臺東高商","doc_count":45},{"key":"土庫商工","doc_count":44},{"key":"新竹高中","doc_count":44},{"key":"竹山高中","doc_count":44},{"key":"北斗家商","doc_count":42},{"key":"成大南工","doc_count":42},{"key":"善化高中","doc_count":41},{"key":"旗山農工","doc_count":39},{"key":"玉井工商","doc_count":38},{"key":"嘉義特教","doc_count":37},{"key":"花蓮特教","doc_count":37},{"key":"南大附中","doc_count":36},{"key":"溪湖高中","doc_count":36},{"key":"家齊高中","doc_count":34},{"key":"羅東高工","doc_count":34},{"key":"頭城家商","doc_count":34}]}}}
DEBUG 2025/12/17 17:33:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:33:00   Bucket[0]: Key=黑快馬主機, DocCount=1005
DEBUG 2025/12/17 17:33:00   Bucket[1]: Key=花蓮高農, DocCount=742
DEBUG 2025/12/17 17:33:00   Bucket[2]: Key=金門農工, DocCount=555
DEBUG 2025/12/17 17:33:00   Bucket[3]: Key=仁愛高農, DocCount=550
DEBUG 2025/12/17 17:33:00   Bucket[4]: Key=金門高中, DocCount=529
DEBUG 2025/12/17 17:33:00   Bucket[5]: Key=新竹女中, DocCount=493
DEBUG 2025/12/17 17:33:00   Bucket[6]: Key=華僑高中, DocCount=452
DEBUG 2025/12/17 17:33:00   Bucket[7]: Key=南投高商, DocCount=449
DEBUG 2025/12/17 17:33:00   Bucket[8]: Key=北門高中, DocCount=368
DEBUG 2025/12/17 17:33:00   Bucket[9]: Key=宜蘭高商, DocCount=312
DEBUG 2025/12/17 17:33:00   Bucket[10]: Key=臺東高中, DocCount=261
DEBUG 2025/12/17 17:33:00   Bucket[11]: Key=蘇澳海事, DocCount=245
DEBUG 2025/12/17 17:33:00   Bucket[12]: Key=後壁高中, DocCount=238
DEBUG 2025/12/17 17:33:00   Bucket[13]: Key=竹北高中, DocCount=237
DEBUG 2025/12/17 17:33:00   Bucket[14]: Key=嘉義高商, DocCount=231
DEBUG 2025/12/17 17:33:00   Bucket[15]: Key=興大附中, DocCount=227
DEBUG 2025/12/17 17:33:00   Bucket[16]: Key=斗六家商, DocCount=208
DEBUG 2025/12/17 17:33:00   Bucket[17]: Key=新港藝高, DocCount=202
DEBUG 2025/12/17 17:33:00   Bucket[18]: Key=內埔農工, DocCount=182
DEBUG 2025/12/17 17:33:00   Bucket[19]: Key=清華附小, DocCount=182
DEBUG 2025/12/17 17:33:00   Bucket[20]: Key=苗栗高中, DocCount=176
DEBUG 2025/12/17 17:33:00   Bucket[21]: Key=關山工商, DocCount=176
DEBUG 2025/12/17 17:33:00   Bucket[22]: Key=竹南高中, DocCount=174
DEBUG 2025/12/17 17:33:00   Bucket[23]: Key=新竹高工, DocCount=165
DEBUG 2025/12/17 17:33:00   Bucket[24]: Key=關西高中, DocCount=162
DEBUG 2025/12/17 17:33:00   Bucket[25]: Key=新化高工, DocCount=156
DEBUG 2025/12/17 17:33:00   Bucket[26]: Key=花蓮高商, DocCount=156
DEBUG 2025/12/17 17:33:00   Bucket[27]: Key=旗美高中, DocCount=145
DEBUG 2025/12/17 17:33:00   Bucket[28]: Key=中大壢中, DocCount=143
DEBUG 2025/12/17 17:33:00   Bucket[29]: Key=政大附中, DocCount=138
DEBUG 2025/12/17 17:33:00   Bucket[30]: Key=南投特教, DocCount=137
DEBUG 2025/12/17 17:33:00   Bucket[31]: Key=玉里高中, DocCount=131
DEBUG 2025/12/17 17:33:00   Bucket[32]: Key=苗栗農工, DocCount=128
DEBUG 2025/12/17 17:33:00   Bucket[33]: Key=新營高工, DocCount=121
DEBUG 2025/12/17 17:33:00   Bucket[34]: Key=員林農工, DocCount=120
DEBUG 2025/12/17 17:33:00   Bucket[35]: Key=宜蘭高中, DocCount=118
DEBUG 2025/12/17 17:33:00   Bucket[36]: Key=員林家商, DocCount=115
DEBUG 2025/12/17 17:33:00   Bucket[37]: Key=虎尾高中, DocCount=115
DEBUG 2025/12/17 17:33:00   Bucket[38]: Key=新化高中, DocCount=114
DEBUG 2025/12/17 17:33:00   Bucket[39]: Key=屏東女中, DocCount=113
DEBUG 2025/12/17 17:33:00   Bucket[40]: Key=南大附聰, DocCount=107
DEBUG 2025/12/17 17:33:00   Bucket[41]: Key=北教大實小, DocCount=105
DEBUG 2025/12/17 17:33:00   Bucket[42]: Key=花蓮高工, DocCount=98
DEBUG 2025/12/17 17:33:00   Bucket[43]: Key=草屯商工, DocCount=93
DEBUG 2025/12/17 17:33:00   Bucket[44]: Key=新營高中, DocCount=87
DEBUG 2025/12/17 17:33:00   Bucket[45]: Key=東港海事, DocCount=87
DEBUG 2025/12/17 17:33:00   Bucket[46]: Key=鳳山高中, DocCount=87
DEBUG 2025/12/17 17:33:00   Bucket[47]: Key=嘉義家職, DocCount=85
DEBUG 2025/12/17 17:33:00   Bucket[48]: Key=師大附中高中部, DocCount=85
DEBUG 2025/12/17 17:33:00   Bucket[49]: Key=彰化高商, DocCount=85
DEBUG 2025/12/17 17:33:00   Bucket[50]: Key=彰師附工, DocCount=85
DEBUG 2025/12/17 17:33:00   Bucket[51]: Key=興大附農, DocCount=84
DEBUG 2025/12/17 17:33:00   Bucket[52]: Key=中興高中, DocCount=83
DEBUG 2025/12/17 17:33:00   Bucket[53]: Key=屏科實中, DocCount=80
DEBUG 2025/12/17 17:33:00   Bucket[54]: Key=臺南一中, DocCount=80
DEBUG 2025/12/17 17:33:00   Bucket[55]: Key=屏東高中, DocCount=77
DEBUG 2025/12/17 17:33:00   Bucket[56]: Key=北港高中, DocCount=73
DEBUG 2025/12/17 17:33:00   Bucket[57]: Key=苗栗高商, DocCount=73
DEBUG 2025/12/17 17:33:00   Bucket[58]: Key=南投高中, DocCount=67
DEBUG 2025/12/17 17:33:00   Bucket[59]: Key=崇實高工, DocCount=65
DEBUG 2025/12/17 17:33:00   Bucket[60]: Key=竹東高中, DocCount=64
DEBUG 2025/12/17 17:33:00   Bucket[61]: Key=潮州高中, DocCount=62
DEBUG 2025/12/17 17:33:00   Bucket[62]: Key=嘉義高中, DocCount=61
DEBUG 2025/12/17 17:33:00   Bucket[63]: Key=高餐大附中, DocCount=59
DEBUG 2025/12/17 17:33:00   Bucket[64]: Key=嘉義高工, DocCount=58
DEBUG 2025/12/17 17:33:00   Bucket[65]: Key=屏東特教, DocCount=55
DEBUG 2025/12/17 17:33:00   Bucket[66]: Key=海大附中, DocCount=54
DEBUG 2025/12/17 17:33:00   Bucket[67]: Key=蘭陽女中, DocCount=54
DEBUG 2025/12/17 17:33:00   Bucket[68]: Key=花蓮高中, DocCount=53
DEBUG 2025/12/17 17:33:00   Bucket[69]: Key=二林工商, DocCount=52
DEBUG 2025/12/17 17:33:00   Bucket[70]: Key=曾文農工, DocCount=52
DEBUG 2025/12/17 17:33:00   Bucket[71]: Key=東石高中, DocCount=52
DEBUG 2025/12/17 17:33:00   Bucket[72]: Key=羅東高商, DocCount=50
DEBUG 2025/12/17 17:33:00   Bucket[73]: Key=華南高商, DocCount=50
DEBUG 2025/12/17 17:33:00   Bucket[74]: Key=屏東高工, DocCount=49
DEBUG 2025/12/17 17:33:00   Bucket[75]: Key=臺南高商, DocCount=49
DEBUG 2025/12/17 17:33:00   Bucket[76]: Key=嘉科實中, DocCount=48
DEBUG 2025/12/17 17:33:00   Bucket[77]: Key=新豐高中, DocCount=48
DEBUG 2025/12/17 17:33:00   Bucket[78]: Key=澎湖海事, DocCount=48
DEBUG 2025/12/17 17:33:00   Bucket[79]: Key=白河商工, DocCount=48
DEBUG 2025/12/17 17:33:00   Bucket[80]: Key=雲林特教, DocCount=48
DEBUG 2025/12/17 17:33:00   Bucket[81]: Key=新竹高商, DocCount=47
DEBUG 2025/12/17 17:33:00   Bucket[82]: Key=臺東女中, DocCount=46
DEBUG 2025/12/17 17:33:00   Bucket[83]: Key=水里商工, DocCount=45
DEBUG 2025/12/17 17:33:00   Bucket[84]: Key=臺東高商, DocCount=45
DEBUG 2025/12/17 17:33:00   Bucket[85]: Key=土庫商工, DocCount=44
DEBUG 2025/12/17 17:33:00   Bucket[86]: Key=新竹高中, DocCount=44
DEBUG 2025/12/17 17:33:00   Bucket[87]: Key=竹山高中, DocCount=44
DEBUG 2025/12/17 17:33:00   Bucket[88]: Key=北斗家商, DocCount=42
DEBUG 2025/12/17 17:33:00   Bucket[89]: Key=成大南工, DocCount=42
DEBUG 2025/12/17 17:33:00   Bucket[90]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:33:00   Bucket[91]: Key=旗山農工, DocCount=39
DEBUG 2025/12/17 17:33:00   Bucket[92]: Key=玉井工商, DocCount=38
DEBUG 2025/12/17 17:33:00   Bucket[93]: Key=嘉義特教, DocCount=37
DEBUG 2025/12/17 17:33:00   Bucket[94]: Key=花蓮特教, DocCount=37
DEBUG 2025/12/17 17:33:00   Bucket[95]: Key=南大附中, DocCount=36
DEBUG 2025/12/17 17:33:00   Bucket[96]: Key=溪湖高中, DocCount=36
DEBUG 2025/12/17 17:33:00   Bucket[97]: Key=家齊高中, DocCount=34
DEBUG 2025/12/17 17:33:00   Bucket[98]: Key=羅東高工, DocCount=34
DEBUG 2025/12/17 17:33:00   Bucket[99]: Key=頭城家商, DocCount=34
DEBUG 2025/12/17 17:33:00 ========================================================
INFO 2025/12/17 17:33:08 ✅ Successfully flushed 50/50 history records to TimescaleDB
INFO 2025/12/17 17:33:08 ✅ Successfully flushed 50/0 history records to TimescaleDB
INFO 2025/12/17 17:33:11 Processing 15 offline devices
INFO 2025/12/17 17:33:11 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:33:11 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:33:11 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:33:11 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:33:11 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:33:11 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:33:11 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:33:11 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:33:11 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:33:11 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:33:11 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:33:11 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:33:11 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:33:11 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:33:11 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:33:11 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:33:11 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:33:11 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:33:11 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:33:11 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:33:11 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:33:11 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:33:11 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:33:11 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:33:11 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:33:11 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:33:11 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:33:11 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:33:12 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:33:12 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:33:12 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:33:12 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:33:12 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:33:12 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:33:12 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:33:12 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:33:12 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:33:12 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:33:12 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:33:12 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:33:12 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:33:12 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:33:12 ✅ Successfully flushed 57/1 history records to TimescaleDB
DEBUG 2025/12/17 17:33:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:33:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:33:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:33:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:33:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:33:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:33:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:33:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:33:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:33:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:33:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:33:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:33:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:33:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:33:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:33:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:33:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:33:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:33:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:33:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:33:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:33:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:33:45 ES Alert Created [high][performance]: Memory usage high: 89.75% (threshold: 80.00%)
INFO 2025/12/17 17:33:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:33:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.51% (threshold: 85.00%)
DEBUG 2025/12/17 17:33:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:33:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:33:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:33:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:33:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:33:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:33:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:34:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:34:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:34:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:34:00 Field: school_name.keyword
DEBUG 2025/12/17 17:34:00 Time From: 2025-12-17T17:33:00.000+08:00
DEBUG 2025/12/17 17:34:00 Time To: 2025-12-17T17:34:00.000+08:00
DEBUG 2025/12/17 17:34:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:33:00.000+08:00",
					"lte": "2025-12-17T17:34:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:34:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:34:00 ES Response IsError: false
DEBUG 2025/12/17 17:34:00 ES Response Body:
{"took":68,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":430,"buckets":[{"key":"黑快馬主機","doc_count":1147},{"key":"花蓮高農","doc_count":1026},{"key":"金門農工","doc_count":582},{"key":"仁愛高農","doc_count":577},{"key":"新竹女中","doc_count":512},{"key":"金門高中","doc_count":501},{"key":"華僑高中","doc_count":395},{"key":"北門高中","doc_count":373},{"key":"蘇澳海事","doc_count":331},{"key":"南投高商","doc_count":326},{"key":"宜蘭高商","doc_count":312},{"key":"嘉義高商","doc_count":305},{"key":"竹北高中","doc_count":304},{"key":"內埔農工","doc_count":254},{"key":"臺東高中","doc_count":234},{"key":"興大附中","doc_count":231},{"key":"斗六家商","doc_count":217},{"key":"中大壢中","doc_count":195},{"key":"清華附小","doc_count":194},{"key":"後壁高中","doc_count":193},{"key":"竹南高中","doc_count":192},{"key":"新化高工","doc_count":186},{"key":"關西高中","doc_count":180},{"key":"新港藝高","doc_count":177},{"key":"玉里高中","doc_count":177},{"key":"苗栗高中","doc_count":177},{"key":"屏東女中","doc_count":171},{"key":"中興高中","doc_count":169},{"key":"南投高中","doc_count":161},{"key":"關山工商","doc_count":160},{"key":"南投特教","doc_count":152},{"key":"花蓮高商","doc_count":149},{"key":"新竹高工","doc_count":139},{"key":"旗美高中","doc_count":138},{"key":"苗栗農工","doc_count":138},{"key":"宜蘭高中","doc_count":135},{"key":"新營高工","doc_count":124},{"key":"花蓮高工","doc_count":122},{"key":"北港高中","doc_count":120},{"key":"員林家商","doc_count":113},{"key":"新化高中","doc_count":112},{"key":"彰化高商","doc_count":111},{"key":"東港海事","doc_count":105},{"key":"虎尾高中","doc_count":102},{"key":"鳳山高中","doc_count":97},{"key":"北教大實小","doc_count":96},{"key":"新營高中","doc_count":96},{"key":"彰師附工","doc_count":95},{"key":"南大附聰","doc_count":88},{"key":"屏東高中","doc_count":84},{"key":"屏東高工","doc_count":80},{"key":"頭城家商","doc_count":79},{"key":"嘉義家職","doc_count":76},{"key":"崇實高工","doc_count":76},{"key":"屏科實中","doc_count":70},{"key":"師大附中高中部","doc_count":70},{"key":"興大附農","doc_count":70},{"key":"嘉義高中","doc_count":67},{"key":"員林農工","doc_count":66},{"key":"新豐高中","doc_count":66},{"key":"水里商工","doc_count":66},{"key":"澎湖海事","doc_count":65},{"key":"北斗家商","doc_count":64},{"key":"成大南工","doc_count":63},{"key":"臺東高商","doc_count":63},{"key":"新竹高商","doc_count":62},{"key":"臺南高商","doc_count":62},{"key":"二林工商","doc_count":61},{"key":"竹山高中","doc_count":61},{"key":"羅東高商","doc_count":61},{"key":"蘭陽女中","doc_count":59},{"key":"政大附中","doc_count":58},{"key":"花蓮高中","doc_count":58},{"key":"苗栗高商","doc_count":58},{"key":"員林高中","doc_count":55},{"key":"佳冬高農","doc_count":54},{"key":"海大附中","doc_count":53},{"key":"臺南一中","doc_count":50},{"key":"土庫商工","doc_count":49},{"key":"臺東女中","doc_count":49},{"key":"華南高商","doc_count":49},{"key":"高餐大附中","doc_count":48},{"key":"嘉義高工","doc_count":46},{"key":"曾文農工","doc_count":46},{"key":"嘉科實中","doc_count":44},{"key":"屏東特教","doc_count":43},{"key":"溪湖高中","doc_count":43},{"key":"草屯商工","doc_count":43},{"key":"東石高中","doc_count":42},{"key":"雲林特教","doc_count":42},{"key":"潮州高中","doc_count":40},{"key":"師大附中國中部","doc_count":39},{"key":"竹東高中","doc_count":39},{"key":"北港農工","doc_count":38},{"key":"家齊高中","doc_count":36},{"key":"花蓮特教","doc_count":36},{"key":"善化高中","doc_count":35},{"key":"基隆商工","doc_count":34},{"key":"新竹高中","doc_count":34},{"key":"白河商工","doc_count":33}]}}}
DEBUG 2025/12/17 17:34:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:34:00   Bucket[0]: Key=黑快馬主機, DocCount=1147
DEBUG 2025/12/17 17:34:00   Bucket[1]: Key=花蓮高農, DocCount=1026
DEBUG 2025/12/17 17:34:00   Bucket[2]: Key=金門農工, DocCount=582
DEBUG 2025/12/17 17:34:00   Bucket[3]: Key=仁愛高農, DocCount=577
DEBUG 2025/12/17 17:34:00   Bucket[4]: Key=新竹女中, DocCount=512
DEBUG 2025/12/17 17:34:00   Bucket[5]: Key=金門高中, DocCount=501
DEBUG 2025/12/17 17:34:00   Bucket[6]: Key=華僑高中, DocCount=395
DEBUG 2025/12/17 17:34:00   Bucket[7]: Key=北門高中, DocCount=373
DEBUG 2025/12/17 17:34:00   Bucket[8]: Key=蘇澳海事, DocCount=331
DEBUG 2025/12/17 17:34:00   Bucket[9]: Key=南投高商, DocCount=326
DEBUG 2025/12/17 17:34:00   Bucket[10]: Key=宜蘭高商, DocCount=312
DEBUG 2025/12/17 17:34:00   Bucket[11]: Key=嘉義高商, DocCount=305
DEBUG 2025/12/17 17:34:00   Bucket[12]: Key=竹北高中, DocCount=304
DEBUG 2025/12/17 17:34:00   Bucket[13]: Key=內埔農工, DocCount=254
DEBUG 2025/12/17 17:34:00   Bucket[14]: Key=臺東高中, DocCount=234
DEBUG 2025/12/17 17:34:00   Bucket[15]: Key=興大附中, DocCount=231
DEBUG 2025/12/17 17:34:00   Bucket[16]: Key=斗六家商, DocCount=217
DEBUG 2025/12/17 17:34:00   Bucket[17]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:34:00   Bucket[18]: Key=清華附小, DocCount=194
DEBUG 2025/12/17 17:34:00   Bucket[19]: Key=後壁高中, DocCount=193
DEBUG 2025/12/17 17:34:00   Bucket[20]: Key=竹南高中, DocCount=192
DEBUG 2025/12/17 17:34:00   Bucket[21]: Key=新化高工, DocCount=186
DEBUG 2025/12/17 17:34:00   Bucket[22]: Key=關西高中, DocCount=180
DEBUG 2025/12/17 17:34:00   Bucket[23]: Key=新港藝高, DocCount=177
DEBUG 2025/12/17 17:34:00   Bucket[24]: Key=玉里高中, DocCount=177
DEBUG 2025/12/17 17:34:00   Bucket[25]: Key=苗栗高中, DocCount=177
DEBUG 2025/12/17 17:34:00   Bucket[26]: Key=屏東女中, DocCount=171
DEBUG 2025/12/17 17:34:00   Bucket[27]: Key=中興高中, DocCount=169
DEBUG 2025/12/17 17:34:00   Bucket[28]: Key=南投高中, DocCount=161
DEBUG 2025/12/17 17:34:00   Bucket[29]: Key=關山工商, DocCount=160
DEBUG 2025/12/17 17:34:00   Bucket[30]: Key=南投特教, DocCount=152
DEBUG 2025/12/17 17:34:00   Bucket[31]: Key=花蓮高商, DocCount=149
DEBUG 2025/12/17 17:34:00   Bucket[32]: Key=新竹高工, DocCount=139
DEBUG 2025/12/17 17:34:00   Bucket[33]: Key=旗美高中, DocCount=138
DEBUG 2025/12/17 17:34:00   Bucket[34]: Key=苗栗農工, DocCount=138
DEBUG 2025/12/17 17:34:00   Bucket[35]: Key=宜蘭高中, DocCount=135
DEBUG 2025/12/17 17:34:00   Bucket[36]: Key=新營高工, DocCount=124
DEBUG 2025/12/17 17:34:00   Bucket[37]: Key=花蓮高工, DocCount=122
DEBUG 2025/12/17 17:34:00   Bucket[38]: Key=北港高中, DocCount=120
DEBUG 2025/12/17 17:34:00   Bucket[39]: Key=員林家商, DocCount=113
DEBUG 2025/12/17 17:34:00   Bucket[40]: Key=新化高中, DocCount=112
DEBUG 2025/12/17 17:34:00   Bucket[41]: Key=彰化高商, DocCount=111
DEBUG 2025/12/17 17:34:00   Bucket[42]: Key=東港海事, DocCount=105
DEBUG 2025/12/17 17:34:00   Bucket[43]: Key=虎尾高中, DocCount=102
DEBUG 2025/12/17 17:34:00   Bucket[44]: Key=鳳山高中, DocCount=97
DEBUG 2025/12/17 17:34:00   Bucket[45]: Key=北教大實小, DocCount=96
DEBUG 2025/12/17 17:34:00   Bucket[46]: Key=新營高中, DocCount=96
DEBUG 2025/12/17 17:34:00   Bucket[47]: Key=彰師附工, DocCount=95
DEBUG 2025/12/17 17:34:00   Bucket[48]: Key=南大附聰, DocCount=88
DEBUG 2025/12/17 17:34:00   Bucket[49]: Key=屏東高中, DocCount=84
DEBUG 2025/12/17 17:34:00   Bucket[50]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:34:00   Bucket[51]: Key=頭城家商, DocCount=79
DEBUG 2025/12/17 17:34:00   Bucket[52]: Key=嘉義家職, DocCount=76
DEBUG 2025/12/17 17:34:00   Bucket[53]: Key=崇實高工, DocCount=76
DEBUG 2025/12/17 17:34:00   Bucket[54]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:34:00   Bucket[55]: Key=師大附中高中部, DocCount=70
DEBUG 2025/12/17 17:34:00   Bucket[56]: Key=興大附農, DocCount=70
DEBUG 2025/12/17 17:34:00   Bucket[57]: Key=嘉義高中, DocCount=67
DEBUG 2025/12/17 17:34:00   Bucket[58]: Key=員林農工, DocCount=66
DEBUG 2025/12/17 17:34:00   Bucket[59]: Key=新豐高中, DocCount=66
DEBUG 2025/12/17 17:34:00   Bucket[60]: Key=水里商工, DocCount=66
DEBUG 2025/12/17 17:34:00   Bucket[61]: Key=澎湖海事, DocCount=65
DEBUG 2025/12/17 17:34:00   Bucket[62]: Key=北斗家商, DocCount=64
DEBUG 2025/12/17 17:34:00   Bucket[63]: Key=成大南工, DocCount=63
DEBUG 2025/12/17 17:34:00   Bucket[64]: Key=臺東高商, DocCount=63
DEBUG 2025/12/17 17:34:00   Bucket[65]: Key=新竹高商, DocCount=62
DEBUG 2025/12/17 17:34:00   Bucket[66]: Key=臺南高商, DocCount=62
DEBUG 2025/12/17 17:34:00   Bucket[67]: Key=二林工商, DocCount=61
DEBUG 2025/12/17 17:34:00   Bucket[68]: Key=竹山高中, DocCount=61
DEBUG 2025/12/17 17:34:00   Bucket[69]: Key=羅東高商, DocCount=61
DEBUG 2025/12/17 17:34:00   Bucket[70]: Key=蘭陽女中, DocCount=59
DEBUG 2025/12/17 17:34:00   Bucket[71]: Key=政大附中, DocCount=58
DEBUG 2025/12/17 17:34:00   Bucket[72]: Key=花蓮高中, DocCount=58
DEBUG 2025/12/17 17:34:00   Bucket[73]: Key=苗栗高商, DocCount=58
DEBUG 2025/12/17 17:34:00   Bucket[74]: Key=員林高中, DocCount=55
DEBUG 2025/12/17 17:34:00   Bucket[75]: Key=佳冬高農, DocCount=54
DEBUG 2025/12/17 17:34:00   Bucket[76]: Key=海大附中, DocCount=53
DEBUG 2025/12/17 17:34:00   Bucket[77]: Key=臺南一中, DocCount=50
DEBUG 2025/12/17 17:34:00   Bucket[78]: Key=土庫商工, DocCount=49
DEBUG 2025/12/17 17:34:00   Bucket[79]: Key=臺東女中, DocCount=49
DEBUG 2025/12/17 17:34:00   Bucket[80]: Key=華南高商, DocCount=49
DEBUG 2025/12/17 17:34:00   Bucket[81]: Key=高餐大附中, DocCount=48
DEBUG 2025/12/17 17:34:00   Bucket[82]: Key=嘉義高工, DocCount=46
DEBUG 2025/12/17 17:34:00   Bucket[83]: Key=曾文農工, DocCount=46
DEBUG 2025/12/17 17:34:00   Bucket[84]: Key=嘉科實中, DocCount=44
DEBUG 2025/12/17 17:34:00   Bucket[85]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 17:34:00   Bucket[86]: Key=溪湖高中, DocCount=43
DEBUG 2025/12/17 17:34:00   Bucket[87]: Key=草屯商工, DocCount=43
DEBUG 2025/12/17 17:34:00   Bucket[88]: Key=東石高中, DocCount=42
DEBUG 2025/12/17 17:34:00   Bucket[89]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:34:00   Bucket[90]: Key=潮州高中, DocCount=40
DEBUG 2025/12/17 17:34:00   Bucket[91]: Key=師大附中國中部, DocCount=39
DEBUG 2025/12/17 17:34:00   Bucket[92]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 17:34:00   Bucket[93]: Key=北港農工, DocCount=38
DEBUG 2025/12/17 17:34:00   Bucket[94]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:34:00   Bucket[95]: Key=花蓮特教, DocCount=36
DEBUG 2025/12/17 17:34:00   Bucket[96]: Key=善化高中, DocCount=35
DEBUG 2025/12/17 17:34:00   Bucket[97]: Key=基隆商工, DocCount=34
DEBUG 2025/12/17 17:34:00   Bucket[98]: Key=新竹高中, DocCount=34
DEBUG 2025/12/17 17:34:00   Bucket[99]: Key=白河商工, DocCount=33
DEBUG 2025/12/17 17:34:00 ========================================================
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 50/55 history records to TimescaleDB
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:34:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:34:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 17:34:09 Processing 15 offline devices
INFO 2025/12/17 17:34:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:34:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:34:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:34:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:34:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:34:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:34:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:34:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:34:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:34:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:34:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:34:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:34:09 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:34:09 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:34:09 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:34:09 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:34:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:34:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:34:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:34:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:34:10 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:34:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:34:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:34:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:34:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:34:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:34:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:34:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:34:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:34:10 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:34:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 17:34:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:34:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:34:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:34:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:34:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:34:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:34:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:34:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:34:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:34:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:34:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:34:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:34:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:34:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:34:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:34:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:34:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:34:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:34:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:34:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:34:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:34:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:34:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:34:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.58% (threshold: 80.00%)
WARN 2025/12/17 17:34:45 ES Alert Created [high][capacity]: Disk usage high: 93.54% (threshold: 85.00%)
WARN 2025/12/17 17:34:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:34:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:34:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:34:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:34:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:34:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:34:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:34:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:35:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:35:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:35:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:35:00 Field: school_name.keyword
DEBUG 2025/12/17 17:35:00 Time From: 2025-12-17T17:34:00.000+08:00
DEBUG 2025/12/17 17:35:00 Time To: 2025-12-17T17:35:00.000+08:00
DEBUG 2025/12/17 17:35:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:34:00.000+08:00",
					"lte": "2025-12-17T17:35:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:35:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:35:00 ES Response IsError: false
DEBUG 2025/12/17 17:35:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":437,"buckets":[{"key":"黑快馬主機","doc_count":1054},{"key":"花蓮高農","doc_count":1018},{"key":"仁愛高農","doc_count":625},{"key":"金門農工","doc_count":603},{"key":"金門高中","doc_count":525},{"key":"新竹女中","doc_count":456},{"key":"北門高中","doc_count":401},{"key":"華僑高中","doc_count":360},{"key":"竹北高中","doc_count":323},{"key":"宜蘭高商","doc_count":300},{"key":"嘉義高商","doc_count":299},{"key":"南投高商","doc_count":293},{"key":"蘇澳海事","doc_count":284},{"key":"臺東高中","doc_count":262},{"key":"斗六家商","doc_count":256},{"key":"內埔農工","doc_count":254},{"key":"竹南高中","doc_count":244},{"key":"興大附中","doc_count":226},{"key":"關西高中","doc_count":215},{"key":"新港藝高","doc_count":211},{"key":"清華附小","doc_count":187},{"key":"花蓮高商","doc_count":184},{"key":"玉里高中","doc_count":183},{"key":"後壁高中","doc_count":182},{"key":"興大附農","doc_count":182},{"key":"彰師附工","doc_count":181},{"key":"新營高工","doc_count":175},{"key":"新化高工","doc_count":166},{"key":"新化高中","doc_count":162},{"key":"苗栗高中","doc_count":159},{"key":"南投特教","doc_count":156},{"key":"關山工商","doc_count":155},{"key":"旗美高中","doc_count":151},{"key":"中興高中","doc_count":144},{"key":"屏東女中","doc_count":139},{"key":"師大附中高中部","doc_count":137},{"key":"苗栗農工","doc_count":136},{"key":"中大壢中","doc_count":134},{"key":"南大附聰","doc_count":129},{"key":"新營高中","doc_count":125},{"key":"新竹高工","doc_count":125},{"key":"鳳山高中","doc_count":125},{"key":"南投高中","doc_count":115},{"key":"員林家商","doc_count":115},{"key":"虎尾高中","doc_count":109},{"key":"東港海事","doc_count":104},{"key":"屏東高工","doc_count":101},{"key":"彰化高商","doc_count":98},{"key":"苗栗高商","doc_count":93},{"key":"北教大實小","doc_count":86},{"key":"屏科實中","doc_count":82},{"key":"新豐高中","doc_count":81},{"key":"崇實高工","doc_count":74},{"key":"嘉義高中","doc_count":72},{"key":"臺東女中","doc_count":71},{"key":"臺東高商","doc_count":71},{"key":"新竹高商","doc_count":67},{"key":"屏東高中","doc_count":65},{"key":"曾文農工","doc_count":65},{"key":"花蓮高工","doc_count":64},{"key":"北港高中","doc_count":62},{"key":"員林農工","doc_count":62},{"key":"員林高中","doc_count":62},{"key":"羅東高商","doc_count":60},{"key":"澎湖海事","doc_count":58},{"key":"華南高商","doc_count":58},{"key":"嘉義家職","doc_count":57},{"key":"土庫商工","doc_count":55},{"key":"臺南一中","doc_count":53},{"key":"花蓮特教","doc_count":53},{"key":"花蓮高中","doc_count":52},{"key":"草屯商工","doc_count":52},{"key":"家齊高中","doc_count":51},{"key":"新竹高中","doc_count":51},{"key":"海大附中","doc_count":51},{"key":"臺南高商","doc_count":51},{"key":"頭城家商","doc_count":51},{"key":"成大南工","doc_count":48},{"key":"竹東高中","doc_count":48},{"key":"竹山高中","doc_count":47},{"key":"羅東高工","doc_count":47},{"key":"秀水高工","doc_count":46},{"key":"嘉義特教","doc_count":45},{"key":"雲林特教","doc_count":45},{"key":"白河商工","doc_count":43},{"key":"佳冬高農","doc_count":42},{"key":"潮州高中","doc_count":42},{"key":"北斗家商","doc_count":41},{"key":"水里商工","doc_count":41},{"key":"二林工商","doc_count":40},{"key":"嘉科實中","doc_count":40},{"key":"屏北高中","doc_count":40},{"key":"屏東特教","doc_count":40},{"key":"新竹特教","doc_count":40},{"key":"溪湖高中","doc_count":40},{"key":"善化高中","doc_count":37},{"key":"埔里高工","doc_count":37},{"key":"旗山農工","doc_count":37},{"key":"北港農工","doc_count":36},{"key":"南大附小","doc_count":36}]}}}
DEBUG 2025/12/17 17:35:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:35:00   Bucket[0]: Key=黑快馬主機, DocCount=1054
DEBUG 2025/12/17 17:35:00   Bucket[1]: Key=花蓮高農, DocCount=1018
DEBUG 2025/12/17 17:35:00   Bucket[2]: Key=仁愛高農, DocCount=625
DEBUG 2025/12/17 17:35:00   Bucket[3]: Key=金門農工, DocCount=603
DEBUG 2025/12/17 17:35:00   Bucket[4]: Key=金門高中, DocCount=525
DEBUG 2025/12/17 17:35:00   Bucket[5]: Key=新竹女中, DocCount=456
DEBUG 2025/12/17 17:35:00   Bucket[6]: Key=北門高中, DocCount=401
DEBUG 2025/12/17 17:35:00   Bucket[7]: Key=華僑高中, DocCount=360
DEBUG 2025/12/17 17:35:00   Bucket[8]: Key=竹北高中, DocCount=323
DEBUG 2025/12/17 17:35:00   Bucket[9]: Key=宜蘭高商, DocCount=300
DEBUG 2025/12/17 17:35:00   Bucket[10]: Key=嘉義高商, DocCount=299
DEBUG 2025/12/17 17:35:00   Bucket[11]: Key=南投高商, DocCount=293
DEBUG 2025/12/17 17:35:00   Bucket[12]: Key=蘇澳海事, DocCount=284
DEBUG 2025/12/17 17:35:00   Bucket[13]: Key=臺東高中, DocCount=262
DEBUG 2025/12/17 17:35:00   Bucket[14]: Key=斗六家商, DocCount=256
DEBUG 2025/12/17 17:35:00   Bucket[15]: Key=內埔農工, DocCount=254
DEBUG 2025/12/17 17:35:00   Bucket[16]: Key=竹南高中, DocCount=244
DEBUG 2025/12/17 17:35:00   Bucket[17]: Key=興大附中, DocCount=226
DEBUG 2025/12/17 17:35:00   Bucket[18]: Key=關西高中, DocCount=215
DEBUG 2025/12/17 17:35:00   Bucket[19]: Key=新港藝高, DocCount=211
DEBUG 2025/12/17 17:35:00   Bucket[20]: Key=清華附小, DocCount=187
DEBUG 2025/12/17 17:35:00   Bucket[21]: Key=花蓮高商, DocCount=184
DEBUG 2025/12/17 17:35:00   Bucket[22]: Key=玉里高中, DocCount=183
DEBUG 2025/12/17 17:35:00   Bucket[23]: Key=後壁高中, DocCount=182
DEBUG 2025/12/17 17:35:00   Bucket[24]: Key=興大附農, DocCount=182
DEBUG 2025/12/17 17:35:00   Bucket[25]: Key=彰師附工, DocCount=181
DEBUG 2025/12/17 17:35:00   Bucket[26]: Key=新營高工, DocCount=175
DEBUG 2025/12/17 17:35:00   Bucket[27]: Key=新化高工, DocCount=166
DEBUG 2025/12/17 17:35:00   Bucket[28]: Key=新化高中, DocCount=162
DEBUG 2025/12/17 17:35:00   Bucket[29]: Key=苗栗高中, DocCount=159
DEBUG 2025/12/17 17:35:00   Bucket[30]: Key=南投特教, DocCount=156
DEBUG 2025/12/17 17:35:00   Bucket[31]: Key=關山工商, DocCount=155
DEBUG 2025/12/17 17:35:00   Bucket[32]: Key=旗美高中, DocCount=151
DEBUG 2025/12/17 17:35:00   Bucket[33]: Key=中興高中, DocCount=144
DEBUG 2025/12/17 17:35:00   Bucket[34]: Key=屏東女中, DocCount=139
DEBUG 2025/12/17 17:35:00   Bucket[35]: Key=師大附中高中部, DocCount=137
DEBUG 2025/12/17 17:35:00   Bucket[36]: Key=苗栗農工, DocCount=136
DEBUG 2025/12/17 17:35:00   Bucket[37]: Key=中大壢中, DocCount=134
DEBUG 2025/12/17 17:35:00   Bucket[38]: Key=南大附聰, DocCount=129
DEBUG 2025/12/17 17:35:00   Bucket[39]: Key=新營高中, DocCount=125
DEBUG 2025/12/17 17:35:00   Bucket[40]: Key=新竹高工, DocCount=125
DEBUG 2025/12/17 17:35:00   Bucket[41]: Key=鳳山高中, DocCount=125
DEBUG 2025/12/17 17:35:00   Bucket[42]: Key=南投高中, DocCount=115
DEBUG 2025/12/17 17:35:00   Bucket[43]: Key=員林家商, DocCount=115
DEBUG 2025/12/17 17:35:00   Bucket[44]: Key=虎尾高中, DocCount=109
DEBUG 2025/12/17 17:35:00   Bucket[45]: Key=東港海事, DocCount=104
DEBUG 2025/12/17 17:35:00   Bucket[46]: Key=屏東高工, DocCount=101
DEBUG 2025/12/17 17:35:00   Bucket[47]: Key=彰化高商, DocCount=98
DEBUG 2025/12/17 17:35:00   Bucket[48]: Key=苗栗高商, DocCount=93
DEBUG 2025/12/17 17:35:00   Bucket[49]: Key=北教大實小, DocCount=86
DEBUG 2025/12/17 17:35:00   Bucket[50]: Key=屏科實中, DocCount=82
DEBUG 2025/12/17 17:35:00   Bucket[51]: Key=新豐高中, DocCount=81
DEBUG 2025/12/17 17:35:00   Bucket[52]: Key=崇實高工, DocCount=74
DEBUG 2025/12/17 17:35:00   Bucket[53]: Key=嘉義高中, DocCount=72
DEBUG 2025/12/17 17:35:00   Bucket[54]: Key=臺東女中, DocCount=71
DEBUG 2025/12/17 17:35:00   Bucket[55]: Key=臺東高商, DocCount=71
DEBUG 2025/12/17 17:35:00   Bucket[56]: Key=新竹高商, DocCount=67
DEBUG 2025/12/17 17:35:00   Bucket[57]: Key=屏東高中, DocCount=65
DEBUG 2025/12/17 17:35:00   Bucket[58]: Key=曾文農工, DocCount=65
DEBUG 2025/12/17 17:35:00   Bucket[59]: Key=花蓮高工, DocCount=64
DEBUG 2025/12/17 17:35:00   Bucket[60]: Key=北港高中, DocCount=62
DEBUG 2025/12/17 17:35:00   Bucket[61]: Key=員林農工, DocCount=62
DEBUG 2025/12/17 17:35:00   Bucket[62]: Key=員林高中, DocCount=62
DEBUG 2025/12/17 17:35:00   Bucket[63]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 17:35:00   Bucket[64]: Key=澎湖海事, DocCount=58
DEBUG 2025/12/17 17:35:00   Bucket[65]: Key=華南高商, DocCount=58
DEBUG 2025/12/17 17:35:00   Bucket[66]: Key=嘉義家職, DocCount=57
DEBUG 2025/12/17 17:35:00   Bucket[67]: Key=土庫商工, DocCount=55
DEBUG 2025/12/17 17:35:00   Bucket[68]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:35:00   Bucket[69]: Key=花蓮特教, DocCount=53
DEBUG 2025/12/17 17:35:00   Bucket[70]: Key=花蓮高中, DocCount=52
DEBUG 2025/12/17 17:35:00   Bucket[71]: Key=草屯商工, DocCount=52
DEBUG 2025/12/17 17:35:00   Bucket[72]: Key=家齊高中, DocCount=51
DEBUG 2025/12/17 17:35:00   Bucket[73]: Key=新竹高中, DocCount=51
DEBUG 2025/12/17 17:35:00   Bucket[74]: Key=海大附中, DocCount=51
DEBUG 2025/12/17 17:35:00   Bucket[75]: Key=臺南高商, DocCount=51
DEBUG 2025/12/17 17:35:00   Bucket[76]: Key=頭城家商, DocCount=51
DEBUG 2025/12/17 17:35:00   Bucket[77]: Key=成大南工, DocCount=48
DEBUG 2025/12/17 17:35:00   Bucket[78]: Key=竹東高中, DocCount=48
DEBUG 2025/12/17 17:35:00   Bucket[79]: Key=竹山高中, DocCount=47
DEBUG 2025/12/17 17:35:00   Bucket[80]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:35:00   Bucket[81]: Key=秀水高工, DocCount=46
DEBUG 2025/12/17 17:35:00   Bucket[82]: Key=嘉義特教, DocCount=45
DEBUG 2025/12/17 17:35:00   Bucket[83]: Key=雲林特教, DocCount=45
DEBUG 2025/12/17 17:35:00   Bucket[84]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:35:00   Bucket[85]: Key=佳冬高農, DocCount=42
DEBUG 2025/12/17 17:35:00   Bucket[86]: Key=潮州高中, DocCount=42
DEBUG 2025/12/17 17:35:00   Bucket[87]: Key=北斗家商, DocCount=41
DEBUG 2025/12/17 17:35:00   Bucket[88]: Key=水里商工, DocCount=41
DEBUG 2025/12/17 17:35:00   Bucket[89]: Key=二林工商, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[90]: Key=嘉科實中, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[91]: Key=屏北高中, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[92]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[93]: Key=新竹特教, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[94]: Key=溪湖高中, DocCount=40
DEBUG 2025/12/17 17:35:00   Bucket[95]: Key=善化高中, DocCount=37
DEBUG 2025/12/17 17:35:00   Bucket[96]: Key=埔里高工, DocCount=37
DEBUG 2025/12/17 17:35:00   Bucket[97]: Key=旗山農工, DocCount=37
DEBUG 2025/12/17 17:35:00   Bucket[98]: Key=北港農工, DocCount=36
DEBUG 2025/12/17 17:35:00   Bucket[99]: Key=南大附小, DocCount=36
DEBUG 2025/12/17 17:35:00 ========================================================
INFO 2025/12/17 17:35:03 ✅ Successfully flushed 4/4 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 17:35:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:35:08 ✅ Successfully flushed 25/25 history records to TimescaleDB
INFO 2025/12/17 17:35:09 Processing 15 offline devices
INFO 2025/12/17 17:35:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:35:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:35:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:35:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:35:09 Creating history record for offline device: 宜蘭高中
INFO 2025/12/17 17:35:09 About to add history to batch for device: 宜蘭高中
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 宜蘭高中
INFO 2025/12/17 17:35:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:35:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:35:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:35:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:35:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:35:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:35:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:35:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:35:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:35:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:35:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:35:10 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:35:10 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:35:10 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:35:10 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:35:10 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:35:10 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:35:10 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:35:10 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:35:10 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:35:10 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:35:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:35:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:35:10 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:35:10 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:35:10 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:35:13 ✅ Successfully flushed 26/26 history records to TimescaleDB
DEBUG 2025/12/17 17:35:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:35:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:35:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:35:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:35:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:35:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:35:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:35:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:35:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:35:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:35:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:35:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:35:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:35:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:35:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:35:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:35:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:35:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:35:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:35:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:35:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.86% (threshold: 80.00%)
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
INFO 2025/12/17 17:35:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:35:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:35:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:35:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:35:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:35:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:36:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:36:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:36:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:36:00 Field: school_name.keyword
DEBUG 2025/12/17 17:36:00 Time From: 2025-12-17T17:35:00.000+08:00
DEBUG 2025/12/17 17:36:00 Time To: 2025-12-17T17:36:00.000+08:00
DEBUG 2025/12/17 17:36:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:35:00.000+08:00",
					"lte": "2025-12-17T17:36:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:36:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:36:00 ES Response IsError: false
DEBUG 2025/12/17 17:36:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":465,"buckets":[{"key":"黑快馬主機","doc_count":1196},{"key":"花蓮高農","doc_count":962},{"key":"仁愛高農","doc_count":607},{"key":"金門高中","doc_count":578},{"key":"金門農工","doc_count":570},{"key":"新竹女中","doc_count":436},{"key":"北門高中","doc_count":427},{"key":"華僑高中","doc_count":376},{"key":"宜蘭高商","doc_count":370},{"key":"斗六家商","doc_count":340},{"key":"嘉義高商","doc_count":283},{"key":"南投高商","doc_count":281},{"key":"蘇澳海事","doc_count":274},{"key":"關西高中","doc_count":267},{"key":"內埔農工","doc_count":263},{"key":"臺東高中","doc_count":261},{"key":"玉里高中","doc_count":249},{"key":"竹北高中","doc_count":245},{"key":"關山工商","doc_count":227},{"key":"新港藝高","doc_count":218},{"key":"清華附小","doc_count":207},{"key":"新化高工","doc_count":204},{"key":"竹南高中","doc_count":203},{"key":"新營高工","doc_count":194},{"key":"後壁高中","doc_count":193},{"key":"興大附中","doc_count":181},{"key":"苗栗農工","doc_count":179},{"key":"旗美高中","doc_count":177},{"key":"中大壢中","doc_count":174},{"key":"花蓮高商","doc_count":173},{"key":"南大附聰","doc_count":152},{"key":"彰師附工","doc_count":149},{"key":"南投特教","doc_count":147},{"key":"花蓮高工","doc_count":138},{"key":"南投高中","doc_count":136},{"key":"新化高中","doc_count":136},{"key":"屏東女中","doc_count":116},{"key":"虎尾高中","doc_count":116},{"key":"基隆商工","doc_count":113},{"key":"苗栗高中","doc_count":113},{"key":"員林家商","doc_count":106},{"key":"苗栗高商","doc_count":106},{"key":"東港海事","doc_count":105},{"key":"師大附中高中部","doc_count":104},{"key":"臺南高商","doc_count":101},{"key":"水里商工","doc_count":97},{"key":"鳳山高中","doc_count":97},{"key":"彰化高商","doc_count":96},{"key":"新竹高工","doc_count":95},{"key":"新營高中","doc_count":93},{"key":"北教大實小","doc_count":90},{"key":"草屯商工","doc_count":90},{"key":"中興高中","doc_count":87},{"key":"屏科實中","doc_count":85},{"key":"興大附農","doc_count":85},{"key":"旗山農工","doc_count":82},{"key":"高餐大附中","doc_count":82},{"key":"二林工商","doc_count":79},{"key":"屏東高中","doc_count":79},{"key":"花蓮高中","doc_count":73},{"key":"成大南工","doc_count":72},{"key":"北港高中","doc_count":70},{"key":"嘉義高中","doc_count":67},{"key":"玉井工商","doc_count":67},{"key":"員林農工","doc_count":64},{"key":"海大附中","doc_count":64},{"key":"曾文農工","doc_count":63},{"key":"善化高中","doc_count":60},{"key":"嘉義家職","doc_count":60},{"key":"新竹高中","doc_count":59},{"key":"潮州高中","doc_count":59},{"key":"羅東高工","doc_count":55},{"key":"臺東女中","doc_count":55},{"key":"南大附中","doc_count":54},{"key":"政大附中","doc_count":52},{"key":"嘉義特教","doc_count":51},{"key":"宜蘭高中","doc_count":51},{"key":"屏東高工","doc_count":51},{"key":"花蓮特教","doc_count":51},{"key":"嘉科實中","doc_count":50},{"key":"秀水高工","doc_count":49},{"key":"北斗家商","doc_count":48},{"key":"臺東高商","doc_count":47},{"key":"頭城家商","doc_count":47},{"key":"羅東高商","doc_count":46},{"key":"蘭陽女中","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"屏東特教","doc_count":45},{"key":"新豐高中","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"土庫商工","doc_count":44},{"key":"崇實高工","doc_count":43},{"key":"永靖高工","doc_count":43},{"key":"白河商工","doc_count":43},{"key":"澎湖海事","doc_count":42},{"key":"雲林特教","doc_count":42},{"key":"華南高商","doc_count":41},{"key":"新竹高商","doc_count":40},{"key":"竹東高中","doc_count":40},{"key":"北港農工","doc_count":39}]}}}
DEBUG 2025/12/17 17:36:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:36:00   Bucket[0]: Key=黑快馬主機, DocCount=1196
DEBUG 2025/12/17 17:36:00   Bucket[1]: Key=花蓮高農, DocCount=962
DEBUG 2025/12/17 17:36:00   Bucket[2]: Key=仁愛高農, DocCount=607
DEBUG 2025/12/17 17:36:00   Bucket[3]: Key=金門高中, DocCount=578
DEBUG 2025/12/17 17:36:00   Bucket[4]: Key=金門農工, DocCount=570
DEBUG 2025/12/17 17:36:00   Bucket[5]: Key=新竹女中, DocCount=436
DEBUG 2025/12/17 17:36:00   Bucket[6]: Key=北門高中, DocCount=427
DEBUG 2025/12/17 17:36:00   Bucket[7]: Key=華僑高中, DocCount=376
DEBUG 2025/12/17 17:36:00   Bucket[8]: Key=宜蘭高商, DocCount=370
DEBUG 2025/12/17 17:36:00   Bucket[9]: Key=斗六家商, DocCount=340
DEBUG 2025/12/17 17:36:00   Bucket[10]: Key=嘉義高商, DocCount=283
DEBUG 2025/12/17 17:36:00   Bucket[11]: Key=南投高商, DocCount=281
DEBUG 2025/12/17 17:36:00   Bucket[12]: Key=蘇澳海事, DocCount=274
DEBUG 2025/12/17 17:36:00   Bucket[13]: Key=關西高中, DocCount=267
DEBUG 2025/12/17 17:36:00   Bucket[14]: Key=內埔農工, DocCount=263
DEBUG 2025/12/17 17:36:00   Bucket[15]: Key=臺東高中, DocCount=261
DEBUG 2025/12/17 17:36:00   Bucket[16]: Key=玉里高中, DocCount=249
DEBUG 2025/12/17 17:36:00   Bucket[17]: Key=竹北高中, DocCount=245
DEBUG 2025/12/17 17:36:00   Bucket[18]: Key=關山工商, DocCount=227
DEBUG 2025/12/17 17:36:00   Bucket[19]: Key=新港藝高, DocCount=218
DEBUG 2025/12/17 17:36:00   Bucket[20]: Key=清華附小, DocCount=207
DEBUG 2025/12/17 17:36:00   Bucket[21]: Key=新化高工, DocCount=204
DEBUG 2025/12/17 17:36:00   Bucket[22]: Key=竹南高中, DocCount=203
DEBUG 2025/12/17 17:36:00   Bucket[23]: Key=新營高工, DocCount=194
DEBUG 2025/12/17 17:36:00   Bucket[24]: Key=後壁高中, DocCount=193
DEBUG 2025/12/17 17:36:00   Bucket[25]: Key=興大附中, DocCount=181
DEBUG 2025/12/17 17:36:00   Bucket[26]: Key=苗栗農工, DocCount=179
DEBUG 2025/12/17 17:36:00   Bucket[27]: Key=旗美高中, DocCount=177
DEBUG 2025/12/17 17:36:00   Bucket[28]: Key=中大壢中, DocCount=174
DEBUG 2025/12/17 17:36:00   Bucket[29]: Key=花蓮高商, DocCount=173
DEBUG 2025/12/17 17:36:00   Bucket[30]: Key=南大附聰, DocCount=152
DEBUG 2025/12/17 17:36:00   Bucket[31]: Key=彰師附工, DocCount=149
DEBUG 2025/12/17 17:36:00   Bucket[32]: Key=南投特教, DocCount=147
DEBUG 2025/12/17 17:36:00   Bucket[33]: Key=花蓮高工, DocCount=138
DEBUG 2025/12/17 17:36:00   Bucket[34]: Key=南投高中, DocCount=136
DEBUG 2025/12/17 17:36:00   Bucket[35]: Key=新化高中, DocCount=136
DEBUG 2025/12/17 17:36:00   Bucket[36]: Key=屏東女中, DocCount=116
DEBUG 2025/12/17 17:36:00   Bucket[37]: Key=虎尾高中, DocCount=116
DEBUG 2025/12/17 17:36:00   Bucket[38]: Key=基隆商工, DocCount=113
DEBUG 2025/12/17 17:36:00   Bucket[39]: Key=苗栗高中, DocCount=113
DEBUG 2025/12/17 17:36:00   Bucket[40]: Key=員林家商, DocCount=106
DEBUG 2025/12/17 17:36:00   Bucket[41]: Key=苗栗高商, DocCount=106
DEBUG 2025/12/17 17:36:00   Bucket[42]: Key=東港海事, DocCount=105
DEBUG 2025/12/17 17:36:00   Bucket[43]: Key=師大附中高中部, DocCount=104
DEBUG 2025/12/17 17:36:00   Bucket[44]: Key=臺南高商, DocCount=101
DEBUG 2025/12/17 17:36:00   Bucket[45]: Key=水里商工, DocCount=97
DEBUG 2025/12/17 17:36:00   Bucket[46]: Key=鳳山高中, DocCount=97
DEBUG 2025/12/17 17:36:00   Bucket[47]: Key=彰化高商, DocCount=96
DEBUG 2025/12/17 17:36:00   Bucket[48]: Key=新竹高工, DocCount=95
DEBUG 2025/12/17 17:36:00   Bucket[49]: Key=新營高中, DocCount=93
DEBUG 2025/12/17 17:36:00   Bucket[50]: Key=北教大實小, DocCount=90
DEBUG 2025/12/17 17:36:00   Bucket[51]: Key=草屯商工, DocCount=90
DEBUG 2025/12/17 17:36:00   Bucket[52]: Key=中興高中, DocCount=87
DEBUG 2025/12/17 17:36:00   Bucket[53]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:36:00   Bucket[54]: Key=興大附農, DocCount=85
DEBUG 2025/12/17 17:36:00   Bucket[55]: Key=旗山農工, DocCount=82
DEBUG 2025/12/17 17:36:00   Bucket[56]: Key=高餐大附中, DocCount=82
DEBUG 2025/12/17 17:36:00   Bucket[57]: Key=二林工商, DocCount=79
DEBUG 2025/12/17 17:36:00   Bucket[58]: Key=屏東高中, DocCount=79
DEBUG 2025/12/17 17:36:00   Bucket[59]: Key=花蓮高中, DocCount=73
DEBUG 2025/12/17 17:36:00   Bucket[60]: Key=成大南工, DocCount=72
DEBUG 2025/12/17 17:36:00   Bucket[61]: Key=北港高中, DocCount=70
DEBUG 2025/12/17 17:36:00   Bucket[62]: Key=嘉義高中, DocCount=67
DEBUG 2025/12/17 17:36:00   Bucket[63]: Key=玉井工商, DocCount=67
DEBUG 2025/12/17 17:36:00   Bucket[64]: Key=員林農工, DocCount=64
DEBUG 2025/12/17 17:36:00   Bucket[65]: Key=海大附中, DocCount=64
DEBUG 2025/12/17 17:36:00   Bucket[66]: Key=曾文農工, DocCount=63
DEBUG 2025/12/17 17:36:00   Bucket[67]: Key=善化高中, DocCount=60
DEBUG 2025/12/17 17:36:00   Bucket[68]: Key=嘉義家職, DocCount=60
DEBUG 2025/12/17 17:36:00   Bucket[69]: Key=新竹高中, DocCount=59
DEBUG 2025/12/17 17:36:00   Bucket[70]: Key=潮州高中, DocCount=59
DEBUG 2025/12/17 17:36:00   Bucket[71]: Key=羅東高工, DocCount=55
DEBUG 2025/12/17 17:36:00   Bucket[72]: Key=臺東女中, DocCount=55
DEBUG 2025/12/17 17:36:00   Bucket[73]: Key=南大附中, DocCount=54
DEBUG 2025/12/17 17:36:00   Bucket[74]: Key=政大附中, DocCount=52
DEBUG 2025/12/17 17:36:00   Bucket[75]: Key=嘉義特教, DocCount=51
DEBUG 2025/12/17 17:36:00   Bucket[76]: Key=宜蘭高中, DocCount=51
DEBUG 2025/12/17 17:36:00   Bucket[77]: Key=屏東高工, DocCount=51
DEBUG 2025/12/17 17:36:00   Bucket[78]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 17:36:00   Bucket[79]: Key=嘉科實中, DocCount=50
DEBUG 2025/12/17 17:36:00   Bucket[80]: Key=秀水高工, DocCount=49
DEBUG 2025/12/17 17:36:00   Bucket[81]: Key=北斗家商, DocCount=48
DEBUG 2025/12/17 17:36:00   Bucket[82]: Key=臺東高商, DocCount=47
DEBUG 2025/12/17 17:36:00   Bucket[83]: Key=頭城家商, DocCount=47
DEBUG 2025/12/17 17:36:00   Bucket[84]: Key=羅東高商, DocCount=46
DEBUG 2025/12/17 17:36:00   Bucket[85]: Key=蘭陽女中, DocCount=46
DEBUG 2025/12/17 17:36:00   Bucket[86]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:36:00   Bucket[87]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:36:00   Bucket[88]: Key=新豐高中, DocCount=45
DEBUG 2025/12/17 17:36:00   Bucket[89]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 17:36:00   Bucket[90]: Key=土庫商工, DocCount=44
DEBUG 2025/12/17 17:36:00   Bucket[91]: Key=崇實高工, DocCount=43
DEBUG 2025/12/17 17:36:00   Bucket[92]: Key=永靖高工, DocCount=43
DEBUG 2025/12/17 17:36:00   Bucket[93]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:36:00   Bucket[94]: Key=澎湖海事, DocCount=42
DEBUG 2025/12/17 17:36:00   Bucket[95]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:36:00   Bucket[96]: Key=華南高商, DocCount=41
DEBUG 2025/12/17 17:36:00   Bucket[97]: Key=新竹高商, DocCount=40
DEBUG 2025/12/17 17:36:00   Bucket[98]: Key=竹東高中, DocCount=40
DEBUG 2025/12/17 17:36:00   Bucket[99]: Key=北港農工, DocCount=39
DEBUG 2025/12/17 17:36:00 ========================================================
INFO 2025/12/17 17:36:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:36:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:36:08 Processing 15 offline devices
INFO 2025/12/17 17:36:08 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:36:08 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:36:08 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:36:08 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:36:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:36:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:36:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:36:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:36:08 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:36:08 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:36:08 ✅ Successfully flushed 28/28 history records to TimescaleDB
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:36:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:36:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:36:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:36:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:36:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:36:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:36:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:36:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:36:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:36:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:36:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:36:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:36:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:36:08 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:36:08 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:36:09 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:36:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:36:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:36:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:36:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:36:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:36:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:36:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:36:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:36:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:36:13 ✅ Successfully flushed 11/11 history records to TimescaleDB
DEBUG 2025/12/17 17:36:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:36:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:36:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:36:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:36:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:36:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:36:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:36:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:36:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:36:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:36:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:36:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:36:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:36:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:36:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:36:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:36:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:36:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:36:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:36:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:36:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:36:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:36:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:36:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.24% (threshold: 80.00%)
DEBUG 2025/12/17 17:36:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.15% (threshold: 85.00%)
DEBUG 2025/12/17 17:36:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:36:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:36:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:36:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:36:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:36:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:36:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:37:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:37:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:37:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:37:00 Field: school_name.keyword
DEBUG 2025/12/17 17:37:00 Time From: 2025-12-17T17:36:00.000+08:00
DEBUG 2025/12/17 17:37:00 Time To: 2025-12-17T17:37:00.000+08:00
DEBUG 2025/12/17 17:37:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:36:00.000+08:00",
					"lte": "2025-12-17T17:37:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:37:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:37:00 ES Response IsError: false
DEBUG 2025/12/17 17:37:00 ES Response Body:
{"took":59,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":454,"buckets":[{"key":"黑快馬主機","doc_count":1305},{"key":"花蓮高農","doc_count":806},{"key":"金門高中","doc_count":665},{"key":"仁愛高農","doc_count":584},{"key":"金門農工","doc_count":557},{"key":"宜蘭高商","doc_count":541},{"key":"新竹女中","doc_count":524},{"key":"北門高中","doc_count":380},{"key":"華僑高中","doc_count":361},{"key":"蘇澳海事","doc_count":271},{"key":"南投高商","doc_count":262},{"key":"竹北高中","doc_count":257},{"key":"竹南高中","doc_count":247},{"key":"臺東高中","doc_count":244},{"key":"彰師附工","doc_count":235},{"key":"關西高中","doc_count":232},{"key":"清華附小","doc_count":227},{"key":"興大附中","doc_count":227},{"key":"內埔農工","doc_count":224},{"key":"斗六家商","doc_count":214},{"key":"玉里高中","doc_count":201},{"key":"花蓮高商","doc_count":197},{"key":"中大壢中","doc_count":196},{"key":"新港藝高","doc_count":183},{"key":"旗美高中","doc_count":173},{"key":"鳳山高中","doc_count":172},{"key":"關山工商","doc_count":164},{"key":"新竹高工","doc_count":163},{"key":"後壁高中","doc_count":162},{"key":"嘉義高商","doc_count":151},{"key":"南投特教","doc_count":143},{"key":"屏東女中","doc_count":142},{"key":"屏東高中","doc_count":140},{"key":"虎尾高中","doc_count":140},{"key":"苗栗農工","doc_count":131},{"key":"彰化高商","doc_count":127},{"key":"中興高中","doc_count":120},{"key":"新營高工","doc_count":115},{"key":"師大附中高中部","doc_count":109},{"key":"新化高中","doc_count":106},{"key":"員林家商","doc_count":105},{"key":"高餐大附中","doc_count":99},{"key":"嘉義高中","doc_count":98},{"key":"新化高工","doc_count":96},{"key":"東港海事","doc_count":95},{"key":"羅東高工","doc_count":95},{"key":"屏科實中","doc_count":93},{"key":"南大附聰","doc_count":92},{"key":"新竹特教","doc_count":86},{"key":"北教大實小","doc_count":76},{"key":"基隆商工","doc_count":73},{"key":"員林農工","doc_count":71},{"key":"新營高中","doc_count":71},{"key":"溪湖高中","doc_count":71},{"key":"頭城家商","doc_count":71},{"key":"東石高中","doc_count":63},{"key":"秀水高工","doc_count":62},{"key":"南大附中","doc_count":61},{"key":"屏東高工","doc_count":59},{"key":"臺南高商","doc_count":59},{"key":"苗栗高中","doc_count":57},{"key":"崇實高工","doc_count":55},{"key":"新竹高中","doc_count":55},{"key":"新豐高中","doc_count":55},{"key":"苗栗高商","doc_count":55},{"key":"南投高中","doc_count":54},{"key":"雲林特教","doc_count":54},{"key":"員林高中","doc_count":53},{"key":"華南高商","doc_count":53},{"key":"興大附農","doc_count":52},{"key":"竹東高中","doc_count":51},{"key":"南大附小","doc_count":50},{"key":"嘉科實中","doc_count":50},{"key":"水里商工","doc_count":50},{"key":"善化高中","doc_count":49},{"key":"新竹高商","doc_count":49},{"key":"海大附中","doc_count":49},{"key":"花蓮高工","doc_count":49},{"key":"屏東特教","doc_count":48},{"key":"北港高中","doc_count":47},{"key":"臺南一中","doc_count":46},{"key":"蘭陽女中","doc_count":46},{"key":"花蓮特教","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"政大附中","doc_count":44},{"key":"土庫商工","doc_count":43},{"key":"成大南工","doc_count":43},{"key":"白河商工","doc_count":43},{"key":"宜蘭高中","doc_count":42},{"key":"羅東高商","doc_count":42},{"key":"草屯商工","doc_count":42},{"key":"旗山農工","doc_count":41},{"key":"澎湖海事","doc_count":41},{"key":"北斗家商","doc_count":40},{"key":"屏北高中","doc_count":40},{"key":"潮州高中","doc_count":39},{"key":"臺東女中","doc_count":39},{"key":"北港農工","doc_count":38},{"key":"花蓮高中","doc_count":37},{"key":"佳冬高農","doc_count":36}]}}}
DEBUG 2025/12/17 17:37:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:37:00   Bucket[0]: Key=黑快馬主機, DocCount=1305
DEBUG 2025/12/17 17:37:00   Bucket[1]: Key=花蓮高農, DocCount=806
DEBUG 2025/12/17 17:37:00   Bucket[2]: Key=金門高中, DocCount=665
DEBUG 2025/12/17 17:37:00   Bucket[3]: Key=仁愛高農, DocCount=584
DEBUG 2025/12/17 17:37:00   Bucket[4]: Key=金門農工, DocCount=557
DEBUG 2025/12/17 17:37:00   Bucket[5]: Key=宜蘭高商, DocCount=541
DEBUG 2025/12/17 17:37:00   Bucket[6]: Key=新竹女中, DocCount=524
DEBUG 2025/12/17 17:37:00   Bucket[7]: Key=北門高中, DocCount=380
DEBUG 2025/12/17 17:37:00   Bucket[8]: Key=華僑高中, DocCount=361
DEBUG 2025/12/17 17:37:00   Bucket[9]: Key=蘇澳海事, DocCount=271
DEBUG 2025/12/17 17:37:00   Bucket[10]: Key=南投高商, DocCount=262
DEBUG 2025/12/17 17:37:00   Bucket[11]: Key=竹北高中, DocCount=257
DEBUG 2025/12/17 17:37:00   Bucket[12]: Key=竹南高中, DocCount=247
DEBUG 2025/12/17 17:37:00   Bucket[13]: Key=臺東高中, DocCount=244
DEBUG 2025/12/17 17:37:00   Bucket[14]: Key=彰師附工, DocCount=235
DEBUG 2025/12/17 17:37:00   Bucket[15]: Key=關西高中, DocCount=232
DEBUG 2025/12/17 17:37:00   Bucket[16]: Key=清華附小, DocCount=227
DEBUG 2025/12/17 17:37:00   Bucket[17]: Key=興大附中, DocCount=227
DEBUG 2025/12/17 17:37:00   Bucket[18]: Key=內埔農工, DocCount=224
DEBUG 2025/12/17 17:37:00   Bucket[19]: Key=斗六家商, DocCount=214
DEBUG 2025/12/17 17:37:00   Bucket[20]: Key=玉里高中, DocCount=201
DEBUG 2025/12/17 17:37:00   Bucket[21]: Key=花蓮高商, DocCount=197
DEBUG 2025/12/17 17:37:00   Bucket[22]: Key=中大壢中, DocCount=196
DEBUG 2025/12/17 17:37:00   Bucket[23]: Key=新港藝高, DocCount=183
DEBUG 2025/12/17 17:37:00   Bucket[24]: Key=旗美高中, DocCount=173
DEBUG 2025/12/17 17:37:00   Bucket[25]: Key=鳳山高中, DocCount=172
DEBUG 2025/12/17 17:37:00   Bucket[26]: Key=關山工商, DocCount=164
DEBUG 2025/12/17 17:37:00   Bucket[27]: Key=新竹高工, DocCount=163
DEBUG 2025/12/17 17:37:00   Bucket[28]: Key=後壁高中, DocCount=162
DEBUG 2025/12/17 17:37:00   Bucket[29]: Key=嘉義高商, DocCount=151
DEBUG 2025/12/17 17:37:00   Bucket[30]: Key=南投特教, DocCount=143
DEBUG 2025/12/17 17:37:00   Bucket[31]: Key=屏東女中, DocCount=142
DEBUG 2025/12/17 17:37:00   Bucket[32]: Key=屏東高中, DocCount=140
DEBUG 2025/12/17 17:37:00   Bucket[33]: Key=虎尾高中, DocCount=140
DEBUG 2025/12/17 17:37:00   Bucket[34]: Key=苗栗農工, DocCount=131
DEBUG 2025/12/17 17:37:00   Bucket[35]: Key=彰化高商, DocCount=127
DEBUG 2025/12/17 17:37:00   Bucket[36]: Key=中興高中, DocCount=120
DEBUG 2025/12/17 17:37:00   Bucket[37]: Key=新營高工, DocCount=115
DEBUG 2025/12/17 17:37:00   Bucket[38]: Key=師大附中高中部, DocCount=109
DEBUG 2025/12/17 17:37:00   Bucket[39]: Key=新化高中, DocCount=106
DEBUG 2025/12/17 17:37:00   Bucket[40]: Key=員林家商, DocCount=105
DEBUG 2025/12/17 17:37:00   Bucket[41]: Key=高餐大附中, DocCount=99
DEBUG 2025/12/17 17:37:00   Bucket[42]: Key=嘉義高中, DocCount=98
DEBUG 2025/12/17 17:37:00   Bucket[43]: Key=新化高工, DocCount=96
DEBUG 2025/12/17 17:37:00   Bucket[44]: Key=東港海事, DocCount=95
DEBUG 2025/12/17 17:37:00   Bucket[45]: Key=羅東高工, DocCount=95
DEBUG 2025/12/17 17:37:00   Bucket[46]: Key=屏科實中, DocCount=93
DEBUG 2025/12/17 17:37:00   Bucket[47]: Key=南大附聰, DocCount=92
DEBUG 2025/12/17 17:37:00   Bucket[48]: Key=新竹特教, DocCount=86
DEBUG 2025/12/17 17:37:00   Bucket[49]: Key=北教大實小, DocCount=76
DEBUG 2025/12/17 17:37:00   Bucket[50]: Key=基隆商工, DocCount=73
DEBUG 2025/12/17 17:37:00   Bucket[51]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:37:00   Bucket[52]: Key=新營高中, DocCount=71
DEBUG 2025/12/17 17:37:00   Bucket[53]: Key=溪湖高中, DocCount=71
DEBUG 2025/12/17 17:37:00   Bucket[54]: Key=頭城家商, DocCount=71
DEBUG 2025/12/17 17:37:00   Bucket[55]: Key=東石高中, DocCount=63
DEBUG 2025/12/17 17:37:00   Bucket[56]: Key=秀水高工, DocCount=62
DEBUG 2025/12/17 17:37:00   Bucket[57]: Key=南大附中, DocCount=61
DEBUG 2025/12/17 17:37:00   Bucket[58]: Key=屏東高工, DocCount=59
DEBUG 2025/12/17 17:37:00   Bucket[59]: Key=臺南高商, DocCount=59
DEBUG 2025/12/17 17:37:00   Bucket[60]: Key=苗栗高中, DocCount=57
DEBUG 2025/12/17 17:37:00   Bucket[61]: Key=崇實高工, DocCount=55
DEBUG 2025/12/17 17:37:00   Bucket[62]: Key=新竹高中, DocCount=55
DEBUG 2025/12/17 17:37:00   Bucket[63]: Key=新豐高中, DocCount=55
DEBUG 2025/12/17 17:37:00   Bucket[64]: Key=苗栗高商, DocCount=55
DEBUG 2025/12/17 17:37:00   Bucket[65]: Key=南投高中, DocCount=54
DEBUG 2025/12/17 17:37:00   Bucket[66]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:37:00   Bucket[67]: Key=員林高中, DocCount=53
DEBUG 2025/12/17 17:37:00   Bucket[68]: Key=華南高商, DocCount=53
DEBUG 2025/12/17 17:37:00   Bucket[69]: Key=興大附農, DocCount=52
DEBUG 2025/12/17 17:37:00   Bucket[70]: Key=竹東高中, DocCount=51
DEBUG 2025/12/17 17:37:00   Bucket[71]: Key=南大附小, DocCount=50
DEBUG 2025/12/17 17:37:00   Bucket[72]: Key=嘉科實中, DocCount=50
DEBUG 2025/12/17 17:37:00   Bucket[73]: Key=水里商工, DocCount=50
DEBUG 2025/12/17 17:37:00   Bucket[74]: Key=善化高中, DocCount=49
DEBUG 2025/12/17 17:37:00   Bucket[75]: Key=新竹高商, DocCount=49
DEBUG 2025/12/17 17:37:00   Bucket[76]: Key=海大附中, DocCount=49
DEBUG 2025/12/17 17:37:00   Bucket[77]: Key=花蓮高工, DocCount=49
DEBUG 2025/12/17 17:37:00   Bucket[78]: Key=屏東特教, DocCount=48
DEBUG 2025/12/17 17:37:00   Bucket[79]: Key=北港高中, DocCount=47
DEBUG 2025/12/17 17:37:00   Bucket[80]: Key=臺南一中, DocCount=46
DEBUG 2025/12/17 17:37:00   Bucket[81]: Key=蘭陽女中, DocCount=46
DEBUG 2025/12/17 17:37:00   Bucket[82]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:37:00   Bucket[83]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:37:00   Bucket[84]: Key=政大附中, DocCount=44
DEBUG 2025/12/17 17:37:00   Bucket[85]: Key=土庫商工, DocCount=43
DEBUG 2025/12/17 17:37:00   Bucket[86]: Key=成大南工, DocCount=43
DEBUG 2025/12/17 17:37:00   Bucket[87]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:37:00   Bucket[88]: Key=宜蘭高中, DocCount=42
DEBUG 2025/12/17 17:37:00   Bucket[89]: Key=羅東高商, DocCount=42
DEBUG 2025/12/17 17:37:00   Bucket[90]: Key=草屯商工, DocCount=42
DEBUG 2025/12/17 17:37:00   Bucket[91]: Key=旗山農工, DocCount=41
DEBUG 2025/12/17 17:37:00   Bucket[92]: Key=澎湖海事, DocCount=41
DEBUG 2025/12/17 17:37:00   Bucket[93]: Key=北斗家商, DocCount=40
DEBUG 2025/12/17 17:37:00   Bucket[94]: Key=屏北高中, DocCount=40
DEBUG 2025/12/17 17:37:00   Bucket[95]: Key=潮州高中, DocCount=39
DEBUG 2025/12/17 17:37:00   Bucket[96]: Key=臺東女中, DocCount=39
DEBUG 2025/12/17 17:37:00   Bucket[97]: Key=北港農工, DocCount=38
DEBUG 2025/12/17 17:37:00   Bucket[98]: Key=花蓮高中, DocCount=37
DEBUG 2025/12/17 17:37:00   Bucket[99]: Key=佳冬高農, DocCount=36
DEBUG 2025/12/17 17:37:00 ========================================================
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:37:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:37:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:37:08 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:37:08 ✅ Successfully flushed 2/2 history records to TimescaleDB
INFO 2025/12/17 17:37:12 Processing 15 offline devices
INFO 2025/12/17 17:37:12 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:37:12 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:37:12 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:37:12 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:37:12 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:37:12 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:37:12 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:37:12 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:37:12 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:37:12 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:37:12 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:37:12 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:37:12 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:37:12 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:37:13 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:37:13 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:37:13 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:37:13 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:37:13 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:37:13 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:37:13 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:37:13 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:37:13 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:37:13 ✅ Successfully flushed 42/42 history records to TimescaleDB
INFO 2025/12/17 17:37:13 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:37:13 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:37:13 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:37:14 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:37:14 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:37:14 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:37:14 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:37:14 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:37:14 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:37:14 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:37:14 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:37:14 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:37:14 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:37:14 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:37:14 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:37:14 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:37:14 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:37:14 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:37:17 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:37:17 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:37:17 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:37:17 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:37:18 ✅ Successfully flushed 8/8 history records to TimescaleDB
DEBUG 2025/12/17 17:37:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:37:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:37:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:37:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:37:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:37:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:37:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:37:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:37:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:37:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:37:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:37:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:37:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:37:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:37:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:37:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:37:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:37:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:37:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:37:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:37:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:37:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:37:45 ES Alert Created [critical][performance]: Memory usage critical: 90.09% (threshold: 90.00%)
INFO 2025/12/17 17:37:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:37:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.18% (threshold: 85.00%)
DEBUG 2025/12/17 17:37:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:37:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:37:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:37:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:37:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:37:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:37:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:38:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:38:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:38:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:38:00 Field: school_name.keyword
DEBUG 2025/12/17 17:38:00 Time From: 2025-12-17T17:37:00.000+08:00
DEBUG 2025/12/17 17:38:00 Time To: 2025-12-17T17:38:00.000+08:00
DEBUG 2025/12/17 17:38:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:37:00.000+08:00",
					"lte": "2025-12-17T17:38:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:38:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:38:00 ES Response IsError: false
DEBUG 2025/12/17 17:38:00 ES Response Body:
{"took":77,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":425,"buckets":[{"key":"黑快馬主機","doc_count":1306},{"key":"花蓮高農","doc_count":850},{"key":"仁愛高農","doc_count":608},{"key":"金門高中","doc_count":529},{"key":"金門農工","doc_count":494},{"key":"新竹女中","doc_count":479},{"key":"北門高中","doc_count":437},{"key":"華僑高中","doc_count":367},{"key":"宜蘭高商","doc_count":366},{"key":"蘇澳海事","doc_count":362},{"key":"竹北高中","doc_count":333},{"key":"南投高商","doc_count":322},{"key":"政大附中","doc_count":273},{"key":"臺東高中","doc_count":263},{"key":"新港藝高","doc_count":246},{"key":"關西高中","doc_count":244},{"key":"竹南高中","doc_count":234},{"key":"內埔農工","doc_count":225},{"key":"興大附中","doc_count":211},{"key":"清華附小","doc_count":206},{"key":"花蓮高商","doc_count":199},{"key":"花蓮高中","doc_count":181},{"key":"關山工商","doc_count":178},{"key":"高餐大附中","doc_count":178},{"key":"新營高工","doc_count":165},{"key":"旗美高中","doc_count":159},{"key":"鳳山高中","doc_count":154},{"key":"玉里高中","doc_count":153},{"key":"嘉義高商","doc_count":148},{"key":"南投特教","doc_count":144},{"key":"苗栗農工","doc_count":143},{"key":"中大壢中","doc_count":141},{"key":"後壁高中","doc_count":138},{"key":"新化高工","doc_count":134},{"key":"屏東女中","doc_count":133},{"key":"斗六家商","doc_count":130},{"key":"秀水高工","doc_count":128},{"key":"基隆商工","doc_count":121},{"key":"北教大實小","doc_count":111},{"key":"虎尾高中","doc_count":108},{"key":"新竹高中","doc_count":100},{"key":"師大附中高中部","doc_count":94},{"key":"新化高中","doc_count":94},{"key":"南大附聰","doc_count":91},{"key":"員林家商","doc_count":91},{"key":"新竹高商","doc_count":89},{"key":"屏科實中","doc_count":88},{"key":"潮州高中","doc_count":87},{"key":"東港海事","doc_count":85},{"key":"員林高中","doc_count":84},{"key":"苗栗高商","doc_count":84},{"key":"草屯商工","doc_count":82},{"key":"北港高中","doc_count":80},{"key":"新竹高工","doc_count":80},{"key":"羅東高工","doc_count":80},{"key":"中興高中","doc_count":77},{"key":"彰師附工","doc_count":74},{"key":"東石高中","doc_count":74},{"key":"屏東高中","doc_count":73},{"key":"宜蘭高中","doc_count":70},{"key":"花蓮特教","doc_count":70},{"key":"興大附農","doc_count":68},{"key":"成大南工","doc_count":66},{"key":"新營高中","doc_count":64},{"key":"臺南高商","doc_count":64},{"key":"頭城家商","doc_count":61},{"key":"埔里高工","doc_count":59},{"key":"海大附中","doc_count":59},{"key":"臺東女中","doc_count":54},{"key":"曾文農工","doc_count":50},{"key":"華南高商","doc_count":50},{"key":"水里商工","doc_count":48},{"key":"臺南一中","doc_count":48},{"key":"嘉義高中","doc_count":47},{"key":"土庫商工","doc_count":47},{"key":"南投高中","doc_count":46},{"key":"嘉科實中","doc_count":46},{"key":"南大附中","doc_count":45},{"key":"屏東高工","doc_count":45},{"key":"彰化高商","doc_count":45},{"key":"羅東高商","doc_count":44},{"key":"員林農工","doc_count":43},{"key":"溪湖高中","doc_count":43},{"key":"白河商工","doc_count":41},{"key":"花蓮高工","doc_count":41},{"key":"新豐高中","doc_count":40},{"key":"澎湖海事","doc_count":40},{"key":"玉井工商","doc_count":40},{"key":"二林工商","doc_count":39},{"key":"家齊高中","doc_count":39},{"key":"佳冬高農","doc_count":38},{"key":"北斗家商","doc_count":38},{"key":"竹東高中","doc_count":38},{"key":"南大附小","doc_count":36},{"key":"嘉義特教","doc_count":36},{"key":"嘉義高工","doc_count":35},{"key":"屏東特教","doc_count":35},{"key":"雲林特教","doc_count":35},{"key":"永靖高工","doc_count":34},{"key":"臺東高商","doc_count":34}]}}}
DEBUG 2025/12/17 17:38:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:38:00   Bucket[0]: Key=黑快馬主機, DocCount=1306
DEBUG 2025/12/17 17:38:00   Bucket[1]: Key=花蓮高農, DocCount=850
DEBUG 2025/12/17 17:38:00   Bucket[2]: Key=仁愛高農, DocCount=608
DEBUG 2025/12/17 17:38:00   Bucket[3]: Key=金門高中, DocCount=529
DEBUG 2025/12/17 17:38:00   Bucket[4]: Key=金門農工, DocCount=494
DEBUG 2025/12/17 17:38:00   Bucket[5]: Key=新竹女中, DocCount=479
DEBUG 2025/12/17 17:38:00   Bucket[6]: Key=北門高中, DocCount=437
DEBUG 2025/12/17 17:38:00   Bucket[7]: Key=華僑高中, DocCount=367
DEBUG 2025/12/17 17:38:00   Bucket[8]: Key=宜蘭高商, DocCount=366
DEBUG 2025/12/17 17:38:00   Bucket[9]: Key=蘇澳海事, DocCount=362
DEBUG 2025/12/17 17:38:00   Bucket[10]: Key=竹北高中, DocCount=333
DEBUG 2025/12/17 17:38:00   Bucket[11]: Key=南投高商, DocCount=322
DEBUG 2025/12/17 17:38:00   Bucket[12]: Key=政大附中, DocCount=273
DEBUG 2025/12/17 17:38:00   Bucket[13]: Key=臺東高中, DocCount=263
DEBUG 2025/12/17 17:38:00   Bucket[14]: Key=新港藝高, DocCount=246
DEBUG 2025/12/17 17:38:00   Bucket[15]: Key=關西高中, DocCount=244
DEBUG 2025/12/17 17:38:00   Bucket[16]: Key=竹南高中, DocCount=234
DEBUG 2025/12/17 17:38:00   Bucket[17]: Key=內埔農工, DocCount=225
DEBUG 2025/12/17 17:38:00   Bucket[18]: Key=興大附中, DocCount=211
DEBUG 2025/12/17 17:38:00   Bucket[19]: Key=清華附小, DocCount=206
DEBUG 2025/12/17 17:38:00   Bucket[20]: Key=花蓮高商, DocCount=199
DEBUG 2025/12/17 17:38:00   Bucket[21]: Key=花蓮高中, DocCount=181
DEBUG 2025/12/17 17:38:00   Bucket[22]: Key=關山工商, DocCount=178
DEBUG 2025/12/17 17:38:00   Bucket[23]: Key=高餐大附中, DocCount=178
DEBUG 2025/12/17 17:38:00   Bucket[24]: Key=新營高工, DocCount=165
DEBUG 2025/12/17 17:38:00   Bucket[25]: Key=旗美高中, DocCount=159
DEBUG 2025/12/17 17:38:00   Bucket[26]: Key=鳳山高中, DocCount=154
DEBUG 2025/12/17 17:38:00   Bucket[27]: Key=玉里高中, DocCount=153
DEBUG 2025/12/17 17:38:00   Bucket[28]: Key=嘉義高商, DocCount=148
DEBUG 2025/12/17 17:38:00   Bucket[29]: Key=南投特教, DocCount=144
DEBUG 2025/12/17 17:38:00   Bucket[30]: Key=苗栗農工, DocCount=143
DEBUG 2025/12/17 17:38:00   Bucket[31]: Key=中大壢中, DocCount=141
DEBUG 2025/12/17 17:38:00   Bucket[32]: Key=後壁高中, DocCount=138
DEBUG 2025/12/17 17:38:00   Bucket[33]: Key=新化高工, DocCount=134
DEBUG 2025/12/17 17:38:00   Bucket[34]: Key=屏東女中, DocCount=133
DEBUG 2025/12/17 17:38:00   Bucket[35]: Key=斗六家商, DocCount=130
DEBUG 2025/12/17 17:38:00   Bucket[36]: Key=秀水高工, DocCount=128
DEBUG 2025/12/17 17:38:00   Bucket[37]: Key=基隆商工, DocCount=121
DEBUG 2025/12/17 17:38:00   Bucket[38]: Key=北教大實小, DocCount=111
DEBUG 2025/12/17 17:38:00   Bucket[39]: Key=虎尾高中, DocCount=108
DEBUG 2025/12/17 17:38:00   Bucket[40]: Key=新竹高中, DocCount=100
DEBUG 2025/12/17 17:38:00   Bucket[41]: Key=師大附中高中部, DocCount=94
DEBUG 2025/12/17 17:38:00   Bucket[42]: Key=新化高中, DocCount=94
DEBUG 2025/12/17 17:38:00   Bucket[43]: Key=南大附聰, DocCount=91
DEBUG 2025/12/17 17:38:00   Bucket[44]: Key=員林家商, DocCount=91
DEBUG 2025/12/17 17:38:00   Bucket[45]: Key=新竹高商, DocCount=89
DEBUG 2025/12/17 17:38:00   Bucket[46]: Key=屏科實中, DocCount=88
DEBUG 2025/12/17 17:38:00   Bucket[47]: Key=潮州高中, DocCount=87
DEBUG 2025/12/17 17:38:00   Bucket[48]: Key=東港海事, DocCount=85
DEBUG 2025/12/17 17:38:00   Bucket[49]: Key=員林高中, DocCount=84
DEBUG 2025/12/17 17:38:00   Bucket[50]: Key=苗栗高商, DocCount=84
DEBUG 2025/12/17 17:38:00   Bucket[51]: Key=草屯商工, DocCount=82
DEBUG 2025/12/17 17:38:00   Bucket[52]: Key=北港高中, DocCount=80
DEBUG 2025/12/17 17:38:00   Bucket[53]: Key=新竹高工, DocCount=80
DEBUG 2025/12/17 17:38:00   Bucket[54]: Key=羅東高工, DocCount=80
DEBUG 2025/12/17 17:38:00   Bucket[55]: Key=中興高中, DocCount=77
DEBUG 2025/12/17 17:38:00   Bucket[56]: Key=彰師附工, DocCount=74
DEBUG 2025/12/17 17:38:00   Bucket[57]: Key=東石高中, DocCount=74
DEBUG 2025/12/17 17:38:00   Bucket[58]: Key=屏東高中, DocCount=73
DEBUG 2025/12/17 17:38:00   Bucket[59]: Key=宜蘭高中, DocCount=70
DEBUG 2025/12/17 17:38:00   Bucket[60]: Key=花蓮特教, DocCount=70
DEBUG 2025/12/17 17:38:00   Bucket[61]: Key=興大附農, DocCount=68
DEBUG 2025/12/17 17:38:00   Bucket[62]: Key=成大南工, DocCount=66
DEBUG 2025/12/17 17:38:00   Bucket[63]: Key=新營高中, DocCount=64
DEBUG 2025/12/17 17:38:00   Bucket[64]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 17:38:00   Bucket[65]: Key=頭城家商, DocCount=61
DEBUG 2025/12/17 17:38:00   Bucket[66]: Key=埔里高工, DocCount=59
DEBUG 2025/12/17 17:38:00   Bucket[67]: Key=海大附中, DocCount=59
DEBUG 2025/12/17 17:38:00   Bucket[68]: Key=臺東女中, DocCount=54
DEBUG 2025/12/17 17:38:00   Bucket[69]: Key=曾文農工, DocCount=50
DEBUG 2025/12/17 17:38:00   Bucket[70]: Key=華南高商, DocCount=50
DEBUG 2025/12/17 17:38:00   Bucket[71]: Key=水里商工, DocCount=48
DEBUG 2025/12/17 17:38:00   Bucket[72]: Key=臺南一中, DocCount=48
DEBUG 2025/12/17 17:38:00   Bucket[73]: Key=嘉義高中, DocCount=47
DEBUG 2025/12/17 17:38:00   Bucket[74]: Key=土庫商工, DocCount=47
DEBUG 2025/12/17 17:38:00   Bucket[75]: Key=南投高中, DocCount=46
DEBUG 2025/12/17 17:38:00   Bucket[76]: Key=嘉科實中, DocCount=46
DEBUG 2025/12/17 17:38:00   Bucket[77]: Key=南大附中, DocCount=45
DEBUG 2025/12/17 17:38:00   Bucket[78]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:38:00   Bucket[79]: Key=彰化高商, DocCount=45
DEBUG 2025/12/17 17:38:00   Bucket[80]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 17:38:00   Bucket[81]: Key=員林農工, DocCount=43
DEBUG 2025/12/17 17:38:00   Bucket[82]: Key=溪湖高中, DocCount=43
DEBUG 2025/12/17 17:38:00   Bucket[83]: Key=白河商工, DocCount=41
DEBUG 2025/12/17 17:38:00   Bucket[84]: Key=花蓮高工, DocCount=41
DEBUG 2025/12/17 17:38:00   Bucket[85]: Key=新豐高中, DocCount=40
DEBUG 2025/12/17 17:38:00   Bucket[86]: Key=澎湖海事, DocCount=40
DEBUG 2025/12/17 17:38:00   Bucket[87]: Key=玉井工商, DocCount=40
DEBUG 2025/12/17 17:38:00   Bucket[88]: Key=二林工商, DocCount=39
DEBUG 2025/12/17 17:38:00   Bucket[89]: Key=家齊高中, DocCount=39
DEBUG 2025/12/17 17:38:00   Bucket[90]: Key=佳冬高農, DocCount=38
DEBUG 2025/12/17 17:38:00   Bucket[91]: Key=北斗家商, DocCount=38
DEBUG 2025/12/17 17:38:00   Bucket[92]: Key=竹東高中, DocCount=38
DEBUG 2025/12/17 17:38:00   Bucket[93]: Key=南大附小, DocCount=36
DEBUG 2025/12/17 17:38:00   Bucket[94]: Key=嘉義特教, DocCount=36
DEBUG 2025/12/17 17:38:00   Bucket[95]: Key=嘉義高工, DocCount=35
DEBUG 2025/12/17 17:38:00   Bucket[96]: Key=屏東特教, DocCount=35
DEBUG 2025/12/17 17:38:00   Bucket[97]: Key=雲林特教, DocCount=35
DEBUG 2025/12/17 17:38:00   Bucket[98]: Key=永靖高工, DocCount=34
DEBUG 2025/12/17 17:38:00   Bucket[99]: Key=臺東高商, DocCount=34
DEBUG 2025/12/17 17:38:00 ========================================================
INFO 2025/12/17 17:38:03 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:38:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:38:08 ✅ Successfully flushed 18/18 history records to TimescaleDB
INFO 2025/12/17 17:38:08 Processing 15 offline devices
INFO 2025/12/17 17:38:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:38:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:38:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:38:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:38:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:38:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:38:08 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:38:08 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:38:08 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:38:08 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:38:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:38:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:38:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:38:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:38:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:38:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:38:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:38:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:38:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:38:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:38:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:38:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:38:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:38:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:38:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:38:09 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:38:09 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:38:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:38:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:38:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:38:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:38:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:38:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:38:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:38:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:38:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:38:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:38:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:38:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:38:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:38:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:38:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:38:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:38:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:38:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:38:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:38:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:38:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:38:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:38:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:38:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:38:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:38:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:38:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.02% (threshold: 80.00%)
INFO 2025/12/17 17:38:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.22% (threshold: 85.00%)
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:38:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:38:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:38:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:38:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:38:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:39:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:39:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:39:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:39:00 Field: school_name.keyword
DEBUG 2025/12/17 17:39:00 Time From: 2025-12-17T17:38:00.000+08:00
DEBUG 2025/12/17 17:39:00 Time To: 2025-12-17T17:39:00.000+08:00
DEBUG 2025/12/17 17:39:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:38:00.000+08:00",
					"lte": "2025-12-17T17:39:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:39:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:39:00 ES Response IsError: false
DEBUG 2025/12/17 17:39:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":422,"buckets":[{"key":"黑快馬主機","doc_count":1435},{"key":"花蓮高農","doc_count":855},{"key":"仁愛高農","doc_count":606},{"key":"金門高中","doc_count":550},{"key":"金門農工","doc_count":519},{"key":"南投高商","doc_count":470},{"key":"新竹女中","doc_count":436},{"key":"北門高中","doc_count":389},{"key":"蘇澳海事","doc_count":366},{"key":"華僑高中","doc_count":346},{"key":"竹北高中","doc_count":320},{"key":"宜蘭高商","doc_count":267},{"key":"內埔農工","doc_count":241},{"key":"關西高中","doc_count":236},{"key":"臺東高中","doc_count":215},{"key":"政大附中","doc_count":208},{"key":"新港藝高","doc_count":202},{"key":"興大附中","doc_count":197},{"key":"竹南高中","doc_count":196},{"key":"清華附小","doc_count":195},{"key":"斗六家商","doc_count":180},{"key":"旗美高中","doc_count":175},{"key":"關山工商","doc_count":175},{"key":"新化高中","doc_count":169},{"key":"中大壢中","doc_count":164},{"key":"北教大實小","doc_count":164},{"key":"玉里高中","doc_count":160},{"key":"南投特教","doc_count":158},{"key":"後壁高中","doc_count":151},{"key":"花蓮高商","doc_count":140},{"key":"竹山高中","doc_count":137},{"key":"苗栗農工","doc_count":137},{"key":"屏東女中","doc_count":135},{"key":"員林家商","doc_count":126},{"key":"嘉義高商","doc_count":126},{"key":"潮州高中","doc_count":125},{"key":"新竹高商","doc_count":116},{"key":"員林高中","doc_count":115},{"key":"新化高工","doc_count":111},{"key":"新營高工","doc_count":106},{"key":"虎尾高中","doc_count":103},{"key":"南大附中","doc_count":101},{"key":"東港海事","doc_count":101},{"key":"新竹高中","doc_count":100},{"key":"溪湖高中","doc_count":97},{"key":"南投高中","doc_count":94},{"key":"鳳山高中","doc_count":94},{"key":"新營高中","doc_count":87},{"key":"嘉義高中","doc_count":86},{"key":"新竹高工","doc_count":86},{"key":"基隆商工","doc_count":85},{"key":"屏科實中","doc_count":83},{"key":"彰化高商","doc_count":81},{"key":"南大附聰","doc_count":75},{"key":"羅東高工","doc_count":74},{"key":"曾文農工","doc_count":70},{"key":"師大附中高中部","doc_count":69},{"key":"成大南工","doc_count":69},{"key":"嘉科實中","doc_count":67},{"key":"旗山農工","doc_count":67},{"key":"花蓮高中","doc_count":66},{"key":"苗栗高商","doc_count":66},{"key":"二林工商","doc_count":63},{"key":"高餐大附中","doc_count":63},{"key":"北斗家商","doc_count":59},{"key":"北港高中","doc_count":58},{"key":"中興高中","doc_count":54},{"key":"土庫商工","doc_count":54},{"key":"秀水高工","doc_count":54},{"key":"臺南高商","doc_count":54},{"key":"興大附農","doc_count":53},{"key":"新豐高中","doc_count":52},{"key":"白河商工","doc_count":52},{"key":"屏東高中","doc_count":51},{"key":"草屯商工","doc_count":49},{"key":"彰師附工","doc_count":48},{"key":"暨大附中","doc_count":48},{"key":"嘉義高工","doc_count":47},{"key":"屏東高工","doc_count":45},{"key":"水里商工","doc_count":45},{"key":"嘉義家職","doc_count":44},{"key":"海大附中","doc_count":44},{"key":"雲林特教","doc_count":44},{"key":"苗栗高中","doc_count":43},{"key":"東石高中","doc_count":42},{"key":"頭城家商","doc_count":42},{"key":"員林農工","doc_count":41},{"key":"花蓮高工","doc_count":41},{"key":"華南高商","doc_count":41},{"key":"崇實高工","doc_count":40},{"key":"羅東高商","doc_count":40},{"key":"南大附小","doc_count":39},{"key":"屏東特教","doc_count":39},{"key":"玉井工商","doc_count":39},{"key":"宜蘭高中","doc_count":38},{"key":"臺南一中","doc_count":38},{"key":"澎湖海事","doc_count":36},{"key":"成功商水","doc_count":35},{"key":"臺東女中","doc_count":35},{"key":"臺東高商","doc_count":35}]}}}
DEBUG 2025/12/17 17:39:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:39:00   Bucket[0]: Key=黑快馬主機, DocCount=1435
DEBUG 2025/12/17 17:39:00   Bucket[1]: Key=花蓮高農, DocCount=855
DEBUG 2025/12/17 17:39:00   Bucket[2]: Key=仁愛高農, DocCount=606
DEBUG 2025/12/17 17:39:00   Bucket[3]: Key=金門高中, DocCount=550
DEBUG 2025/12/17 17:39:00   Bucket[4]: Key=金門農工, DocCount=519
DEBUG 2025/12/17 17:39:00   Bucket[5]: Key=南投高商, DocCount=470
DEBUG 2025/12/17 17:39:00   Bucket[6]: Key=新竹女中, DocCount=436
DEBUG 2025/12/17 17:39:00   Bucket[7]: Key=北門高中, DocCount=389
DEBUG 2025/12/17 17:39:00   Bucket[8]: Key=蘇澳海事, DocCount=366
DEBUG 2025/12/17 17:39:00   Bucket[9]: Key=華僑高中, DocCount=346
DEBUG 2025/12/17 17:39:00   Bucket[10]: Key=竹北高中, DocCount=320
DEBUG 2025/12/17 17:39:00   Bucket[11]: Key=宜蘭高商, DocCount=267
DEBUG 2025/12/17 17:39:00   Bucket[12]: Key=內埔農工, DocCount=241
DEBUG 2025/12/17 17:39:00   Bucket[13]: Key=關西高中, DocCount=236
DEBUG 2025/12/17 17:39:00   Bucket[14]: Key=臺東高中, DocCount=215
DEBUG 2025/12/17 17:39:00   Bucket[15]: Key=政大附中, DocCount=208
DEBUG 2025/12/17 17:39:00   Bucket[16]: Key=新港藝高, DocCount=202
DEBUG 2025/12/17 17:39:00   Bucket[17]: Key=興大附中, DocCount=197
DEBUG 2025/12/17 17:39:00   Bucket[18]: Key=竹南高中, DocCount=196
DEBUG 2025/12/17 17:39:00   Bucket[19]: Key=清華附小, DocCount=195
DEBUG 2025/12/17 17:39:00   Bucket[20]: Key=斗六家商, DocCount=180
DEBUG 2025/12/17 17:39:00   Bucket[21]: Key=旗美高中, DocCount=175
DEBUG 2025/12/17 17:39:00   Bucket[22]: Key=關山工商, DocCount=175
DEBUG 2025/12/17 17:39:00   Bucket[23]: Key=新化高中, DocCount=169
DEBUG 2025/12/17 17:39:00   Bucket[24]: Key=中大壢中, DocCount=164
DEBUG 2025/12/17 17:39:00   Bucket[25]: Key=北教大實小, DocCount=164
DEBUG 2025/12/17 17:39:00   Bucket[26]: Key=玉里高中, DocCount=160
DEBUG 2025/12/17 17:39:00   Bucket[27]: Key=南投特教, DocCount=158
DEBUG 2025/12/17 17:39:00   Bucket[28]: Key=後壁高中, DocCount=151
DEBUG 2025/12/17 17:39:00   Bucket[29]: Key=花蓮高商, DocCount=140
DEBUG 2025/12/17 17:39:00   Bucket[30]: Key=竹山高中, DocCount=137
DEBUG 2025/12/17 17:39:00   Bucket[31]: Key=苗栗農工, DocCount=137
DEBUG 2025/12/17 17:39:00   Bucket[32]: Key=屏東女中, DocCount=135
DEBUG 2025/12/17 17:39:00   Bucket[33]: Key=員林家商, DocCount=126
DEBUG 2025/12/17 17:39:00   Bucket[34]: Key=嘉義高商, DocCount=126
DEBUG 2025/12/17 17:39:00   Bucket[35]: Key=潮州高中, DocCount=125
DEBUG 2025/12/17 17:39:00   Bucket[36]: Key=新竹高商, DocCount=116
DEBUG 2025/12/17 17:39:00   Bucket[37]: Key=員林高中, DocCount=115
DEBUG 2025/12/17 17:39:00   Bucket[38]: Key=新化高工, DocCount=111
DEBUG 2025/12/17 17:39:00   Bucket[39]: Key=新營高工, DocCount=106
DEBUG 2025/12/17 17:39:00   Bucket[40]: Key=虎尾高中, DocCount=103
DEBUG 2025/12/17 17:39:00   Bucket[41]: Key=南大附中, DocCount=101
DEBUG 2025/12/17 17:39:00   Bucket[42]: Key=東港海事, DocCount=101
DEBUG 2025/12/17 17:39:00   Bucket[43]: Key=新竹高中, DocCount=100
DEBUG 2025/12/17 17:39:00   Bucket[44]: Key=溪湖高中, DocCount=97
DEBUG 2025/12/17 17:39:00   Bucket[45]: Key=南投高中, DocCount=94
DEBUG 2025/12/17 17:39:00   Bucket[46]: Key=鳳山高中, DocCount=94
DEBUG 2025/12/17 17:39:00   Bucket[47]: Key=新營高中, DocCount=87
DEBUG 2025/12/17 17:39:00   Bucket[48]: Key=嘉義高中, DocCount=86
DEBUG 2025/12/17 17:39:00   Bucket[49]: Key=新竹高工, DocCount=86
DEBUG 2025/12/17 17:39:00   Bucket[50]: Key=基隆商工, DocCount=85
DEBUG 2025/12/17 17:39:00   Bucket[51]: Key=屏科實中, DocCount=83
DEBUG 2025/12/17 17:39:00   Bucket[52]: Key=彰化高商, DocCount=81
DEBUG 2025/12/17 17:39:00   Bucket[53]: Key=南大附聰, DocCount=75
DEBUG 2025/12/17 17:39:00   Bucket[54]: Key=羅東高工, DocCount=74
DEBUG 2025/12/17 17:39:00   Bucket[55]: Key=曾文農工, DocCount=70
DEBUG 2025/12/17 17:39:00   Bucket[56]: Key=師大附中高中部, DocCount=69
DEBUG 2025/12/17 17:39:00   Bucket[57]: Key=成大南工, DocCount=69
DEBUG 2025/12/17 17:39:00   Bucket[58]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:39:00   Bucket[59]: Key=旗山農工, DocCount=67
DEBUG 2025/12/17 17:39:00   Bucket[60]: Key=花蓮高中, DocCount=66
DEBUG 2025/12/17 17:39:00   Bucket[61]: Key=苗栗高商, DocCount=66
DEBUG 2025/12/17 17:39:00   Bucket[62]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 17:39:00   Bucket[63]: Key=高餐大附中, DocCount=63
DEBUG 2025/12/17 17:39:00   Bucket[64]: Key=北斗家商, DocCount=59
DEBUG 2025/12/17 17:39:00   Bucket[65]: Key=北港高中, DocCount=58
DEBUG 2025/12/17 17:39:00   Bucket[66]: Key=中興高中, DocCount=54
DEBUG 2025/12/17 17:39:00   Bucket[67]: Key=土庫商工, DocCount=54
DEBUG 2025/12/17 17:39:00   Bucket[68]: Key=秀水高工, DocCount=54
DEBUG 2025/12/17 17:39:00   Bucket[69]: Key=臺南高商, DocCount=54
DEBUG 2025/12/17 17:39:00   Bucket[70]: Key=興大附農, DocCount=53
DEBUG 2025/12/17 17:39:00   Bucket[71]: Key=新豐高中, DocCount=52
DEBUG 2025/12/17 17:39:00   Bucket[72]: Key=白河商工, DocCount=52
DEBUG 2025/12/17 17:39:00   Bucket[73]: Key=屏東高中, DocCount=51
DEBUG 2025/12/17 17:39:00   Bucket[74]: Key=草屯商工, DocCount=49
DEBUG 2025/12/17 17:39:00   Bucket[75]: Key=彰師附工, DocCount=48
DEBUG 2025/12/17 17:39:00   Bucket[76]: Key=暨大附中, DocCount=48
DEBUG 2025/12/17 17:39:00   Bucket[77]: Key=嘉義高工, DocCount=47
DEBUG 2025/12/17 17:39:00   Bucket[78]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:39:00   Bucket[79]: Key=水里商工, DocCount=45
DEBUG 2025/12/17 17:39:00   Bucket[80]: Key=嘉義家職, DocCount=44
DEBUG 2025/12/17 17:39:00   Bucket[81]: Key=海大附中, DocCount=44
DEBUG 2025/12/17 17:39:00   Bucket[82]: Key=雲林特教, DocCount=44
DEBUG 2025/12/17 17:39:00   Bucket[83]: Key=苗栗高中, DocCount=43
DEBUG 2025/12/17 17:39:00   Bucket[84]: Key=東石高中, DocCount=42
DEBUG 2025/12/17 17:39:00   Bucket[85]: Key=頭城家商, DocCount=42
DEBUG 2025/12/17 17:39:00   Bucket[86]: Key=員林農工, DocCount=41
DEBUG 2025/12/17 17:39:00   Bucket[87]: Key=花蓮高工, DocCount=41
DEBUG 2025/12/17 17:39:00   Bucket[88]: Key=華南高商, DocCount=41
DEBUG 2025/12/17 17:39:00   Bucket[89]: Key=崇實高工, DocCount=40
DEBUG 2025/12/17 17:39:00   Bucket[90]: Key=羅東高商, DocCount=40
DEBUG 2025/12/17 17:39:00   Bucket[91]: Key=南大附小, DocCount=39
DEBUG 2025/12/17 17:39:00   Bucket[92]: Key=屏東特教, DocCount=39
DEBUG 2025/12/17 17:39:00   Bucket[93]: Key=玉井工商, DocCount=39
DEBUG 2025/12/17 17:39:00   Bucket[94]: Key=宜蘭高中, DocCount=38
DEBUG 2025/12/17 17:39:00   Bucket[95]: Key=臺南一中, DocCount=38
DEBUG 2025/12/17 17:39:00   Bucket[96]: Key=澎湖海事, DocCount=36
DEBUG 2025/12/17 17:39:00   Bucket[97]: Key=成功商水, DocCount=35
DEBUG 2025/12/17 17:39:00   Bucket[98]: Key=臺東女中, DocCount=35
DEBUG 2025/12/17 17:39:00   Bucket[99]: Key=臺東高商, DocCount=35
DEBUG 2025/12/17 17:39:00 ========================================================
INFO 2025/12/17 17:39:03 ✅ Successfully flushed 3/3 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:39:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:39:08 Processing 15 offline devices
INFO 2025/12/17 17:39:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:39:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:39:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:39:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:39:08 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:39:08 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:39:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:39:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:39:08 ✅ Successfully flushed 36/36 history records to TimescaleDB
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:39:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:39:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:39:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:39:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:39:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:39:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:39:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:39:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:39:08 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:39:08 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:39:08 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:39:08 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:39:08 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:39:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:39:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:39:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:39:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:39:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:39:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:39:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:39:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:39:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:39:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:39:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:39:13 ✅ Successfully flushed 12/12 history records to TimescaleDB
DEBUG 2025/12/17 17:39:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:39:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:39:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:39:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:39:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:39:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:39:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:39:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:39:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:39:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:39:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:39:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:39:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:39:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:39:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:39:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:39:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:39:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:39:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:39:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:39:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:39:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:39:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:39:45 ES Alert Created [high][performance]: Memory usage high: 88.06% (threshold: 80.00%)
DEBUG 2025/12/17 17:39:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.25% (threshold: 85.00%)
DEBUG 2025/12/17 17:39:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:39:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:39:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:39:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:39:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:39:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:39:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:40:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:40:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:40:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:40:00 Field: school_name.keyword
DEBUG 2025/12/17 17:40:00 Time From: 2025-12-17T17:39:00.000+08:00
DEBUG 2025/12/17 17:40:00 Time To: 2025-12-17T17:40:00.000+08:00
DEBUG 2025/12/17 17:40:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:39:00.000+08:00",
					"lte": "2025-12-17T17:40:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:40:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:40:00 ES Response IsError: false
DEBUG 2025/12/17 17:40:00 ES Response Body:
{"took":67,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":481,"buckets":[{"key":"花蓮高農","doc_count":814},{"key":"黑快馬主機","doc_count":774},{"key":"宜蘭高商","doc_count":617},{"key":"仁愛高農","doc_count":604},{"key":"金門高中","doc_count":571},{"key":"南投高商","doc_count":491},{"key":"新竹女中","doc_count":490},{"key":"北門高中","doc_count":434},{"key":"金門農工","doc_count":425},{"key":"華僑高中","doc_count":344},{"key":"蘇澳海事","doc_count":335},{"key":"竹北高中","doc_count":316},{"key":"花蓮高商","doc_count":282},{"key":"臺東高中","doc_count":276},{"key":"內埔農工","doc_count":243},{"key":"清華附小","doc_count":227},{"key":"中大壢中","doc_count":226},{"key":"關西高中","doc_count":219},{"key":"苗栗農工","doc_count":207},{"key":"斗六家商","doc_count":204},{"key":"旗美高中","doc_count":204},{"key":"新化高中","doc_count":203},{"key":"興大附中","doc_count":203},{"key":"新港藝高","doc_count":197},{"key":"關山工商","doc_count":191},{"key":"嘉義高中","doc_count":189},{"key":"玉里高中","doc_count":181},{"key":"南投特教","doc_count":169},{"key":"屏東女中","doc_count":164},{"key":"後壁高中","doc_count":161},{"key":"鳳山高中","doc_count":157},{"key":"新化高工","doc_count":152},{"key":"嘉義高商","doc_count":150},{"key":"竹南高中","doc_count":149},{"key":"新營高工","doc_count":146},{"key":"北教大實小","doc_count":145},{"key":"宜蘭高中","doc_count":139},{"key":"東港海事","doc_count":120},{"key":"虎尾高中","doc_count":116},{"key":"潮州高中","doc_count":113},{"key":"南大附聰","doc_count":104},{"key":"員林家商","doc_count":102},{"key":"屏東高中","doc_count":99},{"key":"苗栗高商","doc_count":99},{"key":"北斗家商","doc_count":98},{"key":"成大南工","doc_count":98},{"key":"彰化高商","doc_count":97},{"key":"政大附中","doc_count":94},{"key":"中興高中","doc_count":90},{"key":"北港高中","doc_count":90},{"key":"員林高中","doc_count":90},{"key":"彰師附工","doc_count":86},{"key":"師大附中高中部","doc_count":85},{"key":"南投高中","doc_count":84},{"key":"員林農工","doc_count":82},{"key":"嘉科實中","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"屏科實中","doc_count":79},{"key":"南大附中","doc_count":77},{"key":"新竹高中","doc_count":74},{"key":"高餐大附中","doc_count":73},{"key":"暨大附中","doc_count":70},{"key":"南大附小","doc_count":64},{"key":"基隆商工","doc_count":64},{"key":"臺南高商","doc_count":64},{"key":"新竹高工","doc_count":62},{"key":"雲林特教","doc_count":62},{"key":"海大附中","doc_count":61},{"key":"草屯商工","doc_count":61},{"key":"興大附農","doc_count":59},{"key":"永靖高工","doc_count":56},{"key":"屏東高工","doc_count":54},{"key":"溪湖高中","doc_count":54},{"key":"臺南一中","doc_count":54},{"key":"曾文農工","doc_count":53},{"key":"土庫商工","doc_count":51},{"key":"羅東高工","doc_count":51},{"key":"二林工商","doc_count":49},{"key":"嘉義高工","doc_count":49},{"key":"白河商工","doc_count":49},{"key":"北港農工","doc_count":48},{"key":"嘉義家職","doc_count":48},{"key":"屏東特教","doc_count":47},{"key":"新豐高中","doc_count":47},{"key":"秀水高工","doc_count":46},{"key":"華南高商","doc_count":46},{"key":"水里商工","doc_count":45},{"key":"頭城家商","doc_count":45},{"key":"新竹特教","doc_count":43},{"key":"花蓮高工","doc_count":43},{"key":"新竹高商","doc_count":42},{"key":"善化高中","doc_count":41},{"key":"佳冬高農","doc_count":40},{"key":"基隆特教","doc_count":39},{"key":"花蓮高中","doc_count":39},{"key":"崇實高工","doc_count":38},{"key":"羅東高商","doc_count":38},{"key":"家齊高中","doc_count":37},{"key":"花蓮特教","doc_count":36},{"key":"澎湖海事","doc_count":35}]}}}
DEBUG 2025/12/17 17:40:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:40:00   Bucket[0]: Key=花蓮高農, DocCount=814
DEBUG 2025/12/17 17:40:00   Bucket[1]: Key=黑快馬主機, DocCount=774
DEBUG 2025/12/17 17:40:00   Bucket[2]: Key=宜蘭高商, DocCount=617
DEBUG 2025/12/17 17:40:00   Bucket[3]: Key=仁愛高農, DocCount=604
DEBUG 2025/12/17 17:40:00   Bucket[4]: Key=金門高中, DocCount=571
DEBUG 2025/12/17 17:40:00   Bucket[5]: Key=南投高商, DocCount=491
DEBUG 2025/12/17 17:40:00   Bucket[6]: Key=新竹女中, DocCount=490
DEBUG 2025/12/17 17:40:00   Bucket[7]: Key=北門高中, DocCount=434
DEBUG 2025/12/17 17:40:00   Bucket[8]: Key=金門農工, DocCount=425
DEBUG 2025/12/17 17:40:00   Bucket[9]: Key=華僑高中, DocCount=344
DEBUG 2025/12/17 17:40:00   Bucket[10]: Key=蘇澳海事, DocCount=335
DEBUG 2025/12/17 17:40:00   Bucket[11]: Key=竹北高中, DocCount=316
DEBUG 2025/12/17 17:40:00   Bucket[12]: Key=花蓮高商, DocCount=282
DEBUG 2025/12/17 17:40:00   Bucket[13]: Key=臺東高中, DocCount=276
DEBUG 2025/12/17 17:40:00   Bucket[14]: Key=內埔農工, DocCount=243
DEBUG 2025/12/17 17:40:00   Bucket[15]: Key=清華附小, DocCount=227
DEBUG 2025/12/17 17:40:00   Bucket[16]: Key=中大壢中, DocCount=226
DEBUG 2025/12/17 17:40:00   Bucket[17]: Key=關西高中, DocCount=219
DEBUG 2025/12/17 17:40:00   Bucket[18]: Key=苗栗農工, DocCount=207
DEBUG 2025/12/17 17:40:00   Bucket[19]: Key=斗六家商, DocCount=204
DEBUG 2025/12/17 17:40:00   Bucket[20]: Key=旗美高中, DocCount=204
DEBUG 2025/12/17 17:40:00   Bucket[21]: Key=新化高中, DocCount=203
DEBUG 2025/12/17 17:40:00   Bucket[22]: Key=興大附中, DocCount=203
DEBUG 2025/12/17 17:40:00   Bucket[23]: Key=新港藝高, DocCount=197
DEBUG 2025/12/17 17:40:00   Bucket[24]: Key=關山工商, DocCount=191
DEBUG 2025/12/17 17:40:00   Bucket[25]: Key=嘉義高中, DocCount=189
DEBUG 2025/12/17 17:40:00   Bucket[26]: Key=玉里高中, DocCount=181
DEBUG 2025/12/17 17:40:00   Bucket[27]: Key=南投特教, DocCount=169
DEBUG 2025/12/17 17:40:00   Bucket[28]: Key=屏東女中, DocCount=164
DEBUG 2025/12/17 17:40:00   Bucket[29]: Key=後壁高中, DocCount=161
DEBUG 2025/12/17 17:40:00   Bucket[30]: Key=鳳山高中, DocCount=157
DEBUG 2025/12/17 17:40:00   Bucket[31]: Key=新化高工, DocCount=152
DEBUG 2025/12/17 17:40:00   Bucket[32]: Key=嘉義高商, DocCount=150
DEBUG 2025/12/17 17:40:00   Bucket[33]: Key=竹南高中, DocCount=149
DEBUG 2025/12/17 17:40:00   Bucket[34]: Key=新營高工, DocCount=146
DEBUG 2025/12/17 17:40:00   Bucket[35]: Key=北教大實小, DocCount=145
DEBUG 2025/12/17 17:40:00   Bucket[36]: Key=宜蘭高中, DocCount=139
DEBUG 2025/12/17 17:40:00   Bucket[37]: Key=東港海事, DocCount=120
DEBUG 2025/12/17 17:40:00   Bucket[38]: Key=虎尾高中, DocCount=116
DEBUG 2025/12/17 17:40:00   Bucket[39]: Key=潮州高中, DocCount=113
DEBUG 2025/12/17 17:40:00   Bucket[40]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:40:00   Bucket[41]: Key=員林家商, DocCount=102
DEBUG 2025/12/17 17:40:00   Bucket[42]: Key=屏東高中, DocCount=99
DEBUG 2025/12/17 17:40:00   Bucket[43]: Key=苗栗高商, DocCount=99
DEBUG 2025/12/17 17:40:00   Bucket[44]: Key=北斗家商, DocCount=98
DEBUG 2025/12/17 17:40:00   Bucket[45]: Key=成大南工, DocCount=98
DEBUG 2025/12/17 17:40:00   Bucket[46]: Key=彰化高商, DocCount=97
DEBUG 2025/12/17 17:40:00   Bucket[47]: Key=政大附中, DocCount=94
DEBUG 2025/12/17 17:40:00   Bucket[48]: Key=中興高中, DocCount=90
DEBUG 2025/12/17 17:40:00   Bucket[49]: Key=北港高中, DocCount=90
DEBUG 2025/12/17 17:40:00   Bucket[50]: Key=員林高中, DocCount=90
DEBUG 2025/12/17 17:40:00   Bucket[51]: Key=彰師附工, DocCount=86
DEBUG 2025/12/17 17:40:00   Bucket[52]: Key=師大附中高中部, DocCount=85
DEBUG 2025/12/17 17:40:00   Bucket[53]: Key=南投高中, DocCount=84
DEBUG 2025/12/17 17:40:00   Bucket[54]: Key=員林農工, DocCount=82
DEBUG 2025/12/17 17:40:00   Bucket[55]: Key=嘉科實中, DocCount=82
DEBUG 2025/12/17 17:40:00   Bucket[56]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 17:40:00   Bucket[57]: Key=屏科實中, DocCount=79
DEBUG 2025/12/17 17:40:00   Bucket[58]: Key=南大附中, DocCount=77
DEBUG 2025/12/17 17:40:00   Bucket[59]: Key=新竹高中, DocCount=74
DEBUG 2025/12/17 17:40:00   Bucket[60]: Key=高餐大附中, DocCount=73
DEBUG 2025/12/17 17:40:00   Bucket[61]: Key=暨大附中, DocCount=70
DEBUG 2025/12/17 17:40:00   Bucket[62]: Key=南大附小, DocCount=64
DEBUG 2025/12/17 17:40:00   Bucket[63]: Key=基隆商工, DocCount=64
DEBUG 2025/12/17 17:40:00   Bucket[64]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 17:40:00   Bucket[65]: Key=新竹高工, DocCount=62
DEBUG 2025/12/17 17:40:00   Bucket[66]: Key=雲林特教, DocCount=62
DEBUG 2025/12/17 17:40:00   Bucket[67]: Key=海大附中, DocCount=61
DEBUG 2025/12/17 17:40:00   Bucket[68]: Key=草屯商工, DocCount=61
DEBUG 2025/12/17 17:40:00   Bucket[69]: Key=興大附農, DocCount=59
DEBUG 2025/12/17 17:40:00   Bucket[70]: Key=永靖高工, DocCount=56
DEBUG 2025/12/17 17:40:00   Bucket[71]: Key=屏東高工, DocCount=54
DEBUG 2025/12/17 17:40:00   Bucket[72]: Key=溪湖高中, DocCount=54
DEBUG 2025/12/17 17:40:00   Bucket[73]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 17:40:00   Bucket[74]: Key=曾文農工, DocCount=53
DEBUG 2025/12/17 17:40:00   Bucket[75]: Key=土庫商工, DocCount=51
DEBUG 2025/12/17 17:40:00   Bucket[76]: Key=羅東高工, DocCount=51
DEBUG 2025/12/17 17:40:00   Bucket[77]: Key=二林工商, DocCount=49
DEBUG 2025/12/17 17:40:00   Bucket[78]: Key=嘉義高工, DocCount=49
DEBUG 2025/12/17 17:40:00   Bucket[79]: Key=白河商工, DocCount=49
DEBUG 2025/12/17 17:40:00   Bucket[80]: Key=北港農工, DocCount=48
DEBUG 2025/12/17 17:40:00   Bucket[81]: Key=嘉義家職, DocCount=48
DEBUG 2025/12/17 17:40:00   Bucket[82]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:40:00   Bucket[83]: Key=新豐高中, DocCount=47
DEBUG 2025/12/17 17:40:00   Bucket[84]: Key=秀水高工, DocCount=46
DEBUG 2025/12/17 17:40:00   Bucket[85]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:40:00   Bucket[86]: Key=水里商工, DocCount=45
DEBUG 2025/12/17 17:40:00   Bucket[87]: Key=頭城家商, DocCount=45
DEBUG 2025/12/17 17:40:00   Bucket[88]: Key=新竹特教, DocCount=43
DEBUG 2025/12/17 17:40:00   Bucket[89]: Key=花蓮高工, DocCount=43
DEBUG 2025/12/17 17:40:00   Bucket[90]: Key=新竹高商, DocCount=42
DEBUG 2025/12/17 17:40:00   Bucket[91]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:40:00   Bucket[92]: Key=佳冬高農, DocCount=40
DEBUG 2025/12/17 17:40:00   Bucket[93]: Key=基隆特教, DocCount=39
DEBUG 2025/12/17 17:40:00   Bucket[94]: Key=花蓮高中, DocCount=39
DEBUG 2025/12/17 17:40:00   Bucket[95]: Key=崇實高工, DocCount=38
DEBUG 2025/12/17 17:40:00   Bucket[96]: Key=羅東高商, DocCount=38
DEBUG 2025/12/17 17:40:00   Bucket[97]: Key=家齊高中, DocCount=37
DEBUG 2025/12/17 17:40:00   Bucket[98]: Key=花蓮特教, DocCount=36
DEBUG 2025/12/17 17:40:00   Bucket[99]: Key=澎湖海事, DocCount=35
DEBUG 2025/12/17 17:40:00 ========================================================
INFO 2025/12/17 17:40:03 ✅ Successfully flushed 14/14 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:40:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:40:07 Processing 15 offline devices
INFO 2025/12/17 17:40:07 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:40:07 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:40:07 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:40:07 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:40:07 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:40:07 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:40:07 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:40:07 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:40:07 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:40:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:40:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:40:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:40:07 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:40:07 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:40:08 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:40:08 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:40:08 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:40:08 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:40:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:40:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:40:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:40:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:40:08 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:40:08 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:40:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:40:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:40:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:40:08 ✅ Successfully flushed 36/36 history records to TimescaleDB
DEBUG 2025/12/17 17:40:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:40:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:40:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:40:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:40:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:40:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:40:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:40:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:40:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:40:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:40:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:40:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:40:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:40:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:40:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:40:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:40:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:40:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:40:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:40:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:40:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:40:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:40:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.24% (threshold: 90.00%)
INFO 2025/12/17 17:40:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:40:45 ES Alert Created [high][capacity]: Disk usage high: 93.25% (threshold: 85.00%)
WARN 2025/12/17 17:40:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:40:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:40:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:40:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:40:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:40:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:40:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:40:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:41:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:41:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:41:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:41:00 Field: school_name.keyword
DEBUG 2025/12/17 17:41:00 Time From: 2025-12-17T17:40:00.000+08:00
DEBUG 2025/12/17 17:41:00 Time To: 2025-12-17T17:41:00.000+08:00
DEBUG 2025/12/17 17:41:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:40:00.000+08:00",
					"lte": "2025-12-17T17:41:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:41:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:41:00 ES Response IsError: false
DEBUG 2025/12/17 17:41:00 ES Response Body:
{"took":237,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":435,"buckets":[{"key":"黑快馬主機","doc_count":1092},{"key":"花蓮高農","doc_count":841},{"key":"仁愛高農","doc_count":618},{"key":"金門高中","doc_count":581},{"key":"金門農工","doc_count":475},{"key":"新竹女中","doc_count":472},{"key":"北門高中","doc_count":411},{"key":"南投高商","doc_count":389},{"key":"宜蘭高商","doc_count":389},{"key":"玉里高中","doc_count":320},{"key":"華僑高中","doc_count":311},{"key":"蘇澳海事","doc_count":308},{"key":"新營高工","doc_count":301},{"key":"竹北高中","doc_count":266},{"key":"興大附中","doc_count":252},{"key":"內埔農工","doc_count":246},{"key":"新港藝高","doc_count":241},{"key":"臺東高中","doc_count":216},{"key":"旗美高中","doc_count":215},{"key":"清華附小","doc_count":215},{"key":"新化高工","doc_count":211},{"key":"關西高中","doc_count":206},{"key":"關山工商","doc_count":187},{"key":"中大壢中","doc_count":180},{"key":"花蓮高商","doc_count":179},{"key":"後壁高中","doc_count":176},{"key":"嘉義高商","doc_count":174},{"key":"斗六家商","doc_count":171},{"key":"苗栗農工","doc_count":152},{"key":"竹南高中","doc_count":151},{"key":"虎尾高中","doc_count":148},{"key":"南投特教","doc_count":147},{"key":"溪湖高中","doc_count":142},{"key":"屏東女中","doc_count":133},{"key":"嘉科實中","doc_count":130},{"key":"政大附中","doc_count":127},{"key":"鳳山高中","doc_count":125},{"key":"師大附中高中部","doc_count":122},{"key":"新化高中","doc_count":118},{"key":"中興高中","doc_count":117},{"key":"員林家商","doc_count":117},{"key":"屏東特教","doc_count":108},{"key":"東港海事","doc_count":108},{"key":"南投高中","doc_count":105},{"key":"潮州高中","doc_count":100},{"key":"彰師附工","doc_count":98},{"key":"南大附聰","doc_count":93},{"key":"北斗家商","doc_count":88},{"key":"南大附中","doc_count":84},{"key":"新營高中","doc_count":79},{"key":"嘉義高中","doc_count":77},{"key":"苗栗高商","doc_count":75},{"key":"海大附中","doc_count":74},{"key":"雲林特教","doc_count":69},{"key":"屏科實中","doc_count":68},{"key":"彰化高商","doc_count":68},{"key":"暨大附中","doc_count":68},{"key":"屏東高中","doc_count":66},{"key":"二林工商","doc_count":65},{"key":"成大南工","doc_count":65},{"key":"頭城家商","doc_count":65},{"key":"嘉義高工","doc_count":64},{"key":"新竹高工","doc_count":64},{"key":"花蓮高工","doc_count":64},{"key":"北教大實小","doc_count":63},{"key":"北港農工","doc_count":62},{"key":"東石高中","doc_count":60},{"key":"土庫商工","doc_count":58},{"key":"新竹高商","doc_count":56},{"key":"臺東女中","doc_count":56},{"key":"羅東高工","doc_count":54},{"key":"臺南高商","doc_count":54},{"key":"華南高商","doc_count":54},{"key":"宜蘭高中","doc_count":53},{"key":"永靖高工","doc_count":50},{"key":"臺南一中","doc_count":50},{"key":"臺東高商","doc_count":50},{"key":"員林農工","doc_count":49},{"key":"崇實高工","doc_count":49},{"key":"北港高中","doc_count":48},{"key":"南大附小","doc_count":47},{"key":"興大附農","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"屏東高工","doc_count":46},{"key":"善化高中","doc_count":44},{"key":"新豐高中","doc_count":44},{"key":"蘭陽女中","doc_count":44},{"key":"曾文農工","doc_count":43},{"key":"羅東高商","doc_count":43},{"key":"白河商工","doc_count":42},{"key":"澎湖海事","doc_count":41},{"key":"員林高中","doc_count":40},{"key":"竹山高中","doc_count":40},{"key":"竹東高中","doc_count":39},{"key":"花蓮高中","doc_count":39},{"key":"花蓮特教","doc_count":38},{"key":"埔里高工","doc_count":37},{"key":"秀水高工","doc_count":37},{"key":"新竹高中","doc_count":36},{"key":"高餐大附中","doc_count":36}]}}}
DEBUG 2025/12/17 17:41:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:41:00   Bucket[0]: Key=黑快馬主機, DocCount=1092
DEBUG 2025/12/17 17:41:00   Bucket[1]: Key=花蓮高農, DocCount=841
DEBUG 2025/12/17 17:41:00   Bucket[2]: Key=仁愛高農, DocCount=618
DEBUG 2025/12/17 17:41:00   Bucket[3]: Key=金門高中, DocCount=581
DEBUG 2025/12/17 17:41:00   Bucket[4]: Key=金門農工, DocCount=475
DEBUG 2025/12/17 17:41:00   Bucket[5]: Key=新竹女中, DocCount=472
DEBUG 2025/12/17 17:41:00   Bucket[6]: Key=北門高中, DocCount=411
DEBUG 2025/12/17 17:41:00   Bucket[7]: Key=南投高商, DocCount=389
DEBUG 2025/12/17 17:41:00   Bucket[8]: Key=宜蘭高商, DocCount=389
DEBUG 2025/12/17 17:41:00   Bucket[9]: Key=玉里高中, DocCount=320
DEBUG 2025/12/17 17:41:00   Bucket[10]: Key=華僑高中, DocCount=311
DEBUG 2025/12/17 17:41:00   Bucket[11]: Key=蘇澳海事, DocCount=308
DEBUG 2025/12/17 17:41:00   Bucket[12]: Key=新營高工, DocCount=301
DEBUG 2025/12/17 17:41:00   Bucket[13]: Key=竹北高中, DocCount=266
DEBUG 2025/12/17 17:41:00   Bucket[14]: Key=興大附中, DocCount=252
DEBUG 2025/12/17 17:41:00   Bucket[15]: Key=內埔農工, DocCount=246
DEBUG 2025/12/17 17:41:00   Bucket[16]: Key=新港藝高, DocCount=241
DEBUG 2025/12/17 17:41:00   Bucket[17]: Key=臺東高中, DocCount=216
DEBUG 2025/12/17 17:41:00   Bucket[18]: Key=旗美高中, DocCount=215
DEBUG 2025/12/17 17:41:00   Bucket[19]: Key=清華附小, DocCount=215
DEBUG 2025/12/17 17:41:00   Bucket[20]: Key=新化高工, DocCount=211
DEBUG 2025/12/17 17:41:00   Bucket[21]: Key=關西高中, DocCount=206
DEBUG 2025/12/17 17:41:00   Bucket[22]: Key=關山工商, DocCount=187
DEBUG 2025/12/17 17:41:00   Bucket[23]: Key=中大壢中, DocCount=180
DEBUG 2025/12/17 17:41:00   Bucket[24]: Key=花蓮高商, DocCount=179
DEBUG 2025/12/17 17:41:00   Bucket[25]: Key=後壁高中, DocCount=176
DEBUG 2025/12/17 17:41:00   Bucket[26]: Key=嘉義高商, DocCount=174
DEBUG 2025/12/17 17:41:00   Bucket[27]: Key=斗六家商, DocCount=171
DEBUG 2025/12/17 17:41:00   Bucket[28]: Key=苗栗農工, DocCount=152
DEBUG 2025/12/17 17:41:00   Bucket[29]: Key=竹南高中, DocCount=151
DEBUG 2025/12/17 17:41:00   Bucket[30]: Key=虎尾高中, DocCount=148
DEBUG 2025/12/17 17:41:00   Bucket[31]: Key=南投特教, DocCount=147
DEBUG 2025/12/17 17:41:00   Bucket[32]: Key=溪湖高中, DocCount=142
DEBUG 2025/12/17 17:41:00   Bucket[33]: Key=屏東女中, DocCount=133
DEBUG 2025/12/17 17:41:00   Bucket[34]: Key=嘉科實中, DocCount=130
DEBUG 2025/12/17 17:41:00   Bucket[35]: Key=政大附中, DocCount=127
DEBUG 2025/12/17 17:41:00   Bucket[36]: Key=鳳山高中, DocCount=125
DEBUG 2025/12/17 17:41:00   Bucket[37]: Key=師大附中高中部, DocCount=122
DEBUG 2025/12/17 17:41:00   Bucket[38]: Key=新化高中, DocCount=118
DEBUG 2025/12/17 17:41:00   Bucket[39]: Key=中興高中, DocCount=117
DEBUG 2025/12/17 17:41:00   Bucket[40]: Key=員林家商, DocCount=117
DEBUG 2025/12/17 17:41:00   Bucket[41]: Key=屏東特教, DocCount=108
DEBUG 2025/12/17 17:41:00   Bucket[42]: Key=東港海事, DocCount=108
DEBUG 2025/12/17 17:41:00   Bucket[43]: Key=南投高中, DocCount=105
DEBUG 2025/12/17 17:41:00   Bucket[44]: Key=潮州高中, DocCount=100
DEBUG 2025/12/17 17:41:00   Bucket[45]: Key=彰師附工, DocCount=98
DEBUG 2025/12/17 17:41:00   Bucket[46]: Key=南大附聰, DocCount=93
DEBUG 2025/12/17 17:41:00   Bucket[47]: Key=北斗家商, DocCount=88
DEBUG 2025/12/17 17:41:00   Bucket[48]: Key=南大附中, DocCount=84
DEBUG 2025/12/17 17:41:00   Bucket[49]: Key=新營高中, DocCount=79
DEBUG 2025/12/17 17:41:00   Bucket[50]: Key=嘉義高中, DocCount=77
DEBUG 2025/12/17 17:41:00   Bucket[51]: Key=苗栗高商, DocCount=75
DEBUG 2025/12/17 17:41:00   Bucket[52]: Key=海大附中, DocCount=74
DEBUG 2025/12/17 17:41:00   Bucket[53]: Key=雲林特教, DocCount=69
DEBUG 2025/12/17 17:41:00   Bucket[54]: Key=屏科實中, DocCount=68
DEBUG 2025/12/17 17:41:00   Bucket[55]: Key=彰化高商, DocCount=68
DEBUG 2025/12/17 17:41:00   Bucket[56]: Key=暨大附中, DocCount=68
DEBUG 2025/12/17 17:41:00   Bucket[57]: Key=屏東高中, DocCount=66
DEBUG 2025/12/17 17:41:00   Bucket[58]: Key=二林工商, DocCount=65
DEBUG 2025/12/17 17:41:00   Bucket[59]: Key=成大南工, DocCount=65
DEBUG 2025/12/17 17:41:00   Bucket[60]: Key=頭城家商, DocCount=65
DEBUG 2025/12/17 17:41:00   Bucket[61]: Key=嘉義高工, DocCount=64
DEBUG 2025/12/17 17:41:00   Bucket[62]: Key=新竹高工, DocCount=64
DEBUG 2025/12/17 17:41:00   Bucket[63]: Key=花蓮高工, DocCount=64
DEBUG 2025/12/17 17:41:00   Bucket[64]: Key=北教大實小, DocCount=63
DEBUG 2025/12/17 17:41:00   Bucket[65]: Key=北港農工, DocCount=62
DEBUG 2025/12/17 17:41:00   Bucket[66]: Key=東石高中, DocCount=60
DEBUG 2025/12/17 17:41:00   Bucket[67]: Key=土庫商工, DocCount=58
DEBUG 2025/12/17 17:41:00   Bucket[68]: Key=新竹高商, DocCount=56
DEBUG 2025/12/17 17:41:00   Bucket[69]: Key=臺東女中, DocCount=56
DEBUG 2025/12/17 17:41:00   Bucket[70]: Key=羅東高工, DocCount=54
DEBUG 2025/12/17 17:41:00   Bucket[71]: Key=臺南高商, DocCount=54
DEBUG 2025/12/17 17:41:00   Bucket[72]: Key=華南高商, DocCount=54
DEBUG 2025/12/17 17:41:00   Bucket[73]: Key=宜蘭高中, DocCount=53
DEBUG 2025/12/17 17:41:00   Bucket[74]: Key=永靖高工, DocCount=50
DEBUG 2025/12/17 17:41:00   Bucket[75]: Key=臺南一中, DocCount=50
DEBUG 2025/12/17 17:41:00   Bucket[76]: Key=臺東高商, DocCount=50
DEBUG 2025/12/17 17:41:00   Bucket[77]: Key=員林農工, DocCount=49
DEBUG 2025/12/17 17:41:00   Bucket[78]: Key=崇實高工, DocCount=49
DEBUG 2025/12/17 17:41:00   Bucket[79]: Key=北港高中, DocCount=48
DEBUG 2025/12/17 17:41:00   Bucket[80]: Key=南大附小, DocCount=47
DEBUG 2025/12/17 17:41:00   Bucket[81]: Key=興大附農, DocCount=47
DEBUG 2025/12/17 17:41:00   Bucket[82]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:41:00   Bucket[83]: Key=屏東高工, DocCount=46
DEBUG 2025/12/17 17:41:00   Bucket[84]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:41:00   Bucket[85]: Key=新豐高中, DocCount=44
DEBUG 2025/12/17 17:41:00   Bucket[86]: Key=蘭陽女中, DocCount=44
DEBUG 2025/12/17 17:41:00   Bucket[87]: Key=曾文農工, DocCount=43
DEBUG 2025/12/17 17:41:00   Bucket[88]: Key=羅東高商, DocCount=43
DEBUG 2025/12/17 17:41:00   Bucket[89]: Key=白河商工, DocCount=42
DEBUG 2025/12/17 17:41:00   Bucket[90]: Key=澎湖海事, DocCount=41
DEBUG 2025/12/17 17:41:00   Bucket[91]: Key=員林高中, DocCount=40
DEBUG 2025/12/17 17:41:00   Bucket[92]: Key=竹山高中, DocCount=40
DEBUG 2025/12/17 17:41:00   Bucket[93]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 17:41:00   Bucket[94]: Key=花蓮高中, DocCount=39
DEBUG 2025/12/17 17:41:00   Bucket[95]: Key=花蓮特教, DocCount=38
DEBUG 2025/12/17 17:41:00   Bucket[96]: Key=埔里高工, DocCount=37
DEBUG 2025/12/17 17:41:00   Bucket[97]: Key=秀水高工, DocCount=37
DEBUG 2025/12/17 17:41:00   Bucket[98]: Key=新竹高中, DocCount=36
DEBUG 2025/12/17 17:41:00   Bucket[99]: Key=高餐大附中, DocCount=36
DEBUG 2025/12/17 17:41:00 ========================================================
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:41:11 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:41:13 ✅ Successfully flushed 28/28 history records to TimescaleDB
INFO 2025/12/17 17:41:13 Processing 15 offline devices
INFO 2025/12/17 17:41:13 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:41:13 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:41:13 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:41:13 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:41:13 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:41:14 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:41:14 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:41:14 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:41:14 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:41:14 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:41:14 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:41:14 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:41:14 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:41:14 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:41:14 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:41:14 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:41:14 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:41:14 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:41:14 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:41:14 Creating history record for offline device: 水里商工
INFO 2025/12/17 17:41:14 About to add history to batch for device: 水里商工
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 水里商工
INFO 2025/12/17 17:41:14 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:41:14 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:41:14 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:41:14 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:41:14 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:41:14 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:41:14 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:41:14 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:41:14 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:41:14 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:41:14 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:41:18 ✅ Successfully flushed 21/21 history records to TimescaleDB
DEBUG 2025/12/17 17:41:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:41:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:41:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:41:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:41:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:41:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:41:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:41:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:41:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:41:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:41:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:41:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:41:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:41:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:41:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:41:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:41:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:41:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:41:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:41:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:41:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.37% (threshold: 80.00%)
INFO 2025/12/17 17:41:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:41:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:41:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:41:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:41:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:41:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:42:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:42:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:42:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:42:00 Field: school_name.keyword
DEBUG 2025/12/17 17:42:00 Time From: 2025-12-17T17:41:00.000+08:00
DEBUG 2025/12/17 17:42:00 Time To: 2025-12-17T17:42:00.000+08:00
DEBUG 2025/12/17 17:42:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:41:00.000+08:00",
					"lte": "2025-12-17T17:42:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:42:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:42:00 ES Response IsError: false
DEBUG 2025/12/17 17:42:00 ES Response Body:
{"took":61,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":476,"buckets":[{"key":"黑快馬主機","doc_count":1091},{"key":"花蓮高農","doc_count":971},{"key":"金門高中","doc_count":655},{"key":"仁愛高農","doc_count":608},{"key":"南大附聰","doc_count":530},{"key":"金門農工","doc_count":473},{"key":"新竹女中","doc_count":427},{"key":"北門高中","doc_count":378},{"key":"南投高商","doc_count":336},{"key":"宜蘭高商","doc_count":325},{"key":"華僑高中","doc_count":317},{"key":"蘇澳海事","doc_count":288},{"key":"玉里高中","doc_count":280},{"key":"竹北高中","doc_count":264},{"key":"臺東高中","doc_count":251},{"key":"清華附小","doc_count":233},{"key":"內埔農工","doc_count":232},{"key":"興大附中","doc_count":221},{"key":"關西高中","doc_count":203},{"key":"旗美高中","doc_count":202},{"key":"中大壢中","doc_count":201},{"key":"花蓮高商","doc_count":197},{"key":"新港藝高","doc_count":190},{"key":"新營高工","doc_count":190},{"key":"斗六家商","doc_count":184},{"key":"南投高中","doc_count":181},{"key":"新化高工","doc_count":180},{"key":"苗栗農工","doc_count":177},{"key":"關山工商","doc_count":176},{"key":"後壁高中","doc_count":172},{"key":"政大附中","doc_count":164},{"key":"南投特教","doc_count":152},{"key":"嘉義高商","doc_count":134},{"key":"東港海事","doc_count":134},{"key":"員林家商","doc_count":132},{"key":"竹南高中","doc_count":121},{"key":"屏東女中","doc_count":120},{"key":"新竹高工","doc_count":112},{"key":"新化高中","doc_count":110},{"key":"溪湖高中","doc_count":108},{"key":"虎尾高中","doc_count":108},{"key":"苗栗高商","doc_count":106},{"key":"北教大實小","doc_count":101},{"key":"嘉科實中","doc_count":101},{"key":"新竹高中","doc_count":100},{"key":"北斗家商","doc_count":90},{"key":"成大南工","doc_count":90},{"key":"鳳山高中","doc_count":87},{"key":"北港高中","doc_count":86},{"key":"員林高中","doc_count":84},{"key":"潮州高中","doc_count":84},{"key":"彰師附工","doc_count":83},{"key":"嘉義高中","doc_count":81},{"key":"師大附中高中部","doc_count":81},{"key":"澎湖海事","doc_count":80},{"key":"海大附中","doc_count":77},{"key":"新營高中","doc_count":75},{"key":"中興高中","doc_count":70},{"key":"屏科實中","doc_count":70},{"key":"北港農工","doc_count":67},{"key":"新豐高中","doc_count":67},{"key":"彰化高商","doc_count":65},{"key":"羅東高工","doc_count":64},{"key":"新竹高商","doc_count":62},{"key":"臺東女中","doc_count":62},{"key":"臺南高商","doc_count":60},{"key":"永靖高工","doc_count":59},{"key":"南大附中","doc_count":58},{"key":"屏東高中","doc_count":58},{"key":"基隆商工","doc_count":56},{"key":"白河商工","doc_count":56},{"key":"華南高商","doc_count":56},{"key":"嘉義高工","doc_count":55},{"key":"旗山農工","doc_count":55},{"key":"屏東高工","doc_count":54},{"key":"竹山高中","doc_count":54},{"key":"雲林特教","doc_count":54},{"key":"東石高中","doc_count":53},{"key":"興大附農","doc_count":53},{"key":"苗栗高中","doc_count":53},{"key":"屏北高中","doc_count":51},{"key":"秀水高工","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"屏東特教","doc_count":49},{"key":"臺東高商","doc_count":48},{"key":"善化高中","doc_count":47},{"key":"水里商工","doc_count":47},{"key":"蘭陽女中","doc_count":47},{"key":"家齊高中","doc_count":46},{"key":"玉井工商","doc_count":46},{"key":"臺南一中","doc_count":46},{"key":"草屯商工","doc_count":45},{"key":"高餐大附中","doc_count":45},{"key":"花蓮高中","doc_count":44},{"key":"宜蘭高中","doc_count":43},{"key":"羅東高商","doc_count":43},{"key":"員林農工","doc_count":42},{"key":"埔里高工","doc_count":39},{"key":"成功商水","doc_count":38},{"key":"暨大附中","doc_count":38}]}}}
DEBUG 2025/12/17 17:42:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:42:00   Bucket[0]: Key=黑快馬主機, DocCount=1091
DEBUG 2025/12/17 17:42:00   Bucket[1]: Key=花蓮高農, DocCount=971
DEBUG 2025/12/17 17:42:00   Bucket[2]: Key=金門高中, DocCount=655
DEBUG 2025/12/17 17:42:00   Bucket[3]: Key=仁愛高農, DocCount=608
DEBUG 2025/12/17 17:42:00   Bucket[4]: Key=南大附聰, DocCount=530
DEBUG 2025/12/17 17:42:00   Bucket[5]: Key=金門農工, DocCount=473
DEBUG 2025/12/17 17:42:00   Bucket[6]: Key=新竹女中, DocCount=427
DEBUG 2025/12/17 17:42:00   Bucket[7]: Key=北門高中, DocCount=378
DEBUG 2025/12/17 17:42:00   Bucket[8]: Key=南投高商, DocCount=336
DEBUG 2025/12/17 17:42:00   Bucket[9]: Key=宜蘭高商, DocCount=325
DEBUG 2025/12/17 17:42:00   Bucket[10]: Key=華僑高中, DocCount=317
DEBUG 2025/12/17 17:42:00   Bucket[11]: Key=蘇澳海事, DocCount=288
DEBUG 2025/12/17 17:42:00   Bucket[12]: Key=玉里高中, DocCount=280
DEBUG 2025/12/17 17:42:00   Bucket[13]: Key=竹北高中, DocCount=264
DEBUG 2025/12/17 17:42:00   Bucket[14]: Key=臺東高中, DocCount=251
DEBUG 2025/12/17 17:42:00   Bucket[15]: Key=清華附小, DocCount=233
DEBUG 2025/12/17 17:42:00   Bucket[16]: Key=內埔農工, DocCount=232
DEBUG 2025/12/17 17:42:00   Bucket[17]: Key=興大附中, DocCount=221
DEBUG 2025/12/17 17:42:00   Bucket[18]: Key=關西高中, DocCount=203
DEBUG 2025/12/17 17:42:00   Bucket[19]: Key=旗美高中, DocCount=202
DEBUG 2025/12/17 17:42:00   Bucket[20]: Key=中大壢中, DocCount=201
DEBUG 2025/12/17 17:42:00   Bucket[21]: Key=花蓮高商, DocCount=197
DEBUG 2025/12/17 17:42:00   Bucket[22]: Key=新港藝高, DocCount=190
DEBUG 2025/12/17 17:42:00   Bucket[23]: Key=新營高工, DocCount=190
DEBUG 2025/12/17 17:42:00   Bucket[24]: Key=斗六家商, DocCount=184
DEBUG 2025/12/17 17:42:00   Bucket[25]: Key=南投高中, DocCount=181
DEBUG 2025/12/17 17:42:00   Bucket[26]: Key=新化高工, DocCount=180
DEBUG 2025/12/17 17:42:00   Bucket[27]: Key=苗栗農工, DocCount=177
DEBUG 2025/12/17 17:42:00   Bucket[28]: Key=關山工商, DocCount=176
DEBUG 2025/12/17 17:42:00   Bucket[29]: Key=後壁高中, DocCount=172
DEBUG 2025/12/17 17:42:00   Bucket[30]: Key=政大附中, DocCount=164
DEBUG 2025/12/17 17:42:00   Bucket[31]: Key=南投特教, DocCount=152
DEBUG 2025/12/17 17:42:00   Bucket[32]: Key=嘉義高商, DocCount=134
DEBUG 2025/12/17 17:42:00   Bucket[33]: Key=東港海事, DocCount=134
DEBUG 2025/12/17 17:42:00   Bucket[34]: Key=員林家商, DocCount=132
DEBUG 2025/12/17 17:42:00   Bucket[35]: Key=竹南高中, DocCount=121
DEBUG 2025/12/17 17:42:00   Bucket[36]: Key=屏東女中, DocCount=120
DEBUG 2025/12/17 17:42:00   Bucket[37]: Key=新竹高工, DocCount=112
DEBUG 2025/12/17 17:42:00   Bucket[38]: Key=新化高中, DocCount=110
DEBUG 2025/12/17 17:42:00   Bucket[39]: Key=溪湖高中, DocCount=108
DEBUG 2025/12/17 17:42:00   Bucket[40]: Key=虎尾高中, DocCount=108
DEBUG 2025/12/17 17:42:00   Bucket[41]: Key=苗栗高商, DocCount=106
DEBUG 2025/12/17 17:42:00   Bucket[42]: Key=北教大實小, DocCount=101
DEBUG 2025/12/17 17:42:00   Bucket[43]: Key=嘉科實中, DocCount=101
DEBUG 2025/12/17 17:42:00   Bucket[44]: Key=新竹高中, DocCount=100
DEBUG 2025/12/17 17:42:00   Bucket[45]: Key=北斗家商, DocCount=90
DEBUG 2025/12/17 17:42:00   Bucket[46]: Key=成大南工, DocCount=90
DEBUG 2025/12/17 17:42:00   Bucket[47]: Key=鳳山高中, DocCount=87
DEBUG 2025/12/17 17:42:00   Bucket[48]: Key=北港高中, DocCount=86
DEBUG 2025/12/17 17:42:00   Bucket[49]: Key=員林高中, DocCount=84
DEBUG 2025/12/17 17:42:00   Bucket[50]: Key=潮州高中, DocCount=84
DEBUG 2025/12/17 17:42:00   Bucket[51]: Key=彰師附工, DocCount=83
DEBUG 2025/12/17 17:42:00   Bucket[52]: Key=嘉義高中, DocCount=81
DEBUG 2025/12/17 17:42:00   Bucket[53]: Key=師大附中高中部, DocCount=81
DEBUG 2025/12/17 17:42:00   Bucket[54]: Key=澎湖海事, DocCount=80
DEBUG 2025/12/17 17:42:00   Bucket[55]: Key=海大附中, DocCount=77
DEBUG 2025/12/17 17:42:00   Bucket[56]: Key=新營高中, DocCount=75
DEBUG 2025/12/17 17:42:00   Bucket[57]: Key=中興高中, DocCount=70
DEBUG 2025/12/17 17:42:00   Bucket[58]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:42:00   Bucket[59]: Key=北港農工, DocCount=67
DEBUG 2025/12/17 17:42:00   Bucket[60]: Key=新豐高中, DocCount=67
DEBUG 2025/12/17 17:42:00   Bucket[61]: Key=彰化高商, DocCount=65
DEBUG 2025/12/17 17:42:00   Bucket[62]: Key=羅東高工, DocCount=64
DEBUG 2025/12/17 17:42:00   Bucket[63]: Key=新竹高商, DocCount=62
DEBUG 2025/12/17 17:42:00   Bucket[64]: Key=臺東女中, DocCount=62
DEBUG 2025/12/17 17:42:00   Bucket[65]: Key=臺南高商, DocCount=60
DEBUG 2025/12/17 17:42:00   Bucket[66]: Key=永靖高工, DocCount=59
DEBUG 2025/12/17 17:42:00   Bucket[67]: Key=南大附中, DocCount=58
DEBUG 2025/12/17 17:42:00   Bucket[68]: Key=屏東高中, DocCount=58
DEBUG 2025/12/17 17:42:00   Bucket[69]: Key=基隆商工, DocCount=56
DEBUG 2025/12/17 17:42:00   Bucket[70]: Key=白河商工, DocCount=56
DEBUG 2025/12/17 17:42:00   Bucket[71]: Key=華南高商, DocCount=56
DEBUG 2025/12/17 17:42:00   Bucket[72]: Key=嘉義高工, DocCount=55
DEBUG 2025/12/17 17:42:00   Bucket[73]: Key=旗山農工, DocCount=55
DEBUG 2025/12/17 17:42:00   Bucket[74]: Key=屏東高工, DocCount=54
DEBUG 2025/12/17 17:42:00   Bucket[75]: Key=竹山高中, DocCount=54
DEBUG 2025/12/17 17:42:00   Bucket[76]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:42:00   Bucket[77]: Key=東石高中, DocCount=53
DEBUG 2025/12/17 17:42:00   Bucket[78]: Key=興大附農, DocCount=53
DEBUG 2025/12/17 17:42:00   Bucket[79]: Key=苗栗高中, DocCount=53
DEBUG 2025/12/17 17:42:00   Bucket[80]: Key=屏北高中, DocCount=51
DEBUG 2025/12/17 17:42:00   Bucket[81]: Key=秀水高工, DocCount=50
DEBUG 2025/12/17 17:42:00   Bucket[82]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:42:00   Bucket[83]: Key=屏東特教, DocCount=49
DEBUG 2025/12/17 17:42:00   Bucket[84]: Key=臺東高商, DocCount=48
DEBUG 2025/12/17 17:42:00   Bucket[85]: Key=善化高中, DocCount=47
DEBUG 2025/12/17 17:42:00   Bucket[86]: Key=水里商工, DocCount=47
DEBUG 2025/12/17 17:42:00   Bucket[87]: Key=蘭陽女中, DocCount=47
DEBUG 2025/12/17 17:42:00   Bucket[88]: Key=家齊高中, DocCount=46
DEBUG 2025/12/17 17:42:00   Bucket[89]: Key=玉井工商, DocCount=46
DEBUG 2025/12/17 17:42:00   Bucket[90]: Key=臺南一中, DocCount=46
DEBUG 2025/12/17 17:42:00   Bucket[91]: Key=草屯商工, DocCount=45
DEBUG 2025/12/17 17:42:00   Bucket[92]: Key=高餐大附中, DocCount=45
DEBUG 2025/12/17 17:42:00   Bucket[93]: Key=花蓮高中, DocCount=44
DEBUG 2025/12/17 17:42:00   Bucket[94]: Key=宜蘭高中, DocCount=43
DEBUG 2025/12/17 17:42:00   Bucket[95]: Key=羅東高商, DocCount=43
DEBUG 2025/12/17 17:42:00   Bucket[96]: Key=員林農工, DocCount=42
DEBUG 2025/12/17 17:42:00   Bucket[97]: Key=埔里高工, DocCount=39
DEBUG 2025/12/17 17:42:00   Bucket[98]: Key=成功商水, DocCount=38
DEBUG 2025/12/17 17:42:00   Bucket[99]: Key=暨大附中, DocCount=38
DEBUG 2025/12/17 17:42:00 ========================================================
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 50/55 history records to TimescaleDB
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:42:08 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:42:13 Processing 15 offline devices
INFO 2025/12/17 17:42:13 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:42:13 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:42:13 ✅ Successfully flushed 41/41 history records to TimescaleDB
INFO 2025/12/17 17:42:13 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:42:13 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:42:13 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:42:13 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:42:13 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:42:13 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:42:13 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:42:13 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:42:13 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:42:14 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:42:14 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:42:14 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:42:14 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:42:14 Creating history record for offline device: 花蓮高工
INFO 2025/12/17 17:42:14 About to add history to batch for device: 花蓮高工
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 花蓮高工
INFO 2025/12/17 17:42:14 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:42:14 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:42:14 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:42:14 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:42:14 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:42:14 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:42:14 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:42:14 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:42:14 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:42:14 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:42:14 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:42:14 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:42:14 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:42:14 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:42:14 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:42:14 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:42:14 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:42:18 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:42:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:42:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:42:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:42:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:42:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:42:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:42:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:42:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:42:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:42:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:42:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:42:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:42:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:42:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:42:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:42:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:42:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:42:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:42:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:42:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:42:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:42:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:42:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.95% (threshold: 80.00%)
INFO 2025/12/17 17:42:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:42:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.32% (threshold: 85.00%)
DEBUG 2025/12/17 17:42:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:42:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:42:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:42:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:42:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:42:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:42:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:43:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:43:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:43:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:43:00 Field: school_name.keyword
DEBUG 2025/12/17 17:43:00 Time From: 2025-12-17T17:42:00.000+08:00
DEBUG 2025/12/17 17:43:00 Time To: 2025-12-17T17:43:00.000+08:00
DEBUG 2025/12/17 17:43:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:42:00.000+08:00",
					"lte": "2025-12-17T17:43:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:43:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:43:00 ES Response IsError: false
DEBUG 2025/12/17 17:43:00 ES Response Body:
{"took":60,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":374,"buckets":[{"key":"黑快馬主機","doc_count":766},{"key":"花蓮高農","doc_count":757},{"key":"仁愛高農","doc_count":494},{"key":"金門高中","doc_count":488},{"key":"新竹女中","doc_count":429},{"key":"金門農工","doc_count":411},{"key":"北門高中","doc_count":350},{"key":"南投高商","doc_count":292},{"key":"臺東高中","doc_count":288},{"key":"華僑高中","doc_count":286},{"key":"蘇澳海事","doc_count":274},{"key":"宜蘭高商","doc_count":257},{"key":"玉里高中","doc_count":233},{"key":"師大附中高中部","doc_count":224},{"key":"清華附小","doc_count":223},{"key":"竹北高中","doc_count":219},{"key":"內埔農工","doc_count":192},{"key":"新港藝高","doc_count":191},{"key":"旗美高中","doc_count":183},{"key":"斗六家商","doc_count":174},{"key":"關西高中","doc_count":169},{"key":"南投高中","doc_count":163},{"key":"花蓮高商","doc_count":163},{"key":"興大附中","doc_count":162},{"key":"苗栗農工","doc_count":157},{"key":"關山工商","doc_count":157},{"key":"新營高工","doc_count":153},{"key":"後壁高中","doc_count":137},{"key":"中大壢中","doc_count":136},{"key":"虎尾高中","doc_count":135},{"key":"南投特教","doc_count":133},{"key":"屏東女中","doc_count":128},{"key":"竹南高中","doc_count":124},{"key":"新化高工","doc_count":117},{"key":"東港海事","doc_count":112},{"key":"北斗家商","doc_count":110},{"key":"政大附中","doc_count":110},{"key":"新化高中","doc_count":105},{"key":"鳳山高中","doc_count":97},{"key":"嘉科實中","doc_count":93},{"key":"彰化高商","doc_count":88},{"key":"宜蘭高中","doc_count":87},{"key":"雲林特教","doc_count":82},{"key":"彰師附工","doc_count":81},{"key":"員林家商","doc_count":80},{"key":"屏東高工","doc_count":79},{"key":"新竹高工","doc_count":78},{"key":"嘉義高商","doc_count":71},{"key":"東石高中","doc_count":71},{"key":"華南高商","doc_count":71},{"key":"成大南工","doc_count":70},{"key":"臺南高商","doc_count":70},{"key":"土庫商工","doc_count":68},{"key":"北教大實小","doc_count":66},{"key":"北港高中","doc_count":66},{"key":"南大附聰","doc_count":66},{"key":"屏科實中","doc_count":66},{"key":"新營高中","doc_count":65},{"key":"新竹高中","doc_count":65},{"key":"嘉義高中","doc_count":63},{"key":"屏東特教","doc_count":63},{"key":"屏東高中","doc_count":63},{"key":"海大附中","doc_count":60},{"key":"苗栗高商","doc_count":60},{"key":"潮州高中","doc_count":56},{"key":"中興高中","doc_count":55},{"key":"花蓮高中","doc_count":55},{"key":"屏北高中","doc_count":54},{"key":"澎湖海事","doc_count":54},{"key":"臺南一中","doc_count":53},{"key":"北港農工","doc_count":50},{"key":"新豐高中","doc_count":50},{"key":"埔里高工","doc_count":49},{"key":"永靖高工","doc_count":49},{"key":"新竹高商","doc_count":48},{"key":"興大附農","doc_count":48},{"key":"新竹特教","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"溪湖高中","doc_count":46},{"key":"蘭陽女中","doc_count":45},{"key":"嘉義家職","doc_count":43},{"key":"頭城家商","doc_count":41},{"key":"佳冬高農","doc_count":40},{"key":"南大附小","doc_count":40},{"key":"秀水高工","doc_count":40},{"key":"家齊高中","doc_count":38},{"key":"旗山農工","doc_count":38},{"key":"水里商工","doc_count":38},{"key":"花蓮高工","doc_count":38},{"key":"嘉義高工","doc_count":37},{"key":"玉井工商","doc_count":36},{"key":"花蓮特教","doc_count":36},{"key":"高餐大附中","doc_count":36},{"key":"羅東高工","doc_count":34},{"key":"二林工商","doc_count":33},{"key":"員林農工","doc_count":33},{"key":"師大附中國中部","doc_count":32},{"key":"臺東女中","doc_count":32},{"key":"南大附中","doc_count":31},{"key":"崇實高工","doc_count":31}]}}}
DEBUG 2025/12/17 17:43:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:43:00   Bucket[0]: Key=黑快馬主機, DocCount=766
DEBUG 2025/12/17 17:43:00   Bucket[1]: Key=花蓮高農, DocCount=757
DEBUG 2025/12/17 17:43:00   Bucket[2]: Key=仁愛高農, DocCount=494
DEBUG 2025/12/17 17:43:00   Bucket[3]: Key=金門高中, DocCount=488
DEBUG 2025/12/17 17:43:00   Bucket[4]: Key=新竹女中, DocCount=429
DEBUG 2025/12/17 17:43:00   Bucket[5]: Key=金門農工, DocCount=411
DEBUG 2025/12/17 17:43:00   Bucket[6]: Key=北門高中, DocCount=350
DEBUG 2025/12/17 17:43:00   Bucket[7]: Key=南投高商, DocCount=292
DEBUG 2025/12/17 17:43:00   Bucket[8]: Key=臺東高中, DocCount=288
DEBUG 2025/12/17 17:43:00   Bucket[9]: Key=華僑高中, DocCount=286
DEBUG 2025/12/17 17:43:00   Bucket[10]: Key=蘇澳海事, DocCount=274
DEBUG 2025/12/17 17:43:00   Bucket[11]: Key=宜蘭高商, DocCount=257
DEBUG 2025/12/17 17:43:00   Bucket[12]: Key=玉里高中, DocCount=233
DEBUG 2025/12/17 17:43:00   Bucket[13]: Key=師大附中高中部, DocCount=224
DEBUG 2025/12/17 17:43:00   Bucket[14]: Key=清華附小, DocCount=223
DEBUG 2025/12/17 17:43:00   Bucket[15]: Key=竹北高中, DocCount=219
DEBUG 2025/12/17 17:43:00   Bucket[16]: Key=內埔農工, DocCount=192
DEBUG 2025/12/17 17:43:00   Bucket[17]: Key=新港藝高, DocCount=191
DEBUG 2025/12/17 17:43:00   Bucket[18]: Key=旗美高中, DocCount=183
DEBUG 2025/12/17 17:43:00   Bucket[19]: Key=斗六家商, DocCount=174
DEBUG 2025/12/17 17:43:00   Bucket[20]: Key=關西高中, DocCount=169
DEBUG 2025/12/17 17:43:00   Bucket[21]: Key=南投高中, DocCount=163
DEBUG 2025/12/17 17:43:00   Bucket[22]: Key=花蓮高商, DocCount=163
DEBUG 2025/12/17 17:43:00   Bucket[23]: Key=興大附中, DocCount=162
DEBUG 2025/12/17 17:43:00   Bucket[24]: Key=苗栗農工, DocCount=157
DEBUG 2025/12/17 17:43:00   Bucket[25]: Key=關山工商, DocCount=157
DEBUG 2025/12/17 17:43:00   Bucket[26]: Key=新營高工, DocCount=153
DEBUG 2025/12/17 17:43:00   Bucket[27]: Key=後壁高中, DocCount=137
DEBUG 2025/12/17 17:43:00   Bucket[28]: Key=中大壢中, DocCount=136
DEBUG 2025/12/17 17:43:00   Bucket[29]: Key=虎尾高中, DocCount=135
DEBUG 2025/12/17 17:43:00   Bucket[30]: Key=南投特教, DocCount=133
DEBUG 2025/12/17 17:43:00   Bucket[31]: Key=屏東女中, DocCount=128
DEBUG 2025/12/17 17:43:00   Bucket[32]: Key=竹南高中, DocCount=124
DEBUG 2025/12/17 17:43:00   Bucket[33]: Key=新化高工, DocCount=117
DEBUG 2025/12/17 17:43:00   Bucket[34]: Key=東港海事, DocCount=112
DEBUG 2025/12/17 17:43:00   Bucket[35]: Key=北斗家商, DocCount=110
DEBUG 2025/12/17 17:43:00   Bucket[36]: Key=政大附中, DocCount=110
DEBUG 2025/12/17 17:43:00   Bucket[37]: Key=新化高中, DocCount=105
DEBUG 2025/12/17 17:43:00   Bucket[38]: Key=鳳山高中, DocCount=97
DEBUG 2025/12/17 17:43:00   Bucket[39]: Key=嘉科實中, DocCount=93
DEBUG 2025/12/17 17:43:00   Bucket[40]: Key=彰化高商, DocCount=88
DEBUG 2025/12/17 17:43:00   Bucket[41]: Key=宜蘭高中, DocCount=87
DEBUG 2025/12/17 17:43:00   Bucket[42]: Key=雲林特教, DocCount=82
DEBUG 2025/12/17 17:43:00   Bucket[43]: Key=彰師附工, DocCount=81
DEBUG 2025/12/17 17:43:00   Bucket[44]: Key=員林家商, DocCount=80
DEBUG 2025/12/17 17:43:00   Bucket[45]: Key=屏東高工, DocCount=79
DEBUG 2025/12/17 17:43:00   Bucket[46]: Key=新竹高工, DocCount=78
DEBUG 2025/12/17 17:43:00   Bucket[47]: Key=嘉義高商, DocCount=71
DEBUG 2025/12/17 17:43:00   Bucket[48]: Key=東石高中, DocCount=71
DEBUG 2025/12/17 17:43:00   Bucket[49]: Key=華南高商, DocCount=71
DEBUG 2025/12/17 17:43:00   Bucket[50]: Key=成大南工, DocCount=70
DEBUG 2025/12/17 17:43:00   Bucket[51]: Key=臺南高商, DocCount=70
DEBUG 2025/12/17 17:43:00   Bucket[52]: Key=土庫商工, DocCount=68
DEBUG 2025/12/17 17:43:00   Bucket[53]: Key=北教大實小, DocCount=66
DEBUG 2025/12/17 17:43:00   Bucket[54]: Key=北港高中, DocCount=66
DEBUG 2025/12/17 17:43:00   Bucket[55]: Key=南大附聰, DocCount=66
DEBUG 2025/12/17 17:43:00   Bucket[56]: Key=屏科實中, DocCount=66
DEBUG 2025/12/17 17:43:00   Bucket[57]: Key=新營高中, DocCount=65
DEBUG 2025/12/17 17:43:00   Bucket[58]: Key=新竹高中, DocCount=65
DEBUG 2025/12/17 17:43:00   Bucket[59]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 17:43:00   Bucket[60]: Key=屏東特教, DocCount=63
DEBUG 2025/12/17 17:43:00   Bucket[61]: Key=屏東高中, DocCount=63
DEBUG 2025/12/17 17:43:00   Bucket[62]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:43:00   Bucket[63]: Key=苗栗高商, DocCount=60
DEBUG 2025/12/17 17:43:00   Bucket[64]: Key=潮州高中, DocCount=56
DEBUG 2025/12/17 17:43:00   Bucket[65]: Key=中興高中, DocCount=55
DEBUG 2025/12/17 17:43:00   Bucket[66]: Key=花蓮高中, DocCount=55
DEBUG 2025/12/17 17:43:00   Bucket[67]: Key=屏北高中, DocCount=54
DEBUG 2025/12/17 17:43:00   Bucket[68]: Key=澎湖海事, DocCount=54
DEBUG 2025/12/17 17:43:00   Bucket[69]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:43:00   Bucket[70]: Key=北港農工, DocCount=50
DEBUG 2025/12/17 17:43:00   Bucket[71]: Key=新豐高中, DocCount=50
DEBUG 2025/12/17 17:43:00   Bucket[72]: Key=埔里高工, DocCount=49
DEBUG 2025/12/17 17:43:00   Bucket[73]: Key=永靖高工, DocCount=49
DEBUG 2025/12/17 17:43:00   Bucket[74]: Key=新竹高商, DocCount=48
DEBUG 2025/12/17 17:43:00   Bucket[75]: Key=興大附農, DocCount=48
DEBUG 2025/12/17 17:43:00   Bucket[76]: Key=新竹特教, DocCount=47
DEBUG 2025/12/17 17:43:00   Bucket[77]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:43:00   Bucket[78]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 17:43:00   Bucket[79]: Key=蘭陽女中, DocCount=45
DEBUG 2025/12/17 17:43:00   Bucket[80]: Key=嘉義家職, DocCount=43
DEBUG 2025/12/17 17:43:00   Bucket[81]: Key=頭城家商, DocCount=41
DEBUG 2025/12/17 17:43:00   Bucket[82]: Key=佳冬高農, DocCount=40
DEBUG 2025/12/17 17:43:00   Bucket[83]: Key=南大附小, DocCount=40
DEBUG 2025/12/17 17:43:00   Bucket[84]: Key=秀水高工, DocCount=40
DEBUG 2025/12/17 17:43:00   Bucket[85]: Key=家齊高中, DocCount=38
DEBUG 2025/12/17 17:43:00   Bucket[86]: Key=旗山農工, DocCount=38
DEBUG 2025/12/17 17:43:00   Bucket[87]: Key=水里商工, DocCount=38
DEBUG 2025/12/17 17:43:00   Bucket[88]: Key=花蓮高工, DocCount=38
DEBUG 2025/12/17 17:43:00   Bucket[89]: Key=嘉義高工, DocCount=37
DEBUG 2025/12/17 17:43:00   Bucket[90]: Key=玉井工商, DocCount=36
DEBUG 2025/12/17 17:43:00   Bucket[91]: Key=花蓮特教, DocCount=36
DEBUG 2025/12/17 17:43:00   Bucket[92]: Key=高餐大附中, DocCount=36
DEBUG 2025/12/17 17:43:00   Bucket[93]: Key=羅東高工, DocCount=34
DEBUG 2025/12/17 17:43:00   Bucket[94]: Key=二林工商, DocCount=33
DEBUG 2025/12/17 17:43:00   Bucket[95]: Key=員林農工, DocCount=33
DEBUG 2025/12/17 17:43:00   Bucket[96]: Key=師大附中國中部, DocCount=32
DEBUG 2025/12/17 17:43:00   Bucket[97]: Key=臺東女中, DocCount=32
DEBUG 2025/12/17 17:43:00   Bucket[98]: Key=南大附中, DocCount=31
DEBUG 2025/12/17 17:43:00   Bucket[99]: Key=崇實高工, DocCount=31
DEBUG 2025/12/17 17:43:00 ========================================================
INFO 2025/12/17 17:43:03 ✅ Successfully flushed 5/5 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:43:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:43:08 Processing 15 offline devices
INFO 2025/12/17 17:43:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:43:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:43:08 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:43:08 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:43:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:43:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:43:08 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:43:08 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:43:08 ✅ Successfully flushed 35/35 history records to TimescaleDB
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:43:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:43:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:43:08 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:43:08 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:43:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:43:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:43:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:43:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:43:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:43:08 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:43:08 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:43:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:43:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:43:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:43:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:43:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:43:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:43:09 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:43:09 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:43:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:43:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:43:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:43:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:43:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:43:13 ✅ Successfully flushed 12/12 history records to TimescaleDB
DEBUG 2025/12/17 17:43:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:43:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:43:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:43:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:43:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:43:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:43:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:43:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:43:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:43:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 17:43:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:43:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:43:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:43:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:43:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:43:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:43:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:43:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:43:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:43:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:43:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:43:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
WARN 2025/12/17 17:43:45 ES Alert Created [critical][performance]: Memory usage critical: 90.65% (threshold: 90.00%)
INFO 2025/12/17 17:43:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:43:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:43:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:43:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:43:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:43:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:43:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:43:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:43:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:44:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:44:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:44:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:44:00 Field: school_name.keyword
DEBUG 2025/12/17 17:44:00 Time From: 2025-12-17T17:43:00.000+08:00
DEBUG 2025/12/17 17:44:00 Time To: 2025-12-17T17:44:00.000+08:00
DEBUG 2025/12/17 17:44:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:43:00.000+08:00",
					"lte": "2025-12-17T17:44:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:44:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:44:00 ES Response IsError: false
DEBUG 2025/12/17 17:44:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":418,"buckets":[{"key":"花蓮高農","doc_count":883},{"key":"黑快馬主機","doc_count":780},{"key":"仁愛高農","doc_count":607},{"key":"新竹女中","doc_count":505},{"key":"金門農工","doc_count":482},{"key":"金門高中","doc_count":477},{"key":"北門高中","doc_count":417},{"key":"宜蘭高商","doc_count":360},{"key":"嘉義高商","doc_count":292},{"key":"蘇澳海事","doc_count":283},{"key":"南投高商","doc_count":278},{"key":"斗六家商","doc_count":274},{"key":"旗美高中","doc_count":267},{"key":"臺東高中","doc_count":256},{"key":"內埔農工","doc_count":255},{"key":"竹北高中","doc_count":254},{"key":"華僑高中","doc_count":252},{"key":"政大附中","doc_count":236},{"key":"關西高中","doc_count":227},{"key":"新港藝高","doc_count":224},{"key":"清華附小","doc_count":209},{"key":"興大附中","doc_count":202},{"key":"關山工商","doc_count":202},{"key":"玉里高中","doc_count":201},{"key":"苗栗農工","doc_count":201},{"key":"師大附中高中部","doc_count":187},{"key":"虎尾高中","doc_count":187},{"key":"南大附聰","doc_count":175},{"key":"花蓮高商","doc_count":164},{"key":"南投特教","doc_count":157},{"key":"新化高中","doc_count":155},{"key":"後壁高中","doc_count":152},{"key":"竹南高中","doc_count":151},{"key":"中大壢中","doc_count":146},{"key":"彰師附工","doc_count":142},{"key":"屏東女中","doc_count":139},{"key":"新營高工","doc_count":139},{"key":"屏東高中","doc_count":138},{"key":"嘉科實中","doc_count":131},{"key":"新化高工","doc_count":115},{"key":"東港海事","doc_count":115},{"key":"屏東高工","doc_count":108},{"key":"南投高中","doc_count":105},{"key":"北斗家商","doc_count":103},{"key":"澎湖海事","doc_count":102},{"key":"員林家商","doc_count":89},{"key":"屏科實中","doc_count":89},{"key":"彰化高商","doc_count":88},{"key":"新竹高工","doc_count":83},{"key":"嘉義高中","doc_count":79},{"key":"北教大實小","doc_count":77},{"key":"員林高中","doc_count":77},{"key":"鳳山高中","doc_count":75},{"key":"北港高中","doc_count":73},{"key":"秀水高工","doc_count":72},{"key":"羅東高工","doc_count":68},{"key":"白河商工","doc_count":66},{"key":"臺南高商","doc_count":66},{"key":"屏東特教","doc_count":65},{"key":"苗栗高商","doc_count":65},{"key":"水里商工","doc_count":63},{"key":"苗栗高中","doc_count":62},{"key":"新竹高中","doc_count":60},{"key":"溪湖高中","doc_count":60},{"key":"嘉義高工","doc_count":58},{"key":"新營高中","doc_count":58},{"key":"華南高商","doc_count":58},{"key":"宜蘭高中","doc_count":57},{"key":"花蓮高工","doc_count":56},{"key":"雲林特教","doc_count":56},{"key":"海大附中","doc_count":53},{"key":"土庫商工","doc_count":52},{"key":"暨大附中","doc_count":51},{"key":"臺南一中","doc_count":51},{"key":"花蓮高中","doc_count":50},{"key":"基隆商工","doc_count":49},{"key":"曾文農工","doc_count":47},{"key":"崇實高工","doc_count":46},{"key":"頭城家商","doc_count":46},{"key":"成大南工","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"家齊高中","doc_count":43},{"key":"永靖高工","doc_count":43},{"key":"屏北高中","doc_count":42},{"key":"新豐高中","doc_count":42},{"key":"高餐大附中","doc_count":42},{"key":"善化高中","doc_count":41},{"key":"旗山農工","doc_count":40},{"key":"南大附中","doc_count":39},{"key":"羅東高商","doc_count":39},{"key":"草屯商工","doc_count":39},{"key":"嘉義家職","doc_count":38},{"key":"埔里高工","doc_count":37},{"key":"新竹高商","doc_count":37},{"key":"東石高中","doc_count":37},{"key":"玉井工商","doc_count":37},{"key":"竹東高中","doc_count":37},{"key":"新竹特教","doc_count":35},{"key":"北港農工","doc_count":34},{"key":"竹山高中","doc_count":33}]}}}
DEBUG 2025/12/17 17:44:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:44:00   Bucket[0]: Key=花蓮高農, DocCount=883
DEBUG 2025/12/17 17:44:00   Bucket[1]: Key=黑快馬主機, DocCount=780
DEBUG 2025/12/17 17:44:00   Bucket[2]: Key=仁愛高農, DocCount=607
DEBUG 2025/12/17 17:44:00   Bucket[3]: Key=新竹女中, DocCount=505
DEBUG 2025/12/17 17:44:00   Bucket[4]: Key=金門農工, DocCount=482
DEBUG 2025/12/17 17:44:00   Bucket[5]: Key=金門高中, DocCount=477
DEBUG 2025/12/17 17:44:00   Bucket[6]: Key=北門高中, DocCount=417
DEBUG 2025/12/17 17:44:00   Bucket[7]: Key=宜蘭高商, DocCount=360
DEBUG 2025/12/17 17:44:00   Bucket[8]: Key=嘉義高商, DocCount=292
DEBUG 2025/12/17 17:44:00   Bucket[9]: Key=蘇澳海事, DocCount=283
DEBUG 2025/12/17 17:44:00   Bucket[10]: Key=南投高商, DocCount=278
DEBUG 2025/12/17 17:44:00   Bucket[11]: Key=斗六家商, DocCount=274
DEBUG 2025/12/17 17:44:00   Bucket[12]: Key=旗美高中, DocCount=267
DEBUG 2025/12/17 17:44:00   Bucket[13]: Key=臺東高中, DocCount=256
DEBUG 2025/12/17 17:44:00   Bucket[14]: Key=內埔農工, DocCount=255
DEBUG 2025/12/17 17:44:00   Bucket[15]: Key=竹北高中, DocCount=254
DEBUG 2025/12/17 17:44:00   Bucket[16]: Key=華僑高中, DocCount=252
DEBUG 2025/12/17 17:44:00   Bucket[17]: Key=政大附中, DocCount=236
DEBUG 2025/12/17 17:44:00   Bucket[18]: Key=關西高中, DocCount=227
DEBUG 2025/12/17 17:44:00   Bucket[19]: Key=新港藝高, DocCount=224
DEBUG 2025/12/17 17:44:00   Bucket[20]: Key=清華附小, DocCount=209
DEBUG 2025/12/17 17:44:00   Bucket[21]: Key=興大附中, DocCount=202
DEBUG 2025/12/17 17:44:00   Bucket[22]: Key=關山工商, DocCount=202
DEBUG 2025/12/17 17:44:00   Bucket[23]: Key=玉里高中, DocCount=201
DEBUG 2025/12/17 17:44:00   Bucket[24]: Key=苗栗農工, DocCount=201
DEBUG 2025/12/17 17:44:00   Bucket[25]: Key=師大附中高中部, DocCount=187
DEBUG 2025/12/17 17:44:00   Bucket[26]: Key=虎尾高中, DocCount=187
DEBUG 2025/12/17 17:44:00   Bucket[27]: Key=南大附聰, DocCount=175
DEBUG 2025/12/17 17:44:00   Bucket[28]: Key=花蓮高商, DocCount=164
DEBUG 2025/12/17 17:44:00   Bucket[29]: Key=南投特教, DocCount=157
DEBUG 2025/12/17 17:44:00   Bucket[30]: Key=新化高中, DocCount=155
DEBUG 2025/12/17 17:44:00   Bucket[31]: Key=後壁高中, DocCount=152
DEBUG 2025/12/17 17:44:00   Bucket[32]: Key=竹南高中, DocCount=151
DEBUG 2025/12/17 17:44:00   Bucket[33]: Key=中大壢中, DocCount=146
DEBUG 2025/12/17 17:44:00   Bucket[34]: Key=彰師附工, DocCount=142
DEBUG 2025/12/17 17:44:00   Bucket[35]: Key=屏東女中, DocCount=139
DEBUG 2025/12/17 17:44:00   Bucket[36]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:44:00   Bucket[37]: Key=屏東高中, DocCount=138
DEBUG 2025/12/17 17:44:00   Bucket[38]: Key=嘉科實中, DocCount=131
DEBUG 2025/12/17 17:44:00   Bucket[39]: Key=新化高工, DocCount=115
DEBUG 2025/12/17 17:44:00   Bucket[40]: Key=東港海事, DocCount=115
DEBUG 2025/12/17 17:44:00   Bucket[41]: Key=屏東高工, DocCount=108
DEBUG 2025/12/17 17:44:00   Bucket[42]: Key=南投高中, DocCount=105
DEBUG 2025/12/17 17:44:00   Bucket[43]: Key=北斗家商, DocCount=103
DEBUG 2025/12/17 17:44:00   Bucket[44]: Key=澎湖海事, DocCount=102
DEBUG 2025/12/17 17:44:00   Bucket[45]: Key=員林家商, DocCount=89
DEBUG 2025/12/17 17:44:00   Bucket[46]: Key=屏科實中, DocCount=89
DEBUG 2025/12/17 17:44:00   Bucket[47]: Key=彰化高商, DocCount=88
DEBUG 2025/12/17 17:44:00   Bucket[48]: Key=新竹高工, DocCount=83
DEBUG 2025/12/17 17:44:00   Bucket[49]: Key=嘉義高中, DocCount=79
DEBUG 2025/12/17 17:44:00   Bucket[50]: Key=北教大實小, DocCount=77
DEBUG 2025/12/17 17:44:00   Bucket[51]: Key=員林高中, DocCount=77
DEBUG 2025/12/17 17:44:00   Bucket[52]: Key=鳳山高中, DocCount=75
DEBUG 2025/12/17 17:44:00   Bucket[53]: Key=北港高中, DocCount=73
DEBUG 2025/12/17 17:44:00   Bucket[54]: Key=秀水高工, DocCount=72
DEBUG 2025/12/17 17:44:00   Bucket[55]: Key=羅東高工, DocCount=68
DEBUG 2025/12/17 17:44:00   Bucket[56]: Key=白河商工, DocCount=66
DEBUG 2025/12/17 17:44:00   Bucket[57]: Key=臺南高商, DocCount=66
DEBUG 2025/12/17 17:44:00   Bucket[58]: Key=屏東特教, DocCount=65
DEBUG 2025/12/17 17:44:00   Bucket[59]: Key=苗栗高商, DocCount=65
DEBUG 2025/12/17 17:44:00   Bucket[60]: Key=水里商工, DocCount=63
DEBUG 2025/12/17 17:44:00   Bucket[61]: Key=苗栗高中, DocCount=62
DEBUG 2025/12/17 17:44:00   Bucket[62]: Key=新竹高中, DocCount=60
DEBUG 2025/12/17 17:44:00   Bucket[63]: Key=溪湖高中, DocCount=60
DEBUG 2025/12/17 17:44:00   Bucket[64]: Key=嘉義高工, DocCount=58
DEBUG 2025/12/17 17:44:00   Bucket[65]: Key=新營高中, DocCount=58
DEBUG 2025/12/17 17:44:00   Bucket[66]: Key=華南高商, DocCount=58
DEBUG 2025/12/17 17:44:00   Bucket[67]: Key=宜蘭高中, DocCount=57
DEBUG 2025/12/17 17:44:00   Bucket[68]: Key=花蓮高工, DocCount=56
DEBUG 2025/12/17 17:44:00   Bucket[69]: Key=雲林特教, DocCount=56
DEBUG 2025/12/17 17:44:00   Bucket[70]: Key=海大附中, DocCount=53
DEBUG 2025/12/17 17:44:00   Bucket[71]: Key=土庫商工, DocCount=52
DEBUG 2025/12/17 17:44:00   Bucket[72]: Key=暨大附中, DocCount=51
DEBUG 2025/12/17 17:44:00   Bucket[73]: Key=臺南一中, DocCount=51
DEBUG 2025/12/17 17:44:00   Bucket[74]: Key=花蓮高中, DocCount=50
DEBUG 2025/12/17 17:44:00   Bucket[75]: Key=基隆商工, DocCount=49
DEBUG 2025/12/17 17:44:00   Bucket[76]: Key=曾文農工, DocCount=47
DEBUG 2025/12/17 17:44:00   Bucket[77]: Key=崇實高工, DocCount=46
DEBUG 2025/12/17 17:44:00   Bucket[78]: Key=頭城家商, DocCount=46
DEBUG 2025/12/17 17:44:00   Bucket[79]: Key=成大南工, DocCount=45
DEBUG 2025/12/17 17:44:00   Bucket[80]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:44:00   Bucket[81]: Key=家齊高中, DocCount=43
DEBUG 2025/12/17 17:44:00   Bucket[82]: Key=永靖高工, DocCount=43
DEBUG 2025/12/17 17:44:00   Bucket[83]: Key=屏北高中, DocCount=42
DEBUG 2025/12/17 17:44:00   Bucket[84]: Key=新豐高中, DocCount=42
DEBUG 2025/12/17 17:44:00   Bucket[85]: Key=高餐大附中, DocCount=42
DEBUG 2025/12/17 17:44:00   Bucket[86]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:44:00   Bucket[87]: Key=旗山農工, DocCount=40
DEBUG 2025/12/17 17:44:00   Bucket[88]: Key=南大附中, DocCount=39
DEBUG 2025/12/17 17:44:00   Bucket[89]: Key=羅東高商, DocCount=39
DEBUG 2025/12/17 17:44:00   Bucket[90]: Key=草屯商工, DocCount=39
DEBUG 2025/12/17 17:44:00   Bucket[91]: Key=嘉義家職, DocCount=38
DEBUG 2025/12/17 17:44:00   Bucket[92]: Key=埔里高工, DocCount=37
DEBUG 2025/12/17 17:44:00   Bucket[93]: Key=新竹高商, DocCount=37
DEBUG 2025/12/17 17:44:00   Bucket[94]: Key=東石高中, DocCount=37
DEBUG 2025/12/17 17:44:00   Bucket[95]: Key=玉井工商, DocCount=37
DEBUG 2025/12/17 17:44:00   Bucket[96]: Key=竹東高中, DocCount=37
DEBUG 2025/12/17 17:44:00   Bucket[97]: Key=新竹特教, DocCount=35
DEBUG 2025/12/17 17:44:00   Bucket[98]: Key=北港農工, DocCount=34
DEBUG 2025/12/17 17:44:00   Bucket[99]: Key=竹山高中, DocCount=33
DEBUG 2025/12/17 17:44:00 ========================================================
INFO 2025/12/17 17:44:03 ✅ Successfully flushed 11/11 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:44:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:44:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:44:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:44:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:44:07 Processing 15 offline devices
INFO 2025/12/17 17:44:07 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:44:07 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:44:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:44:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:44:08 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:44:08 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:44:08 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:44:08 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:44:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:44:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:44:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:44:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:44:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:44:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:44:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:44:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:44:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:44:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:44:08 Creating history record for offline device: 潮州高中
INFO 2025/12/17 17:44:08 About to add history to batch for device: 潮州高中
INFO 2025/12/17 17:44:08 ✅ Successfully flushed 29/29 history records to TimescaleDB
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 17:44:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:44:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:44:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:44:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:44:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:44:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:44:08 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:44:08 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:44:08 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:44:08 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:44:08 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:44:13 ✅ Successfully flushed 6/6 history records to TimescaleDB
DEBUG 2025/12/17 17:44:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:44:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:44:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:44:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:44:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:44:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:44:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:44:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:44:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:44:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:44:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:44:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:44:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:44:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:44:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:44:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:44:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:44:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:44:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:44:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:44:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:44:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.56% (threshold: 90.00%)
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.38% (threshold: 85.00%)
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:44:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:44:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:44:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:44:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:44:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:45:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:45:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:45:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:45:00 Field: school_name.keyword
DEBUG 2025/12/17 17:45:00 Time From: 2025-12-17T17:44:00.000+08:00
DEBUG 2025/12/17 17:45:00 Time To: 2025-12-17T17:45:00.000+08:00
DEBUG 2025/12/17 17:45:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:44:00.000+08:00",
					"lte": "2025-12-17T17:45:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:45:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:45:00 ES Response IsError: false
DEBUG 2025/12/17 17:45:00 ES Response Body:
{"took":68,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":394,"buckets":[{"key":"黑快馬主機","doc_count":1172},{"key":"花蓮高農","doc_count":1107},{"key":"仁愛高農","doc_count":581},{"key":"新竹女中","doc_count":536},{"key":"金門農工","doc_count":483},{"key":"金門高中","doc_count":441},{"key":"北門高中","doc_count":402},{"key":"蘇澳海事","doc_count":353},{"key":"宜蘭高商","doc_count":332},{"key":"南投高商","doc_count":280},{"key":"嘉義高商","doc_count":270},{"key":"玉里高中","doc_count":265},{"key":"關西高中","doc_count":261},{"key":"華僑高中","doc_count":257},{"key":"竹北高中","doc_count":252},{"key":"臺東高中","doc_count":217},{"key":"內埔農工","doc_count":212},{"key":"清華附小","doc_count":207},{"key":"關山工商","doc_count":200},{"key":"中大壢中","doc_count":198},{"key":"斗六家商","doc_count":191},{"key":"北教大實小","doc_count":183},{"key":"旗美高中","doc_count":172},{"key":"興大附中","doc_count":169},{"key":"苗栗農工","doc_count":159},{"key":"新營高工","doc_count":158},{"key":"花蓮高商","doc_count":158},{"key":"虎尾高中","doc_count":158},{"key":"後壁高中","doc_count":147},{"key":"員林農工","doc_count":146},{"key":"新化高工","doc_count":146},{"key":"溪湖高中","doc_count":146},{"key":"新竹高工","doc_count":145},{"key":"南投特教","doc_count":144},{"key":"南大附聰","doc_count":142},{"key":"新港藝高","doc_count":141},{"key":"新化高中","doc_count":139},{"key":"屏東女中","doc_count":138},{"key":"東港海事","doc_count":127},{"key":"竹南高中","doc_count":126},{"key":"澎湖海事","doc_count":122},{"key":"曾文農工","doc_count":111},{"key":"竹山高中","doc_count":111},{"key":"師大附中高中部","doc_count":96},{"key":"苗栗高商","doc_count":95},{"key":"宜蘭高中","doc_count":92},{"key":"屏東高中","doc_count":91},{"key":"屏科實中","doc_count":89},{"key":"南大附中","doc_count":82},{"key":"員林家商","doc_count":82},{"key":"北港高中","doc_count":80},{"key":"南投高中","doc_count":79},{"key":"新豐高中","doc_count":78},{"key":"鳳山高中","doc_count":78},{"key":"華南高商","doc_count":73},{"key":"屏東高工","doc_count":72},{"key":"成大南工","doc_count":71},{"key":"羅東高商","doc_count":71},{"key":"新營高中","doc_count":69},{"key":"潮州高中","doc_count":66},{"key":"彰化高商","doc_count":63},{"key":"新竹高商","doc_count":63},{"key":"興大附農","doc_count":63},{"key":"嘉科實中","doc_count":61},{"key":"海大附中","doc_count":61},{"key":"東石高中","doc_count":60},{"key":"臺南一中","doc_count":59},{"key":"崇實高工","doc_count":57},{"key":"彰師附工","doc_count":57},{"key":"臺南高商","doc_count":57},{"key":"花蓮高工","doc_count":57},{"key":"基隆商工","doc_count":56},{"key":"秀水高工","doc_count":55},{"key":"北斗家商","doc_count":54},{"key":"永靖高工","doc_count":53},{"key":"臺東女中","doc_count":53},{"key":"嘉義高中","doc_count":52},{"key":"屏北高中","doc_count":52},{"key":"旗山農工","doc_count":51},{"key":"白河商工","doc_count":51},{"key":"羅東高工","doc_count":50},{"key":"苗栗高中","doc_count":50},{"key":"埔里高工","doc_count":47},{"key":"屏東特教","doc_count":47},{"key":"政大附中","doc_count":45},{"key":"土庫商工","doc_count":43},{"key":"雲林特教","doc_count":42},{"key":"頭城家商","doc_count":42},{"key":"師大附中國中部","doc_count":41},{"key":"花蓮高中","doc_count":39},{"key":"中興高中","doc_count":38},{"key":"善化高中","doc_count":37},{"key":"嘉義高工","doc_count":37},{"key":"北港農工","doc_count":36},{"key":"家齊高中","doc_count":35},{"key":"水里商工","doc_count":35},{"key":"二林工商","doc_count":33},{"key":"新竹高中","doc_count":33},{"key":"臺東高商","doc_count":33},{"key":"草屯商工","doc_count":33}]}}}
DEBUG 2025/12/17 17:45:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:45:00   Bucket[0]: Key=黑快馬主機, DocCount=1172
DEBUG 2025/12/17 17:45:00   Bucket[1]: Key=花蓮高農, DocCount=1107
DEBUG 2025/12/17 17:45:00   Bucket[2]: Key=仁愛高農, DocCount=581
DEBUG 2025/12/17 17:45:00   Bucket[3]: Key=新竹女中, DocCount=536
DEBUG 2025/12/17 17:45:00   Bucket[4]: Key=金門農工, DocCount=483
DEBUG 2025/12/17 17:45:00   Bucket[5]: Key=金門高中, DocCount=441
DEBUG 2025/12/17 17:45:00   Bucket[6]: Key=北門高中, DocCount=402
DEBUG 2025/12/17 17:45:00   Bucket[7]: Key=蘇澳海事, DocCount=353
DEBUG 2025/12/17 17:45:00   Bucket[8]: Key=宜蘭高商, DocCount=332
DEBUG 2025/12/17 17:45:00   Bucket[9]: Key=南投高商, DocCount=280
DEBUG 2025/12/17 17:45:00   Bucket[10]: Key=嘉義高商, DocCount=270
DEBUG 2025/12/17 17:45:00   Bucket[11]: Key=玉里高中, DocCount=265
DEBUG 2025/12/17 17:45:00   Bucket[12]: Key=關西高中, DocCount=261
DEBUG 2025/12/17 17:45:00   Bucket[13]: Key=華僑高中, DocCount=257
DEBUG 2025/12/17 17:45:00   Bucket[14]: Key=竹北高中, DocCount=252
DEBUG 2025/12/17 17:45:00   Bucket[15]: Key=臺東高中, DocCount=217
DEBUG 2025/12/17 17:45:00   Bucket[16]: Key=內埔農工, DocCount=212
DEBUG 2025/12/17 17:45:00   Bucket[17]: Key=清華附小, DocCount=207
DEBUG 2025/12/17 17:45:00   Bucket[18]: Key=關山工商, DocCount=200
DEBUG 2025/12/17 17:45:00   Bucket[19]: Key=中大壢中, DocCount=198
DEBUG 2025/12/17 17:45:00   Bucket[20]: Key=斗六家商, DocCount=191
DEBUG 2025/12/17 17:45:00   Bucket[21]: Key=北教大實小, DocCount=183
DEBUG 2025/12/17 17:45:00   Bucket[22]: Key=旗美高中, DocCount=172
DEBUG 2025/12/17 17:45:00   Bucket[23]: Key=興大附中, DocCount=169
DEBUG 2025/12/17 17:45:00   Bucket[24]: Key=苗栗農工, DocCount=159
DEBUG 2025/12/17 17:45:00   Bucket[25]: Key=新營高工, DocCount=158
DEBUG 2025/12/17 17:45:00   Bucket[26]: Key=花蓮高商, DocCount=158
DEBUG 2025/12/17 17:45:00   Bucket[27]: Key=虎尾高中, DocCount=158
DEBUG 2025/12/17 17:45:00   Bucket[28]: Key=後壁高中, DocCount=147
DEBUG 2025/12/17 17:45:00   Bucket[29]: Key=員林農工, DocCount=146
DEBUG 2025/12/17 17:45:00   Bucket[30]: Key=新化高工, DocCount=146
DEBUG 2025/12/17 17:45:00   Bucket[31]: Key=溪湖高中, DocCount=146
DEBUG 2025/12/17 17:45:00   Bucket[32]: Key=新竹高工, DocCount=145
DEBUG 2025/12/17 17:45:00   Bucket[33]: Key=南投特教, DocCount=144
DEBUG 2025/12/17 17:45:00   Bucket[34]: Key=南大附聰, DocCount=142
DEBUG 2025/12/17 17:45:00   Bucket[35]: Key=新港藝高, DocCount=141
DEBUG 2025/12/17 17:45:00   Bucket[36]: Key=新化高中, DocCount=139
DEBUG 2025/12/17 17:45:00   Bucket[37]: Key=屏東女中, DocCount=138
DEBUG 2025/12/17 17:45:00   Bucket[38]: Key=東港海事, DocCount=127
DEBUG 2025/12/17 17:45:00   Bucket[39]: Key=竹南高中, DocCount=126
DEBUG 2025/12/17 17:45:00   Bucket[40]: Key=澎湖海事, DocCount=122
DEBUG 2025/12/17 17:45:00   Bucket[41]: Key=曾文農工, DocCount=111
DEBUG 2025/12/17 17:45:00   Bucket[42]: Key=竹山高中, DocCount=111
DEBUG 2025/12/17 17:45:00   Bucket[43]: Key=師大附中高中部, DocCount=96
DEBUG 2025/12/17 17:45:00   Bucket[44]: Key=苗栗高商, DocCount=95
DEBUG 2025/12/17 17:45:00   Bucket[45]: Key=宜蘭高中, DocCount=92
DEBUG 2025/12/17 17:45:00   Bucket[46]: Key=屏東高中, DocCount=91
DEBUG 2025/12/17 17:45:00   Bucket[47]: Key=屏科實中, DocCount=89
DEBUG 2025/12/17 17:45:00   Bucket[48]: Key=南大附中, DocCount=82
DEBUG 2025/12/17 17:45:00   Bucket[49]: Key=員林家商, DocCount=82
DEBUG 2025/12/17 17:45:00   Bucket[50]: Key=北港高中, DocCount=80
DEBUG 2025/12/17 17:45:00   Bucket[51]: Key=南投高中, DocCount=79
DEBUG 2025/12/17 17:45:00   Bucket[52]: Key=新豐高中, DocCount=78
DEBUG 2025/12/17 17:45:00   Bucket[53]: Key=鳳山高中, DocCount=78
DEBUG 2025/12/17 17:45:00   Bucket[54]: Key=華南高商, DocCount=73
DEBUG 2025/12/17 17:45:00   Bucket[55]: Key=屏東高工, DocCount=72
DEBUG 2025/12/17 17:45:00   Bucket[56]: Key=成大南工, DocCount=71
DEBUG 2025/12/17 17:45:00   Bucket[57]: Key=羅東高商, DocCount=71
DEBUG 2025/12/17 17:45:00   Bucket[58]: Key=新營高中, DocCount=69
DEBUG 2025/12/17 17:45:00   Bucket[59]: Key=潮州高中, DocCount=66
DEBUG 2025/12/17 17:45:00   Bucket[60]: Key=彰化高商, DocCount=63
DEBUG 2025/12/17 17:45:00   Bucket[61]: Key=新竹高商, DocCount=63
DEBUG 2025/12/17 17:45:00   Bucket[62]: Key=興大附農, DocCount=63
DEBUG 2025/12/17 17:45:00   Bucket[63]: Key=嘉科實中, DocCount=61
DEBUG 2025/12/17 17:45:00   Bucket[64]: Key=海大附中, DocCount=61
DEBUG 2025/12/17 17:45:00   Bucket[65]: Key=東石高中, DocCount=60
DEBUG 2025/12/17 17:45:00   Bucket[66]: Key=臺南一中, DocCount=59
DEBUG 2025/12/17 17:45:00   Bucket[67]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 17:45:00   Bucket[68]: Key=彰師附工, DocCount=57
DEBUG 2025/12/17 17:45:00   Bucket[69]: Key=臺南高商, DocCount=57
DEBUG 2025/12/17 17:45:00   Bucket[70]: Key=花蓮高工, DocCount=57
DEBUG 2025/12/17 17:45:00   Bucket[71]: Key=基隆商工, DocCount=56
DEBUG 2025/12/17 17:45:00   Bucket[72]: Key=秀水高工, DocCount=55
DEBUG 2025/12/17 17:45:00   Bucket[73]: Key=北斗家商, DocCount=54
DEBUG 2025/12/17 17:45:00   Bucket[74]: Key=永靖高工, DocCount=53
DEBUG 2025/12/17 17:45:00   Bucket[75]: Key=臺東女中, DocCount=53
DEBUG 2025/12/17 17:45:00   Bucket[76]: Key=嘉義高中, DocCount=52
DEBUG 2025/12/17 17:45:00   Bucket[77]: Key=屏北高中, DocCount=52
DEBUG 2025/12/17 17:45:00   Bucket[78]: Key=旗山農工, DocCount=51
DEBUG 2025/12/17 17:45:00   Bucket[79]: Key=白河商工, DocCount=51
DEBUG 2025/12/17 17:45:00   Bucket[80]: Key=羅東高工, DocCount=50
DEBUG 2025/12/17 17:45:00   Bucket[81]: Key=苗栗高中, DocCount=50
DEBUG 2025/12/17 17:45:00   Bucket[82]: Key=埔里高工, DocCount=47
DEBUG 2025/12/17 17:45:00   Bucket[83]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:45:00   Bucket[84]: Key=政大附中, DocCount=45
DEBUG 2025/12/17 17:45:00   Bucket[85]: Key=土庫商工, DocCount=43
DEBUG 2025/12/17 17:45:00   Bucket[86]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:45:00   Bucket[87]: Key=頭城家商, DocCount=42
DEBUG 2025/12/17 17:45:00   Bucket[88]: Key=師大附中國中部, DocCount=41
DEBUG 2025/12/17 17:45:00   Bucket[89]: Key=花蓮高中, DocCount=39
DEBUG 2025/12/17 17:45:00   Bucket[90]: Key=中興高中, DocCount=38
DEBUG 2025/12/17 17:45:00   Bucket[91]: Key=善化高中, DocCount=37
DEBUG 2025/12/17 17:45:00   Bucket[92]: Key=嘉義高工, DocCount=37
DEBUG 2025/12/17 17:45:00   Bucket[93]: Key=北港農工, DocCount=36
DEBUG 2025/12/17 17:45:00   Bucket[94]: Key=家齊高中, DocCount=35
DEBUG 2025/12/17 17:45:00   Bucket[95]: Key=水里商工, DocCount=35
DEBUG 2025/12/17 17:45:00   Bucket[96]: Key=二林工商, DocCount=33
DEBUG 2025/12/17 17:45:00   Bucket[97]: Key=新竹高中, DocCount=33
DEBUG 2025/12/17 17:45:00   Bucket[98]: Key=臺東高商, DocCount=33
DEBUG 2025/12/17 17:45:00   Bucket[99]: Key=草屯商工, DocCount=33
DEBUG 2025/12/17 17:45:00 ========================================================
INFO 2025/12/17 17:45:03 ✅ Successfully flushed 1/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:45:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:45:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:45:08 Processing 15 offline devices
INFO 2025/12/17 17:45:08 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:45:08 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:45:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 17:45:08 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:45:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:45:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:45:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:45:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:45:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:45:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:45:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:45:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:45:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:45:08 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:45:08 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:45:08 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:45:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:45:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:45:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:45:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:45:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:45:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:45:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:45:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:45:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:45:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:45:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:45:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:45:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:45:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:45:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:45:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:45:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:45:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:45:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:45:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:45:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:45:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:45:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:45:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:45:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:45:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:45:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:45:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:45:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:45:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:45:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:45:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:45:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:45:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:45:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:45:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:45:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:45:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:45:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:45:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:45:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:45:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:45:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:45:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:45:45 ES Alert Created [high][performance]: Memory usage high: 89.08% (threshold: 80.00%)
INFO 2025/12/17 17:45:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:45:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.42% (threshold: 85.00%)
DEBUG 2025/12/17 17:45:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:45:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:45:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:45:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:45:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:45:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:45:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:45:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:46:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:46:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:46:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:46:00 Field: school_name.keyword
DEBUG 2025/12/17 17:46:00 Time From: 2025-12-17T17:45:00.000+08:00
DEBUG 2025/12/17 17:46:00 Time To: 2025-12-17T17:46:00.000+08:00
DEBUG 2025/12/17 17:46:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:45:00.000+08:00",
					"lte": "2025-12-17T17:46:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:46:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:46:00 ES Response IsError: false
DEBUG 2025/12/17 17:46:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":444,"buckets":[{"key":"黑快馬主機","doc_count":1148},{"key":"花蓮高農","doc_count":942},{"key":"仁愛高農","doc_count":537},{"key":"新竹女中","doc_count":518},{"key":"金門農工","doc_count":480},{"key":"金門高中","doc_count":454},{"key":"北門高中","doc_count":421},{"key":"蘇澳海事","doc_count":378},{"key":"宜蘭高商","doc_count":316},{"key":"華僑高中","doc_count":305},{"key":"玉里高中","doc_count":303},{"key":"南投高商","doc_count":283},{"key":"虎尾高中","doc_count":263},{"key":"內埔農工","doc_count":238},{"key":"竹北高中","doc_count":232},{"key":"臺東高中","doc_count":232},{"key":"屏東女中","doc_count":230},{"key":"清華附小","doc_count":223},{"key":"斗六家商","doc_count":218},{"key":"關西高中","doc_count":201},{"key":"花蓮高商","doc_count":200},{"key":"新港藝高","doc_count":197},{"key":"興大附中","doc_count":189},{"key":"旗美高中","doc_count":182},{"key":"後壁高中","doc_count":174},{"key":"嘉義高商","doc_count":172},{"key":"苗栗農工","doc_count":169},{"key":"關山工商","doc_count":164},{"key":"中大壢中","doc_count":156},{"key":"南投特教","doc_count":147},{"key":"政大附中","doc_count":143},{"key":"新營高工","doc_count":142},{"key":"嘉義高中","doc_count":135},{"key":"曾文農工","doc_count":135},{"key":"竹南高中","doc_count":131},{"key":"員林家商","doc_count":126},{"key":"南投高中","doc_count":125},{"key":"宜蘭高中","doc_count":124},{"key":"新竹高工","doc_count":119},{"key":"東港海事","doc_count":111},{"key":"新化高工","doc_count":110},{"key":"苗栗高中","doc_count":107},{"key":"鳳山高中","doc_count":107},{"key":"土庫商工","doc_count":106},{"key":"新化高中","doc_count":101},{"key":"南大附聰","doc_count":100},{"key":"嘉科實中","doc_count":99},{"key":"新竹高商","doc_count":98},{"key":"員林農工","doc_count":95},{"key":"新營高中","doc_count":95},{"key":"二林工商","doc_count":91},{"key":"屏科實中","doc_count":89},{"key":"水里商工","doc_count":88},{"key":"北斗家商","doc_count":87},{"key":"新竹高中","doc_count":87},{"key":"永靖高工","doc_count":84},{"key":"臺南高商","doc_count":79},{"key":"臺東高商","doc_count":78},{"key":"彰化高商","doc_count":75},{"key":"師大附中高中部","doc_count":74},{"key":"埔里高工","doc_count":70},{"key":"新豐高中","doc_count":70},{"key":"頭城家商","doc_count":69},{"key":"北港農工","doc_count":68},{"key":"羅東高商","doc_count":67},{"key":"秀水高工","doc_count":66},{"key":"高餐大附中","doc_count":62},{"key":"基隆商工","doc_count":61},{"key":"屏東高工","doc_count":60},{"key":"南大附中","doc_count":59},{"key":"臺南一中","doc_count":59},{"key":"苗栗高商","doc_count":58},{"key":"北教大實小","doc_count":57},{"key":"彰師附工","doc_count":57},{"key":"花蓮高工","doc_count":56},{"key":"草屯商工","doc_count":55},{"key":"玉井工商","doc_count":53},{"key":"華南高商","doc_count":53},{"key":"北港高中","doc_count":52},{"key":"員林高中","doc_count":52},{"key":"東石高中","doc_count":51},{"key":"屏東特教","doc_count":49},{"key":"屏東高中","doc_count":48},{"key":"成大南工","doc_count":48},{"key":"竹山高中","doc_count":47},{"key":"羅東高工","doc_count":45},{"key":"興大附農","doc_count":44},{"key":"海大附中","doc_count":43},{"key":"潮州高中","doc_count":43},{"key":"花蓮特教","doc_count":43},{"key":"佳冬高農","doc_count":42},{"key":"家齊高中","doc_count":42},{"key":"旗山農工","doc_count":42},{"key":"善化高中","doc_count":41},{"key":"新竹特教","doc_count":41},{"key":"竹東高中","doc_count":41},{"key":"中興高中","doc_count":40},{"key":"崇實高工","doc_count":40},{"key":"雲林特教","doc_count":40},{"key":"南大附小","doc_count":39}]}}}
DEBUG 2025/12/17 17:46:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:46:00   Bucket[0]: Key=黑快馬主機, DocCount=1148
DEBUG 2025/12/17 17:46:00   Bucket[1]: Key=花蓮高農, DocCount=942
DEBUG 2025/12/17 17:46:00   Bucket[2]: Key=仁愛高農, DocCount=537
DEBUG 2025/12/17 17:46:00   Bucket[3]: Key=新竹女中, DocCount=518
DEBUG 2025/12/17 17:46:00   Bucket[4]: Key=金門農工, DocCount=480
DEBUG 2025/12/17 17:46:00   Bucket[5]: Key=金門高中, DocCount=454
DEBUG 2025/12/17 17:46:00   Bucket[6]: Key=北門高中, DocCount=421
DEBUG 2025/12/17 17:46:00   Bucket[7]: Key=蘇澳海事, DocCount=378
DEBUG 2025/12/17 17:46:00   Bucket[8]: Key=宜蘭高商, DocCount=316
DEBUG 2025/12/17 17:46:00   Bucket[9]: Key=華僑高中, DocCount=305
DEBUG 2025/12/17 17:46:00   Bucket[10]: Key=玉里高中, DocCount=303
DEBUG 2025/12/17 17:46:00   Bucket[11]: Key=南投高商, DocCount=283
DEBUG 2025/12/17 17:46:00   Bucket[12]: Key=虎尾高中, DocCount=263
DEBUG 2025/12/17 17:46:00   Bucket[13]: Key=內埔農工, DocCount=238
DEBUG 2025/12/17 17:46:00   Bucket[14]: Key=竹北高中, DocCount=232
DEBUG 2025/12/17 17:46:00   Bucket[15]: Key=臺東高中, DocCount=232
DEBUG 2025/12/17 17:46:00   Bucket[16]: Key=屏東女中, DocCount=230
DEBUG 2025/12/17 17:46:00   Bucket[17]: Key=清華附小, DocCount=223
DEBUG 2025/12/17 17:46:00   Bucket[18]: Key=斗六家商, DocCount=218
DEBUG 2025/12/17 17:46:00   Bucket[19]: Key=關西高中, DocCount=201
DEBUG 2025/12/17 17:46:00   Bucket[20]: Key=花蓮高商, DocCount=200
DEBUG 2025/12/17 17:46:00   Bucket[21]: Key=新港藝高, DocCount=197
DEBUG 2025/12/17 17:46:00   Bucket[22]: Key=興大附中, DocCount=189
DEBUG 2025/12/17 17:46:00   Bucket[23]: Key=旗美高中, DocCount=182
DEBUG 2025/12/17 17:46:00   Bucket[24]: Key=後壁高中, DocCount=174
DEBUG 2025/12/17 17:46:00   Bucket[25]: Key=嘉義高商, DocCount=172
DEBUG 2025/12/17 17:46:00   Bucket[26]: Key=苗栗農工, DocCount=169
DEBUG 2025/12/17 17:46:00   Bucket[27]: Key=關山工商, DocCount=164
DEBUG 2025/12/17 17:46:00   Bucket[28]: Key=中大壢中, DocCount=156
DEBUG 2025/12/17 17:46:00   Bucket[29]: Key=南投特教, DocCount=147
DEBUG 2025/12/17 17:46:00   Bucket[30]: Key=政大附中, DocCount=143
DEBUG 2025/12/17 17:46:00   Bucket[31]: Key=新營高工, DocCount=142
DEBUG 2025/12/17 17:46:00   Bucket[32]: Key=嘉義高中, DocCount=135
DEBUG 2025/12/17 17:46:00   Bucket[33]: Key=曾文農工, DocCount=135
DEBUG 2025/12/17 17:46:00   Bucket[34]: Key=竹南高中, DocCount=131
DEBUG 2025/12/17 17:46:00   Bucket[35]: Key=員林家商, DocCount=126
DEBUG 2025/12/17 17:46:00   Bucket[36]: Key=南投高中, DocCount=125
DEBUG 2025/12/17 17:46:00   Bucket[37]: Key=宜蘭高中, DocCount=124
DEBUG 2025/12/17 17:46:00   Bucket[38]: Key=新竹高工, DocCount=119
DEBUG 2025/12/17 17:46:00   Bucket[39]: Key=東港海事, DocCount=111
DEBUG 2025/12/17 17:46:00   Bucket[40]: Key=新化高工, DocCount=110
DEBUG 2025/12/17 17:46:00   Bucket[41]: Key=苗栗高中, DocCount=107
DEBUG 2025/12/17 17:46:00   Bucket[42]: Key=鳳山高中, DocCount=107
DEBUG 2025/12/17 17:46:00   Bucket[43]: Key=土庫商工, DocCount=106
DEBUG 2025/12/17 17:46:00   Bucket[44]: Key=新化高中, DocCount=101
DEBUG 2025/12/17 17:46:00   Bucket[45]: Key=南大附聰, DocCount=100
DEBUG 2025/12/17 17:46:00   Bucket[46]: Key=嘉科實中, DocCount=99
DEBUG 2025/12/17 17:46:00   Bucket[47]: Key=新竹高商, DocCount=98
DEBUG 2025/12/17 17:46:00   Bucket[48]: Key=員林農工, DocCount=95
DEBUG 2025/12/17 17:46:00   Bucket[49]: Key=新營高中, DocCount=95
DEBUG 2025/12/17 17:46:00   Bucket[50]: Key=二林工商, DocCount=91
DEBUG 2025/12/17 17:46:00   Bucket[51]: Key=屏科實中, DocCount=89
DEBUG 2025/12/17 17:46:00   Bucket[52]: Key=水里商工, DocCount=88
DEBUG 2025/12/17 17:46:00   Bucket[53]: Key=北斗家商, DocCount=87
DEBUG 2025/12/17 17:46:00   Bucket[54]: Key=新竹高中, DocCount=87
DEBUG 2025/12/17 17:46:00   Bucket[55]: Key=永靖高工, DocCount=84
DEBUG 2025/12/17 17:46:00   Bucket[56]: Key=臺南高商, DocCount=79
DEBUG 2025/12/17 17:46:00   Bucket[57]: Key=臺東高商, DocCount=78
DEBUG 2025/12/17 17:46:00   Bucket[58]: Key=彰化高商, DocCount=75
DEBUG 2025/12/17 17:46:00   Bucket[59]: Key=師大附中高中部, DocCount=74
DEBUG 2025/12/17 17:46:00   Bucket[60]: Key=埔里高工, DocCount=70
DEBUG 2025/12/17 17:46:00   Bucket[61]: Key=新豐高中, DocCount=70
DEBUG 2025/12/17 17:46:00   Bucket[62]: Key=頭城家商, DocCount=69
DEBUG 2025/12/17 17:46:00   Bucket[63]: Key=北港農工, DocCount=68
DEBUG 2025/12/17 17:46:00   Bucket[64]: Key=羅東高商, DocCount=67
DEBUG 2025/12/17 17:46:00   Bucket[65]: Key=秀水高工, DocCount=66
DEBUG 2025/12/17 17:46:00   Bucket[66]: Key=高餐大附中, DocCount=62
DEBUG 2025/12/17 17:46:00   Bucket[67]: Key=基隆商工, DocCount=61
DEBUG 2025/12/17 17:46:00   Bucket[68]: Key=屏東高工, DocCount=60
DEBUG 2025/12/17 17:46:00   Bucket[69]: Key=南大附中, DocCount=59
DEBUG 2025/12/17 17:46:00   Bucket[70]: Key=臺南一中, DocCount=59
DEBUG 2025/12/17 17:46:00   Bucket[71]: Key=苗栗高商, DocCount=58
DEBUG 2025/12/17 17:46:00   Bucket[72]: Key=北教大實小, DocCount=57
DEBUG 2025/12/17 17:46:00   Bucket[73]: Key=彰師附工, DocCount=57
DEBUG 2025/12/17 17:46:00   Bucket[74]: Key=花蓮高工, DocCount=56
DEBUG 2025/12/17 17:46:00   Bucket[75]: Key=草屯商工, DocCount=55
DEBUG 2025/12/17 17:46:00   Bucket[76]: Key=玉井工商, DocCount=53
DEBUG 2025/12/17 17:46:00   Bucket[77]: Key=華南高商, DocCount=53
DEBUG 2025/12/17 17:46:00   Bucket[78]: Key=北港高中, DocCount=52
DEBUG 2025/12/17 17:46:00   Bucket[79]: Key=員林高中, DocCount=52
DEBUG 2025/12/17 17:46:00   Bucket[80]: Key=東石高中, DocCount=51
DEBUG 2025/12/17 17:46:00   Bucket[81]: Key=屏東特教, DocCount=49
DEBUG 2025/12/17 17:46:00   Bucket[82]: Key=屏東高中, DocCount=48
DEBUG 2025/12/17 17:46:00   Bucket[83]: Key=成大南工, DocCount=48
DEBUG 2025/12/17 17:46:00   Bucket[84]: Key=竹山高中, DocCount=47
DEBUG 2025/12/17 17:46:00   Bucket[85]: Key=羅東高工, DocCount=45
DEBUG 2025/12/17 17:46:00   Bucket[86]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 17:46:00   Bucket[87]: Key=海大附中, DocCount=43
DEBUG 2025/12/17 17:46:00   Bucket[88]: Key=潮州高中, DocCount=43
DEBUG 2025/12/17 17:46:00   Bucket[89]: Key=花蓮特教, DocCount=43
DEBUG 2025/12/17 17:46:00   Bucket[90]: Key=佳冬高農, DocCount=42
DEBUG 2025/12/17 17:46:00   Bucket[91]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 17:46:00   Bucket[92]: Key=旗山農工, DocCount=42
DEBUG 2025/12/17 17:46:00   Bucket[93]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:46:00   Bucket[94]: Key=新竹特教, DocCount=41
DEBUG 2025/12/17 17:46:00   Bucket[95]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 17:46:00   Bucket[96]: Key=中興高中, DocCount=40
DEBUG 2025/12/17 17:46:00   Bucket[97]: Key=崇實高工, DocCount=40
DEBUG 2025/12/17 17:46:00   Bucket[98]: Key=雲林特教, DocCount=40
DEBUG 2025/12/17 17:46:00   Bucket[99]: Key=南大附小, DocCount=39
DEBUG 2025/12/17 17:46:00 ========================================================
INFO 2025/12/17 17:46:03 ✅ Successfully flushed 6/6 history records to TimescaleDB
INFO 2025/12/17 17:46:06 ✅ Successfully flushed 50/53 history records to TimescaleDB
INFO 2025/12/17 17:46:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:46:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:46:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:46:08 ✅ Successfully flushed 21/21 history records to TimescaleDB
INFO 2025/12/17 17:46:09 Processing 15 offline devices
INFO 2025/12/17 17:46:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:46:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:46:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:46:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:46:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:46:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:46:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:46:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:46:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:46:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:46:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:46:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:46:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:46:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:46:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:46:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:46:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:46:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:46:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:46:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:46:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:46:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:46:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:46:10 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:46:10 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:46:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:46:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:46:10 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:46:10 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:46:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:46:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:46:10 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:46:13 ✅ Successfully flushed 35/35 history records to TimescaleDB
DEBUG 2025/12/17 17:46:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:46:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:46:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:46:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:46:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:46:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:46:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:46:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:46:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:46:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:46:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:46:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:46:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:46:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:46:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:46:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:46:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:46:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:46:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:46:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:46:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:46:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:46:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:46:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.36% (threshold: 80.00%)
WARN 2025/12/17 17:46:45 ES Alert Created [high][capacity]: Disk usage high: 93.45% (threshold: 85.00%)
WARN 2025/12/17 17:46:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:46:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:46:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:46:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:46:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:46:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:46:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:47:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:47:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:47:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:47:00 Field: school_name.keyword
DEBUG 2025/12/17 17:47:00 Time From: 2025-12-17T17:46:00.000+08:00
DEBUG 2025/12/17 17:47:00 Time To: 2025-12-17T17:47:00.000+08:00
DEBUG 2025/12/17 17:47:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:46:00.000+08:00",
					"lte": "2025-12-17T17:47:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:47:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:47:00 ES Response IsError: false
DEBUG 2025/12/17 17:47:00 ES Response Body:
{"took":172,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":393,"buckets":[{"key":"黑快馬主機","doc_count":1688},{"key":"花蓮高農","doc_count":759},{"key":"仁愛高農","doc_count":585},{"key":"新竹女中","doc_count":522},{"key":"金門農工","doc_count":492},{"key":"金門高中","doc_count":487},{"key":"北門高中","doc_count":392},{"key":"蘇澳海事","doc_count":366},{"key":"宜蘭高商","doc_count":349},{"key":"南投高商","doc_count":345},{"key":"師大附中高中部","doc_count":304},{"key":"內埔農工","doc_count":291},{"key":"華僑高中","doc_count":269},{"key":"竹北高中","doc_count":241},{"key":"新竹高商","doc_count":219},{"key":"斗六家商","doc_count":218},{"key":"關西高中","doc_count":214},{"key":"興大附中","doc_count":206},{"key":"臺東高中","doc_count":204},{"key":"清華附小","doc_count":200},{"key":"苗栗農工","doc_count":198},{"key":"旗美高中","doc_count":195},{"key":"新港藝高","doc_count":188},{"key":"花蓮高商","doc_count":186},{"key":"屏東女中","doc_count":172},{"key":"曾文農工","doc_count":166},{"key":"玉里高中","doc_count":162},{"key":"後壁高中","doc_count":160},{"key":"南投特教","doc_count":153},{"key":"關山工商","doc_count":153},{"key":"中大壢中","doc_count":147},{"key":"竹南高中","doc_count":147},{"key":"嘉義高商","doc_count":141},{"key":"彰師附工","doc_count":141},{"key":"新竹高工","doc_count":141},{"key":"員林農工","doc_count":140},{"key":"新營高工","doc_count":127},{"key":"虎尾高中","doc_count":124},{"key":"新化高工","doc_count":122},{"key":"東港海事","doc_count":116},{"key":"南大附聰","doc_count":105},{"key":"溪湖高中","doc_count":102},{"key":"埔里高工","doc_count":94},{"key":"新化高中","doc_count":92},{"key":"澎湖海事","doc_count":91},{"key":"花蓮高工","doc_count":88},{"key":"員林家商","doc_count":87},{"key":"北教大實小","doc_count":84},{"key":"屏科實中","doc_count":76},{"key":"北斗家商","doc_count":75},{"key":"嘉義高中","doc_count":74},{"key":"苗栗高商","doc_count":74},{"key":"南投高中","doc_count":73},{"key":"苗栗高中","doc_count":73},{"key":"政大附中","doc_count":72},{"key":"土庫商工","doc_count":71},{"key":"水里商工","doc_count":69},{"key":"海大附中","doc_count":69},{"key":"潮州高中","doc_count":68},{"key":"二林工商","doc_count":65},{"key":"南大附小","doc_count":65},{"key":"臺南一中","doc_count":65},{"key":"鳳山高中","doc_count":65},{"key":"宜蘭高中","doc_count":63},{"key":"新營高中","doc_count":63},{"key":"興大附農","doc_count":63},{"key":"臺南高商","doc_count":62},{"key":"羅東高商","doc_count":61},{"key":"北港高中","doc_count":59},{"key":"嘉科實中","doc_count":58},{"key":"臺東高商","doc_count":58},{"key":"竹山高中","doc_count":55},{"key":"華南高商","doc_count":53},{"key":"嘉義高工","doc_count":51},{"key":"彰化高商","doc_count":51},{"key":"永靖高工","doc_count":51},{"key":"臺東女中","doc_count":51},{"key":"員林高中","doc_count":46},{"key":"新竹高中","doc_count":46},{"key":"屏東高工","doc_count":45},{"key":"成大南工","doc_count":44},{"key":"基隆商工","doc_count":43},{"key":"佳冬高農","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"草屯商工","doc_count":41},{"key":"屏東高中","doc_count":39},{"key":"北港農工","doc_count":36},{"key":"崇實高工","doc_count":36},{"key":"竹東高中","doc_count":36},{"key":"南大附中","doc_count":35},{"key":"新竹特教","doc_count":35},{"key":"秀水高工","doc_count":35},{"key":"蘭陽女中","doc_count":35},{"key":"嘉義特教","doc_count":34},{"key":"花蓮高中","doc_count":34},{"key":"雲林特教","doc_count":34},{"key":"師大附中國中部","doc_count":33},{"key":"成功商水","doc_count":33},{"key":"新豐高中","doc_count":33},{"key":"旗山農工","doc_count":33}]}}}
DEBUG 2025/12/17 17:47:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:47:00   Bucket[0]: Key=黑快馬主機, DocCount=1688
DEBUG 2025/12/17 17:47:00   Bucket[1]: Key=花蓮高農, DocCount=759
DEBUG 2025/12/17 17:47:00   Bucket[2]: Key=仁愛高農, DocCount=585
DEBUG 2025/12/17 17:47:00   Bucket[3]: Key=新竹女中, DocCount=522
DEBUG 2025/12/17 17:47:00   Bucket[4]: Key=金門農工, DocCount=492
DEBUG 2025/12/17 17:47:00   Bucket[5]: Key=金門高中, DocCount=487
DEBUG 2025/12/17 17:47:00   Bucket[6]: Key=北門高中, DocCount=392
DEBUG 2025/12/17 17:47:00   Bucket[7]: Key=蘇澳海事, DocCount=366
DEBUG 2025/12/17 17:47:00   Bucket[8]: Key=宜蘭高商, DocCount=349
DEBUG 2025/12/17 17:47:00   Bucket[9]: Key=南投高商, DocCount=345
DEBUG 2025/12/17 17:47:00   Bucket[10]: Key=師大附中高中部, DocCount=304
DEBUG 2025/12/17 17:47:00   Bucket[11]: Key=內埔農工, DocCount=291
DEBUG 2025/12/17 17:47:00   Bucket[12]: Key=華僑高中, DocCount=269
DEBUG 2025/12/17 17:47:00   Bucket[13]: Key=竹北高中, DocCount=241
DEBUG 2025/12/17 17:47:00   Bucket[14]: Key=新竹高商, DocCount=219
DEBUG 2025/12/17 17:47:00   Bucket[15]: Key=斗六家商, DocCount=218
DEBUG 2025/12/17 17:47:00   Bucket[16]: Key=關西高中, DocCount=214
DEBUG 2025/12/17 17:47:00   Bucket[17]: Key=興大附中, DocCount=206
DEBUG 2025/12/17 17:47:00   Bucket[18]: Key=臺東高中, DocCount=204
DEBUG 2025/12/17 17:47:00   Bucket[19]: Key=清華附小, DocCount=200
DEBUG 2025/12/17 17:47:00   Bucket[20]: Key=苗栗農工, DocCount=198
DEBUG 2025/12/17 17:47:00   Bucket[21]: Key=旗美高中, DocCount=195
DEBUG 2025/12/17 17:47:00   Bucket[22]: Key=新港藝高, DocCount=188
DEBUG 2025/12/17 17:47:00   Bucket[23]: Key=花蓮高商, DocCount=186
DEBUG 2025/12/17 17:47:00   Bucket[24]: Key=屏東女中, DocCount=172
DEBUG 2025/12/17 17:47:00   Bucket[25]: Key=曾文農工, DocCount=166
DEBUG 2025/12/17 17:47:00   Bucket[26]: Key=玉里高中, DocCount=162
DEBUG 2025/12/17 17:47:00   Bucket[27]: Key=後壁高中, DocCount=160
DEBUG 2025/12/17 17:47:00   Bucket[28]: Key=南投特教, DocCount=153
DEBUG 2025/12/17 17:47:00   Bucket[29]: Key=關山工商, DocCount=153
DEBUG 2025/12/17 17:47:00   Bucket[30]: Key=中大壢中, DocCount=147
DEBUG 2025/12/17 17:47:00   Bucket[31]: Key=竹南高中, DocCount=147
DEBUG 2025/12/17 17:47:00   Bucket[32]: Key=嘉義高商, DocCount=141
DEBUG 2025/12/17 17:47:00   Bucket[33]: Key=彰師附工, DocCount=141
DEBUG 2025/12/17 17:47:00   Bucket[34]: Key=新竹高工, DocCount=141
DEBUG 2025/12/17 17:47:00   Bucket[35]: Key=員林農工, DocCount=140
DEBUG 2025/12/17 17:47:00   Bucket[36]: Key=新營高工, DocCount=127
DEBUG 2025/12/17 17:47:00   Bucket[37]: Key=虎尾高中, DocCount=124
DEBUG 2025/12/17 17:47:00   Bucket[38]: Key=新化高工, DocCount=122
DEBUG 2025/12/17 17:47:00   Bucket[39]: Key=東港海事, DocCount=116
DEBUG 2025/12/17 17:47:00   Bucket[40]: Key=南大附聰, DocCount=105
DEBUG 2025/12/17 17:47:00   Bucket[41]: Key=溪湖高中, DocCount=102
DEBUG 2025/12/17 17:47:00   Bucket[42]: Key=埔里高工, DocCount=94
DEBUG 2025/12/17 17:47:00   Bucket[43]: Key=新化高中, DocCount=92
DEBUG 2025/12/17 17:47:00   Bucket[44]: Key=澎湖海事, DocCount=91
DEBUG 2025/12/17 17:47:00   Bucket[45]: Key=花蓮高工, DocCount=88
DEBUG 2025/12/17 17:47:00   Bucket[46]: Key=員林家商, DocCount=87
DEBUG 2025/12/17 17:47:00   Bucket[47]: Key=北教大實小, DocCount=84
DEBUG 2025/12/17 17:47:00   Bucket[48]: Key=屏科實中, DocCount=76
DEBUG 2025/12/17 17:47:00   Bucket[49]: Key=北斗家商, DocCount=75
DEBUG 2025/12/17 17:47:00   Bucket[50]: Key=嘉義高中, DocCount=74
DEBUG 2025/12/17 17:47:00   Bucket[51]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:47:00   Bucket[52]: Key=南投高中, DocCount=73
DEBUG 2025/12/17 17:47:00   Bucket[53]: Key=苗栗高中, DocCount=73
DEBUG 2025/12/17 17:47:00   Bucket[54]: Key=政大附中, DocCount=72
DEBUG 2025/12/17 17:47:00   Bucket[55]: Key=土庫商工, DocCount=71
DEBUG 2025/12/17 17:47:00   Bucket[56]: Key=水里商工, DocCount=69
DEBUG 2025/12/17 17:47:00   Bucket[57]: Key=海大附中, DocCount=69
DEBUG 2025/12/17 17:47:00   Bucket[58]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:47:00   Bucket[59]: Key=二林工商, DocCount=65
DEBUG 2025/12/17 17:47:00   Bucket[60]: Key=南大附小, DocCount=65
DEBUG 2025/12/17 17:47:00   Bucket[61]: Key=臺南一中, DocCount=65
DEBUG 2025/12/17 17:47:00   Bucket[62]: Key=鳳山高中, DocCount=65
DEBUG 2025/12/17 17:47:00   Bucket[63]: Key=宜蘭高中, DocCount=63
DEBUG 2025/12/17 17:47:00   Bucket[64]: Key=新營高中, DocCount=63
DEBUG 2025/12/17 17:47:00   Bucket[65]: Key=興大附農, DocCount=63
DEBUG 2025/12/17 17:47:00   Bucket[66]: Key=臺南高商, DocCount=62
DEBUG 2025/12/17 17:47:00   Bucket[67]: Key=羅東高商, DocCount=61
DEBUG 2025/12/17 17:47:00   Bucket[68]: Key=北港高中, DocCount=59
DEBUG 2025/12/17 17:47:00   Bucket[69]: Key=嘉科實中, DocCount=58
DEBUG 2025/12/17 17:47:00   Bucket[70]: Key=臺東高商, DocCount=58
DEBUG 2025/12/17 17:47:00   Bucket[71]: Key=竹山高中, DocCount=55
DEBUG 2025/12/17 17:47:00   Bucket[72]: Key=華南高商, DocCount=53
DEBUG 2025/12/17 17:47:00   Bucket[73]: Key=嘉義高工, DocCount=51
DEBUG 2025/12/17 17:47:00   Bucket[74]: Key=彰化高商, DocCount=51
DEBUG 2025/12/17 17:47:00   Bucket[75]: Key=永靖高工, DocCount=51
DEBUG 2025/12/17 17:47:00   Bucket[76]: Key=臺東女中, DocCount=51
DEBUG 2025/12/17 17:47:00   Bucket[77]: Key=員林高中, DocCount=46
DEBUG 2025/12/17 17:47:00   Bucket[78]: Key=新竹高中, DocCount=46
DEBUG 2025/12/17 17:47:00   Bucket[79]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:47:00   Bucket[80]: Key=成大南工, DocCount=44
DEBUG 2025/12/17 17:47:00   Bucket[81]: Key=基隆商工, DocCount=43
DEBUG 2025/12/17 17:47:00   Bucket[82]: Key=佳冬高農, DocCount=42
DEBUG 2025/12/17 17:47:00   Bucket[83]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:47:00   Bucket[84]: Key=草屯商工, DocCount=41
DEBUG 2025/12/17 17:47:00   Bucket[85]: Key=屏東高中, DocCount=39
DEBUG 2025/12/17 17:47:00   Bucket[86]: Key=北港農工, DocCount=36
DEBUG 2025/12/17 17:47:00   Bucket[87]: Key=崇實高工, DocCount=36
DEBUG 2025/12/17 17:47:00   Bucket[88]: Key=竹東高中, DocCount=36
DEBUG 2025/12/17 17:47:00   Bucket[89]: Key=南大附中, DocCount=35
DEBUG 2025/12/17 17:47:00   Bucket[90]: Key=新竹特教, DocCount=35
DEBUG 2025/12/17 17:47:00   Bucket[91]: Key=秀水高工, DocCount=35
DEBUG 2025/12/17 17:47:00   Bucket[92]: Key=蘭陽女中, DocCount=35
DEBUG 2025/12/17 17:47:00   Bucket[93]: Key=嘉義特教, DocCount=34
DEBUG 2025/12/17 17:47:00   Bucket[94]: Key=花蓮高中, DocCount=34
DEBUG 2025/12/17 17:47:00   Bucket[95]: Key=雲林特教, DocCount=34
DEBUG 2025/12/17 17:47:00   Bucket[96]: Key=師大附中國中部, DocCount=33
DEBUG 2025/12/17 17:47:00   Bucket[97]: Key=成功商水, DocCount=33
DEBUG 2025/12/17 17:47:00   Bucket[98]: Key=新豐高中, DocCount=33
DEBUG 2025/12/17 17:47:00   Bucket[99]: Key=旗山農工, DocCount=33
DEBUG 2025/12/17 17:47:00 ========================================================
INFO 2025/12/17 17:47:03 ✅ Successfully flushed 22/22 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 50/55 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:47:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:47:08 ✅ Successfully flushed 15/15 history records to TimescaleDB
INFO 2025/12/17 17:47:08 Processing 15 offline devices
INFO 2025/12/17 17:47:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:47:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:47:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:47:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:47:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:47:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:47:08 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:47:08 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:47:08 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:47:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:47:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:47:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:47:08 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:47:08 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:47:08 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:47:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:47:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:47:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:47:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:47:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:47:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:47:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:47:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:47:09 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:47:09 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:47:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:47:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:47:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:47:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:47:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:47:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:47:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:47:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:47:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:47:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:47:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:47:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 17:47:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:47:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:47:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:47:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:47:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:47:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:47:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:47:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:47:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:47:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:47:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:47:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:47:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:47:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:47:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:47:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:47:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:47:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:47:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:47:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:47:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:47:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:47:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:47:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.53% (threshold: 90.00%)
DEBUG 2025/12/17 17:47:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.45% (threshold: 85.00%)
DEBUG 2025/12/17 17:47:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:47:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:47:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:47:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:47:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:47:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:47:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:48:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:48:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:48:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:48:00 Field: school_name.keyword
DEBUG 2025/12/17 17:48:00 Time From: 2025-12-17T17:47:00.000+08:00
DEBUG 2025/12/17 17:48:00 Time To: 2025-12-17T17:48:00.000+08:00
DEBUG 2025/12/17 17:48:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:47:00.000+08:00",
					"lte": "2025-12-17T17:48:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:48:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:48:00 ES Response IsError: false
DEBUG 2025/12/17 17:48:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":462,"buckets":[{"key":"東石高中","doc_count":859},{"key":"花蓮高農","doc_count":786},{"key":"嘉義特教","doc_count":767},{"key":"華南高商","doc_count":760},{"key":"黑快馬主機","doc_count":580},{"key":"仁愛高農","doc_count":559},{"key":"新竹女中","doc_count":490},{"key":"金門農工","doc_count":449},{"key":"金門高中","doc_count":428},{"key":"北門高中","doc_count":371},{"key":"南投高商","doc_count":342},{"key":"師大附中高中部","doc_count":329},{"key":"竹北高中","doc_count":285},{"key":"宜蘭高商","doc_count":280},{"key":"蘇澳海事","doc_count":272},{"key":"華僑高中","doc_count":243},{"key":"臺東高中","doc_count":242},{"key":"關西高中","doc_count":232},{"key":"後壁高中","doc_count":220},{"key":"旗美高中","doc_count":220},{"key":"內埔農工","doc_count":219},{"key":"斗六家商","doc_count":213},{"key":"玉里高中","doc_count":210},{"key":"清華附小","doc_count":206},{"key":"中大壢中","doc_count":195},{"key":"苗栗農工","doc_count":193},{"key":"興大附中","doc_count":192},{"key":"新港藝高","doc_count":187},{"key":"北斗家商","doc_count":178},{"key":"南投特教","doc_count":159},{"key":"虎尾高中","doc_count":154},{"key":"竹南高中","doc_count":149},{"key":"花蓮高商","doc_count":147},{"key":"鳳山高中","doc_count":147},{"key":"政大附中","doc_count":145},{"key":"宜蘭高中","doc_count":143},{"key":"關山工商","doc_count":143},{"key":"北教大實小","doc_count":141},{"key":"新化高中","doc_count":138},{"key":"屏東女中","doc_count":123},{"key":"新營高工","doc_count":121},{"key":"嘉科實中","doc_count":118},{"key":"草屯商工","doc_count":118},{"key":"東港海事","doc_count":116},{"key":"新竹高工","doc_count":114},{"key":"新化高工","doc_count":111},{"key":"嘉義高商","doc_count":100},{"key":"員林農工","doc_count":95},{"key":"員林高中","doc_count":95},{"key":"新竹高商","doc_count":92},{"key":"土庫商工","doc_count":88},{"key":"員林家商","doc_count":87},{"key":"新竹高中","doc_count":84},{"key":"屏科實中","doc_count":83},{"key":"南投高中","doc_count":82},{"key":"彰師附工","doc_count":82},{"key":"南大附聰","doc_count":81},{"key":"溪湖高中","doc_count":77},{"key":"苗栗高中","doc_count":77},{"key":"彰化高商","doc_count":75},{"key":"北港農工","doc_count":72},{"key":"成大南工","doc_count":72},{"key":"成功商水","doc_count":70},{"key":"澎湖海事","doc_count":70},{"key":"新營高中","doc_count":68},{"key":"花蓮高工","doc_count":65},{"key":"高餐大附中","doc_count":65},{"key":"水里商工","doc_count":64},{"key":"臺南高商","doc_count":64},{"key":"臺東高商","doc_count":62},{"key":"興大附農","doc_count":62},{"key":"旗山農工","doc_count":60},{"key":"海大附中","doc_count":60},{"key":"白河商工","doc_count":60},{"key":"南大附中","doc_count":59},{"key":"基隆商工","doc_count":59},{"key":"屏東高工","doc_count":59},{"key":"竹山高中","doc_count":59},{"key":"臺南一中","doc_count":58},{"key":"苗栗高商","doc_count":57},{"key":"嘉義高中","doc_count":54},{"key":"暨大附中","doc_count":54},{"key":"竹東高中","doc_count":53},{"key":"屏東高中","doc_count":52},{"key":"潮州高中","doc_count":51},{"key":"花蓮高中","doc_count":51},{"key":"曾文農工","doc_count":50},{"key":"新豐高中","doc_count":48},{"key":"雲林特教","doc_count":47},{"key":"二林工商","doc_count":46},{"key":"永靖高工","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"臺東女中","doc_count":44},{"key":"秀水高工","doc_count":42},{"key":"北港高中","doc_count":40},{"key":"屏東特教","doc_count":40},{"key":"嘉義家職","doc_count":39},{"key":"嘉義高工","doc_count":39},{"key":"埔里高工","doc_count":38},{"key":"花蓮特教","doc_count":38}]}}}
DEBUG 2025/12/17 17:48:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:48:00   Bucket[0]: Key=東石高中, DocCount=859
DEBUG 2025/12/17 17:48:00   Bucket[1]: Key=花蓮高農, DocCount=786
DEBUG 2025/12/17 17:48:00   Bucket[2]: Key=嘉義特教, DocCount=767
DEBUG 2025/12/17 17:48:00   Bucket[3]: Key=華南高商, DocCount=760
DEBUG 2025/12/17 17:48:00   Bucket[4]: Key=黑快馬主機, DocCount=580
DEBUG 2025/12/17 17:48:00   Bucket[5]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:48:00   Bucket[6]: Key=新竹女中, DocCount=490
DEBUG 2025/12/17 17:48:00   Bucket[7]: Key=金門農工, DocCount=449
DEBUG 2025/12/17 17:48:00   Bucket[8]: Key=金門高中, DocCount=428
DEBUG 2025/12/17 17:48:00   Bucket[9]: Key=北門高中, DocCount=371
DEBUG 2025/12/17 17:48:00   Bucket[10]: Key=南投高商, DocCount=342
DEBUG 2025/12/17 17:48:00   Bucket[11]: Key=師大附中高中部, DocCount=329
DEBUG 2025/12/17 17:48:00   Bucket[12]: Key=竹北高中, DocCount=285
DEBUG 2025/12/17 17:48:00   Bucket[13]: Key=宜蘭高商, DocCount=280
DEBUG 2025/12/17 17:48:00   Bucket[14]: Key=蘇澳海事, DocCount=272
DEBUG 2025/12/17 17:48:00   Bucket[15]: Key=華僑高中, DocCount=243
DEBUG 2025/12/17 17:48:00   Bucket[16]: Key=臺東高中, DocCount=242
DEBUG 2025/12/17 17:48:00   Bucket[17]: Key=關西高中, DocCount=232
DEBUG 2025/12/17 17:48:00   Bucket[18]: Key=後壁高中, DocCount=220
DEBUG 2025/12/17 17:48:00   Bucket[19]: Key=旗美高中, DocCount=220
DEBUG 2025/12/17 17:48:00   Bucket[20]: Key=內埔農工, DocCount=219
DEBUG 2025/12/17 17:48:00   Bucket[21]: Key=斗六家商, DocCount=213
DEBUG 2025/12/17 17:48:00   Bucket[22]: Key=玉里高中, DocCount=210
DEBUG 2025/12/17 17:48:00   Bucket[23]: Key=清華附小, DocCount=206
DEBUG 2025/12/17 17:48:00   Bucket[24]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:48:00   Bucket[25]: Key=苗栗農工, DocCount=193
DEBUG 2025/12/17 17:48:00   Bucket[26]: Key=興大附中, DocCount=192
DEBUG 2025/12/17 17:48:00   Bucket[27]: Key=新港藝高, DocCount=187
DEBUG 2025/12/17 17:48:00   Bucket[28]: Key=北斗家商, DocCount=178
DEBUG 2025/12/17 17:48:00   Bucket[29]: Key=南投特教, DocCount=159
DEBUG 2025/12/17 17:48:00   Bucket[30]: Key=虎尾高中, DocCount=154
DEBUG 2025/12/17 17:48:00   Bucket[31]: Key=竹南高中, DocCount=149
DEBUG 2025/12/17 17:48:00   Bucket[32]: Key=花蓮高商, DocCount=147
DEBUG 2025/12/17 17:48:00   Bucket[33]: Key=鳳山高中, DocCount=147
DEBUG 2025/12/17 17:48:00   Bucket[34]: Key=政大附中, DocCount=145
DEBUG 2025/12/17 17:48:00   Bucket[35]: Key=宜蘭高中, DocCount=143
DEBUG 2025/12/17 17:48:00   Bucket[36]: Key=關山工商, DocCount=143
DEBUG 2025/12/17 17:48:00   Bucket[37]: Key=北教大實小, DocCount=141
DEBUG 2025/12/17 17:48:00   Bucket[38]: Key=新化高中, DocCount=138
DEBUG 2025/12/17 17:48:00   Bucket[39]: Key=屏東女中, DocCount=123
DEBUG 2025/12/17 17:48:00   Bucket[40]: Key=新營高工, DocCount=121
DEBUG 2025/12/17 17:48:00   Bucket[41]: Key=嘉科實中, DocCount=118
DEBUG 2025/12/17 17:48:00   Bucket[42]: Key=草屯商工, DocCount=118
DEBUG 2025/12/17 17:48:00   Bucket[43]: Key=東港海事, DocCount=116
DEBUG 2025/12/17 17:48:00   Bucket[44]: Key=新竹高工, DocCount=114
DEBUG 2025/12/17 17:48:00   Bucket[45]: Key=新化高工, DocCount=111
DEBUG 2025/12/17 17:48:00   Bucket[46]: Key=嘉義高商, DocCount=100
DEBUG 2025/12/17 17:48:00   Bucket[47]: Key=員林農工, DocCount=95
DEBUG 2025/12/17 17:48:00   Bucket[48]: Key=員林高中, DocCount=95
DEBUG 2025/12/17 17:48:00   Bucket[49]: Key=新竹高商, DocCount=92
DEBUG 2025/12/17 17:48:00   Bucket[50]: Key=土庫商工, DocCount=88
DEBUG 2025/12/17 17:48:00   Bucket[51]: Key=員林家商, DocCount=87
DEBUG 2025/12/17 17:48:00   Bucket[52]: Key=新竹高中, DocCount=84
DEBUG 2025/12/17 17:48:00   Bucket[53]: Key=屏科實中, DocCount=83
DEBUG 2025/12/17 17:48:00   Bucket[54]: Key=南投高中, DocCount=82
DEBUG 2025/12/17 17:48:00   Bucket[55]: Key=彰師附工, DocCount=82
DEBUG 2025/12/17 17:48:00   Bucket[56]: Key=南大附聰, DocCount=81
DEBUG 2025/12/17 17:48:00   Bucket[57]: Key=溪湖高中, DocCount=77
DEBUG 2025/12/17 17:48:00   Bucket[58]: Key=苗栗高中, DocCount=77
DEBUG 2025/12/17 17:48:00   Bucket[59]: Key=彰化高商, DocCount=75
DEBUG 2025/12/17 17:48:00   Bucket[60]: Key=北港農工, DocCount=72
DEBUG 2025/12/17 17:48:00   Bucket[61]: Key=成大南工, DocCount=72
DEBUG 2025/12/17 17:48:00   Bucket[62]: Key=成功商水, DocCount=70
DEBUG 2025/12/17 17:48:00   Bucket[63]: Key=澎湖海事, DocCount=70
DEBUG 2025/12/17 17:48:00   Bucket[64]: Key=新營高中, DocCount=68
DEBUG 2025/12/17 17:48:00   Bucket[65]: Key=花蓮高工, DocCount=65
DEBUG 2025/12/17 17:48:00   Bucket[66]: Key=高餐大附中, DocCount=65
DEBUG 2025/12/17 17:48:00   Bucket[67]: Key=水里商工, DocCount=64
DEBUG 2025/12/17 17:48:00   Bucket[68]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 17:48:00   Bucket[69]: Key=臺東高商, DocCount=62
DEBUG 2025/12/17 17:48:00   Bucket[70]: Key=興大附農, DocCount=62
DEBUG 2025/12/17 17:48:00   Bucket[71]: Key=旗山農工, DocCount=60
DEBUG 2025/12/17 17:48:00   Bucket[72]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:48:00   Bucket[73]: Key=白河商工, DocCount=60
DEBUG 2025/12/17 17:48:00   Bucket[74]: Key=南大附中, DocCount=59
DEBUG 2025/12/17 17:48:00   Bucket[75]: Key=基隆商工, DocCount=59
DEBUG 2025/12/17 17:48:00   Bucket[76]: Key=屏東高工, DocCount=59
DEBUG 2025/12/17 17:48:00   Bucket[77]: Key=竹山高中, DocCount=59
DEBUG 2025/12/17 17:48:00   Bucket[78]: Key=臺南一中, DocCount=58
DEBUG 2025/12/17 17:48:00   Bucket[79]: Key=苗栗高商, DocCount=57
DEBUG 2025/12/17 17:48:00   Bucket[80]: Key=嘉義高中, DocCount=54
DEBUG 2025/12/17 17:48:00   Bucket[81]: Key=暨大附中, DocCount=54
DEBUG 2025/12/17 17:48:00   Bucket[82]: Key=竹東高中, DocCount=53
DEBUG 2025/12/17 17:48:00   Bucket[83]: Key=屏東高中, DocCount=52
DEBUG 2025/12/17 17:48:00   Bucket[84]: Key=潮州高中, DocCount=51
DEBUG 2025/12/17 17:48:00   Bucket[85]: Key=花蓮高中, DocCount=51
DEBUG 2025/12/17 17:48:00   Bucket[86]: Key=曾文農工, DocCount=50
DEBUG 2025/12/17 17:48:00   Bucket[87]: Key=新豐高中, DocCount=48
DEBUG 2025/12/17 17:48:00   Bucket[88]: Key=雲林特教, DocCount=47
DEBUG 2025/12/17 17:48:00   Bucket[89]: Key=二林工商, DocCount=46
DEBUG 2025/12/17 17:48:00   Bucket[90]: Key=永靖高工, DocCount=45
DEBUG 2025/12/17 17:48:00   Bucket[91]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:48:00   Bucket[92]: Key=臺東女中, DocCount=44
DEBUG 2025/12/17 17:48:00   Bucket[93]: Key=秀水高工, DocCount=42
DEBUG 2025/12/17 17:48:00   Bucket[94]: Key=北港高中, DocCount=40
DEBUG 2025/12/17 17:48:00   Bucket[95]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:48:00   Bucket[96]: Key=嘉義家職, DocCount=39
DEBUG 2025/12/17 17:48:00   Bucket[97]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:48:00   Bucket[98]: Key=埔里高工, DocCount=38
DEBUG 2025/12/17 17:48:00   Bucket[99]: Key=花蓮特教, DocCount=38
DEBUG 2025/12/17 17:48:00 ========================================================
INFO 2025/12/17 17:48:03 ✅ Successfully flushed 25/25 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:48:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:48:07 Processing 15 offline devices
INFO 2025/12/17 17:48:07 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:48:07 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:48:07 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:48:07 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:48:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:48:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:48:07 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:48:07 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:48:07 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:48:07 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:48:07 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:48:07 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:48:07 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:48:07 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:48:07 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:48:07 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:48:07 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:48:07 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:48:07 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:48:07 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:48:07 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:48:07 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:48:07 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:48:07 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:48:07 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:48:07 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:48:07 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:48:07 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:48:07 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:48:07 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:48:07 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:48:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:48:08 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 17:48:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:48:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:48:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:48:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:48:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:48:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:48:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:48:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:48:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:48:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:48:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:48:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:48:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:48:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:48:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:48:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:48:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:48:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:48:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:48:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:48:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.34% (threshold: 80.00%)
INFO 2025/12/17 17:48:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.48% (threshold: 85.00%)
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:48:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:48:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:48:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:48:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:48:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:49:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:49:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:49:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:49:00 Field: school_name.keyword
DEBUG 2025/12/17 17:49:00 Time From: 2025-12-17T17:48:00.000+08:00
DEBUG 2025/12/17 17:49:00 Time To: 2025-12-17T17:49:00.000+08:00
DEBUG 2025/12/17 17:49:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:48:00.000+08:00",
					"lte": "2025-12-17T17:49:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:49:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:49:00 ES Response IsError: false
DEBUG 2025/12/17 17:49:00 ES Response Body:
{"took":61,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":386,"buckets":[{"key":"黑快馬主機","doc_count":1300},{"key":"花蓮高農","doc_count":905},{"key":"東石高中","doc_count":797},{"key":"華南高商","doc_count":752},{"key":"嘉義特教","doc_count":750},{"key":"仁愛高農","doc_count":534},{"key":"金門高中","doc_count":446},{"key":"金門農工","doc_count":432},{"key":"新竹女中","doc_count":421},{"key":"北門高中","doc_count":416},{"key":"中大壢中","doc_count":317},{"key":"華僑高中","doc_count":317},{"key":"蘇澳海事","doc_count":304},{"key":"宜蘭高商","doc_count":276},{"key":"新港藝高","doc_count":274},{"key":"南投高商","doc_count":264},{"key":"竹北高中","doc_count":263},{"key":"關西高中","doc_count":211},{"key":"內埔農工","doc_count":206},{"key":"興大附中","doc_count":206},{"key":"宜蘭高中","doc_count":199},{"key":"斗六家商","doc_count":194},{"key":"臺東高中","doc_count":188},{"key":"清華附小","doc_count":177},{"key":"師大附中高中部","doc_count":167},{"key":"花蓮高商","doc_count":163},{"key":"後壁高中","doc_count":160},{"key":"苗栗農工","doc_count":158},{"key":"屏東高中","doc_count":155},{"key":"玉里高中","doc_count":152},{"key":"新竹高商","doc_count":146},{"key":"關山工商","doc_count":146},{"key":"旗美高中","doc_count":140},{"key":"新營高工","doc_count":139},{"key":"苗栗高中","doc_count":132},{"key":"竹南高中","doc_count":131},{"key":"南投特教","doc_count":126},{"key":"鳳山高中","doc_count":124},{"key":"新化高中","doc_count":117},{"key":"新化高工","doc_count":115},{"key":"北教大實小","doc_count":108},{"key":"東港海事","doc_count":102},{"key":"二林工商","doc_count":100},{"key":"旗山農工","doc_count":99},{"key":"澎湖海事","doc_count":97},{"key":"屏東女中","doc_count":96},{"key":"草屯商工","doc_count":93},{"key":"彰師附工","doc_count":92},{"key":"嘉科實中","doc_count":90},{"key":"新竹高工","doc_count":89},{"key":"佳冬高農","doc_count":86},{"key":"嘉義高商","doc_count":86},{"key":"員林家商","doc_count":85},{"key":"暨大附中","doc_count":85},{"key":"虎尾高中","doc_count":85},{"key":"高餐大附中","doc_count":81},{"key":"南投高中","doc_count":80},{"key":"屏科實中","doc_count":80},{"key":"嘉義高中","doc_count":78},{"key":"北斗家商","doc_count":75},{"key":"頭城家商","doc_count":73},{"key":"曾文農工","doc_count":71},{"key":"海大附中","doc_count":68},{"key":"新營高中","doc_count":67},{"key":"永靖高工","doc_count":67},{"key":"臺南高商","doc_count":67},{"key":"埔里高工","doc_count":66},{"key":"南大附聰","doc_count":65},{"key":"花蓮高工","doc_count":65},{"key":"南大附小","doc_count":64},{"key":"土庫商工","doc_count":64},{"key":"政大附中","doc_count":63},{"key":"水里商工","doc_count":62},{"key":"員林農工","doc_count":59},{"key":"成大南工","doc_count":57},{"key":"新豐高中","doc_count":57},{"key":"竹東高中","doc_count":54},{"key":"臺東高商","doc_count":51},{"key":"南大附中","doc_count":50},{"key":"潮州高中","doc_count":49},{"key":"溪湖高中","doc_count":47},{"key":"苗栗高商","doc_count":47},{"key":"基隆商工","doc_count":45},{"key":"臺東女中","doc_count":43},{"key":"善化高中","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"屏東高工","doc_count":42},{"key":"白河商工","doc_count":42},{"key":"玉井工商","doc_count":40},{"key":"蘭陽女中","doc_count":40},{"key":"羅東高工","doc_count":39},{"key":"興大附農","doc_count":39},{"key":"師大附中國中部","doc_count":38},{"key":"彰化高商","doc_count":38},{"key":"臺南一中","doc_count":38},{"key":"秀水高工","doc_count":37},{"key":"員林高中","doc_count":36},{"key":"花蓮高中","doc_count":36},{"key":"北港農工","doc_count":35},{"key":"北港高中","doc_count":35}]}}}
DEBUG 2025/12/17 17:49:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:49:00   Bucket[0]: Key=黑快馬主機, DocCount=1300
DEBUG 2025/12/17 17:49:00   Bucket[1]: Key=花蓮高農, DocCount=905
DEBUG 2025/12/17 17:49:00   Bucket[2]: Key=東石高中, DocCount=797
DEBUG 2025/12/17 17:49:00   Bucket[3]: Key=華南高商, DocCount=752
DEBUG 2025/12/17 17:49:00   Bucket[4]: Key=嘉義特教, DocCount=750
DEBUG 2025/12/17 17:49:00   Bucket[5]: Key=仁愛高農, DocCount=534
DEBUG 2025/12/17 17:49:00   Bucket[6]: Key=金門高中, DocCount=446
DEBUG 2025/12/17 17:49:00   Bucket[7]: Key=金門農工, DocCount=432
DEBUG 2025/12/17 17:49:00   Bucket[8]: Key=新竹女中, DocCount=421
DEBUG 2025/12/17 17:49:00   Bucket[9]: Key=北門高中, DocCount=416
DEBUG 2025/12/17 17:49:00   Bucket[10]: Key=中大壢中, DocCount=317
DEBUG 2025/12/17 17:49:00   Bucket[11]: Key=華僑高中, DocCount=317
DEBUG 2025/12/17 17:49:00   Bucket[12]: Key=蘇澳海事, DocCount=304
DEBUG 2025/12/17 17:49:00   Bucket[13]: Key=宜蘭高商, DocCount=276
DEBUG 2025/12/17 17:49:00   Bucket[14]: Key=新港藝高, DocCount=274
DEBUG 2025/12/17 17:49:00   Bucket[15]: Key=南投高商, DocCount=264
DEBUG 2025/12/17 17:49:00   Bucket[16]: Key=竹北高中, DocCount=263
DEBUG 2025/12/17 17:49:00   Bucket[17]: Key=關西高中, DocCount=211
DEBUG 2025/12/17 17:49:00   Bucket[18]: Key=內埔農工, DocCount=206
DEBUG 2025/12/17 17:49:00   Bucket[19]: Key=興大附中, DocCount=206
DEBUG 2025/12/17 17:49:00   Bucket[20]: Key=宜蘭高中, DocCount=199
DEBUG 2025/12/17 17:49:00   Bucket[21]: Key=斗六家商, DocCount=194
DEBUG 2025/12/17 17:49:00   Bucket[22]: Key=臺東高中, DocCount=188
DEBUG 2025/12/17 17:49:00   Bucket[23]: Key=清華附小, DocCount=177
DEBUG 2025/12/17 17:49:00   Bucket[24]: Key=師大附中高中部, DocCount=167
DEBUG 2025/12/17 17:49:00   Bucket[25]: Key=花蓮高商, DocCount=163
DEBUG 2025/12/17 17:49:00   Bucket[26]: Key=後壁高中, DocCount=160
DEBUG 2025/12/17 17:49:00   Bucket[27]: Key=苗栗農工, DocCount=158
DEBUG 2025/12/17 17:49:00   Bucket[28]: Key=屏東高中, DocCount=155
DEBUG 2025/12/17 17:49:00   Bucket[29]: Key=玉里高中, DocCount=152
DEBUG 2025/12/17 17:49:00   Bucket[30]: Key=新竹高商, DocCount=146
DEBUG 2025/12/17 17:49:00   Bucket[31]: Key=關山工商, DocCount=146
DEBUG 2025/12/17 17:49:00   Bucket[32]: Key=旗美高中, DocCount=140
DEBUG 2025/12/17 17:49:00   Bucket[33]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:49:00   Bucket[34]: Key=苗栗高中, DocCount=132
DEBUG 2025/12/17 17:49:00   Bucket[35]: Key=竹南高中, DocCount=131
DEBUG 2025/12/17 17:49:00   Bucket[36]: Key=南投特教, DocCount=126
DEBUG 2025/12/17 17:49:00   Bucket[37]: Key=鳳山高中, DocCount=124
DEBUG 2025/12/17 17:49:00   Bucket[38]: Key=新化高中, DocCount=117
DEBUG 2025/12/17 17:49:00   Bucket[39]: Key=新化高工, DocCount=115
DEBUG 2025/12/17 17:49:00   Bucket[40]: Key=北教大實小, DocCount=108
DEBUG 2025/12/17 17:49:00   Bucket[41]: Key=東港海事, DocCount=102
DEBUG 2025/12/17 17:49:00   Bucket[42]: Key=二林工商, DocCount=100
DEBUG 2025/12/17 17:49:00   Bucket[43]: Key=旗山農工, DocCount=99
DEBUG 2025/12/17 17:49:00   Bucket[44]: Key=澎湖海事, DocCount=97
DEBUG 2025/12/17 17:49:00   Bucket[45]: Key=屏東女中, DocCount=96
DEBUG 2025/12/17 17:49:00   Bucket[46]: Key=草屯商工, DocCount=93
DEBUG 2025/12/17 17:49:00   Bucket[47]: Key=彰師附工, DocCount=92
DEBUG 2025/12/17 17:49:00   Bucket[48]: Key=嘉科實中, DocCount=90
DEBUG 2025/12/17 17:49:00   Bucket[49]: Key=新竹高工, DocCount=89
DEBUG 2025/12/17 17:49:00   Bucket[50]: Key=佳冬高農, DocCount=86
DEBUG 2025/12/17 17:49:00   Bucket[51]: Key=嘉義高商, DocCount=86
DEBUG 2025/12/17 17:49:00   Bucket[52]: Key=員林家商, DocCount=85
DEBUG 2025/12/17 17:49:00   Bucket[53]: Key=暨大附中, DocCount=85
DEBUG 2025/12/17 17:49:00   Bucket[54]: Key=虎尾高中, DocCount=85
DEBUG 2025/12/17 17:49:00   Bucket[55]: Key=高餐大附中, DocCount=81
DEBUG 2025/12/17 17:49:00   Bucket[56]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:49:00   Bucket[57]: Key=屏科實中, DocCount=80
DEBUG 2025/12/17 17:49:00   Bucket[58]: Key=嘉義高中, DocCount=78
DEBUG 2025/12/17 17:49:00   Bucket[59]: Key=北斗家商, DocCount=75
DEBUG 2025/12/17 17:49:00   Bucket[60]: Key=頭城家商, DocCount=73
DEBUG 2025/12/17 17:49:00   Bucket[61]: Key=曾文農工, DocCount=71
DEBUG 2025/12/17 17:49:00   Bucket[62]: Key=海大附中, DocCount=68
DEBUG 2025/12/17 17:49:00   Bucket[63]: Key=新營高中, DocCount=67
DEBUG 2025/12/17 17:49:00   Bucket[64]: Key=永靖高工, DocCount=67
DEBUG 2025/12/17 17:49:00   Bucket[65]: Key=臺南高商, DocCount=67
DEBUG 2025/12/17 17:49:00   Bucket[66]: Key=埔里高工, DocCount=66
DEBUG 2025/12/17 17:49:00   Bucket[67]: Key=南大附聰, DocCount=65
DEBUG 2025/12/17 17:49:00   Bucket[68]: Key=花蓮高工, DocCount=65
DEBUG 2025/12/17 17:49:00   Bucket[69]: Key=南大附小, DocCount=64
DEBUG 2025/12/17 17:49:00   Bucket[70]: Key=土庫商工, DocCount=64
DEBUG 2025/12/17 17:49:00   Bucket[71]: Key=政大附中, DocCount=63
DEBUG 2025/12/17 17:49:00   Bucket[72]: Key=水里商工, DocCount=62
DEBUG 2025/12/17 17:49:00   Bucket[73]: Key=員林農工, DocCount=59
DEBUG 2025/12/17 17:49:00   Bucket[74]: Key=成大南工, DocCount=57
DEBUG 2025/12/17 17:49:00   Bucket[75]: Key=新豐高中, DocCount=57
DEBUG 2025/12/17 17:49:00   Bucket[76]: Key=竹東高中, DocCount=54
DEBUG 2025/12/17 17:49:00   Bucket[77]: Key=臺東高商, DocCount=51
DEBUG 2025/12/17 17:49:00   Bucket[78]: Key=南大附中, DocCount=50
DEBUG 2025/12/17 17:49:00   Bucket[79]: Key=潮州高中, DocCount=49
DEBUG 2025/12/17 17:49:00   Bucket[80]: Key=溪湖高中, DocCount=47
DEBUG 2025/12/17 17:49:00   Bucket[81]: Key=苗栗高商, DocCount=47
DEBUG 2025/12/17 17:49:00   Bucket[82]: Key=基隆商工, DocCount=45
DEBUG 2025/12/17 17:49:00   Bucket[83]: Key=臺東女中, DocCount=43
DEBUG 2025/12/17 17:49:00   Bucket[84]: Key=善化高中, DocCount=42
DEBUG 2025/12/17 17:49:00   Bucket[85]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:49:00   Bucket[86]: Key=屏東高工, DocCount=42
DEBUG 2025/12/17 17:49:00   Bucket[87]: Key=白河商工, DocCount=42
DEBUG 2025/12/17 17:49:00   Bucket[88]: Key=玉井工商, DocCount=40
DEBUG 2025/12/17 17:49:00   Bucket[89]: Key=蘭陽女中, DocCount=40
DEBUG 2025/12/17 17:49:00   Bucket[90]: Key=羅東高工, DocCount=39
DEBUG 2025/12/17 17:49:00   Bucket[91]: Key=興大附農, DocCount=39
DEBUG 2025/12/17 17:49:00   Bucket[92]: Key=師大附中國中部, DocCount=38
DEBUG 2025/12/17 17:49:00   Bucket[93]: Key=彰化高商, DocCount=38
DEBUG 2025/12/17 17:49:00   Bucket[94]: Key=臺南一中, DocCount=38
DEBUG 2025/12/17 17:49:00   Bucket[95]: Key=秀水高工, DocCount=37
DEBUG 2025/12/17 17:49:00   Bucket[96]: Key=員林高中, DocCount=36
DEBUG 2025/12/17 17:49:00   Bucket[97]: Key=花蓮高中, DocCount=36
DEBUG 2025/12/17 17:49:00   Bucket[98]: Key=北港農工, DocCount=35
DEBUG 2025/12/17 17:49:00   Bucket[99]: Key=北港高中, DocCount=35
DEBUG 2025/12/17 17:49:00 ========================================================
INFO 2025/12/17 17:49:13 ✅ Successfully flushed 34/34 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:49:16 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:49:17 Processing 15 offline devices
INFO 2025/12/17 17:49:17 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:49:17 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:49:17 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:49:17 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:49:17 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:49:17 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:49:17 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:49:17 Creating history record for offline device: 雲林特教
INFO 2025/12/17 17:49:17 About to add history to batch for device: 雲林特教
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 雲林特教
INFO 2025/12/17 17:49:17 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:49:17 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:49:17 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:49:17 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:49:17 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:49:17 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:49:17 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:49:17 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:49:17 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:49:17 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:49:17 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:49:17 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:49:17 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:49:17 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:49:17 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:49:17 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:49:17 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:49:17 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:49:17 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:49:17 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:49:17 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:49:17 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:49:17 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:49:18 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:49:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:49:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:49:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:49:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:49:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:49:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:49:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:49:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:49:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:49:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:49:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:49:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:49:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:49:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:49:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:49:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:49:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:49:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:49:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:49:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:49:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.79% (threshold: 80.00%)
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.52% (threshold: 85.00%)
INFO 2025/12/17 17:49:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:49:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:49:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:49:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:49:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:49:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:50:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:50:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:50:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:50:00 Field: school_name.keyword
DEBUG 2025/12/17 17:50:00 Time From: 2025-12-17T17:49:00.000+08:00
DEBUG 2025/12/17 17:50:00 Time To: 2025-12-17T17:50:00.000+08:00
DEBUG 2025/12/17 17:50:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:49:00.000+08:00",
					"lte": "2025-12-17T17:50:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:50:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:50:00 ES Response IsError: false
DEBUG 2025/12/17 17:50:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":402,"buckets":[{"key":"花蓮高農","doc_count":922},{"key":"黑快馬主機","doc_count":877},{"key":"仁愛高農","doc_count":540},{"key":"金門農工","doc_count":450},{"key":"北門高中","doc_count":446},{"key":"金門高中","doc_count":431},{"key":"新竹女中","doc_count":372},{"key":"華僑高中","doc_count":325},{"key":"宜蘭高商","doc_count":310},{"key":"南投高商","doc_count":288},{"key":"蘇澳海事","doc_count":258},{"key":"斗六家商","doc_count":251},{"key":"關西高中","doc_count":250},{"key":"竹北高中","doc_count":227},{"key":"玉里高中","doc_count":226},{"key":"草屯商工","doc_count":212},{"key":"內埔農工","doc_count":210},{"key":"新港藝高","doc_count":210},{"key":"政大附中","doc_count":206},{"key":"臺東高中","doc_count":195},{"key":"屏東高中","doc_count":192},{"key":"佳冬高農","doc_count":187},{"key":"興大附農","doc_count":187},{"key":"花蓮高商","doc_count":185},{"key":"苗栗農工","doc_count":181},{"key":"興大附中","doc_count":179},{"key":"中大壢中","doc_count":177},{"key":"旗美高中","doc_count":166},{"key":"南投特教","doc_count":157},{"key":"後壁高中","doc_count":154},{"key":"成大南工","doc_count":153},{"key":"清華附小","doc_count":153},{"key":"關山工商","doc_count":132},{"key":"竹南高中","doc_count":126},{"key":"新竹高工","doc_count":124},{"key":"新化高中","doc_count":121},{"key":"虎尾高中","doc_count":121},{"key":"東港海事","doc_count":114},{"key":"羅東高商","doc_count":113},{"key":"鳳山高中","doc_count":112},{"key":"新化高工","doc_count":110},{"key":"屏東女中","doc_count":107},{"key":"南投高中","doc_count":105},{"key":"嘉義高商","doc_count":104},{"key":"新營高工","doc_count":103},{"key":"員林家商","doc_count":102},{"key":"澎湖海事","doc_count":98},{"key":"秀水高工","doc_count":97},{"key":"二林工商","doc_count":91},{"key":"師大附中高中部","doc_count":90},{"key":"新竹高中","doc_count":89},{"key":"北教大實小","doc_count":88},{"key":"嘉科實中","doc_count":85},{"key":"宜蘭高中","doc_count":79},{"key":"花蓮高工","doc_count":79},{"key":"彰師附工","doc_count":78},{"key":"旗山農工","doc_count":78},{"key":"土庫商工","doc_count":77},{"key":"嘉義家職","doc_count":76},{"key":"屏東高工","doc_count":74},{"key":"水里商工","doc_count":74},{"key":"新竹高商","doc_count":72},{"key":"南大附聰","doc_count":70},{"key":"東石高中","doc_count":70},{"key":"溪湖高中","doc_count":67},{"key":"臺南高商","doc_count":67},{"key":"崇實高工","doc_count":64},{"key":"華南高商","doc_count":64},{"key":"嘉義高中","doc_count":63},{"key":"新豐高中","doc_count":60},{"key":"南大附中","doc_count":59},{"key":"南大附小","doc_count":59},{"key":"北港高中","doc_count":58},{"key":"員林高中","doc_count":57},{"key":"羅東高工","doc_count":57},{"key":"基隆商工","doc_count":56},{"key":"北斗家商","doc_count":55},{"key":"臺東高商","doc_count":55},{"key":"花蓮特教","doc_count":55},{"key":"屏科實中","doc_count":54},{"key":"曾文農工","doc_count":54},{"key":"潮州高中","doc_count":54},{"key":"彰化高商","doc_count":51},{"key":"白河商工","doc_count":48},{"key":"新營高中","doc_count":47},{"key":"臺南一中","doc_count":46},{"key":"苗栗高商","doc_count":46},{"key":"頭城家商","doc_count":46},{"key":"高餐大附中","doc_count":46},{"key":"屏北高中","doc_count":44},{"key":"北港農工","doc_count":41},{"key":"中興高中","doc_count":40},{"key":"嘉義高工","doc_count":39},{"key":"師大附中國中部","doc_count":39},{"key":"永靖高工","doc_count":39},{"key":"花蓮高中","doc_count":37},{"key":"員林農工","doc_count":36},{"key":"屏東特教","doc_count":36},{"key":"暨大附中","doc_count":36},{"key":"海大附中","doc_count":34}]}}}
DEBUG 2025/12/17 17:50:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:50:00   Bucket[0]: Key=花蓮高農, DocCount=922
DEBUG 2025/12/17 17:50:00   Bucket[1]: Key=黑快馬主機, DocCount=877
DEBUG 2025/12/17 17:50:00   Bucket[2]: Key=仁愛高農, DocCount=540
DEBUG 2025/12/17 17:50:00   Bucket[3]: Key=金門農工, DocCount=450
DEBUG 2025/12/17 17:50:00   Bucket[4]: Key=北門高中, DocCount=446
DEBUG 2025/12/17 17:50:00   Bucket[5]: Key=金門高中, DocCount=431
DEBUG 2025/12/17 17:50:00   Bucket[6]: Key=新竹女中, DocCount=372
DEBUG 2025/12/17 17:50:00   Bucket[7]: Key=華僑高中, DocCount=325
DEBUG 2025/12/17 17:50:00   Bucket[8]: Key=宜蘭高商, DocCount=310
DEBUG 2025/12/17 17:50:00   Bucket[9]: Key=南投高商, DocCount=288
DEBUG 2025/12/17 17:50:00   Bucket[10]: Key=蘇澳海事, DocCount=258
DEBUG 2025/12/17 17:50:00   Bucket[11]: Key=斗六家商, DocCount=251
DEBUG 2025/12/17 17:50:00   Bucket[12]: Key=關西高中, DocCount=250
DEBUG 2025/12/17 17:50:00   Bucket[13]: Key=竹北高中, DocCount=227
DEBUG 2025/12/17 17:50:00   Bucket[14]: Key=玉里高中, DocCount=226
DEBUG 2025/12/17 17:50:00   Bucket[15]: Key=草屯商工, DocCount=212
DEBUG 2025/12/17 17:50:00   Bucket[16]: Key=內埔農工, DocCount=210
DEBUG 2025/12/17 17:50:00   Bucket[17]: Key=新港藝高, DocCount=210
DEBUG 2025/12/17 17:50:00   Bucket[18]: Key=政大附中, DocCount=206
DEBUG 2025/12/17 17:50:00   Bucket[19]: Key=臺東高中, DocCount=195
DEBUG 2025/12/17 17:50:00   Bucket[20]: Key=屏東高中, DocCount=192
DEBUG 2025/12/17 17:50:00   Bucket[21]: Key=佳冬高農, DocCount=187
DEBUG 2025/12/17 17:50:00   Bucket[22]: Key=興大附農, DocCount=187
DEBUG 2025/12/17 17:50:00   Bucket[23]: Key=花蓮高商, DocCount=185
DEBUG 2025/12/17 17:50:00   Bucket[24]: Key=苗栗農工, DocCount=181
DEBUG 2025/12/17 17:50:00   Bucket[25]: Key=興大附中, DocCount=179
DEBUG 2025/12/17 17:50:00   Bucket[26]: Key=中大壢中, DocCount=177
DEBUG 2025/12/17 17:50:00   Bucket[27]: Key=旗美高中, DocCount=166
DEBUG 2025/12/17 17:50:00   Bucket[28]: Key=南投特教, DocCount=157
DEBUG 2025/12/17 17:50:00   Bucket[29]: Key=後壁高中, DocCount=154
DEBUG 2025/12/17 17:50:00   Bucket[30]: Key=成大南工, DocCount=153
DEBUG 2025/12/17 17:50:00   Bucket[31]: Key=清華附小, DocCount=153
DEBUG 2025/12/17 17:50:00   Bucket[32]: Key=關山工商, DocCount=132
DEBUG 2025/12/17 17:50:00   Bucket[33]: Key=竹南高中, DocCount=126
DEBUG 2025/12/17 17:50:00   Bucket[34]: Key=新竹高工, DocCount=124
DEBUG 2025/12/17 17:50:00   Bucket[35]: Key=新化高中, DocCount=121
DEBUG 2025/12/17 17:50:00   Bucket[36]: Key=虎尾高中, DocCount=121
DEBUG 2025/12/17 17:50:00   Bucket[37]: Key=東港海事, DocCount=114
DEBUG 2025/12/17 17:50:00   Bucket[38]: Key=羅東高商, DocCount=113
DEBUG 2025/12/17 17:50:00   Bucket[39]: Key=鳳山高中, DocCount=112
DEBUG 2025/12/17 17:50:00   Bucket[40]: Key=新化高工, DocCount=110
DEBUG 2025/12/17 17:50:00   Bucket[41]: Key=屏東女中, DocCount=107
DEBUG 2025/12/17 17:50:00   Bucket[42]: Key=南投高中, DocCount=105
DEBUG 2025/12/17 17:50:00   Bucket[43]: Key=嘉義高商, DocCount=104
DEBUG 2025/12/17 17:50:00   Bucket[44]: Key=新營高工, DocCount=103
DEBUG 2025/12/17 17:50:00   Bucket[45]: Key=員林家商, DocCount=102
DEBUG 2025/12/17 17:50:00   Bucket[46]: Key=澎湖海事, DocCount=98
DEBUG 2025/12/17 17:50:00   Bucket[47]: Key=秀水高工, DocCount=97
DEBUG 2025/12/17 17:50:00   Bucket[48]: Key=二林工商, DocCount=91
DEBUG 2025/12/17 17:50:00   Bucket[49]: Key=師大附中高中部, DocCount=90
DEBUG 2025/12/17 17:50:00   Bucket[50]: Key=新竹高中, DocCount=89
DEBUG 2025/12/17 17:50:00   Bucket[51]: Key=北教大實小, DocCount=88
DEBUG 2025/12/17 17:50:00   Bucket[52]: Key=嘉科實中, DocCount=85
DEBUG 2025/12/17 17:50:00   Bucket[53]: Key=宜蘭高中, DocCount=79
DEBUG 2025/12/17 17:50:00   Bucket[54]: Key=花蓮高工, DocCount=79
DEBUG 2025/12/17 17:50:00   Bucket[55]: Key=彰師附工, DocCount=78
DEBUG 2025/12/17 17:50:00   Bucket[56]: Key=旗山農工, DocCount=78
DEBUG 2025/12/17 17:50:00   Bucket[57]: Key=土庫商工, DocCount=77
DEBUG 2025/12/17 17:50:00   Bucket[58]: Key=嘉義家職, DocCount=76
DEBUG 2025/12/17 17:50:00   Bucket[59]: Key=屏東高工, DocCount=74
DEBUG 2025/12/17 17:50:00   Bucket[60]: Key=水里商工, DocCount=74
DEBUG 2025/12/17 17:50:00   Bucket[61]: Key=新竹高商, DocCount=72
DEBUG 2025/12/17 17:50:00   Bucket[62]: Key=南大附聰, DocCount=70
DEBUG 2025/12/17 17:50:00   Bucket[63]: Key=東石高中, DocCount=70
DEBUG 2025/12/17 17:50:00   Bucket[64]: Key=溪湖高中, DocCount=67
DEBUG 2025/12/17 17:50:00   Bucket[65]: Key=臺南高商, DocCount=67
DEBUG 2025/12/17 17:50:00   Bucket[66]: Key=崇實高工, DocCount=64
DEBUG 2025/12/17 17:50:00   Bucket[67]: Key=華南高商, DocCount=64
DEBUG 2025/12/17 17:50:00   Bucket[68]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 17:50:00   Bucket[69]: Key=新豐高中, DocCount=60
DEBUG 2025/12/17 17:50:00   Bucket[70]: Key=南大附中, DocCount=59
DEBUG 2025/12/17 17:50:00   Bucket[71]: Key=南大附小, DocCount=59
DEBUG 2025/12/17 17:50:00   Bucket[72]: Key=北港高中, DocCount=58
DEBUG 2025/12/17 17:50:00   Bucket[73]: Key=員林高中, DocCount=57
DEBUG 2025/12/17 17:50:00   Bucket[74]: Key=羅東高工, DocCount=57
DEBUG 2025/12/17 17:50:00   Bucket[75]: Key=基隆商工, DocCount=56
DEBUG 2025/12/17 17:50:00   Bucket[76]: Key=北斗家商, DocCount=55
DEBUG 2025/12/17 17:50:00   Bucket[77]: Key=臺東高商, DocCount=55
DEBUG 2025/12/17 17:50:00   Bucket[78]: Key=花蓮特教, DocCount=55
DEBUG 2025/12/17 17:50:00   Bucket[79]: Key=屏科實中, DocCount=54
DEBUG 2025/12/17 17:50:00   Bucket[80]: Key=曾文農工, DocCount=54
DEBUG 2025/12/17 17:50:00   Bucket[81]: Key=潮州高中, DocCount=54
DEBUG 2025/12/17 17:50:00   Bucket[82]: Key=彰化高商, DocCount=51
DEBUG 2025/12/17 17:50:00   Bucket[83]: Key=白河商工, DocCount=48
DEBUG 2025/12/17 17:50:00   Bucket[84]: Key=新營高中, DocCount=47
DEBUG 2025/12/17 17:50:00   Bucket[85]: Key=臺南一中, DocCount=46
DEBUG 2025/12/17 17:50:00   Bucket[86]: Key=苗栗高商, DocCount=46
DEBUG 2025/12/17 17:50:00   Bucket[87]: Key=頭城家商, DocCount=46
DEBUG 2025/12/17 17:50:00   Bucket[88]: Key=高餐大附中, DocCount=46
DEBUG 2025/12/17 17:50:00   Bucket[89]: Key=屏北高中, DocCount=44
DEBUG 2025/12/17 17:50:00   Bucket[90]: Key=北港農工, DocCount=41
DEBUG 2025/12/17 17:50:00   Bucket[91]: Key=中興高中, DocCount=40
DEBUG 2025/12/17 17:50:00   Bucket[92]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:50:00   Bucket[93]: Key=師大附中國中部, DocCount=39
DEBUG 2025/12/17 17:50:00   Bucket[94]: Key=永靖高工, DocCount=39
DEBUG 2025/12/17 17:50:00   Bucket[95]: Key=花蓮高中, DocCount=37
DEBUG 2025/12/17 17:50:00   Bucket[96]: Key=員林農工, DocCount=36
DEBUG 2025/12/17 17:50:00   Bucket[97]: Key=屏東特教, DocCount=36
DEBUG 2025/12/17 17:50:00   Bucket[98]: Key=暨大附中, DocCount=36
DEBUG 2025/12/17 17:50:00   Bucket[99]: Key=海大附中, DocCount=34
DEBUG 2025/12/17 17:50:00 ========================================================
INFO 2025/12/17 17:50:03 ✅ Successfully flushed 14/14 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:50:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:50:09 Processing 15 offline devices
INFO 2025/12/17 17:50:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:50:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:50:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:50:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:50:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:50:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:50:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:50:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:50:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:50:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:50:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:50:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:50:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:50:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:50:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:50:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:50:10 Creating history record for offline device: 雲林特教
INFO 2025/12/17 17:50:10 About to add history to batch for device: 雲林特教
INFO 2025/12/17 17:50:10 Successfully added history record for offline device: 雲林特教
INFO 2025/12/17 17:50:10 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:50:10 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:50:10 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:50:13 ✅ Successfully flushed 34/34 history records to TimescaleDB
DEBUG 2025/12/17 17:50:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:50:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:50:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:50:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:50:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:50:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:50:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:50:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:50:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:50:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:50:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:50:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:50:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:50:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:50:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:50:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:50:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:50:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:50:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:50:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:50:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:50:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:50:45 ES Alert Created [high][performance]: Memory usage high: 88.67% (threshold: 80.00%)
INFO 2025/12/17 17:50:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:50:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.32% (threshold: 85.00%)
DEBUG 2025/12/17 17:50:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:50:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:50:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:50:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:50:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:50:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:50:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:50:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:51:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:51:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:51:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:51:00 Field: school_name.keyword
DEBUG 2025/12/17 17:51:00 Time From: 2025-12-17T17:50:00.000+08:00
DEBUG 2025/12/17 17:51:00 Time To: 2025-12-17T17:51:00.000+08:00
DEBUG 2025/12/17 17:51:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:50:00.000+08:00",
					"lte": "2025-12-17T17:51:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:51:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:51:00 ES Response IsError: false
DEBUG 2025/12/17 17:51:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":417,"buckets":[{"key":"黑快馬主機","doc_count":865},{"key":"花蓮高農","doc_count":687},{"key":"仁愛高農","doc_count":512},{"key":"金門農工","doc_count":440},{"key":"金門高中","doc_count":430},{"key":"新竹女中","doc_count":419},{"key":"北門高中","doc_count":413},{"key":"斗六家商","doc_count":318},{"key":"宜蘭高商","doc_count":307},{"key":"華僑高中","doc_count":285},{"key":"南投高商","doc_count":252},{"key":"蘇澳海事","doc_count":252},{"key":"屏東女中","doc_count":245},{"key":"關西高中","doc_count":235},{"key":"臺東高中","doc_count":219},{"key":"興大附中","doc_count":214},{"key":"新化高工","doc_count":208},{"key":"苗栗農工","doc_count":207},{"key":"政大附中","doc_count":199},{"key":"竹北高中","doc_count":199},{"key":"內埔農工","doc_count":196},{"key":"玉里高中","doc_count":188},{"key":"新港藝高","doc_count":183},{"key":"花蓮高商","doc_count":172},{"key":"南投特教","doc_count":148},{"key":"旗美高中","doc_count":147},{"key":"鳳山高中","doc_count":142},{"key":"後壁高中","doc_count":139},{"key":"關山工商","doc_count":137},{"key":"虎尾高中","doc_count":135},{"key":"清華附小","doc_count":134},{"key":"竹南高中","doc_count":134},{"key":"二林工商","doc_count":122},{"key":"草屯商工","doc_count":120},{"key":"新營高工","doc_count":118},{"key":"成大南工","doc_count":116},{"key":"中大壢中","doc_count":112},{"key":"新竹高中","doc_count":112},{"key":"新化高中","doc_count":108},{"key":"東港海事","doc_count":107},{"key":"屏東高工","doc_count":98},{"key":"秀水高工","doc_count":95},{"key":"土庫商工","doc_count":92},{"key":"師大附中高中部","doc_count":91},{"key":"彰師附工","doc_count":91},{"key":"北港高中","doc_count":90},{"key":"東石高中","doc_count":90},{"key":"永靖高工","doc_count":88},{"key":"嘉義高商","doc_count":86},{"key":"北教大實小","doc_count":82},{"key":"新竹高工","doc_count":78},{"key":"水里商工","doc_count":78},{"key":"員林家商","doc_count":77},{"key":"高餐大附中","doc_count":75},{"key":"嘉義高中","doc_count":72},{"key":"彰化高商","doc_count":72},{"key":"嘉科實中","doc_count":71},{"key":"屏東高中","doc_count":71},{"key":"曾文農工","doc_count":70},{"key":"新營高中","doc_count":69},{"key":"基隆商工","doc_count":68},{"key":"旗山農工","doc_count":67},{"key":"員林高中","doc_count":65},{"key":"羅東高商","doc_count":65},{"key":"南大附聰","doc_count":62},{"key":"臺東女中","doc_count":60},{"key":"苗栗高商","doc_count":60},{"key":"佳冬高農","doc_count":59},{"key":"宜蘭高中","doc_count":58},{"key":"屏科實中","doc_count":58},{"key":"華南高商","doc_count":55},{"key":"臺南高商","doc_count":54},{"key":"北斗家商","doc_count":51},{"key":"海大附中","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"中興高中","doc_count":47},{"key":"崇實高工","doc_count":47},{"key":"南投高中","doc_count":46},{"key":"蘭陽女中","doc_count":46},{"key":"臺南一中","doc_count":45},{"key":"北港農工","doc_count":44},{"key":"臺東高商","doc_count":44},{"key":"澎湖海事","doc_count":43},{"key":"竹東高中","doc_count":43},{"key":"員林農工","doc_count":42},{"key":"興大附農","doc_count":42},{"key":"花蓮特教","doc_count":41},{"key":"花蓮高工","doc_count":41},{"key":"雲林特教","doc_count":41},{"key":"新豐高中","doc_count":40},{"key":"花蓮高中","doc_count":40},{"key":"屏東特教","doc_count":39},{"key":"南大附中","doc_count":38},{"key":"暨大附中","doc_count":38},{"key":"成功商水","doc_count":36},{"key":"新竹高商","doc_count":36},{"key":"竹山高中","doc_count":35},{"key":"苗栗高中","doc_count":35},{"key":"嘉義高工","doc_count":34},{"key":"嘉義特教","doc_count":32}]}}}
DEBUG 2025/12/17 17:51:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:51:00   Bucket[0]: Key=黑快馬主機, DocCount=865
DEBUG 2025/12/17 17:51:00   Bucket[1]: Key=花蓮高農, DocCount=687
DEBUG 2025/12/17 17:51:00   Bucket[2]: Key=仁愛高農, DocCount=512
DEBUG 2025/12/17 17:51:00   Bucket[3]: Key=金門農工, DocCount=440
DEBUG 2025/12/17 17:51:00   Bucket[4]: Key=金門高中, DocCount=430
DEBUG 2025/12/17 17:51:00   Bucket[5]: Key=新竹女中, DocCount=419
DEBUG 2025/12/17 17:51:00   Bucket[6]: Key=北門高中, DocCount=413
DEBUG 2025/12/17 17:51:00   Bucket[7]: Key=斗六家商, DocCount=318
DEBUG 2025/12/17 17:51:00   Bucket[8]: Key=宜蘭高商, DocCount=307
DEBUG 2025/12/17 17:51:00   Bucket[9]: Key=華僑高中, DocCount=285
DEBUG 2025/12/17 17:51:00   Bucket[10]: Key=南投高商, DocCount=252
DEBUG 2025/12/17 17:51:00   Bucket[11]: Key=蘇澳海事, DocCount=252
DEBUG 2025/12/17 17:51:00   Bucket[12]: Key=屏東女中, DocCount=245
DEBUG 2025/12/17 17:51:00   Bucket[13]: Key=關西高中, DocCount=235
DEBUG 2025/12/17 17:51:00   Bucket[14]: Key=臺東高中, DocCount=219
DEBUG 2025/12/17 17:51:00   Bucket[15]: Key=興大附中, DocCount=214
DEBUG 2025/12/17 17:51:00   Bucket[16]: Key=新化高工, DocCount=208
DEBUG 2025/12/17 17:51:00   Bucket[17]: Key=苗栗農工, DocCount=207
DEBUG 2025/12/17 17:51:00   Bucket[18]: Key=政大附中, DocCount=199
DEBUG 2025/12/17 17:51:00   Bucket[19]: Key=竹北高中, DocCount=199
DEBUG 2025/12/17 17:51:00   Bucket[20]: Key=內埔農工, DocCount=196
DEBUG 2025/12/17 17:51:00   Bucket[21]: Key=玉里高中, DocCount=188
DEBUG 2025/12/17 17:51:00   Bucket[22]: Key=新港藝高, DocCount=183
DEBUG 2025/12/17 17:51:00   Bucket[23]: Key=花蓮高商, DocCount=172
DEBUG 2025/12/17 17:51:00   Bucket[24]: Key=南投特教, DocCount=148
DEBUG 2025/12/17 17:51:00   Bucket[25]: Key=旗美高中, DocCount=147
DEBUG 2025/12/17 17:51:00   Bucket[26]: Key=鳳山高中, DocCount=142
DEBUG 2025/12/17 17:51:00   Bucket[27]: Key=後壁高中, DocCount=139
DEBUG 2025/12/17 17:51:00   Bucket[28]: Key=關山工商, DocCount=137
DEBUG 2025/12/17 17:51:00   Bucket[29]: Key=虎尾高中, DocCount=135
DEBUG 2025/12/17 17:51:00   Bucket[30]: Key=清華附小, DocCount=134
DEBUG 2025/12/17 17:51:00   Bucket[31]: Key=竹南高中, DocCount=134
DEBUG 2025/12/17 17:51:00   Bucket[32]: Key=二林工商, DocCount=122
DEBUG 2025/12/17 17:51:00   Bucket[33]: Key=草屯商工, DocCount=120
DEBUG 2025/12/17 17:51:00   Bucket[34]: Key=新營高工, DocCount=118
DEBUG 2025/12/17 17:51:00   Bucket[35]: Key=成大南工, DocCount=116
DEBUG 2025/12/17 17:51:00   Bucket[36]: Key=中大壢中, DocCount=112
DEBUG 2025/12/17 17:51:00   Bucket[37]: Key=新竹高中, DocCount=112
DEBUG 2025/12/17 17:51:00   Bucket[38]: Key=新化高中, DocCount=108
DEBUG 2025/12/17 17:51:00   Bucket[39]: Key=東港海事, DocCount=107
DEBUG 2025/12/17 17:51:00   Bucket[40]: Key=屏東高工, DocCount=98
DEBUG 2025/12/17 17:51:00   Bucket[41]: Key=秀水高工, DocCount=95
DEBUG 2025/12/17 17:51:00   Bucket[42]: Key=土庫商工, DocCount=92
DEBUG 2025/12/17 17:51:00   Bucket[43]: Key=師大附中高中部, DocCount=91
DEBUG 2025/12/17 17:51:00   Bucket[44]: Key=彰師附工, DocCount=91
DEBUG 2025/12/17 17:51:00   Bucket[45]: Key=北港高中, DocCount=90
DEBUG 2025/12/17 17:51:00   Bucket[46]: Key=東石高中, DocCount=90
DEBUG 2025/12/17 17:51:00   Bucket[47]: Key=永靖高工, DocCount=88
DEBUG 2025/12/17 17:51:00   Bucket[48]: Key=嘉義高商, DocCount=86
DEBUG 2025/12/17 17:51:00   Bucket[49]: Key=北教大實小, DocCount=82
DEBUG 2025/12/17 17:51:00   Bucket[50]: Key=新竹高工, DocCount=78
DEBUG 2025/12/17 17:51:00   Bucket[51]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 17:51:00   Bucket[52]: Key=員林家商, DocCount=77
DEBUG 2025/12/17 17:51:00   Bucket[53]: Key=高餐大附中, DocCount=75
DEBUG 2025/12/17 17:51:00   Bucket[54]: Key=嘉義高中, DocCount=72
DEBUG 2025/12/17 17:51:00   Bucket[55]: Key=彰化高商, DocCount=72
DEBUG 2025/12/17 17:51:00   Bucket[56]: Key=嘉科實中, DocCount=71
DEBUG 2025/12/17 17:51:00   Bucket[57]: Key=屏東高中, DocCount=71
DEBUG 2025/12/17 17:51:00   Bucket[58]: Key=曾文農工, DocCount=70
DEBUG 2025/12/17 17:51:00   Bucket[59]: Key=新營高中, DocCount=69
DEBUG 2025/12/17 17:51:00   Bucket[60]: Key=基隆商工, DocCount=68
DEBUG 2025/12/17 17:51:00   Bucket[61]: Key=旗山農工, DocCount=67
DEBUG 2025/12/17 17:51:00   Bucket[62]: Key=員林高中, DocCount=65
DEBUG 2025/12/17 17:51:00   Bucket[63]: Key=羅東高商, DocCount=65
DEBUG 2025/12/17 17:51:00   Bucket[64]: Key=南大附聰, DocCount=62
DEBUG 2025/12/17 17:51:00   Bucket[65]: Key=臺東女中, DocCount=60
DEBUG 2025/12/17 17:51:00   Bucket[66]: Key=苗栗高商, DocCount=60
DEBUG 2025/12/17 17:51:00   Bucket[67]: Key=佳冬高農, DocCount=59
DEBUG 2025/12/17 17:51:00   Bucket[68]: Key=宜蘭高中, DocCount=58
DEBUG 2025/12/17 17:51:00   Bucket[69]: Key=屏科實中, DocCount=58
DEBUG 2025/12/17 17:51:00   Bucket[70]: Key=華南高商, DocCount=55
DEBUG 2025/12/17 17:51:00   Bucket[71]: Key=臺南高商, DocCount=54
DEBUG 2025/12/17 17:51:00   Bucket[72]: Key=北斗家商, DocCount=51
DEBUG 2025/12/17 17:51:00   Bucket[73]: Key=海大附中, DocCount=50
DEBUG 2025/12/17 17:51:00   Bucket[74]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:51:00   Bucket[75]: Key=中興高中, DocCount=47
DEBUG 2025/12/17 17:51:00   Bucket[76]: Key=崇實高工, DocCount=47
DEBUG 2025/12/17 17:51:00   Bucket[77]: Key=南投高中, DocCount=46
DEBUG 2025/12/17 17:51:00   Bucket[78]: Key=蘭陽女中, DocCount=46
DEBUG 2025/12/17 17:51:00   Bucket[79]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 17:51:00   Bucket[80]: Key=北港農工, DocCount=44
DEBUG 2025/12/17 17:51:00   Bucket[81]: Key=臺東高商, DocCount=44
DEBUG 2025/12/17 17:51:00   Bucket[82]: Key=澎湖海事, DocCount=43
DEBUG 2025/12/17 17:51:00   Bucket[83]: Key=竹東高中, DocCount=43
DEBUG 2025/12/17 17:51:00   Bucket[84]: Key=員林農工, DocCount=42
DEBUG 2025/12/17 17:51:00   Bucket[85]: Key=興大附農, DocCount=42
DEBUG 2025/12/17 17:51:00   Bucket[86]: Key=花蓮特教, DocCount=41
DEBUG 2025/12/17 17:51:00   Bucket[87]: Key=花蓮高工, DocCount=41
DEBUG 2025/12/17 17:51:00   Bucket[88]: Key=雲林特教, DocCount=41
DEBUG 2025/12/17 17:51:00   Bucket[89]: Key=新豐高中, DocCount=40
DEBUG 2025/12/17 17:51:00   Bucket[90]: Key=花蓮高中, DocCount=40
DEBUG 2025/12/17 17:51:00   Bucket[91]: Key=屏東特教, DocCount=39
DEBUG 2025/12/17 17:51:00   Bucket[92]: Key=南大附中, DocCount=38
DEBUG 2025/12/17 17:51:00   Bucket[93]: Key=暨大附中, DocCount=38
DEBUG 2025/12/17 17:51:00   Bucket[94]: Key=成功商水, DocCount=36
DEBUG 2025/12/17 17:51:00   Bucket[95]: Key=新竹高商, DocCount=36
DEBUG 2025/12/17 17:51:00   Bucket[96]: Key=竹山高中, DocCount=35
DEBUG 2025/12/17 17:51:00   Bucket[97]: Key=苗栗高中, DocCount=35
DEBUG 2025/12/17 17:51:00   Bucket[98]: Key=嘉義高工, DocCount=34
DEBUG 2025/12/17 17:51:00   Bucket[99]: Key=嘉義特教, DocCount=32
DEBUG 2025/12/17 17:51:00 ========================================================
INFO 2025/12/17 17:51:03 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:51:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:51:07 Processing 15 offline devices
INFO 2025/12/17 17:51:07 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:51:07 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:51:07 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:51:07 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:51:07 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:51:07 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:51:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:51:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:51:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:51:07 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:51:07 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:51:07 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:51:07 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:51:07 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:51:07 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:51:07 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:51:07 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:51:08 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:51:08 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:51:08 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:51:08 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:51:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:51:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:51:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:51:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:51:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:51:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:51:08 Creating history record for offline device: 潮州高中
INFO 2025/12/17 17:51:08 About to add history to batch for device: 潮州高中
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 17:51:08 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:51:08 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:51:08 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:51:08 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:51:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:51:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:51:08 ✅ Successfully flushed 35/35 history records to TimescaleDB
INFO 2025/12/17 17:51:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:51:13 ✅ Successfully flushed 1/1 history records to TimescaleDB
DEBUG 2025/12/17 17:51:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:51:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:51:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:51:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:51:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:51:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:51:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:51:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:51:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:51:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:51:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:51:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:51:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:51:45 ES Alert Created [critical][performance]: Memory usage critical: 91.13% (threshold: 90.00%)
DEBUG 2025/12/17 17:51:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:51:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:51:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:51:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:51:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:51:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:51:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:51:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:52:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:52:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:52:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:52:00 Field: school_name.keyword
DEBUG 2025/12/17 17:52:00 Time From: 2025-12-17T17:51:00.000+08:00
DEBUG 2025/12/17 17:52:00 Time To: 2025-12-17T17:52:00.000+08:00
DEBUG 2025/12/17 17:52:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:51:00.000+08:00",
					"lte": "2025-12-17T17:52:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:52:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:52:00 ES Response IsError: false
DEBUG 2025/12/17 17:52:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":416,"buckets":[{"key":"黑快馬主機","doc_count":1366},{"key":"花蓮高農","doc_count":692},{"key":"仁愛高農","doc_count":587},{"key":"新竹女中","doc_count":464},{"key":"金門高中","doc_count":408},{"key":"金門農工","doc_count":407},{"key":"北門高中","doc_count":365},{"key":"宜蘭高商","doc_count":315},{"key":"南投高商","doc_count":287},{"key":"政大附中","doc_count":275},{"key":"蘇澳海事","doc_count":268},{"key":"華僑高中","doc_count":267},{"key":"斗六家商","doc_count":257},{"key":"新港藝高","doc_count":213},{"key":"竹北高中","doc_count":211},{"key":"臺東高中","doc_count":208},{"key":"屏東女中","doc_count":195},{"key":"興大附中","doc_count":189},{"key":"二林工商","doc_count":179},{"key":"關西高中","doc_count":177},{"key":"內埔農工","doc_count":171},{"key":"苗栗農工","doc_count":170},{"key":"關山工商","doc_count":168},{"key":"嘉義高商","doc_count":166},{"key":"中大壢中","doc_count":153},{"key":"旗美高中","doc_count":150},{"key":"清華附小","doc_count":149},{"key":"員林家商","doc_count":144},{"key":"新化高工","doc_count":140},{"key":"竹南高中","doc_count":138},{"key":"花蓮高商","doc_count":138},{"key":"後壁高中","doc_count":136},{"key":"虎尾高中","doc_count":134},{"key":"南投特教","doc_count":133},{"key":"玉里高中","doc_count":123},{"key":"新化高中","doc_count":122},{"key":"屏東高工","doc_count":119},{"key":"新營高工","doc_count":105},{"key":"新竹高商","doc_count":102},{"key":"東港海事","doc_count":100},{"key":"秀水高工","doc_count":99},{"key":"草屯商工","doc_count":96},{"key":"新竹高工","doc_count":92},{"key":"員林高中","doc_count":88},{"key":"嘉義高中","doc_count":85},{"key":"水里商工","doc_count":83},{"key":"苗栗高中","doc_count":82},{"key":"臺南高商","doc_count":77},{"key":"鳳山高中","doc_count":75},{"key":"永靖高工","doc_count":73},{"key":"師大附中高中部","doc_count":72},{"key":"高餐大附中","doc_count":72},{"key":"旗山農工","doc_count":71},{"key":"羅東高商","doc_count":71},{"key":"北教大實小","doc_count":70},{"key":"北港高中","doc_count":70},{"key":"新營高中","doc_count":70},{"key":"屏科實中","doc_count":67},{"key":"澎湖海事","doc_count":65},{"key":"北斗家商","doc_count":63},{"key":"嘉科實中","doc_count":60},{"key":"員林農工","doc_count":57},{"key":"彰師附工","doc_count":56},{"key":"苗栗高商","doc_count":56},{"key":"頭城家商","doc_count":56},{"key":"南大附聰","doc_count":55},{"key":"彰化高商","doc_count":53},{"key":"成功商水","doc_count":53},{"key":"成大南工","doc_count":53},{"key":"臺東高商","doc_count":53},{"key":"暨大附中","doc_count":52},{"key":"海大附中","doc_count":51},{"key":"竹山高中","doc_count":51},{"key":"南投高中","doc_count":48},{"key":"花蓮高工","doc_count":48},{"key":"佳冬高農","doc_count":47},{"key":"埔里高工","doc_count":46},{"key":"南大附中","doc_count":45},{"key":"新竹高中","doc_count":45},{"key":"曾文農工","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"土庫商工","doc_count":44},{"key":"屏東高中","doc_count":43},{"key":"家齊高中","doc_count":42},{"key":"臺南一中","doc_count":41},{"key":"雲林特教","doc_count":41},{"key":"屏東特教","doc_count":40},{"key":"溪湖高中","doc_count":40},{"key":"北港農工","doc_count":39},{"key":"花蓮特教","doc_count":38},{"key":"善化高中","doc_count":37},{"key":"基隆商工","doc_count":37},{"key":"宜蘭高中","doc_count":37},{"key":"新豐高中","doc_count":37},{"key":"嘉義高工","doc_count":36},{"key":"華南高商","doc_count":36},{"key":"竹東高中","doc_count":35},{"key":"東石高中","doc_count":34},{"key":"羅東高工","doc_count":34},{"key":"中興高中","doc_count":33}]}}}
DEBUG 2025/12/17 17:52:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:52:00   Bucket[0]: Key=黑快馬主機, DocCount=1366
DEBUG 2025/12/17 17:52:00   Bucket[1]: Key=花蓮高農, DocCount=692
DEBUG 2025/12/17 17:52:00   Bucket[2]: Key=仁愛高農, DocCount=587
DEBUG 2025/12/17 17:52:00   Bucket[3]: Key=新竹女中, DocCount=464
DEBUG 2025/12/17 17:52:00   Bucket[4]: Key=金門高中, DocCount=408
DEBUG 2025/12/17 17:52:00   Bucket[5]: Key=金門農工, DocCount=407
DEBUG 2025/12/17 17:52:00   Bucket[6]: Key=北門高中, DocCount=365
DEBUG 2025/12/17 17:52:00   Bucket[7]: Key=宜蘭高商, DocCount=315
DEBUG 2025/12/17 17:52:00   Bucket[8]: Key=南投高商, DocCount=287
DEBUG 2025/12/17 17:52:00   Bucket[9]: Key=政大附中, DocCount=275
DEBUG 2025/12/17 17:52:00   Bucket[10]: Key=蘇澳海事, DocCount=268
DEBUG 2025/12/17 17:52:00   Bucket[11]: Key=華僑高中, DocCount=267
DEBUG 2025/12/17 17:52:00   Bucket[12]: Key=斗六家商, DocCount=257
DEBUG 2025/12/17 17:52:00   Bucket[13]: Key=新港藝高, DocCount=213
DEBUG 2025/12/17 17:52:00   Bucket[14]: Key=竹北高中, DocCount=211
DEBUG 2025/12/17 17:52:00   Bucket[15]: Key=臺東高中, DocCount=208
DEBUG 2025/12/17 17:52:00   Bucket[16]: Key=屏東女中, DocCount=195
DEBUG 2025/12/17 17:52:00   Bucket[17]: Key=興大附中, DocCount=189
DEBUG 2025/12/17 17:52:00   Bucket[18]: Key=二林工商, DocCount=179
DEBUG 2025/12/17 17:52:00   Bucket[19]: Key=關西高中, DocCount=177
DEBUG 2025/12/17 17:52:00   Bucket[20]: Key=內埔農工, DocCount=171
DEBUG 2025/12/17 17:52:00   Bucket[21]: Key=苗栗農工, DocCount=170
DEBUG 2025/12/17 17:52:00   Bucket[22]: Key=關山工商, DocCount=168
DEBUG 2025/12/17 17:52:00   Bucket[23]: Key=嘉義高商, DocCount=166
DEBUG 2025/12/17 17:52:00   Bucket[24]: Key=中大壢中, DocCount=153
DEBUG 2025/12/17 17:52:00   Bucket[25]: Key=旗美高中, DocCount=150
DEBUG 2025/12/17 17:52:00   Bucket[26]: Key=清華附小, DocCount=149
DEBUG 2025/12/17 17:52:00   Bucket[27]: Key=員林家商, DocCount=144
DEBUG 2025/12/17 17:52:00   Bucket[28]: Key=新化高工, DocCount=140
DEBUG 2025/12/17 17:52:00   Bucket[29]: Key=竹南高中, DocCount=138
DEBUG 2025/12/17 17:52:00   Bucket[30]: Key=花蓮高商, DocCount=138
DEBUG 2025/12/17 17:52:00   Bucket[31]: Key=後壁高中, DocCount=136
DEBUG 2025/12/17 17:52:00   Bucket[32]: Key=虎尾高中, DocCount=134
DEBUG 2025/12/17 17:52:00   Bucket[33]: Key=南投特教, DocCount=133
DEBUG 2025/12/17 17:52:00   Bucket[34]: Key=玉里高中, DocCount=123
DEBUG 2025/12/17 17:52:00   Bucket[35]: Key=新化高中, DocCount=122
DEBUG 2025/12/17 17:52:00   Bucket[36]: Key=屏東高工, DocCount=119
DEBUG 2025/12/17 17:52:00   Bucket[37]: Key=新營高工, DocCount=105
DEBUG 2025/12/17 17:52:00   Bucket[38]: Key=新竹高商, DocCount=102
DEBUG 2025/12/17 17:52:00   Bucket[39]: Key=東港海事, DocCount=100
DEBUG 2025/12/17 17:52:00   Bucket[40]: Key=秀水高工, DocCount=99
DEBUG 2025/12/17 17:52:00   Bucket[41]: Key=草屯商工, DocCount=96
DEBUG 2025/12/17 17:52:00   Bucket[42]: Key=新竹高工, DocCount=92
DEBUG 2025/12/17 17:52:00   Bucket[43]: Key=員林高中, DocCount=88
DEBUG 2025/12/17 17:52:00   Bucket[44]: Key=嘉義高中, DocCount=85
DEBUG 2025/12/17 17:52:00   Bucket[45]: Key=水里商工, DocCount=83
DEBUG 2025/12/17 17:52:00   Bucket[46]: Key=苗栗高中, DocCount=82
DEBUG 2025/12/17 17:52:00   Bucket[47]: Key=臺南高商, DocCount=77
DEBUG 2025/12/17 17:52:00   Bucket[48]: Key=鳳山高中, DocCount=75
DEBUG 2025/12/17 17:52:00   Bucket[49]: Key=永靖高工, DocCount=73
DEBUG 2025/12/17 17:52:00   Bucket[50]: Key=師大附中高中部, DocCount=72
DEBUG 2025/12/17 17:52:00   Bucket[51]: Key=高餐大附中, DocCount=72
DEBUG 2025/12/17 17:52:00   Bucket[52]: Key=旗山農工, DocCount=71
DEBUG 2025/12/17 17:52:00   Bucket[53]: Key=羅東高商, DocCount=71
DEBUG 2025/12/17 17:52:00   Bucket[54]: Key=北教大實小, DocCount=70
DEBUG 2025/12/17 17:52:00   Bucket[55]: Key=北港高中, DocCount=70
DEBUG 2025/12/17 17:52:00   Bucket[56]: Key=新營高中, DocCount=70
DEBUG 2025/12/17 17:52:00   Bucket[57]: Key=屏科實中, DocCount=67
DEBUG 2025/12/17 17:52:00   Bucket[58]: Key=澎湖海事, DocCount=65
DEBUG 2025/12/17 17:52:00   Bucket[59]: Key=北斗家商, DocCount=63
DEBUG 2025/12/17 17:52:00   Bucket[60]: Key=嘉科實中, DocCount=60
DEBUG 2025/12/17 17:52:00   Bucket[61]: Key=員林農工, DocCount=57
DEBUG 2025/12/17 17:52:00   Bucket[62]: Key=彰師附工, DocCount=56
DEBUG 2025/12/17 17:52:00   Bucket[63]: Key=苗栗高商, DocCount=56
DEBUG 2025/12/17 17:52:00   Bucket[64]: Key=頭城家商, DocCount=56
DEBUG 2025/12/17 17:52:00   Bucket[65]: Key=南大附聰, DocCount=55
DEBUG 2025/12/17 17:52:00   Bucket[66]: Key=彰化高商, DocCount=53
DEBUG 2025/12/17 17:52:00   Bucket[67]: Key=成功商水, DocCount=53
DEBUG 2025/12/17 17:52:00   Bucket[68]: Key=成大南工, DocCount=53
DEBUG 2025/12/17 17:52:00   Bucket[69]: Key=臺東高商, DocCount=53
DEBUG 2025/12/17 17:52:00   Bucket[70]: Key=暨大附中, DocCount=52
DEBUG 2025/12/17 17:52:00   Bucket[71]: Key=海大附中, DocCount=51
DEBUG 2025/12/17 17:52:00   Bucket[72]: Key=竹山高中, DocCount=51
DEBUG 2025/12/17 17:52:00   Bucket[73]: Key=南投高中, DocCount=48
DEBUG 2025/12/17 17:52:00   Bucket[74]: Key=花蓮高工, DocCount=48
DEBUG 2025/12/17 17:52:00   Bucket[75]: Key=佳冬高農, DocCount=47
DEBUG 2025/12/17 17:52:00   Bucket[76]: Key=埔里高工, DocCount=46
DEBUG 2025/12/17 17:52:00   Bucket[77]: Key=南大附中, DocCount=45
DEBUG 2025/12/17 17:52:00   Bucket[78]: Key=新竹高中, DocCount=45
DEBUG 2025/12/17 17:52:00   Bucket[79]: Key=曾文農工, DocCount=45
DEBUG 2025/12/17 17:52:00   Bucket[80]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:52:00   Bucket[81]: Key=土庫商工, DocCount=44
DEBUG 2025/12/17 17:52:00   Bucket[82]: Key=屏東高中, DocCount=43
DEBUG 2025/12/17 17:52:00   Bucket[83]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 17:52:00   Bucket[84]: Key=臺南一中, DocCount=41
DEBUG 2025/12/17 17:52:00   Bucket[85]: Key=雲林特教, DocCount=41
DEBUG 2025/12/17 17:52:00   Bucket[86]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:52:00   Bucket[87]: Key=溪湖高中, DocCount=40
DEBUG 2025/12/17 17:52:00   Bucket[88]: Key=北港農工, DocCount=39
DEBUG 2025/12/17 17:52:00   Bucket[89]: Key=花蓮特教, DocCount=38
DEBUG 2025/12/17 17:52:00   Bucket[90]: Key=善化高中, DocCount=37
DEBUG 2025/12/17 17:52:00   Bucket[91]: Key=基隆商工, DocCount=37
DEBUG 2025/12/17 17:52:00   Bucket[92]: Key=宜蘭高中, DocCount=37
DEBUG 2025/12/17 17:52:00   Bucket[93]: Key=新豐高中, DocCount=37
DEBUG 2025/12/17 17:52:00   Bucket[94]: Key=嘉義高工, DocCount=36
DEBUG 2025/12/17 17:52:00   Bucket[95]: Key=華南高商, DocCount=36
DEBUG 2025/12/17 17:52:00   Bucket[96]: Key=竹東高中, DocCount=35
DEBUG 2025/12/17 17:52:00   Bucket[97]: Key=東石高中, DocCount=34
DEBUG 2025/12/17 17:52:00   Bucket[98]: Key=羅東高工, DocCount=34
DEBUG 2025/12/17 17:52:00   Bucket[99]: Key=中興高中, DocCount=33
DEBUG 2025/12/17 17:52:00 ========================================================
INFO 2025/12/17 17:52:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:52:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:52:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:52:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:52:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:52:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:52:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:52:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:52:08 ✅ Successfully flushed 24/24 history records to TimescaleDB
INFO 2025/12/17 17:52:08 Processing 15 offline devices
INFO 2025/12/17 17:52:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:52:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:52:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:52:08 Creating history record for offline device: 潮州高中
INFO 2025/12/17 17:52:08 About to add history to batch for device: 潮州高中
INFO 2025/12/17 17:52:08 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 17:52:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:52:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:52:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:52:08 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:52:08 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:52:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:52:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:52:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:52:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:52:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:52:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:52:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:52:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:52:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:52:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:52:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:52:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:52:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:52:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:52:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:52:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:52:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:52:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:52:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:52:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:52:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:52:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:52:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:52:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:52:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:52:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:52:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:52:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:52:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:52:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:52:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:52:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:52:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:52:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:52:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:52:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:52:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:52:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:52:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:52:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.11% (threshold: 90.00%)
INFO 2025/12/17 17:52:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:52:45 ES Alert Created [high][capacity]: Disk usage high: 93.39% (threshold: 85.00%)
WARN 2025/12/17 17:52:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:52:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:52:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:52:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:52:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:52:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:52:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:53:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:53:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:53:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:53:00 Field: school_name.keyword
DEBUG 2025/12/17 17:53:00 Time From: 2025-12-17T17:52:00.000+08:00
DEBUG 2025/12/17 17:53:00 Time To: 2025-12-17T17:53:00.000+08:00
DEBUG 2025/12/17 17:53:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:52:00.000+08:00",
					"lte": "2025-12-17T17:53:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:53:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:53:00 ES Response IsError: false
DEBUG 2025/12/17 17:53:00 ES Response Body:
{"took":74,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":374,"buckets":[{"key":"黑快馬主機","doc_count":1132},{"key":"花蓮高農","doc_count":716},{"key":"仁愛高農","doc_count":547},{"key":"金門農工","doc_count":447},{"key":"新竹女中","doc_count":417},{"key":"金門高中","doc_count":383},{"key":"北門高中","doc_count":367},{"key":"臺東高中","doc_count":338},{"key":"華僑高中","doc_count":309},{"key":"宜蘭高商","doc_count":301},{"key":"南投高商","doc_count":292},{"key":"政大附中","doc_count":261},{"key":"竹北高中","doc_count":250},{"key":"斗六家商","doc_count":246},{"key":"蘇澳海事","doc_count":233},{"key":"新化高工","doc_count":202},{"key":"關西高中","doc_count":193},{"key":"苗栗農工","doc_count":192},{"key":"後壁高中","doc_count":186},{"key":"關山工商","doc_count":186},{"key":"中大壢中","doc_count":171},{"key":"內埔農工","doc_count":171},{"key":"興大附中","doc_count":160},{"key":"新港藝高","doc_count":158},{"key":"清華附小","doc_count":158},{"key":"旗美高中","doc_count":145},{"key":"苗栗高中","doc_count":144},{"key":"南投特教","doc_count":141},{"key":"花蓮高商","doc_count":137},{"key":"虎尾高中","doc_count":134},{"key":"竹南高中","doc_count":129},{"key":"屏東女中","doc_count":128},{"key":"員林家商","doc_count":127},{"key":"新營高工","doc_count":114},{"key":"玉里高中","doc_count":112},{"key":"嘉義高商","doc_count":107},{"key":"屏東高工","doc_count":103},{"key":"屏東高中","doc_count":102},{"key":"成大南工","doc_count":97},{"key":"新化高中","doc_count":94},{"key":"東港海事","doc_count":93},{"key":"永靖高工","doc_count":87},{"key":"南大附中","doc_count":81},{"key":"秀水高工","doc_count":81},{"key":"旗山農工","doc_count":77},{"key":"南大附聰","doc_count":75},{"key":"中興高中","doc_count":74},{"key":"宜蘭高中","doc_count":74},{"key":"苗栗高商","doc_count":74},{"key":"二林工商","doc_count":73},{"key":"草屯商工","doc_count":73},{"key":"嘉科實中","doc_count":70},{"key":"北教大實小","doc_count":69},{"key":"曾文農工","doc_count":69},{"key":"臺南高商","doc_count":69},{"key":"師大附中高中部","doc_count":68},{"key":"屏科實中","doc_count":65},{"key":"南投高中","doc_count":63},{"key":"新營高中","doc_count":61},{"key":"臺南一中","doc_count":61},{"key":"彰化高商","doc_count":57},{"key":"彰師附工","doc_count":56},{"key":"新竹特教","doc_count":55},{"key":"竹山高中","doc_count":55},{"key":"新豐高中","doc_count":54},{"key":"潮州高中","doc_count":54},{"key":"白河商工","doc_count":53},{"key":"員林高中","doc_count":52},{"key":"水里商工","doc_count":52},{"key":"鳳山高中","doc_count":52},{"key":"嘉義高中","doc_count":49},{"key":"新竹高工","doc_count":49},{"key":"新竹高商","doc_count":48},{"key":"北斗家商","doc_count":45},{"key":"東石高中","doc_count":45},{"key":"海大附中","doc_count":44},{"key":"頭城家商","doc_count":42},{"key":"華南高商","doc_count":41},{"key":"嘉義高工","doc_count":40},{"key":"員林農工","doc_count":39},{"key":"土庫商工","doc_count":39},{"key":"新竹高中","doc_count":39},{"key":"澎湖海事","doc_count":39},{"key":"臺東女中","doc_count":39},{"key":"花蓮高中","doc_count":39},{"key":"北港高中","doc_count":38},{"key":"南大附小","doc_count":38},{"key":"花蓮高工","doc_count":38},{"key":"佳冬高農","doc_count":37},{"key":"善化高中","doc_count":36},{"key":"羅東高工","doc_count":36},{"key":"興大附農","doc_count":36},{"key":"花蓮特教","doc_count":36},{"key":"竹東高中","doc_count":35},{"key":"蘭陽女中","doc_count":35},{"key":"崇實高工","doc_count":33},{"key":"雲林特教","doc_count":33},{"key":"高餐大附中","doc_count":33},{"key":"羅東高商","doc_count":32},{"key":"成功商水","doc_count":31}]}}}
DEBUG 2025/12/17 17:53:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:53:00   Bucket[0]: Key=黑快馬主機, DocCount=1132
DEBUG 2025/12/17 17:53:00   Bucket[1]: Key=花蓮高農, DocCount=716
DEBUG 2025/12/17 17:53:00   Bucket[2]: Key=仁愛高農, DocCount=547
DEBUG 2025/12/17 17:53:00   Bucket[3]: Key=金門農工, DocCount=447
DEBUG 2025/12/17 17:53:00   Bucket[4]: Key=新竹女中, DocCount=417
DEBUG 2025/12/17 17:53:00   Bucket[5]: Key=金門高中, DocCount=383
DEBUG 2025/12/17 17:53:00   Bucket[6]: Key=北門高中, DocCount=367
DEBUG 2025/12/17 17:53:00   Bucket[7]: Key=臺東高中, DocCount=338
DEBUG 2025/12/17 17:53:00   Bucket[8]: Key=華僑高中, DocCount=309
DEBUG 2025/12/17 17:53:00   Bucket[9]: Key=宜蘭高商, DocCount=301
DEBUG 2025/12/17 17:53:00   Bucket[10]: Key=南投高商, DocCount=292
DEBUG 2025/12/17 17:53:00   Bucket[11]: Key=政大附中, DocCount=261
DEBUG 2025/12/17 17:53:00   Bucket[12]: Key=竹北高中, DocCount=250
DEBUG 2025/12/17 17:53:00   Bucket[13]: Key=斗六家商, DocCount=246
DEBUG 2025/12/17 17:53:00   Bucket[14]: Key=蘇澳海事, DocCount=233
DEBUG 2025/12/17 17:53:00   Bucket[15]: Key=新化高工, DocCount=202
DEBUG 2025/12/17 17:53:00   Bucket[16]: Key=關西高中, DocCount=193
DEBUG 2025/12/17 17:53:00   Bucket[17]: Key=苗栗農工, DocCount=192
DEBUG 2025/12/17 17:53:00   Bucket[18]: Key=後壁高中, DocCount=186
DEBUG 2025/12/17 17:53:00   Bucket[19]: Key=關山工商, DocCount=186
DEBUG 2025/12/17 17:53:00   Bucket[20]: Key=中大壢中, DocCount=171
DEBUG 2025/12/17 17:53:00   Bucket[21]: Key=內埔農工, DocCount=171
DEBUG 2025/12/17 17:53:00   Bucket[22]: Key=興大附中, DocCount=160
DEBUG 2025/12/17 17:53:00   Bucket[23]: Key=新港藝高, DocCount=158
DEBUG 2025/12/17 17:53:00   Bucket[24]: Key=清華附小, DocCount=158
DEBUG 2025/12/17 17:53:00   Bucket[25]: Key=旗美高中, DocCount=145
DEBUG 2025/12/17 17:53:00   Bucket[26]: Key=苗栗高中, DocCount=144
DEBUG 2025/12/17 17:53:00   Bucket[27]: Key=南投特教, DocCount=141
DEBUG 2025/12/17 17:53:00   Bucket[28]: Key=花蓮高商, DocCount=137
DEBUG 2025/12/17 17:53:00   Bucket[29]: Key=虎尾高中, DocCount=134
DEBUG 2025/12/17 17:53:00   Bucket[30]: Key=竹南高中, DocCount=129
DEBUG 2025/12/17 17:53:00   Bucket[31]: Key=屏東女中, DocCount=128
DEBUG 2025/12/17 17:53:00   Bucket[32]: Key=員林家商, DocCount=127
DEBUG 2025/12/17 17:53:00   Bucket[33]: Key=新營高工, DocCount=114
DEBUG 2025/12/17 17:53:00   Bucket[34]: Key=玉里高中, DocCount=112
DEBUG 2025/12/17 17:53:00   Bucket[35]: Key=嘉義高商, DocCount=107
DEBUG 2025/12/17 17:53:00   Bucket[36]: Key=屏東高工, DocCount=103
DEBUG 2025/12/17 17:53:00   Bucket[37]: Key=屏東高中, DocCount=102
DEBUG 2025/12/17 17:53:00   Bucket[38]: Key=成大南工, DocCount=97
DEBUG 2025/12/17 17:53:00   Bucket[39]: Key=新化高中, DocCount=94
DEBUG 2025/12/17 17:53:00   Bucket[40]: Key=東港海事, DocCount=93
DEBUG 2025/12/17 17:53:00   Bucket[41]: Key=永靖高工, DocCount=87
DEBUG 2025/12/17 17:53:00   Bucket[42]: Key=南大附中, DocCount=81
DEBUG 2025/12/17 17:53:00   Bucket[43]: Key=秀水高工, DocCount=81
DEBUG 2025/12/17 17:53:00   Bucket[44]: Key=旗山農工, DocCount=77
DEBUG 2025/12/17 17:53:00   Bucket[45]: Key=南大附聰, DocCount=75
DEBUG 2025/12/17 17:53:00   Bucket[46]: Key=中興高中, DocCount=74
DEBUG 2025/12/17 17:53:00   Bucket[47]: Key=宜蘭高中, DocCount=74
DEBUG 2025/12/17 17:53:00   Bucket[48]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:53:00   Bucket[49]: Key=二林工商, DocCount=73
DEBUG 2025/12/17 17:53:00   Bucket[50]: Key=草屯商工, DocCount=73
DEBUG 2025/12/17 17:53:00   Bucket[51]: Key=嘉科實中, DocCount=70
DEBUG 2025/12/17 17:53:00   Bucket[52]: Key=北教大實小, DocCount=69
DEBUG 2025/12/17 17:53:00   Bucket[53]: Key=曾文農工, DocCount=69
DEBUG 2025/12/17 17:53:00   Bucket[54]: Key=臺南高商, DocCount=69
DEBUG 2025/12/17 17:53:00   Bucket[55]: Key=師大附中高中部, DocCount=68
DEBUG 2025/12/17 17:53:00   Bucket[56]: Key=屏科實中, DocCount=65
DEBUG 2025/12/17 17:53:00   Bucket[57]: Key=南投高中, DocCount=63
DEBUG 2025/12/17 17:53:00   Bucket[58]: Key=新營高中, DocCount=61
DEBUG 2025/12/17 17:53:00   Bucket[59]: Key=臺南一中, DocCount=61
DEBUG 2025/12/17 17:53:00   Bucket[60]: Key=彰化高商, DocCount=57
DEBUG 2025/12/17 17:53:00   Bucket[61]: Key=彰師附工, DocCount=56
DEBUG 2025/12/17 17:53:00   Bucket[62]: Key=新竹特教, DocCount=55
DEBUG 2025/12/17 17:53:00   Bucket[63]: Key=竹山高中, DocCount=55
DEBUG 2025/12/17 17:53:00   Bucket[64]: Key=新豐高中, DocCount=54
DEBUG 2025/12/17 17:53:00   Bucket[65]: Key=潮州高中, DocCount=54
DEBUG 2025/12/17 17:53:00   Bucket[66]: Key=白河商工, DocCount=53
DEBUG 2025/12/17 17:53:00   Bucket[67]: Key=員林高中, DocCount=52
DEBUG 2025/12/17 17:53:00   Bucket[68]: Key=水里商工, DocCount=52
DEBUG 2025/12/17 17:53:00   Bucket[69]: Key=鳳山高中, DocCount=52
DEBUG 2025/12/17 17:53:00   Bucket[70]: Key=嘉義高中, DocCount=49
DEBUG 2025/12/17 17:53:00   Bucket[71]: Key=新竹高工, DocCount=49
DEBUG 2025/12/17 17:53:00   Bucket[72]: Key=新竹高商, DocCount=48
DEBUG 2025/12/17 17:53:00   Bucket[73]: Key=北斗家商, DocCount=45
DEBUG 2025/12/17 17:53:00   Bucket[74]: Key=東石高中, DocCount=45
DEBUG 2025/12/17 17:53:00   Bucket[75]: Key=海大附中, DocCount=44
DEBUG 2025/12/17 17:53:00   Bucket[76]: Key=頭城家商, DocCount=42
DEBUG 2025/12/17 17:53:00   Bucket[77]: Key=華南高商, DocCount=41
DEBUG 2025/12/17 17:53:00   Bucket[78]: Key=嘉義高工, DocCount=40
DEBUG 2025/12/17 17:53:00   Bucket[79]: Key=員林農工, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[80]: Key=土庫商工, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[81]: Key=新竹高中, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[82]: Key=澎湖海事, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[83]: Key=臺東女中, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[84]: Key=花蓮高中, DocCount=39
DEBUG 2025/12/17 17:53:00   Bucket[85]: Key=北港高中, DocCount=38
DEBUG 2025/12/17 17:53:00   Bucket[86]: Key=南大附小, DocCount=38
DEBUG 2025/12/17 17:53:00   Bucket[87]: Key=花蓮高工, DocCount=38
DEBUG 2025/12/17 17:53:00   Bucket[88]: Key=佳冬高農, DocCount=37
DEBUG 2025/12/17 17:53:00   Bucket[89]: Key=善化高中, DocCount=36
DEBUG 2025/12/17 17:53:00   Bucket[90]: Key=羅東高工, DocCount=36
DEBUG 2025/12/17 17:53:00   Bucket[91]: Key=興大附農, DocCount=36
DEBUG 2025/12/17 17:53:00   Bucket[92]: Key=花蓮特教, DocCount=36
DEBUG 2025/12/17 17:53:00   Bucket[93]: Key=竹東高中, DocCount=35
DEBUG 2025/12/17 17:53:00   Bucket[94]: Key=蘭陽女中, DocCount=35
DEBUG 2025/12/17 17:53:00   Bucket[95]: Key=崇實高工, DocCount=33
DEBUG 2025/12/17 17:53:00   Bucket[96]: Key=雲林特教, DocCount=33
DEBUG 2025/12/17 17:53:00   Bucket[97]: Key=高餐大附中, DocCount=33
DEBUG 2025/12/17 17:53:00   Bucket[98]: Key=羅東高商, DocCount=32
DEBUG 2025/12/17 17:53:00   Bucket[99]: Key=成功商水, DocCount=31
DEBUG 2025/12/17 17:53:00 ========================================================
INFO 2025/12/17 17:53:03 ✅ Successfully flushed 23/23 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 55/3 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:53:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:53:07 Processing 15 offline devices
INFO 2025/12/17 17:53:07 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:53:07 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:53:07 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:53:07 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:53:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:53:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:53:07 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:53:07 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:53:07 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:53:07 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:53:07 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:53:07 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:53:07 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:53:07 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:53:07 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:53:07 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:53:07 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:53:07 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:53:07 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:53:07 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:53:07 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:53:07 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:53:07 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:53:07 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:53:07 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:53:07 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:53:07 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:53:07 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:53:07 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:53:07 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:53:07 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:53:08 ✅ Successfully flushed 26/26 history records to TimescaleDB
DEBUG 2025/12/17 17:53:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:53:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:53:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:53:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:53:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:53:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:53:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:53:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:53:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:53:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
WARN 2025/12/17 17:53:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:53:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:53:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.49% (threshold: 80.00%)
INFO 2025/12/17 17:53:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:53:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.19% (threshold: 85.00%)
DEBUG 2025/12/17 17:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:53:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:53:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:53:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:53:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:53:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:53:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:53:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:54:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:54:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:54:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:54:00 Field: school_name.keyword
DEBUG 2025/12/17 17:54:00 Time From: 2025-12-17T17:53:00.000+08:00
DEBUG 2025/12/17 17:54:00 Time To: 2025-12-17T17:54:00.000+08:00
DEBUG 2025/12/17 17:54:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:53:00.000+08:00",
					"lte": "2025-12-17T17:54:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:54:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:54:00 ES Response IsError: false
DEBUG 2025/12/17 17:54:00 ES Response Body:
{"took":61,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":393,"buckets":[{"key":"東石高中","doc_count":1337},{"key":"華南高商","doc_count":1054},{"key":"嘉義特教","doc_count":938},{"key":"花蓮高農","doc_count":736},{"key":"黑快馬主機","doc_count":689},{"key":"玉里高中","doc_count":655},{"key":"仁愛高農","doc_count":551},{"key":"新竹女中","doc_count":462},{"key":"金門農工","doc_count":432},{"key":"金門高中","doc_count":398},{"key":"北門高中","doc_count":379},{"key":"宜蘭高商","doc_count":277},{"key":"竹北高中","doc_count":277},{"key":"華僑高中","doc_count":276},{"key":"蘇澳海事","doc_count":265},{"key":"臺東高中","doc_count":254},{"key":"南投高商","doc_count":252},{"key":"斗六家商","doc_count":216},{"key":"關西高中","doc_count":204},{"key":"內埔農工","doc_count":195},{"key":"中大壢中","doc_count":178},{"key":"新港藝高","doc_count":178},{"key":"苗栗農工","doc_count":173},{"key":"後壁高中","doc_count":163},{"key":"旗美高中","doc_count":162},{"key":"新化高工","doc_count":157},{"key":"興大附中","doc_count":151},{"key":"中興高中","doc_count":144},{"key":"關山工商","doc_count":143},{"key":"南投特教","doc_count":140},{"key":"清華附小","doc_count":139},{"key":"虎尾高中","doc_count":137},{"key":"花蓮高商","doc_count":136},{"key":"新營高工","doc_count":128},{"key":"東港海事","doc_count":122},{"key":"嘉義高商","doc_count":120},{"key":"新化高中","doc_count":120},{"key":"彰師附工","doc_count":113},{"key":"竹南高中","doc_count":109},{"key":"竹山高中","doc_count":107},{"key":"屏東女中","doc_count":99},{"key":"北教大實小","doc_count":97},{"key":"員林家商","doc_count":97},{"key":"成大南工","doc_count":97},{"key":"師大附中高中部","doc_count":93},{"key":"鳳山高中","doc_count":92},{"key":"嘉義高中","doc_count":89},{"key":"嘉科實中","doc_count":82},{"key":"溪湖高中","doc_count":80},{"key":"屏東高中","doc_count":77},{"key":"彰化高商","doc_count":77},{"key":"潮州高中","doc_count":71},{"key":"水里商工","doc_count":70},{"key":"政大附中","doc_count":69},{"key":"秀水高工","doc_count":64},{"key":"屏東高工","doc_count":63},{"key":"新竹高中","doc_count":61},{"key":"澎湖海事","doc_count":61},{"key":"新營高中","doc_count":60},{"key":"新竹特教","doc_count":60},{"key":"海大附中","doc_count":60},{"key":"花蓮高工","doc_count":60},{"key":"屏科實中","doc_count":59},{"key":"南投高中","doc_count":57},{"key":"南大附聰","doc_count":55},{"key":"新竹高工","doc_count":55},{"key":"臺南高商","doc_count":54},{"key":"苗栗高商","doc_count":53},{"key":"新豐高中","doc_count":52},{"key":"臺東高商","doc_count":52},{"key":"北斗家商","doc_count":49},{"key":"基隆商工","doc_count":48},{"key":"二林工商","doc_count":47},{"key":"南大附中","doc_count":47},{"key":"雲林特教","doc_count":47},{"key":"善化高中","doc_count":46},{"key":"屏北高中","doc_count":46},{"key":"屏東特教","doc_count":45},{"key":"草屯商工","doc_count":45},{"key":"曾文農工","doc_count":42},{"key":"花蓮特教","doc_count":41},{"key":"宜蘭高中","doc_count":39},{"key":"白河商工","doc_count":39},{"key":"羅東高商","doc_count":39},{"key":"興大附農","doc_count":39},{"key":"花蓮高中","doc_count":39},{"key":"頭城家商","doc_count":39},{"key":"南大附小","doc_count":38},{"key":"埔里高工","doc_count":38},{"key":"羅東高工","doc_count":37},{"key":"家齊高中","doc_count":36},{"key":"旗山農工","doc_count":36},{"key":"苗栗高中","doc_count":36},{"key":"佳冬高農","doc_count":34},{"key":"北港高中","doc_count":34},{"key":"暨大附中","doc_count":34},{"key":"師大附中國中部","doc_count":33},{"key":"崇實高工","doc_count":32},{"key":"永靖高工","doc_count":32},{"key":"臺南一中","doc_count":32}]}}}
DEBUG 2025/12/17 17:54:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:54:00   Bucket[0]: Key=東石高中, DocCount=1337
DEBUG 2025/12/17 17:54:00   Bucket[1]: Key=華南高商, DocCount=1054
DEBUG 2025/12/17 17:54:00   Bucket[2]: Key=嘉義特教, DocCount=938
DEBUG 2025/12/17 17:54:00   Bucket[3]: Key=花蓮高農, DocCount=736
DEBUG 2025/12/17 17:54:00   Bucket[4]: Key=黑快馬主機, DocCount=689
DEBUG 2025/12/17 17:54:00   Bucket[5]: Key=玉里高中, DocCount=655
DEBUG 2025/12/17 17:54:00   Bucket[6]: Key=仁愛高農, DocCount=551
DEBUG 2025/12/17 17:54:00   Bucket[7]: Key=新竹女中, DocCount=462
DEBUG 2025/12/17 17:54:00   Bucket[8]: Key=金門農工, DocCount=432
DEBUG 2025/12/17 17:54:00   Bucket[9]: Key=金門高中, DocCount=398
DEBUG 2025/12/17 17:54:00   Bucket[10]: Key=北門高中, DocCount=379
DEBUG 2025/12/17 17:54:00   Bucket[11]: Key=宜蘭高商, DocCount=277
DEBUG 2025/12/17 17:54:00   Bucket[12]: Key=竹北高中, DocCount=277
DEBUG 2025/12/17 17:54:00   Bucket[13]: Key=華僑高中, DocCount=276
DEBUG 2025/12/17 17:54:00   Bucket[14]: Key=蘇澳海事, DocCount=265
DEBUG 2025/12/17 17:54:00   Bucket[15]: Key=臺東高中, DocCount=254
DEBUG 2025/12/17 17:54:00   Bucket[16]: Key=南投高商, DocCount=252
DEBUG 2025/12/17 17:54:00   Bucket[17]: Key=斗六家商, DocCount=216
DEBUG 2025/12/17 17:54:00   Bucket[18]: Key=關西高中, DocCount=204
DEBUG 2025/12/17 17:54:00   Bucket[19]: Key=內埔農工, DocCount=195
DEBUG 2025/12/17 17:54:00   Bucket[20]: Key=中大壢中, DocCount=178
DEBUG 2025/12/17 17:54:00   Bucket[21]: Key=新港藝高, DocCount=178
DEBUG 2025/12/17 17:54:00   Bucket[22]: Key=苗栗農工, DocCount=173
DEBUG 2025/12/17 17:54:00   Bucket[23]: Key=後壁高中, DocCount=163
DEBUG 2025/12/17 17:54:00   Bucket[24]: Key=旗美高中, DocCount=162
DEBUG 2025/12/17 17:54:00   Bucket[25]: Key=新化高工, DocCount=157
DEBUG 2025/12/17 17:54:00   Bucket[26]: Key=興大附中, DocCount=151
DEBUG 2025/12/17 17:54:00   Bucket[27]: Key=中興高中, DocCount=144
DEBUG 2025/12/17 17:54:00   Bucket[28]: Key=關山工商, DocCount=143
DEBUG 2025/12/17 17:54:00   Bucket[29]: Key=南投特教, DocCount=140
DEBUG 2025/12/17 17:54:00   Bucket[30]: Key=清華附小, DocCount=139
DEBUG 2025/12/17 17:54:00   Bucket[31]: Key=虎尾高中, DocCount=137
DEBUG 2025/12/17 17:54:00   Bucket[32]: Key=花蓮高商, DocCount=136
DEBUG 2025/12/17 17:54:00   Bucket[33]: Key=新營高工, DocCount=128
DEBUG 2025/12/17 17:54:00   Bucket[34]: Key=東港海事, DocCount=122
DEBUG 2025/12/17 17:54:00   Bucket[35]: Key=嘉義高商, DocCount=120
DEBUG 2025/12/17 17:54:00   Bucket[36]: Key=新化高中, DocCount=120
DEBUG 2025/12/17 17:54:00   Bucket[37]: Key=彰師附工, DocCount=113
DEBUG 2025/12/17 17:54:00   Bucket[38]: Key=竹南高中, DocCount=109
DEBUG 2025/12/17 17:54:00   Bucket[39]: Key=竹山高中, DocCount=107
DEBUG 2025/12/17 17:54:00   Bucket[40]: Key=屏東女中, DocCount=99
DEBUG 2025/12/17 17:54:00   Bucket[41]: Key=北教大實小, DocCount=97
DEBUG 2025/12/17 17:54:00   Bucket[42]: Key=員林家商, DocCount=97
DEBUG 2025/12/17 17:54:00   Bucket[43]: Key=成大南工, DocCount=97
DEBUG 2025/12/17 17:54:00   Bucket[44]: Key=師大附中高中部, DocCount=93
DEBUG 2025/12/17 17:54:00   Bucket[45]: Key=鳳山高中, DocCount=92
DEBUG 2025/12/17 17:54:00   Bucket[46]: Key=嘉義高中, DocCount=89
DEBUG 2025/12/17 17:54:00   Bucket[47]: Key=嘉科實中, DocCount=82
DEBUG 2025/12/17 17:54:00   Bucket[48]: Key=溪湖高中, DocCount=80
DEBUG 2025/12/17 17:54:00   Bucket[49]: Key=屏東高中, DocCount=77
DEBUG 2025/12/17 17:54:00   Bucket[50]: Key=彰化高商, DocCount=77
DEBUG 2025/12/17 17:54:00   Bucket[51]: Key=潮州高中, DocCount=71
DEBUG 2025/12/17 17:54:00   Bucket[52]: Key=水里商工, DocCount=70
DEBUG 2025/12/17 17:54:00   Bucket[53]: Key=政大附中, DocCount=69
DEBUG 2025/12/17 17:54:00   Bucket[54]: Key=秀水高工, DocCount=64
DEBUG 2025/12/17 17:54:00   Bucket[55]: Key=屏東高工, DocCount=63
DEBUG 2025/12/17 17:54:00   Bucket[56]: Key=新竹高中, DocCount=61
DEBUG 2025/12/17 17:54:00   Bucket[57]: Key=澎湖海事, DocCount=61
DEBUG 2025/12/17 17:54:00   Bucket[58]: Key=新營高中, DocCount=60
DEBUG 2025/12/17 17:54:00   Bucket[59]: Key=新竹特教, DocCount=60
DEBUG 2025/12/17 17:54:00   Bucket[60]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:54:00   Bucket[61]: Key=花蓮高工, DocCount=60
DEBUG 2025/12/17 17:54:00   Bucket[62]: Key=屏科實中, DocCount=59
DEBUG 2025/12/17 17:54:00   Bucket[63]: Key=南投高中, DocCount=57
DEBUG 2025/12/17 17:54:00   Bucket[64]: Key=南大附聰, DocCount=55
DEBUG 2025/12/17 17:54:00   Bucket[65]: Key=新竹高工, DocCount=55
DEBUG 2025/12/17 17:54:00   Bucket[66]: Key=臺南高商, DocCount=54
DEBUG 2025/12/17 17:54:00   Bucket[67]: Key=苗栗高商, DocCount=53
DEBUG 2025/12/17 17:54:00   Bucket[68]: Key=新豐高中, DocCount=52
DEBUG 2025/12/17 17:54:00   Bucket[69]: Key=臺東高商, DocCount=52
DEBUG 2025/12/17 17:54:00   Bucket[70]: Key=北斗家商, DocCount=49
DEBUG 2025/12/17 17:54:00   Bucket[71]: Key=基隆商工, DocCount=48
DEBUG 2025/12/17 17:54:00   Bucket[72]: Key=二林工商, DocCount=47
DEBUG 2025/12/17 17:54:00   Bucket[73]: Key=南大附中, DocCount=47
DEBUG 2025/12/17 17:54:00   Bucket[74]: Key=雲林特教, DocCount=47
DEBUG 2025/12/17 17:54:00   Bucket[75]: Key=善化高中, DocCount=46
DEBUG 2025/12/17 17:54:00   Bucket[76]: Key=屏北高中, DocCount=46
DEBUG 2025/12/17 17:54:00   Bucket[77]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:54:00   Bucket[78]: Key=草屯商工, DocCount=45
DEBUG 2025/12/17 17:54:00   Bucket[79]: Key=曾文農工, DocCount=42
DEBUG 2025/12/17 17:54:00   Bucket[80]: Key=花蓮特教, DocCount=41
DEBUG 2025/12/17 17:54:00   Bucket[81]: Key=宜蘭高中, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[82]: Key=白河商工, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[83]: Key=羅東高商, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[84]: Key=興大附農, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[85]: Key=花蓮高中, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[86]: Key=頭城家商, DocCount=39
DEBUG 2025/12/17 17:54:00   Bucket[87]: Key=南大附小, DocCount=38
DEBUG 2025/12/17 17:54:00   Bucket[88]: Key=埔里高工, DocCount=38
DEBUG 2025/12/17 17:54:00   Bucket[89]: Key=羅東高工, DocCount=37
DEBUG 2025/12/17 17:54:00   Bucket[90]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:54:00   Bucket[91]: Key=旗山農工, DocCount=36
DEBUG 2025/12/17 17:54:00   Bucket[92]: Key=苗栗高中, DocCount=36
DEBUG 2025/12/17 17:54:00   Bucket[93]: Key=佳冬高農, DocCount=34
DEBUG 2025/12/17 17:54:00   Bucket[94]: Key=北港高中, DocCount=34
DEBUG 2025/12/17 17:54:00   Bucket[95]: Key=暨大附中, DocCount=34
DEBUG 2025/12/17 17:54:00   Bucket[96]: Key=師大附中國中部, DocCount=33
DEBUG 2025/12/17 17:54:00   Bucket[97]: Key=崇實高工, DocCount=32
DEBUG 2025/12/17 17:54:00   Bucket[98]: Key=永靖高工, DocCount=32
DEBUG 2025/12/17 17:54:00   Bucket[99]: Key=臺南一中, DocCount=32
DEBUG 2025/12/17 17:54:00 ========================================================
INFO 2025/12/17 17:54:03 ✅ Successfully flushed 14/14 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:54:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:54:08 ✅ Successfully flushed 17/17 history records to TimescaleDB
INFO 2025/12/17 17:54:08 Processing 15 offline devices
INFO 2025/12/17 17:54:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:54:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:54:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:54:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:54:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:54:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:54:08 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:54:08 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:54:08 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:54:08 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:54:08 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:54:08 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:54:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:54:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:54:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:54:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:54:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:54:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:54:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:54:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:54:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:54:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:54:09 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:54:09 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:54:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:54:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:54:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:54:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:54:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:54:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:54:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:54:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:54:09 Creating history record for offline device: 新竹高商
INFO 2025/12/17 17:54:09 About to add history to batch for device: 新竹高商
INFO 2025/12/17 17:54:09 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 17:54:13 ✅ Successfully flushed 20/20 history records to TimescaleDB
DEBUG 2025/12/17 17:54:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:54:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:54:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:54:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:54:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:54:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:54:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:54:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:54:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:54:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:54:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:54:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.26% (threshold: 90.00%)
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.19% (threshold: 85.00%)
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:54:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:54:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:54:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:54:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:54:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:55:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:55:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:55:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:55:00 Field: school_name.keyword
DEBUG 2025/12/17 17:55:00 Time From: 2025-12-17T17:54:00.000+08:00
DEBUG 2025/12/17 17:55:00 Time To: 2025-12-17T17:55:00.000+08:00
DEBUG 2025/12/17 17:55:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:54:00.000+08:00",
					"lte": "2025-12-17T17:55:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:55:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:55:00 ES Response IsError: false
DEBUG 2025/12/17 17:55:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":388,"buckets":[{"key":"花蓮高農","doc_count":728},{"key":"黑快馬主機","doc_count":670},{"key":"仁愛高農","doc_count":583},{"key":"嘉義特教","doc_count":549},{"key":"東石高中","doc_count":514},{"key":"華南高商","doc_count":482},{"key":"新竹女中","doc_count":456},{"key":"金門農工","doc_count":452},{"key":"金門高中","doc_count":418},{"key":"北門高中","doc_count":379},{"key":"興大附中","doc_count":328},{"key":"南投高商","doc_count":313},{"key":"蘇澳海事","doc_count":298},{"key":"宜蘭高商","doc_count":286},{"key":"華僑高中","doc_count":247},{"key":"竹北高中","doc_count":215},{"key":"中大壢中","doc_count":214},{"key":"臺東高中","doc_count":208},{"key":"二林工商","doc_count":206},{"key":"玉里高中","doc_count":203},{"key":"新港藝高","doc_count":194},{"key":"斗六家商","doc_count":187},{"key":"關西高中","doc_count":187},{"key":"興大附農","doc_count":182},{"key":"清華附小","doc_count":175},{"key":"苗栗農工","doc_count":174},{"key":"花蓮高商","doc_count":172},{"key":"內埔農工","doc_count":168},{"key":"新營高工","doc_count":167},{"key":"虎尾高中","doc_count":155},{"key":"後壁高中","doc_count":151},{"key":"關山工商","doc_count":149},{"key":"南投特教","doc_count":144},{"key":"竹南高中","doc_count":142},{"key":"新化高工","doc_count":139},{"key":"南投高中","doc_count":137},{"key":"嘉義高商","doc_count":136},{"key":"旗美高中","doc_count":135},{"key":"政大附中","doc_count":133},{"key":"嘉義高中","doc_count":122},{"key":"新化高中","doc_count":117},{"key":"員林家商","doc_count":113},{"key":"苗栗高商","doc_count":110},{"key":"東港海事","doc_count":105},{"key":"成大南工","doc_count":100},{"key":"屏東女中","doc_count":96},{"key":"新竹高商","doc_count":90},{"key":"臺東高商","doc_count":86},{"key":"海大附中","doc_count":83},{"key":"新竹高工","doc_count":82},{"key":"彰化高商","doc_count":76},{"key":"彰師附工","doc_count":76},{"key":"員林高中","doc_count":74},{"key":"北教大實小","doc_count":71},{"key":"宜蘭高中","doc_count":70},{"key":"屏科實中","doc_count":70},{"key":"竹山高中","doc_count":70},{"key":"師大附中高中部","doc_count":69},{"key":"新營高中","doc_count":68},{"key":"南大附聰","doc_count":66},{"key":"屏東高中","doc_count":64},{"key":"土庫商工","doc_count":63},{"key":"南大附中","doc_count":60},{"key":"溪湖高中","doc_count":59},{"key":"水里商工","doc_count":58},{"key":"臺南高商","doc_count":57},{"key":"鳳山高中","doc_count":55},{"key":"員林農工","doc_count":54},{"key":"崇實高工","doc_count":54},{"key":"竹東高中","doc_count":54},{"key":"臺南一中","doc_count":53},{"key":"澎湖海事","doc_count":52},{"key":"曾文農工","doc_count":50},{"key":"羅東高商","doc_count":50},{"key":"嘉義高工","doc_count":46},{"key":"永靖高工","doc_count":45},{"key":"雲林特教","doc_count":45},{"key":"頭城家商","doc_count":45},{"key":"佳冬高農","doc_count":44},{"key":"北港高中","doc_count":43},{"key":"新豐高中","doc_count":43},{"key":"暨大附中","doc_count":43},{"key":"白河商工","doc_count":43},{"key":"善化高中","doc_count":42},{"key":"新竹高中","doc_count":42},{"key":"屏東特教","doc_count":41},{"key":"屏東高工","doc_count":41},{"key":"草屯商工","doc_count":40},{"key":"埔里高工","doc_count":38},{"key":"秀水高工","doc_count":38},{"key":"花蓮特教","doc_count":37},{"key":"基隆商工","doc_count":36},{"key":"北港農工","doc_count":35},{"key":"花蓮高中","doc_count":35},{"key":"臺東女中","doc_count":34},{"key":"蘭陽女中","doc_count":34},{"key":"北斗家商","doc_count":33},{"key":"嘉科實中","doc_count":33},{"key":"羅東高工","doc_count":33},{"key":"高餐大附中","doc_count":33}]}}}
DEBUG 2025/12/17 17:55:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:55:00   Bucket[0]: Key=花蓮高農, DocCount=728
DEBUG 2025/12/17 17:55:00   Bucket[1]: Key=黑快馬主機, DocCount=670
DEBUG 2025/12/17 17:55:00   Bucket[2]: Key=仁愛高農, DocCount=583
DEBUG 2025/12/17 17:55:00   Bucket[3]: Key=嘉義特教, DocCount=549
DEBUG 2025/12/17 17:55:00   Bucket[4]: Key=東石高中, DocCount=514
DEBUG 2025/12/17 17:55:00   Bucket[5]: Key=華南高商, DocCount=482
DEBUG 2025/12/17 17:55:00   Bucket[6]: Key=新竹女中, DocCount=456
DEBUG 2025/12/17 17:55:00   Bucket[7]: Key=金門農工, DocCount=452
DEBUG 2025/12/17 17:55:00   Bucket[8]: Key=金門高中, DocCount=418
DEBUG 2025/12/17 17:55:00   Bucket[9]: Key=北門高中, DocCount=379
DEBUG 2025/12/17 17:55:00   Bucket[10]: Key=興大附中, DocCount=328
DEBUG 2025/12/17 17:55:00   Bucket[11]: Key=南投高商, DocCount=313
DEBUG 2025/12/17 17:55:00   Bucket[12]: Key=蘇澳海事, DocCount=298
DEBUG 2025/12/17 17:55:00   Bucket[13]: Key=宜蘭高商, DocCount=286
DEBUG 2025/12/17 17:55:00   Bucket[14]: Key=華僑高中, DocCount=247
DEBUG 2025/12/17 17:55:00   Bucket[15]: Key=竹北高中, DocCount=215
DEBUG 2025/12/17 17:55:00   Bucket[16]: Key=中大壢中, DocCount=214
DEBUG 2025/12/17 17:55:00   Bucket[17]: Key=臺東高中, DocCount=208
DEBUG 2025/12/17 17:55:00   Bucket[18]: Key=二林工商, DocCount=206
DEBUG 2025/12/17 17:55:00   Bucket[19]: Key=玉里高中, DocCount=203
DEBUG 2025/12/17 17:55:00   Bucket[20]: Key=新港藝高, DocCount=194
DEBUG 2025/12/17 17:55:00   Bucket[21]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:55:00   Bucket[22]: Key=關西高中, DocCount=187
DEBUG 2025/12/17 17:55:00   Bucket[23]: Key=興大附農, DocCount=182
DEBUG 2025/12/17 17:55:00   Bucket[24]: Key=清華附小, DocCount=175
DEBUG 2025/12/17 17:55:00   Bucket[25]: Key=苗栗農工, DocCount=174
DEBUG 2025/12/17 17:55:00   Bucket[26]: Key=花蓮高商, DocCount=172
DEBUG 2025/12/17 17:55:00   Bucket[27]: Key=內埔農工, DocCount=168
DEBUG 2025/12/17 17:55:00   Bucket[28]: Key=新營高工, DocCount=167
DEBUG 2025/12/17 17:55:00   Bucket[29]: Key=虎尾高中, DocCount=155
DEBUG 2025/12/17 17:55:00   Bucket[30]: Key=後壁高中, DocCount=151
DEBUG 2025/12/17 17:55:00   Bucket[31]: Key=關山工商, DocCount=149
DEBUG 2025/12/17 17:55:00   Bucket[32]: Key=南投特教, DocCount=144
DEBUG 2025/12/17 17:55:00   Bucket[33]: Key=竹南高中, DocCount=142
DEBUG 2025/12/17 17:55:00   Bucket[34]: Key=新化高工, DocCount=139
DEBUG 2025/12/17 17:55:00   Bucket[35]: Key=南投高中, DocCount=137
DEBUG 2025/12/17 17:55:00   Bucket[36]: Key=嘉義高商, DocCount=136
DEBUG 2025/12/17 17:55:00   Bucket[37]: Key=旗美高中, DocCount=135
DEBUG 2025/12/17 17:55:00   Bucket[38]: Key=政大附中, DocCount=133
DEBUG 2025/12/17 17:55:00   Bucket[39]: Key=嘉義高中, DocCount=122
DEBUG 2025/12/17 17:55:00   Bucket[40]: Key=新化高中, DocCount=117
DEBUG 2025/12/17 17:55:00   Bucket[41]: Key=員林家商, DocCount=113
DEBUG 2025/12/17 17:55:00   Bucket[42]: Key=苗栗高商, DocCount=110
DEBUG 2025/12/17 17:55:00   Bucket[43]: Key=東港海事, DocCount=105
DEBUG 2025/12/17 17:55:00   Bucket[44]: Key=成大南工, DocCount=100
DEBUG 2025/12/17 17:55:00   Bucket[45]: Key=屏東女中, DocCount=96
DEBUG 2025/12/17 17:55:00   Bucket[46]: Key=新竹高商, DocCount=90
DEBUG 2025/12/17 17:55:00   Bucket[47]: Key=臺東高商, DocCount=86
DEBUG 2025/12/17 17:55:00   Bucket[48]: Key=海大附中, DocCount=83
DEBUG 2025/12/17 17:55:00   Bucket[49]: Key=新竹高工, DocCount=82
DEBUG 2025/12/17 17:55:00   Bucket[50]: Key=彰化高商, DocCount=76
DEBUG 2025/12/17 17:55:00   Bucket[51]: Key=彰師附工, DocCount=76
DEBUG 2025/12/17 17:55:00   Bucket[52]: Key=員林高中, DocCount=74
DEBUG 2025/12/17 17:55:00   Bucket[53]: Key=北教大實小, DocCount=71
DEBUG 2025/12/17 17:55:00   Bucket[54]: Key=宜蘭高中, DocCount=70
DEBUG 2025/12/17 17:55:00   Bucket[55]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:55:00   Bucket[56]: Key=竹山高中, DocCount=70
DEBUG 2025/12/17 17:55:00   Bucket[57]: Key=師大附中高中部, DocCount=69
DEBUG 2025/12/17 17:55:00   Bucket[58]: Key=新營高中, DocCount=68
DEBUG 2025/12/17 17:55:00   Bucket[59]: Key=南大附聰, DocCount=66
DEBUG 2025/12/17 17:55:00   Bucket[60]: Key=屏東高中, DocCount=64
DEBUG 2025/12/17 17:55:00   Bucket[61]: Key=土庫商工, DocCount=63
DEBUG 2025/12/17 17:55:00   Bucket[62]: Key=南大附中, DocCount=60
DEBUG 2025/12/17 17:55:00   Bucket[63]: Key=溪湖高中, DocCount=59
DEBUG 2025/12/17 17:55:00   Bucket[64]: Key=水里商工, DocCount=58
DEBUG 2025/12/17 17:55:00   Bucket[65]: Key=臺南高商, DocCount=57
DEBUG 2025/12/17 17:55:00   Bucket[66]: Key=鳳山高中, DocCount=55
DEBUG 2025/12/17 17:55:00   Bucket[67]: Key=員林農工, DocCount=54
DEBUG 2025/12/17 17:55:00   Bucket[68]: Key=崇實高工, DocCount=54
DEBUG 2025/12/17 17:55:00   Bucket[69]: Key=竹東高中, DocCount=54
DEBUG 2025/12/17 17:55:00   Bucket[70]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:55:00   Bucket[71]: Key=澎湖海事, DocCount=52
DEBUG 2025/12/17 17:55:00   Bucket[72]: Key=曾文農工, DocCount=50
DEBUG 2025/12/17 17:55:00   Bucket[73]: Key=羅東高商, DocCount=50
DEBUG 2025/12/17 17:55:00   Bucket[74]: Key=嘉義高工, DocCount=46
DEBUG 2025/12/17 17:55:00   Bucket[75]: Key=永靖高工, DocCount=45
DEBUG 2025/12/17 17:55:00   Bucket[76]: Key=雲林特教, DocCount=45
DEBUG 2025/12/17 17:55:00   Bucket[77]: Key=頭城家商, DocCount=45
DEBUG 2025/12/17 17:55:00   Bucket[78]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 17:55:00   Bucket[79]: Key=北港高中, DocCount=43
DEBUG 2025/12/17 17:55:00   Bucket[80]: Key=新豐高中, DocCount=43
DEBUG 2025/12/17 17:55:00   Bucket[81]: Key=暨大附中, DocCount=43
DEBUG 2025/12/17 17:55:00   Bucket[82]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:55:00   Bucket[83]: Key=善化高中, DocCount=42
DEBUG 2025/12/17 17:55:00   Bucket[84]: Key=新竹高中, DocCount=42
DEBUG 2025/12/17 17:55:00   Bucket[85]: Key=屏東特教, DocCount=41
DEBUG 2025/12/17 17:55:00   Bucket[86]: Key=屏東高工, DocCount=41
DEBUG 2025/12/17 17:55:00   Bucket[87]: Key=草屯商工, DocCount=40
DEBUG 2025/12/17 17:55:00   Bucket[88]: Key=埔里高工, DocCount=38
DEBUG 2025/12/17 17:55:00   Bucket[89]: Key=秀水高工, DocCount=38
DEBUG 2025/12/17 17:55:00   Bucket[90]: Key=花蓮特教, DocCount=37
DEBUG 2025/12/17 17:55:00   Bucket[91]: Key=基隆商工, DocCount=36
DEBUG 2025/12/17 17:55:00   Bucket[92]: Key=北港農工, DocCount=35
DEBUG 2025/12/17 17:55:00   Bucket[93]: Key=花蓮高中, DocCount=35
DEBUG 2025/12/17 17:55:00   Bucket[94]: Key=臺東女中, DocCount=34
DEBUG 2025/12/17 17:55:00   Bucket[95]: Key=蘭陽女中, DocCount=34
DEBUG 2025/12/17 17:55:00   Bucket[96]: Key=北斗家商, DocCount=33
DEBUG 2025/12/17 17:55:00   Bucket[97]: Key=嘉科實中, DocCount=33
DEBUG 2025/12/17 17:55:00   Bucket[98]: Key=羅東高工, DocCount=33
DEBUG 2025/12/17 17:55:00   Bucket[99]: Key=高餐大附中, DocCount=33
DEBUG 2025/12/17 17:55:00 ========================================================
INFO 2025/12/17 17:55:03 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 1/1 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:55:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:55:08 Processing 15 offline devices
INFO 2025/12/17 17:55:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:55:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:55:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:55:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:55:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:55:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:55:08 Creating history record for offline device: 潮州高中
INFO 2025/12/17 17:55:08 About to add history to batch for device: 潮州高中
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 17:55:08 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:55:08 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:55:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:55:08 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:55:08 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:55:08 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:55:08 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:55:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:55:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:55:08 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:55:08 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:55:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:55:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:55:08 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:55:08 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:55:08 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:55:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:55:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:55:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:55:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:55:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:55:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:55:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:55:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:55:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:55:09 Creating history record for offline device: 花蓮高工
INFO 2025/12/17 17:55:09 About to add history to batch for device: 花蓮高工
INFO 2025/12/17 17:55:09 Successfully added history record for offline device: 花蓮高工
INFO 2025/12/17 17:55:13 ✅ Successfully flushed 11/11 history records to TimescaleDB
DEBUG 2025/12/17 17:55:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:55:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:55:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:55:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:55:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:55:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:55:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:55:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:55:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:55:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:55:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:55:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:55:45 ES Alert Created [high][performance]: Memory usage high: 89.26% (threshold: 80.00%)
INFO 2025/12/17 17:55:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:55:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.22% (threshold: 85.00%)
DEBUG 2025/12/17 17:55:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:55:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:55:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:55:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:55:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:55:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:55:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:56:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:56:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:56:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:56:00 Field: school_name.keyword
DEBUG 2025/12/17 17:56:00 Time From: 2025-12-17T17:55:00.000+08:00
DEBUG 2025/12/17 17:56:00 Time To: 2025-12-17T17:56:00.000+08:00
DEBUG 2025/12/17 17:56:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:55:00.000+08:00",
					"lte": "2025-12-17T17:56:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:56:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:56:00 ES Response IsError: false
DEBUG 2025/12/17 17:56:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":427,"buckets":[{"key":"黑快馬主機","doc_count":1498},{"key":"花蓮高農","doc_count":891},{"key":"仁愛高農","doc_count":595},{"key":"金門農工","doc_count":474},{"key":"新竹女中","doc_count":420},{"key":"金門高中","doc_count":398},{"key":"北門高中","doc_count":367},{"key":"中大壢中","doc_count":350},{"key":"南投高商","doc_count":299},{"key":"宜蘭高商","doc_count":263},{"key":"竹北高中","doc_count":263},{"key":"關西高中","doc_count":252},{"key":"蘇澳海事","doc_count":248},{"key":"華僑高中","doc_count":230},{"key":"臺東高中","doc_count":227},{"key":"後壁高中","doc_count":214},{"key":"玉里高中","doc_count":198},{"key":"斗六家商","doc_count":193},{"key":"興大附中","doc_count":178},{"key":"虎尾高中","doc_count":171},{"key":"花蓮高商","doc_count":167},{"key":"苗栗農工","doc_count":164},{"key":"新營高中","doc_count":163},{"key":"新化高工","doc_count":159},{"key":"新港藝高","doc_count":159},{"key":"內埔農工","doc_count":157},{"key":"旗美高中","doc_count":151},{"key":"清華附小","doc_count":150},{"key":"屏東女中","doc_count":135},{"key":"竹南高中","doc_count":133},{"key":"南投特教","doc_count":129},{"key":"水里商工","doc_count":128},{"key":"關山工商","doc_count":122},{"key":"東港海事","doc_count":111},{"key":"新化高中","doc_count":108},{"key":"新營高工","doc_count":106},{"key":"彰師附工","doc_count":103},{"key":"草屯商工","doc_count":102},{"key":"新竹高商","doc_count":101},{"key":"竹山高中","doc_count":90},{"key":"南投高中","doc_count":83},{"key":"新竹高工","doc_count":83},{"key":"嘉義高商","doc_count":81},{"key":"師大附中高中部","doc_count":81},{"key":"師大附中國中部","doc_count":79},{"key":"苗栗高商","doc_count":78},{"key":"員林家商","doc_count":77},{"key":"臺南一中","doc_count":76},{"key":"南大附中","doc_count":75},{"key":"嘉科實中","doc_count":74},{"key":"北教大實小","doc_count":72},{"key":"屏科實中","doc_count":70},{"key":"彰化高商","doc_count":69},{"key":"佳冬高農","doc_count":66},{"key":"南大附聰","doc_count":65},{"key":"政大附中","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"溪湖高中","doc_count":62},{"key":"北港高中","doc_count":61},{"key":"臺南高商","doc_count":59},{"key":"善化高中","doc_count":55},{"key":"屏東高工","doc_count":55},{"key":"嘉義高中","doc_count":54},{"key":"崇實高工","doc_count":52},{"key":"蘭陽女中","doc_count":52},{"key":"頭城家商","doc_count":52},{"key":"鳳山高中","doc_count":52},{"key":"嘉義高工","doc_count":51},{"key":"土庫商工","doc_count":51},{"key":"興大附農","doc_count":49},{"key":"成大南工","doc_count":48},{"key":"高餐大附中","doc_count":48},{"key":"宜蘭高中","doc_count":46},{"key":"屏東特教","doc_count":46},{"key":"海大附中","doc_count":46},{"key":"竹東高中","doc_count":46},{"key":"羅東高工","doc_count":46},{"key":"二林工商","doc_count":44},{"key":"北斗家商","doc_count":44},{"key":"永靖高工","doc_count":44},{"key":"羅東高商","doc_count":44},{"key":"臺東高商","doc_count":43},{"key":"東石高中","doc_count":42},{"key":"白河商工","doc_count":42},{"key":"花蓮特教","doc_count":41},{"key":"花蓮高中","doc_count":40},{"key":"花蓮高工","doc_count":40},{"key":"苗栗高中","doc_count":40},{"key":"新豐高中","doc_count":38},{"key":"暨大附中","doc_count":37},{"key":"屏東高中","doc_count":36},{"key":"潮州高中","doc_count":36},{"key":"華南高商","doc_count":36},{"key":"基隆商工","doc_count":35},{"key":"旗山農工","doc_count":35},{"key":"曾文農工","doc_count":33},{"key":"秀水高工","doc_count":33},{"key":"南大附小","doc_count":32},{"key":"家齊高中","doc_count":32},{"key":"北港農工","doc_count":31}]}}}
DEBUG 2025/12/17 17:56:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:56:00   Bucket[0]: Key=黑快馬主機, DocCount=1498
DEBUG 2025/12/17 17:56:00   Bucket[1]: Key=花蓮高農, DocCount=891
DEBUG 2025/12/17 17:56:00   Bucket[2]: Key=仁愛高農, DocCount=595
DEBUG 2025/12/17 17:56:00   Bucket[3]: Key=金門農工, DocCount=474
DEBUG 2025/12/17 17:56:00   Bucket[4]: Key=新竹女中, DocCount=420
DEBUG 2025/12/17 17:56:00   Bucket[5]: Key=金門高中, DocCount=398
DEBUG 2025/12/17 17:56:00   Bucket[6]: Key=北門高中, DocCount=367
DEBUG 2025/12/17 17:56:00   Bucket[7]: Key=中大壢中, DocCount=350
DEBUG 2025/12/17 17:56:00   Bucket[8]: Key=南投高商, DocCount=299
DEBUG 2025/12/17 17:56:00   Bucket[9]: Key=宜蘭高商, DocCount=263
DEBUG 2025/12/17 17:56:00   Bucket[10]: Key=竹北高中, DocCount=263
DEBUG 2025/12/17 17:56:00   Bucket[11]: Key=關西高中, DocCount=252
DEBUG 2025/12/17 17:56:00   Bucket[12]: Key=蘇澳海事, DocCount=248
DEBUG 2025/12/17 17:56:00   Bucket[13]: Key=華僑高中, DocCount=230
DEBUG 2025/12/17 17:56:00   Bucket[14]: Key=臺東高中, DocCount=227
DEBUG 2025/12/17 17:56:00   Bucket[15]: Key=後壁高中, DocCount=214
DEBUG 2025/12/17 17:56:00   Bucket[16]: Key=玉里高中, DocCount=198
DEBUG 2025/12/17 17:56:00   Bucket[17]: Key=斗六家商, DocCount=193
DEBUG 2025/12/17 17:56:00   Bucket[18]: Key=興大附中, DocCount=178
DEBUG 2025/12/17 17:56:00   Bucket[19]: Key=虎尾高中, DocCount=171
DEBUG 2025/12/17 17:56:00   Bucket[20]: Key=花蓮高商, DocCount=167
DEBUG 2025/12/17 17:56:00   Bucket[21]: Key=苗栗農工, DocCount=164
DEBUG 2025/12/17 17:56:00   Bucket[22]: Key=新營高中, DocCount=163
DEBUG 2025/12/17 17:56:00   Bucket[23]: Key=新化高工, DocCount=159
DEBUG 2025/12/17 17:56:00   Bucket[24]: Key=新港藝高, DocCount=159
DEBUG 2025/12/17 17:56:00   Bucket[25]: Key=內埔農工, DocCount=157
DEBUG 2025/12/17 17:56:00   Bucket[26]: Key=旗美高中, DocCount=151
DEBUG 2025/12/17 17:56:00   Bucket[27]: Key=清華附小, DocCount=150
DEBUG 2025/12/17 17:56:00   Bucket[28]: Key=屏東女中, DocCount=135
DEBUG 2025/12/17 17:56:00   Bucket[29]: Key=竹南高中, DocCount=133
DEBUG 2025/12/17 17:56:00   Bucket[30]: Key=南投特教, DocCount=129
DEBUG 2025/12/17 17:56:00   Bucket[31]: Key=水里商工, DocCount=128
DEBUG 2025/12/17 17:56:00   Bucket[32]: Key=關山工商, DocCount=122
DEBUG 2025/12/17 17:56:00   Bucket[33]: Key=東港海事, DocCount=111
DEBUG 2025/12/17 17:56:00   Bucket[34]: Key=新化高中, DocCount=108
DEBUG 2025/12/17 17:56:00   Bucket[35]: Key=新營高工, DocCount=106
DEBUG 2025/12/17 17:56:00   Bucket[36]: Key=彰師附工, DocCount=103
DEBUG 2025/12/17 17:56:00   Bucket[37]: Key=草屯商工, DocCount=102
DEBUG 2025/12/17 17:56:00   Bucket[38]: Key=新竹高商, DocCount=101
DEBUG 2025/12/17 17:56:00   Bucket[39]: Key=竹山高中, DocCount=90
DEBUG 2025/12/17 17:56:00   Bucket[40]: Key=南投高中, DocCount=83
DEBUG 2025/12/17 17:56:00   Bucket[41]: Key=新竹高工, DocCount=83
DEBUG 2025/12/17 17:56:00   Bucket[42]: Key=嘉義高商, DocCount=81
DEBUG 2025/12/17 17:56:00   Bucket[43]: Key=師大附中高中部, DocCount=81
DEBUG 2025/12/17 17:56:00   Bucket[44]: Key=師大附中國中部, DocCount=79
DEBUG 2025/12/17 17:56:00   Bucket[45]: Key=苗栗高商, DocCount=78
DEBUG 2025/12/17 17:56:00   Bucket[46]: Key=員林家商, DocCount=77
DEBUG 2025/12/17 17:56:00   Bucket[47]: Key=臺南一中, DocCount=76
DEBUG 2025/12/17 17:56:00   Bucket[48]: Key=南大附中, DocCount=75
DEBUG 2025/12/17 17:56:00   Bucket[49]: Key=嘉科實中, DocCount=74
DEBUG 2025/12/17 17:56:00   Bucket[50]: Key=北教大實小, DocCount=72
DEBUG 2025/12/17 17:56:00   Bucket[51]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:56:00   Bucket[52]: Key=彰化高商, DocCount=69
DEBUG 2025/12/17 17:56:00   Bucket[53]: Key=佳冬高農, DocCount=66
DEBUG 2025/12/17 17:56:00   Bucket[54]: Key=南大附聰, DocCount=65
DEBUG 2025/12/17 17:56:00   Bucket[55]: Key=政大附中, DocCount=63
DEBUG 2025/12/17 17:56:00   Bucket[56]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 17:56:00   Bucket[57]: Key=溪湖高中, DocCount=62
DEBUG 2025/12/17 17:56:00   Bucket[58]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:56:00   Bucket[59]: Key=臺南高商, DocCount=59
DEBUG 2025/12/17 17:56:00   Bucket[60]: Key=善化高中, DocCount=55
DEBUG 2025/12/17 17:56:00   Bucket[61]: Key=屏東高工, DocCount=55
DEBUG 2025/12/17 17:56:00   Bucket[62]: Key=嘉義高中, DocCount=54
DEBUG 2025/12/17 17:56:00   Bucket[63]: Key=崇實高工, DocCount=52
DEBUG 2025/12/17 17:56:00   Bucket[64]: Key=蘭陽女中, DocCount=52
DEBUG 2025/12/17 17:56:00   Bucket[65]: Key=頭城家商, DocCount=52
DEBUG 2025/12/17 17:56:00   Bucket[66]: Key=鳳山高中, DocCount=52
DEBUG 2025/12/17 17:56:00   Bucket[67]: Key=嘉義高工, DocCount=51
DEBUG 2025/12/17 17:56:00   Bucket[68]: Key=土庫商工, DocCount=51
DEBUG 2025/12/17 17:56:00   Bucket[69]: Key=興大附農, DocCount=49
DEBUG 2025/12/17 17:56:00   Bucket[70]: Key=成大南工, DocCount=48
DEBUG 2025/12/17 17:56:00   Bucket[71]: Key=高餐大附中, DocCount=48
DEBUG 2025/12/17 17:56:00   Bucket[72]: Key=宜蘭高中, DocCount=46
DEBUG 2025/12/17 17:56:00   Bucket[73]: Key=屏東特教, DocCount=46
DEBUG 2025/12/17 17:56:00   Bucket[74]: Key=海大附中, DocCount=46
DEBUG 2025/12/17 17:56:00   Bucket[75]: Key=竹東高中, DocCount=46
DEBUG 2025/12/17 17:56:00   Bucket[76]: Key=羅東高工, DocCount=46
DEBUG 2025/12/17 17:56:00   Bucket[77]: Key=二林工商, DocCount=44
DEBUG 2025/12/17 17:56:00   Bucket[78]: Key=北斗家商, DocCount=44
DEBUG 2025/12/17 17:56:00   Bucket[79]: Key=永靖高工, DocCount=44
DEBUG 2025/12/17 17:56:00   Bucket[80]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 17:56:00   Bucket[81]: Key=臺東高商, DocCount=43
DEBUG 2025/12/17 17:56:00   Bucket[82]: Key=東石高中, DocCount=42
DEBUG 2025/12/17 17:56:00   Bucket[83]: Key=白河商工, DocCount=42
DEBUG 2025/12/17 17:56:00   Bucket[84]: Key=花蓮特教, DocCount=41
DEBUG 2025/12/17 17:56:00   Bucket[85]: Key=花蓮高中, DocCount=40
DEBUG 2025/12/17 17:56:00   Bucket[86]: Key=花蓮高工, DocCount=40
DEBUG 2025/12/17 17:56:00   Bucket[87]: Key=苗栗高中, DocCount=40
DEBUG 2025/12/17 17:56:00   Bucket[88]: Key=新豐高中, DocCount=38
DEBUG 2025/12/17 17:56:00   Bucket[89]: Key=暨大附中, DocCount=37
DEBUG 2025/12/17 17:56:00   Bucket[90]: Key=屏東高中, DocCount=36
DEBUG 2025/12/17 17:56:00   Bucket[91]: Key=潮州高中, DocCount=36
DEBUG 2025/12/17 17:56:00   Bucket[92]: Key=華南高商, DocCount=36
DEBUG 2025/12/17 17:56:00   Bucket[93]: Key=基隆商工, DocCount=35
DEBUG 2025/12/17 17:56:00   Bucket[94]: Key=旗山農工, DocCount=35
DEBUG 2025/12/17 17:56:00   Bucket[95]: Key=曾文農工, DocCount=33
DEBUG 2025/12/17 17:56:00   Bucket[96]: Key=秀水高工, DocCount=33
DEBUG 2025/12/17 17:56:00   Bucket[97]: Key=南大附小, DocCount=32
DEBUG 2025/12/17 17:56:00   Bucket[98]: Key=家齊高中, DocCount=32
DEBUG 2025/12/17 17:56:00   Bucket[99]: Key=北港農工, DocCount=31
DEBUG 2025/12/17 17:56:00 ========================================================
INFO 2025/12/17 17:56:03 ✅ Successfully flushed 21/21 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:56:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:56:07 Processing 15 offline devices
INFO 2025/12/17 17:56:07 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:56:07 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:56:07 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:56:07 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:56:07 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:56:07 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:56:07 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:56:07 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:56:07 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:56:07 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:56:07 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:56:07 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:56:07 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:56:07 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:56:07 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:56:07 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:56:07 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:56:07 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:56:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:56:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:56:07 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:56:07 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:56:07 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:56:07 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:56:07 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:56:07 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:56:07 Creating history record for offline device: 雲林特教
INFO 2025/12/17 17:56:07 About to add history to batch for device: 雲林特教
INFO 2025/12/17 17:56:07 Successfully added history record for offline device: 雲林特教
INFO 2025/12/17 17:56:07 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:56:07 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:56:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:56:08 ✅ Successfully flushed 27/27 history records to TimescaleDB
DEBUG 2025/12/17 17:56:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:56:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:56:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:56:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:56:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:56:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:56:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:56:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:56:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:56:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:56:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:56:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:56:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:56:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.63% (threshold: 80.00%)
DEBUG 2025/12/17 17:56:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.26% (threshold: 85.00%)
DEBUG 2025/12/17 17:56:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:56:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:56:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:56:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:56:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:56:47 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:56:47 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:56:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:57:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:57:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:57:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:57:00 Field: school_name.keyword
DEBUG 2025/12/17 17:57:00 Time From: 2025-12-17T17:56:00.000+08:00
DEBUG 2025/12/17 17:57:00 Time To: 2025-12-17T17:57:00.000+08:00
DEBUG 2025/12/17 17:57:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:56:00.000+08:00",
					"lte": "2025-12-17T17:57:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:57:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:57:00 ES Response IsError: false
DEBUG 2025/12/17 17:57:00 ES Response Body:
{"took":60,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":396,"buckets":[{"key":"黑快馬主機","doc_count":1048},{"key":"花蓮高農","doc_count":791},{"key":"仁愛高農","doc_count":601},{"key":"玉里高中","doc_count":566},{"key":"金門農工","doc_count":476},{"key":"新竹女中","doc_count":469},{"key":"金門高中","doc_count":369},{"key":"北門高中","doc_count":360},{"key":"南投高商","doc_count":347},{"key":"宜蘭高商","doc_count":296},{"key":"關西高中","doc_count":277},{"key":"蘇澳海事","doc_count":275},{"key":"竹北高中","doc_count":274},{"key":"華僑高中","doc_count":263},{"key":"斗六家商","doc_count":227},{"key":"中大壢中","doc_count":224},{"key":"政大附中","doc_count":224},{"key":"臺東高中","doc_count":209},{"key":"花蓮高商","doc_count":209},{"key":"內埔農工","doc_count":189},{"key":"旗美高中","doc_count":176},{"key":"竹南高中","doc_count":176},{"key":"彰師附工","doc_count":173},{"key":"興大附中","doc_count":173},{"key":"新化高工","doc_count":164},{"key":"新港藝高","doc_count":161},{"key":"苗栗農工","doc_count":161},{"key":"虎尾高中","doc_count":161},{"key":"清華附小","doc_count":160},{"key":"後壁高中","doc_count":150},{"key":"南投特教","doc_count":149},{"key":"草屯商工","doc_count":148},{"key":"師大附中高中部","doc_count":136},{"key":"北教大實小","doc_count":135},{"key":"東港海事","doc_count":131},{"key":"二林工商","doc_count":127},{"key":"關山工商","doc_count":127},{"key":"嘉義高商","doc_count":125},{"key":"員林家商","doc_count":122},{"key":"新竹高中","doc_count":121},{"key":"北港高中","doc_count":118},{"key":"新竹高工","doc_count":112},{"key":"屏東女中","doc_count":109},{"key":"新營高工","doc_count":109},{"key":"新竹高商","doc_count":103},{"key":"蘭陽女中","doc_count":102},{"key":"員林高中","doc_count":97},{"key":"竹山高中","doc_count":92},{"key":"員林農工","doc_count":88},{"key":"嘉義高中","doc_count":84},{"key":"水里商工","doc_count":82},{"key":"苗栗高商","doc_count":81},{"key":"成大南工","doc_count":74},{"key":"宜蘭高中","doc_count":73},{"key":"南大附聰","doc_count":72},{"key":"新化高中","doc_count":71},{"key":"屏科實中","doc_count":67},{"key":"華南高商","doc_count":67},{"key":"南投高中","doc_count":66},{"key":"臺南高商","doc_count":64},{"key":"新營高中","doc_count":63},{"key":"高餐大附中","doc_count":62},{"key":"善化高中","doc_count":60},{"key":"彰化高商","doc_count":56},{"key":"東石高中","doc_count":56},{"key":"土庫商工","doc_count":55},{"key":"屏東高工","doc_count":54},{"key":"竹東高中","doc_count":54},{"key":"北港農工","doc_count":53},{"key":"臺南一中","doc_count":52},{"key":"屏東特教","doc_count":51},{"key":"潮州高中","doc_count":50},{"key":"秀水高工","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"羅東高工","doc_count":49},{"key":"南大附小","doc_count":47},{"key":"屏北高中","doc_count":47},{"key":"屏東高中","doc_count":46},{"key":"南大附中","doc_count":45},{"key":"崇實高工","doc_count":45},{"key":"臺東高商","doc_count":45},{"key":"佳冬高農","doc_count":44},{"key":"嘉科實中","doc_count":44},{"key":"花蓮高中","doc_count":44},{"key":"師大附中國中部","doc_count":43},{"key":"海大附中","doc_count":42},{"key":"興大附農","doc_count":42},{"key":"新竹特教","doc_count":41},{"key":"雲林特教","doc_count":39},{"key":"北斗家商","doc_count":38},{"key":"玉井工商","doc_count":38},{"key":"白河商工","doc_count":38},{"key":"嘉義特教","doc_count":37},{"key":"埔里高工","doc_count":37},{"key":"澎湖海事","doc_count":35},{"key":"鳳山高中","doc_count":35},{"key":"基隆商工","doc_count":33},{"key":"新豐高中","doc_count":32},{"key":"旗山農工","doc_count":32},{"key":"苗栗高中","doc_count":31}]}}}
DEBUG 2025/12/17 17:57:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:57:00   Bucket[0]: Key=黑快馬主機, DocCount=1048
DEBUG 2025/12/17 17:57:00   Bucket[1]: Key=花蓮高農, DocCount=791
DEBUG 2025/12/17 17:57:00   Bucket[2]: Key=仁愛高農, DocCount=601
DEBUG 2025/12/17 17:57:00   Bucket[3]: Key=玉里高中, DocCount=566
DEBUG 2025/12/17 17:57:00   Bucket[4]: Key=金門農工, DocCount=476
DEBUG 2025/12/17 17:57:00   Bucket[5]: Key=新竹女中, DocCount=469
DEBUG 2025/12/17 17:57:00   Bucket[6]: Key=金門高中, DocCount=369
DEBUG 2025/12/17 17:57:00   Bucket[7]: Key=北門高中, DocCount=360
DEBUG 2025/12/17 17:57:00   Bucket[8]: Key=南投高商, DocCount=347
DEBUG 2025/12/17 17:57:00   Bucket[9]: Key=宜蘭高商, DocCount=296
DEBUG 2025/12/17 17:57:00   Bucket[10]: Key=關西高中, DocCount=277
DEBUG 2025/12/17 17:57:00   Bucket[11]: Key=蘇澳海事, DocCount=275
DEBUG 2025/12/17 17:57:00   Bucket[12]: Key=竹北高中, DocCount=274
DEBUG 2025/12/17 17:57:00   Bucket[13]: Key=華僑高中, DocCount=263
DEBUG 2025/12/17 17:57:00   Bucket[14]: Key=斗六家商, DocCount=227
DEBUG 2025/12/17 17:57:00   Bucket[15]: Key=中大壢中, DocCount=224
DEBUG 2025/12/17 17:57:00   Bucket[16]: Key=政大附中, DocCount=224
DEBUG 2025/12/17 17:57:00   Bucket[17]: Key=臺東高中, DocCount=209
DEBUG 2025/12/17 17:57:00   Bucket[18]: Key=花蓮高商, DocCount=209
DEBUG 2025/12/17 17:57:00   Bucket[19]: Key=內埔農工, DocCount=189
DEBUG 2025/12/17 17:57:00   Bucket[20]: Key=旗美高中, DocCount=176
DEBUG 2025/12/17 17:57:00   Bucket[21]: Key=竹南高中, DocCount=176
DEBUG 2025/12/17 17:57:00   Bucket[22]: Key=彰師附工, DocCount=173
DEBUG 2025/12/17 17:57:00   Bucket[23]: Key=興大附中, DocCount=173
DEBUG 2025/12/17 17:57:00   Bucket[24]: Key=新化高工, DocCount=164
DEBUG 2025/12/17 17:57:00   Bucket[25]: Key=新港藝高, DocCount=161
DEBUG 2025/12/17 17:57:00   Bucket[26]: Key=苗栗農工, DocCount=161
DEBUG 2025/12/17 17:57:00   Bucket[27]: Key=虎尾高中, DocCount=161
DEBUG 2025/12/17 17:57:00   Bucket[28]: Key=清華附小, DocCount=160
DEBUG 2025/12/17 17:57:00   Bucket[29]: Key=後壁高中, DocCount=150
DEBUG 2025/12/17 17:57:00   Bucket[30]: Key=南投特教, DocCount=149
DEBUG 2025/12/17 17:57:00   Bucket[31]: Key=草屯商工, DocCount=148
DEBUG 2025/12/17 17:57:00   Bucket[32]: Key=師大附中高中部, DocCount=136
DEBUG 2025/12/17 17:57:00   Bucket[33]: Key=北教大實小, DocCount=135
DEBUG 2025/12/17 17:57:00   Bucket[34]: Key=東港海事, DocCount=131
DEBUG 2025/12/17 17:57:00   Bucket[35]: Key=二林工商, DocCount=127
DEBUG 2025/12/17 17:57:00   Bucket[36]: Key=關山工商, DocCount=127
DEBUG 2025/12/17 17:57:00   Bucket[37]: Key=嘉義高商, DocCount=125
DEBUG 2025/12/17 17:57:00   Bucket[38]: Key=員林家商, DocCount=122
DEBUG 2025/12/17 17:57:00   Bucket[39]: Key=新竹高中, DocCount=121
DEBUG 2025/12/17 17:57:00   Bucket[40]: Key=北港高中, DocCount=118
DEBUG 2025/12/17 17:57:00   Bucket[41]: Key=新竹高工, DocCount=112
DEBUG 2025/12/17 17:57:00   Bucket[42]: Key=屏東女中, DocCount=109
DEBUG 2025/12/17 17:57:00   Bucket[43]: Key=新營高工, DocCount=109
DEBUG 2025/12/17 17:57:00   Bucket[44]: Key=新竹高商, DocCount=103
DEBUG 2025/12/17 17:57:00   Bucket[45]: Key=蘭陽女中, DocCount=102
DEBUG 2025/12/17 17:57:00   Bucket[46]: Key=員林高中, DocCount=97
DEBUG 2025/12/17 17:57:00   Bucket[47]: Key=竹山高中, DocCount=92
DEBUG 2025/12/17 17:57:00   Bucket[48]: Key=員林農工, DocCount=88
DEBUG 2025/12/17 17:57:00   Bucket[49]: Key=嘉義高中, DocCount=84
DEBUG 2025/12/17 17:57:00   Bucket[50]: Key=水里商工, DocCount=82
DEBUG 2025/12/17 17:57:00   Bucket[51]: Key=苗栗高商, DocCount=81
DEBUG 2025/12/17 17:57:00   Bucket[52]: Key=成大南工, DocCount=74
DEBUG 2025/12/17 17:57:00   Bucket[53]: Key=宜蘭高中, DocCount=73
DEBUG 2025/12/17 17:57:00   Bucket[54]: Key=南大附聰, DocCount=72
DEBUG 2025/12/17 17:57:00   Bucket[55]: Key=新化高中, DocCount=71
DEBUG 2025/12/17 17:57:00   Bucket[56]: Key=屏科實中, DocCount=67
DEBUG 2025/12/17 17:57:00   Bucket[57]: Key=華南高商, DocCount=67
DEBUG 2025/12/17 17:57:00   Bucket[58]: Key=南投高中, DocCount=66
DEBUG 2025/12/17 17:57:00   Bucket[59]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 17:57:00   Bucket[60]: Key=新營高中, DocCount=63
DEBUG 2025/12/17 17:57:00   Bucket[61]: Key=高餐大附中, DocCount=62
DEBUG 2025/12/17 17:57:00   Bucket[62]: Key=善化高中, DocCount=60
DEBUG 2025/12/17 17:57:00   Bucket[63]: Key=彰化高商, DocCount=56
DEBUG 2025/12/17 17:57:00   Bucket[64]: Key=東石高中, DocCount=56
DEBUG 2025/12/17 17:57:00   Bucket[65]: Key=土庫商工, DocCount=55
DEBUG 2025/12/17 17:57:00   Bucket[66]: Key=屏東高工, DocCount=54
DEBUG 2025/12/17 17:57:00   Bucket[67]: Key=竹東高中, DocCount=54
DEBUG 2025/12/17 17:57:00   Bucket[68]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:57:00   Bucket[69]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:57:00   Bucket[70]: Key=屏東特教, DocCount=51
DEBUG 2025/12/17 17:57:00   Bucket[71]: Key=潮州高中, DocCount=50
DEBUG 2025/12/17 17:57:00   Bucket[72]: Key=秀水高工, DocCount=50
DEBUG 2025/12/17 17:57:00   Bucket[73]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:57:00   Bucket[74]: Key=羅東高工, DocCount=49
DEBUG 2025/12/17 17:57:00   Bucket[75]: Key=南大附小, DocCount=47
DEBUG 2025/12/17 17:57:00   Bucket[76]: Key=屏北高中, DocCount=47
DEBUG 2025/12/17 17:57:00   Bucket[77]: Key=屏東高中, DocCount=46
DEBUG 2025/12/17 17:57:00   Bucket[78]: Key=南大附中, DocCount=45
DEBUG 2025/12/17 17:57:00   Bucket[79]: Key=崇實高工, DocCount=45
DEBUG 2025/12/17 17:57:00   Bucket[80]: Key=臺東高商, DocCount=45
DEBUG 2025/12/17 17:57:00   Bucket[81]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 17:57:00   Bucket[82]: Key=嘉科實中, DocCount=44
DEBUG 2025/12/17 17:57:00   Bucket[83]: Key=花蓮高中, DocCount=44
DEBUG 2025/12/17 17:57:00   Bucket[84]: Key=師大附中國中部, DocCount=43
DEBUG 2025/12/17 17:57:00   Bucket[85]: Key=海大附中, DocCount=42
DEBUG 2025/12/17 17:57:00   Bucket[86]: Key=興大附農, DocCount=42
DEBUG 2025/12/17 17:57:00   Bucket[87]: Key=新竹特教, DocCount=41
DEBUG 2025/12/17 17:57:00   Bucket[88]: Key=雲林特教, DocCount=39
DEBUG 2025/12/17 17:57:00   Bucket[89]: Key=北斗家商, DocCount=38
DEBUG 2025/12/17 17:57:00   Bucket[90]: Key=玉井工商, DocCount=38
DEBUG 2025/12/17 17:57:00   Bucket[91]: Key=白河商工, DocCount=38
DEBUG 2025/12/17 17:57:00   Bucket[92]: Key=嘉義特教, DocCount=37
DEBUG 2025/12/17 17:57:00   Bucket[93]: Key=埔里高工, DocCount=37
DEBUG 2025/12/17 17:57:00   Bucket[94]: Key=澎湖海事, DocCount=35
DEBUG 2025/12/17 17:57:00   Bucket[95]: Key=鳳山高中, DocCount=35
DEBUG 2025/12/17 17:57:00   Bucket[96]: Key=基隆商工, DocCount=33
DEBUG 2025/12/17 17:57:00   Bucket[97]: Key=新豐高中, DocCount=32
DEBUG 2025/12/17 17:57:00   Bucket[98]: Key=旗山農工, DocCount=32
DEBUG 2025/12/17 17:57:00   Bucket[99]: Key=苗栗高中, DocCount=31
DEBUG 2025/12/17 17:57:00 ========================================================
INFO 2025/12/17 17:57:03 ✅ Successfully flushed 21/21 history records to TimescaleDB
INFO 2025/12/17 17:57:08 ✅ Successfully flushed 46/46 history records to TimescaleDB
INFO 2025/12/17 17:57:13 ✅ Successfully flushed 32/32 history records to TimescaleDB
INFO 2025/12/17 17:57:13 Processing 15 offline devices
INFO 2025/12/17 17:57:13 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:57:13 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:57:13 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:57:13 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:57:13 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:57:13 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:57:13 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:57:13 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:57:13 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:57:13 Creating history record for offline device: 花蓮高工
INFO 2025/12/17 17:57:13 About to add history to batch for device: 花蓮高工
INFO 2025/12/17 17:57:13 Successfully added history record for offline device: 花蓮高工
INFO 2025/12/17 17:57:13 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:57:13 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:57:13 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:57:13 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:57:13 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:57:14 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:57:14 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:57:14 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:57:14 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:57:14 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:57:14 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:57:14 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:57:14 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:57:14 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:57:14 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:57:14 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:57:14 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:57:14 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:57:14 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:57:14 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:57:14 Creating history record for offline device: 中興高中
INFO 2025/12/17 17:57:14 About to add history to batch for device: 中興高中
INFO 2025/12/17 17:57:15 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 17:57:15 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:57:15 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:57:15 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:57:18 ✅ Successfully flushed 16/16 history records to TimescaleDB
DEBUG 2025/12/17 17:57:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:57:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:57:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:57:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:57:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:57:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:57:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 17:57:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:57:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:57:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:57:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:57:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:57:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:57:45 ES Alert Created [critical][performance]: Memory usage critical: 90.83% (threshold: 90.00%)
WARN 2025/12/17 17:57:45 ES Alert Created [high][capacity]: Disk usage high: 93.29% (threshold: 85.00%)
WARN 2025/12/17 17:57:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:57:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:57:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:57:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:57:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:57:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:57:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:58:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:58:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:58:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:58:00 Field: school_name.keyword
DEBUG 2025/12/17 17:58:00 Time From: 2025-12-17T17:57:00.000+08:00
DEBUG 2025/12/17 17:58:00 Time To: 2025-12-17T17:58:00.000+08:00
DEBUG 2025/12/17 17:58:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:57:00.000+08:00",
					"lte": "2025-12-17T17:58:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:58:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:58:00 ES Response IsError: false
DEBUG 2025/12/17 17:58:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":402,"buckets":[{"key":"黑快馬主機","doc_count":1051},{"key":"花蓮高農","doc_count":713},{"key":"仁愛高農","doc_count":515},{"key":"金門農工","doc_count":502},{"key":"竹北高中","doc_count":463},{"key":"新竹女中","doc_count":458},{"key":"北門高中","doc_count":399},{"key":"關西高中","doc_count":351},{"key":"蘇澳海事","doc_count":344},{"key":"金門高中","doc_count":337},{"key":"南投高商","doc_count":314},{"key":"宜蘭高商","doc_count":289},{"key":"華僑高中","doc_count":280},{"key":"臺東高中","doc_count":220},{"key":"內埔農工","doc_count":205},{"key":"玉里高中","doc_count":200},{"key":"旗美高中","doc_count":196},{"key":"新港藝高","doc_count":194},{"key":"花蓮高商","doc_count":183},{"key":"屏東女中","doc_count":181},{"key":"苗栗農工","doc_count":178},{"key":"斗六家商","doc_count":171},{"key":"新化高中","doc_count":169},{"key":"興大附中","doc_count":164},{"key":"清華附小","doc_count":161},{"key":"虎尾高中","doc_count":160},{"key":"後壁高中","doc_count":159},{"key":"中大壢中","doc_count":153},{"key":"關山工商","doc_count":142},{"key":"新營高工","doc_count":141},{"key":"嘉義高商","doc_count":139},{"key":"南投特教","doc_count":137},{"key":"政大附中","doc_count":136},{"key":"新化高工","doc_count":134},{"key":"南投高中","doc_count":124},{"key":"東港海事","doc_count":124},{"key":"中興高中","doc_count":119},{"key":"師大附中高中部","doc_count":116},{"key":"竹南高中","doc_count":106},{"key":"草屯商工","doc_count":105},{"key":"彰師附工","doc_count":100},{"key":"北教大實小","doc_count":97},{"key":"員林家商","doc_count":96},{"key":"屏東高中","doc_count":91},{"key":"埔里高工","doc_count":88},{"key":"竹山高中","doc_count":84},{"key":"新竹高中","doc_count":82},{"key":"苗栗高商","doc_count":81},{"key":"嘉義高中","doc_count":78},{"key":"北港高中","doc_count":75},{"key":"基隆商工","doc_count":75},{"key":"南大附聰","doc_count":71},{"key":"屏北高中","doc_count":68},{"key":"臺南高商","doc_count":66},{"key":"水里商工","doc_count":65},{"key":"屏東高工","doc_count":64},{"key":"新竹高工","doc_count":64},{"key":"興大附農","doc_count":64},{"key":"頭城家商","doc_count":64},{"key":"宜蘭高中","doc_count":62},{"key":"二林工商","doc_count":61},{"key":"家齊高中","doc_count":59},{"key":"屏科實中","doc_count":59},{"key":"佳冬高農","doc_count":58},{"key":"彰化高商","doc_count":57},{"key":"海大附中","doc_count":57},{"key":"新營高中","doc_count":55},{"key":"華南高商","doc_count":53},{"key":"臺南一中","doc_count":52},{"key":"新竹高商","doc_count":50},{"key":"花蓮高中","doc_count":49},{"key":"潮州高中","doc_count":47},{"key":"苗栗高中","doc_count":45},{"key":"員林高中","doc_count":44},{"key":"新豐高中","doc_count":44},{"key":"白河商工","doc_count":44},{"key":"屏東特教","doc_count":42},{"key":"羅東高工","doc_count":42},{"key":"花蓮高工","doc_count":42},{"key":"善化高中","doc_count":41},{"key":"師大附中國中部","doc_count":41},{"key":"永靖高工","doc_count":41},{"key":"基隆特教","doc_count":40},{"key":"花蓮特教","doc_count":40},{"key":"成大南工","doc_count":39},{"key":"雲林特教","doc_count":39},{"key":"北斗家商","doc_count":38},{"key":"土庫商工","doc_count":38},{"key":"崇實高工","doc_count":38},{"key":"玉井工商","doc_count":37},{"key":"秀水高工","doc_count":37},{"key":"東石高中","doc_count":36},{"key":"鳳山高中","doc_count":36},{"key":"員林農工","doc_count":34},{"key":"嘉義特教","doc_count":34},{"key":"嘉科實中","doc_count":32},{"key":"新竹特教","doc_count":31},{"key":"高餐大附中","doc_count":31},{"key":"嘉義高工","doc_count":30},{"key":"曾文農工","doc_count":30}]}}}
DEBUG 2025/12/17 17:58:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:58:00   Bucket[0]: Key=黑快馬主機, DocCount=1051
DEBUG 2025/12/17 17:58:00   Bucket[1]: Key=花蓮高農, DocCount=713
DEBUG 2025/12/17 17:58:00   Bucket[2]: Key=仁愛高農, DocCount=515
DEBUG 2025/12/17 17:58:00   Bucket[3]: Key=金門農工, DocCount=502
DEBUG 2025/12/17 17:58:00   Bucket[4]: Key=竹北高中, DocCount=463
DEBUG 2025/12/17 17:58:00   Bucket[5]: Key=新竹女中, DocCount=458
DEBUG 2025/12/17 17:58:00   Bucket[6]: Key=北門高中, DocCount=399
DEBUG 2025/12/17 17:58:00   Bucket[7]: Key=關西高中, DocCount=351
DEBUG 2025/12/17 17:58:00   Bucket[8]: Key=蘇澳海事, DocCount=344
DEBUG 2025/12/17 17:58:00   Bucket[9]: Key=金門高中, DocCount=337
DEBUG 2025/12/17 17:58:00   Bucket[10]: Key=南投高商, DocCount=314
DEBUG 2025/12/17 17:58:00   Bucket[11]: Key=宜蘭高商, DocCount=289
DEBUG 2025/12/17 17:58:00   Bucket[12]: Key=華僑高中, DocCount=280
DEBUG 2025/12/17 17:58:00   Bucket[13]: Key=臺東高中, DocCount=220
DEBUG 2025/12/17 17:58:00   Bucket[14]: Key=內埔農工, DocCount=205
DEBUG 2025/12/17 17:58:00   Bucket[15]: Key=玉里高中, DocCount=200
DEBUG 2025/12/17 17:58:00   Bucket[16]: Key=旗美高中, DocCount=196
DEBUG 2025/12/17 17:58:00   Bucket[17]: Key=新港藝高, DocCount=194
DEBUG 2025/12/17 17:58:00   Bucket[18]: Key=花蓮高商, DocCount=183
DEBUG 2025/12/17 17:58:00   Bucket[19]: Key=屏東女中, DocCount=181
DEBUG 2025/12/17 17:58:00   Bucket[20]: Key=苗栗農工, DocCount=178
DEBUG 2025/12/17 17:58:00   Bucket[21]: Key=斗六家商, DocCount=171
DEBUG 2025/12/17 17:58:00   Bucket[22]: Key=新化高中, DocCount=169
DEBUG 2025/12/17 17:58:00   Bucket[23]: Key=興大附中, DocCount=164
DEBUG 2025/12/17 17:58:00   Bucket[24]: Key=清華附小, DocCount=161
DEBUG 2025/12/17 17:58:00   Bucket[25]: Key=虎尾高中, DocCount=160
DEBUG 2025/12/17 17:58:00   Bucket[26]: Key=後壁高中, DocCount=159
DEBUG 2025/12/17 17:58:00   Bucket[27]: Key=中大壢中, DocCount=153
DEBUG 2025/12/17 17:58:00   Bucket[28]: Key=關山工商, DocCount=142
DEBUG 2025/12/17 17:58:00   Bucket[29]: Key=新營高工, DocCount=141
DEBUG 2025/12/17 17:58:00   Bucket[30]: Key=嘉義高商, DocCount=139
DEBUG 2025/12/17 17:58:00   Bucket[31]: Key=南投特教, DocCount=137
DEBUG 2025/12/17 17:58:00   Bucket[32]: Key=政大附中, DocCount=136
DEBUG 2025/12/17 17:58:00   Bucket[33]: Key=新化高工, DocCount=134
DEBUG 2025/12/17 17:58:00   Bucket[34]: Key=南投高中, DocCount=124
DEBUG 2025/12/17 17:58:00   Bucket[35]: Key=東港海事, DocCount=124
DEBUG 2025/12/17 17:58:00   Bucket[36]: Key=中興高中, DocCount=119
DEBUG 2025/12/17 17:58:00   Bucket[37]: Key=師大附中高中部, DocCount=116
DEBUG 2025/12/17 17:58:00   Bucket[38]: Key=竹南高中, DocCount=106
DEBUG 2025/12/17 17:58:00   Bucket[39]: Key=草屯商工, DocCount=105
DEBUG 2025/12/17 17:58:00   Bucket[40]: Key=彰師附工, DocCount=100
DEBUG 2025/12/17 17:58:00   Bucket[41]: Key=北教大實小, DocCount=97
DEBUG 2025/12/17 17:58:00   Bucket[42]: Key=員林家商, DocCount=96
DEBUG 2025/12/17 17:58:00   Bucket[43]: Key=屏東高中, DocCount=91
DEBUG 2025/12/17 17:58:00   Bucket[44]: Key=埔里高工, DocCount=88
DEBUG 2025/12/17 17:58:00   Bucket[45]: Key=竹山高中, DocCount=84
DEBUG 2025/12/17 17:58:00   Bucket[46]: Key=新竹高中, DocCount=82
DEBUG 2025/12/17 17:58:00   Bucket[47]: Key=苗栗高商, DocCount=81
DEBUG 2025/12/17 17:58:00   Bucket[48]: Key=嘉義高中, DocCount=78
DEBUG 2025/12/17 17:58:00   Bucket[49]: Key=北港高中, DocCount=75
DEBUG 2025/12/17 17:58:00   Bucket[50]: Key=基隆商工, DocCount=75
DEBUG 2025/12/17 17:58:00   Bucket[51]: Key=南大附聰, DocCount=71
DEBUG 2025/12/17 17:58:00   Bucket[52]: Key=屏北高中, DocCount=68
DEBUG 2025/12/17 17:58:00   Bucket[53]: Key=臺南高商, DocCount=66
DEBUG 2025/12/17 17:58:00   Bucket[54]: Key=水里商工, DocCount=65
DEBUG 2025/12/17 17:58:00   Bucket[55]: Key=屏東高工, DocCount=64
DEBUG 2025/12/17 17:58:00   Bucket[56]: Key=新竹高工, DocCount=64
DEBUG 2025/12/17 17:58:00   Bucket[57]: Key=興大附農, DocCount=64
DEBUG 2025/12/17 17:58:00   Bucket[58]: Key=頭城家商, DocCount=64
DEBUG 2025/12/17 17:58:00   Bucket[59]: Key=宜蘭高中, DocCount=62
DEBUG 2025/12/17 17:58:00   Bucket[60]: Key=二林工商, DocCount=61
DEBUG 2025/12/17 17:58:00   Bucket[61]: Key=家齊高中, DocCount=59
DEBUG 2025/12/17 17:58:00   Bucket[62]: Key=屏科實中, DocCount=59
DEBUG 2025/12/17 17:58:00   Bucket[63]: Key=佳冬高農, DocCount=58
DEBUG 2025/12/17 17:58:00   Bucket[64]: Key=彰化高商, DocCount=57
DEBUG 2025/12/17 17:58:00   Bucket[65]: Key=海大附中, DocCount=57
DEBUG 2025/12/17 17:58:00   Bucket[66]: Key=新營高中, DocCount=55
DEBUG 2025/12/17 17:58:00   Bucket[67]: Key=華南高商, DocCount=53
DEBUG 2025/12/17 17:58:00   Bucket[68]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:58:00   Bucket[69]: Key=新竹高商, DocCount=50
DEBUG 2025/12/17 17:58:00   Bucket[70]: Key=花蓮高中, DocCount=49
DEBUG 2025/12/17 17:58:00   Bucket[71]: Key=潮州高中, DocCount=47
DEBUG 2025/12/17 17:58:00   Bucket[72]: Key=苗栗高中, DocCount=45
DEBUG 2025/12/17 17:58:00   Bucket[73]: Key=員林高中, DocCount=44
DEBUG 2025/12/17 17:58:00   Bucket[74]: Key=新豐高中, DocCount=44
DEBUG 2025/12/17 17:58:00   Bucket[75]: Key=白河商工, DocCount=44
DEBUG 2025/12/17 17:58:00   Bucket[76]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:58:00   Bucket[77]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 17:58:00   Bucket[78]: Key=花蓮高工, DocCount=42
DEBUG 2025/12/17 17:58:00   Bucket[79]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:58:00   Bucket[80]: Key=師大附中國中部, DocCount=41
DEBUG 2025/12/17 17:58:00   Bucket[81]: Key=永靖高工, DocCount=41
DEBUG 2025/12/17 17:58:00   Bucket[82]: Key=基隆特教, DocCount=40
DEBUG 2025/12/17 17:58:00   Bucket[83]: Key=花蓮特教, DocCount=40
DEBUG 2025/12/17 17:58:00   Bucket[84]: Key=成大南工, DocCount=39
DEBUG 2025/12/17 17:58:00   Bucket[85]: Key=雲林特教, DocCount=39
DEBUG 2025/12/17 17:58:00   Bucket[86]: Key=北斗家商, DocCount=38
DEBUG 2025/12/17 17:58:00   Bucket[87]: Key=土庫商工, DocCount=38
DEBUG 2025/12/17 17:58:00   Bucket[88]: Key=崇實高工, DocCount=38
DEBUG 2025/12/17 17:58:00   Bucket[89]: Key=玉井工商, DocCount=37
DEBUG 2025/12/17 17:58:00   Bucket[90]: Key=秀水高工, DocCount=37
DEBUG 2025/12/17 17:58:00   Bucket[91]: Key=東石高中, DocCount=36
DEBUG 2025/12/17 17:58:00   Bucket[92]: Key=鳳山高中, DocCount=36
DEBUG 2025/12/17 17:58:00   Bucket[93]: Key=員林農工, DocCount=34
DEBUG 2025/12/17 17:58:00   Bucket[94]: Key=嘉義特教, DocCount=34
DEBUG 2025/12/17 17:58:00   Bucket[95]: Key=嘉科實中, DocCount=32
DEBUG 2025/12/17 17:58:00   Bucket[96]: Key=新竹特教, DocCount=31
DEBUG 2025/12/17 17:58:00   Bucket[97]: Key=高餐大附中, DocCount=31
DEBUG 2025/12/17 17:58:00   Bucket[98]: Key=嘉義高工, DocCount=30
DEBUG 2025/12/17 17:58:00   Bucket[99]: Key=曾文農工, DocCount=30
DEBUG 2025/12/17 17:58:00 ========================================================
INFO 2025/12/17 17:58:03 ✅ Successfully flushed 15/15 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:58:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:58:08 ✅ Successfully flushed 19/19 history records to TimescaleDB
INFO 2025/12/17 17:58:09 Processing 15 offline devices
INFO 2025/12/17 17:58:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:58:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:58:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:58:09 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:58:09 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:58:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:58:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:58:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:58:09 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:58:09 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:58:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:58:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:58:09 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:58:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:58:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:58:09 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:58:09 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:58:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:58:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:58:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:58:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:58:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:58:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:58:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:58:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:58:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:58:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:58:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:58:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:58:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:58:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:58:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:58:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:58:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:58:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:58:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 17:58:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:58:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:58:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:58:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.03% (threshold: 80.00%)
INFO 2025/12/17 17:58:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:58:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.32% (threshold: 85.00%)
DEBUG 2025/12/17 17:58:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:58:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:58:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:58:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:58:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:58:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:58:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:59:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:59:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:59:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:59:00 Field: school_name.keyword
DEBUG 2025/12/17 17:59:00 Time From: 2025-12-17T17:58:00.000+08:00
DEBUG 2025/12/17 17:59:00 Time To: 2025-12-17T17:59:00.000+08:00
DEBUG 2025/12/17 17:59:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:58:00.000+08:00",
					"lte": "2025-12-17T17:59:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:59:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:59:00 ES Response IsError: false
DEBUG 2025/12/17 17:59:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":475,"buckets":[{"key":"黑快馬主機","doc_count":1232},{"key":"花蓮高農","doc_count":774},{"key":"仁愛高農","doc_count":582},{"key":"金門農工","doc_count":489},{"key":"新竹女中","doc_count":453},{"key":"北門高中","doc_count":450},{"key":"金門高中","doc_count":406},{"key":"竹北高中","doc_count":393},{"key":"宜蘭高商","doc_count":374},{"key":"華僑高中","doc_count":322},{"key":"花蓮高商","doc_count":319},{"key":"南投高商","doc_count":318},{"key":"蘇澳海事","doc_count":296},{"key":"玉里高中","doc_count":291},{"key":"臺東高中","doc_count":275},{"key":"關西高中","doc_count":248},{"key":"新港藝高","doc_count":246},{"key":"竹南高中","doc_count":235},{"key":"草屯商工","doc_count":233},{"key":"內埔農工","doc_count":214},{"key":"斗六家商","doc_count":214},{"key":"新營高工","doc_count":203},{"key":"興大附中","doc_count":201},{"key":"新化高工","doc_count":182},{"key":"旗美高中","doc_count":182},{"key":"花蓮高中","doc_count":181},{"key":"南投特教","doc_count":180},{"key":"清華附小","doc_count":178},{"key":"苗栗農工","doc_count":177},{"key":"後壁高中","doc_count":169},{"key":"新化高中","doc_count":157},{"key":"虎尾高中","doc_count":156},{"key":"中大壢中","doc_count":151},{"key":"宜蘭高中","doc_count":146},{"key":"屏東女中","doc_count":125},{"key":"關山工商","doc_count":121},{"key":"員林家商","doc_count":115},{"key":"嘉義高商","doc_count":112},{"key":"東港海事","doc_count":107},{"key":"二林工商","doc_count":106},{"key":"北斗家商","doc_count":101},{"key":"竹山高中","doc_count":99},{"key":"員林高中","doc_count":98},{"key":"新竹高工","doc_count":90},{"key":"北教大實小","doc_count":87},{"key":"成大南工","doc_count":85},{"key":"師大附中高中部","doc_count":84},{"key":"臺東女中","doc_count":84},{"key":"屏東高中","doc_count":77},{"key":"南大附聰","doc_count":76},{"key":"彰師附工","doc_count":76},{"key":"苗栗高中","doc_count":75},{"key":"暨大附中","doc_count":74},{"key":"秀水高工","doc_count":74},{"key":"屏北高中","doc_count":71},{"key":"屏科實中","doc_count":71},{"key":"海大附中","doc_count":69},{"key":"土庫商工","doc_count":67},{"key":"中興高中","doc_count":66},{"key":"旗山農工","doc_count":66},{"key":"臺南高商","doc_count":65},{"key":"南大附中","doc_count":64},{"key":"埔里高工","doc_count":64},{"key":"基隆商工","doc_count":64},{"key":"彰化高商","doc_count":63},{"key":"員林農工","doc_count":62},{"key":"新竹高商","doc_count":62},{"key":"水里商工","doc_count":61},{"key":"花蓮高工","doc_count":61},{"key":"北港高中","doc_count":60},{"key":"蘭陽女中","doc_count":58},{"key":"南大附小","doc_count":56},{"key":"苗栗高商","doc_count":56},{"key":"嘉義高中","doc_count":55},{"key":"華南高商","doc_count":52},{"key":"新營高中","doc_count":51},{"key":"東石高中","doc_count":51},{"key":"師大附中國中部","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"新竹高中","doc_count":49},{"key":"澎湖海事","doc_count":49},{"key":"新豐高中","doc_count":48},{"key":"白河商工","doc_count":48},{"key":"羅東高商","doc_count":48},{"key":"臺東高商","doc_count":48},{"key":"南投高中","doc_count":47},{"key":"曾文農工","doc_count":47},{"key":"崇實高工","doc_count":44},{"key":"臺南一中","doc_count":43},{"key":"屏東高工","doc_count":42},{"key":"雲林特教","doc_count":41},{"key":"溪湖高中","doc_count":40},{"key":"玉井工商","doc_count":40},{"key":"羅東高工","doc_count":40},{"key":"家齊高中","doc_count":39},{"key":"興大附農","doc_count":38},{"key":"高餐大附中","doc_count":38},{"key":"鳳山高中","doc_count":38},{"key":"屏東特教","doc_count":37},{"key":"嘉義特教","doc_count":36}]}}}
DEBUG 2025/12/17 17:59:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:59:00   Bucket[0]: Key=黑快馬主機, DocCount=1232
DEBUG 2025/12/17 17:59:00   Bucket[1]: Key=花蓮高農, DocCount=774
DEBUG 2025/12/17 17:59:00   Bucket[2]: Key=仁愛高農, DocCount=582
DEBUG 2025/12/17 17:59:00   Bucket[3]: Key=金門農工, DocCount=489
DEBUG 2025/12/17 17:59:00   Bucket[4]: Key=新竹女中, DocCount=453
DEBUG 2025/12/17 17:59:00   Bucket[5]: Key=北門高中, DocCount=450
DEBUG 2025/12/17 17:59:00   Bucket[6]: Key=金門高中, DocCount=406
DEBUG 2025/12/17 17:59:00   Bucket[7]: Key=竹北高中, DocCount=393
DEBUG 2025/12/17 17:59:00   Bucket[8]: Key=宜蘭高商, DocCount=374
DEBUG 2025/12/17 17:59:00   Bucket[9]: Key=華僑高中, DocCount=322
DEBUG 2025/12/17 17:59:00   Bucket[10]: Key=花蓮高商, DocCount=319
DEBUG 2025/12/17 17:59:00   Bucket[11]: Key=南投高商, DocCount=318
DEBUG 2025/12/17 17:59:00   Bucket[12]: Key=蘇澳海事, DocCount=296
DEBUG 2025/12/17 17:59:00   Bucket[13]: Key=玉里高中, DocCount=291
DEBUG 2025/12/17 17:59:00   Bucket[14]: Key=臺東高中, DocCount=275
DEBUG 2025/12/17 17:59:00   Bucket[15]: Key=關西高中, DocCount=248
DEBUG 2025/12/17 17:59:00   Bucket[16]: Key=新港藝高, DocCount=246
DEBUG 2025/12/17 17:59:00   Bucket[17]: Key=竹南高中, DocCount=235
DEBUG 2025/12/17 17:59:00   Bucket[18]: Key=草屯商工, DocCount=233
DEBUG 2025/12/17 17:59:00   Bucket[19]: Key=內埔農工, DocCount=214
DEBUG 2025/12/17 17:59:00   Bucket[20]: Key=斗六家商, DocCount=214
DEBUG 2025/12/17 17:59:00   Bucket[21]: Key=新營高工, DocCount=203
DEBUG 2025/12/17 17:59:00   Bucket[22]: Key=興大附中, DocCount=201
DEBUG 2025/12/17 17:59:00   Bucket[23]: Key=新化高工, DocCount=182
DEBUG 2025/12/17 17:59:00   Bucket[24]: Key=旗美高中, DocCount=182
DEBUG 2025/12/17 17:59:00   Bucket[25]: Key=花蓮高中, DocCount=181
DEBUG 2025/12/17 17:59:00   Bucket[26]: Key=南投特教, DocCount=180
DEBUG 2025/12/17 17:59:00   Bucket[27]: Key=清華附小, DocCount=178
DEBUG 2025/12/17 17:59:00   Bucket[28]: Key=苗栗農工, DocCount=177
DEBUG 2025/12/17 17:59:00   Bucket[29]: Key=後壁高中, DocCount=169
DEBUG 2025/12/17 17:59:00   Bucket[30]: Key=新化高中, DocCount=157
DEBUG 2025/12/17 17:59:00   Bucket[31]: Key=虎尾高中, DocCount=156
DEBUG 2025/12/17 17:59:00   Bucket[32]: Key=中大壢中, DocCount=151
DEBUG 2025/12/17 17:59:00   Bucket[33]: Key=宜蘭高中, DocCount=146
DEBUG 2025/12/17 17:59:00   Bucket[34]: Key=屏東女中, DocCount=125
DEBUG 2025/12/17 17:59:00   Bucket[35]: Key=關山工商, DocCount=121
DEBUG 2025/12/17 17:59:00   Bucket[36]: Key=員林家商, DocCount=115
DEBUG 2025/12/17 17:59:00   Bucket[37]: Key=嘉義高商, DocCount=112
DEBUG 2025/12/17 17:59:00   Bucket[38]: Key=東港海事, DocCount=107
DEBUG 2025/12/17 17:59:00   Bucket[39]: Key=二林工商, DocCount=106
DEBUG 2025/12/17 17:59:00   Bucket[40]: Key=北斗家商, DocCount=101
DEBUG 2025/12/17 17:59:00   Bucket[41]: Key=竹山高中, DocCount=99
DEBUG 2025/12/17 17:59:00   Bucket[42]: Key=員林高中, DocCount=98
DEBUG 2025/12/17 17:59:00   Bucket[43]: Key=新竹高工, DocCount=90
DEBUG 2025/12/17 17:59:00   Bucket[44]: Key=北教大實小, DocCount=87
DEBUG 2025/12/17 17:59:00   Bucket[45]: Key=成大南工, DocCount=85
DEBUG 2025/12/17 17:59:00   Bucket[46]: Key=師大附中高中部, DocCount=84
DEBUG 2025/12/17 17:59:00   Bucket[47]: Key=臺東女中, DocCount=84
DEBUG 2025/12/17 17:59:00   Bucket[48]: Key=屏東高中, DocCount=77
DEBUG 2025/12/17 17:59:00   Bucket[49]: Key=南大附聰, DocCount=76
DEBUG 2025/12/17 17:59:00   Bucket[50]: Key=彰師附工, DocCount=76
DEBUG 2025/12/17 17:59:00   Bucket[51]: Key=苗栗高中, DocCount=75
DEBUG 2025/12/17 17:59:00   Bucket[52]: Key=暨大附中, DocCount=74
DEBUG 2025/12/17 17:59:00   Bucket[53]: Key=秀水高工, DocCount=74
DEBUG 2025/12/17 17:59:00   Bucket[54]: Key=屏北高中, DocCount=71
DEBUG 2025/12/17 17:59:00   Bucket[55]: Key=屏科實中, DocCount=71
DEBUG 2025/12/17 17:59:00   Bucket[56]: Key=海大附中, DocCount=69
DEBUG 2025/12/17 17:59:00   Bucket[57]: Key=土庫商工, DocCount=67
DEBUG 2025/12/17 17:59:00   Bucket[58]: Key=中興高中, DocCount=66
DEBUG 2025/12/17 17:59:00   Bucket[59]: Key=旗山農工, DocCount=66
DEBUG 2025/12/17 17:59:00   Bucket[60]: Key=臺南高商, DocCount=65
DEBUG 2025/12/17 17:59:00   Bucket[61]: Key=南大附中, DocCount=64
DEBUG 2025/12/17 17:59:00   Bucket[62]: Key=埔里高工, DocCount=64
DEBUG 2025/12/17 17:59:00   Bucket[63]: Key=基隆商工, DocCount=64
DEBUG 2025/12/17 17:59:00   Bucket[64]: Key=彰化高商, DocCount=63
DEBUG 2025/12/17 17:59:00   Bucket[65]: Key=員林農工, DocCount=62
DEBUG 2025/12/17 17:59:00   Bucket[66]: Key=新竹高商, DocCount=62
DEBUG 2025/12/17 17:59:00   Bucket[67]: Key=水里商工, DocCount=61
DEBUG 2025/12/17 17:59:00   Bucket[68]: Key=花蓮高工, DocCount=61
DEBUG 2025/12/17 17:59:00   Bucket[69]: Key=北港高中, DocCount=60
DEBUG 2025/12/17 17:59:00   Bucket[70]: Key=蘭陽女中, DocCount=58
DEBUG 2025/12/17 17:59:00   Bucket[71]: Key=南大附小, DocCount=56
DEBUG 2025/12/17 17:59:00   Bucket[72]: Key=苗栗高商, DocCount=56
DEBUG 2025/12/17 17:59:00   Bucket[73]: Key=嘉義高中, DocCount=55
DEBUG 2025/12/17 17:59:00   Bucket[74]: Key=華南高商, DocCount=52
DEBUG 2025/12/17 17:59:00   Bucket[75]: Key=新營高中, DocCount=51
DEBUG 2025/12/17 17:59:00   Bucket[76]: Key=東石高中, DocCount=51
DEBUG 2025/12/17 17:59:00   Bucket[77]: Key=師大附中國中部, DocCount=50
DEBUG 2025/12/17 17:59:00   Bucket[78]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:59:00   Bucket[79]: Key=新竹高中, DocCount=49
DEBUG 2025/12/17 17:59:00   Bucket[80]: Key=澎湖海事, DocCount=49
DEBUG 2025/12/17 17:59:00   Bucket[81]: Key=新豐高中, DocCount=48
DEBUG 2025/12/17 17:59:00   Bucket[82]: Key=白河商工, DocCount=48
DEBUG 2025/12/17 17:59:00   Bucket[83]: Key=羅東高商, DocCount=48
DEBUG 2025/12/17 17:59:00   Bucket[84]: Key=臺東高商, DocCount=48
DEBUG 2025/12/17 17:59:00   Bucket[85]: Key=南投高中, DocCount=47
DEBUG 2025/12/17 17:59:00   Bucket[86]: Key=曾文農工, DocCount=47
DEBUG 2025/12/17 17:59:00   Bucket[87]: Key=崇實高工, DocCount=44
DEBUG 2025/12/17 17:59:00   Bucket[88]: Key=臺南一中, DocCount=43
DEBUG 2025/12/17 17:59:00   Bucket[89]: Key=屏東高工, DocCount=42
DEBUG 2025/12/17 17:59:00   Bucket[90]: Key=雲林特教, DocCount=41
DEBUG 2025/12/17 17:59:00   Bucket[91]: Key=溪湖高中, DocCount=40
DEBUG 2025/12/17 17:59:00   Bucket[92]: Key=玉井工商, DocCount=40
DEBUG 2025/12/17 17:59:00   Bucket[93]: Key=羅東高工, DocCount=40
DEBUG 2025/12/17 17:59:00   Bucket[94]: Key=家齊高中, DocCount=39
DEBUG 2025/12/17 17:59:00   Bucket[95]: Key=興大附農, DocCount=38
DEBUG 2025/12/17 17:59:00   Bucket[96]: Key=高餐大附中, DocCount=38
DEBUG 2025/12/17 17:59:00   Bucket[97]: Key=鳳山高中, DocCount=38
DEBUG 2025/12/17 17:59:00   Bucket[98]: Key=屏東特教, DocCount=37
DEBUG 2025/12/17 17:59:00   Bucket[99]: Key=嘉義特教, DocCount=36
DEBUG 2025/12/17 17:59:00 ========================================================
INFO 2025/12/17 17:59:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:59:07 ✅ Successfully flushed 50/54 history records to TimescaleDB
INFO 2025/12/17 17:59:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:59:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:59:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:59:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:59:08 ✅ Successfully flushed 19/19 history records to TimescaleDB
INFO 2025/12/17 17:59:09 Processing 15 offline devices
INFO 2025/12/17 17:59:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:59:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:59:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:59:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:59:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:59:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:59:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:59:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:59:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:59:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:59:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:59:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:59:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:59:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:59:09 Creating history record for offline device: 潮州高中
INFO 2025/12/17 17:59:09 About to add history to batch for device: 潮州高中
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 17:59:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:59:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:59:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:59:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:59:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:59:10 Creating history record for offline device: 嘉科實中
INFO 2025/12/17 17:59:10 About to add history to batch for device: 嘉科實中
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 嘉科實中
INFO 2025/12/17 17:59:10 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:59:10 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:59:10 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:59:10 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:59:10 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:59:10 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:59:10 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:59:10 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:59:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:59:13 ✅ Successfully flushed 33/33 history records to TimescaleDB
DEBUG 2025/12/17 17:59:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:59:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:59:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:59:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:59:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:59:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:59:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:59:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:59:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:59:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:59:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:59:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:59:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:59:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:00:03 Failed to check duplicate alert: read tcp 192.168.68.65:61883->10.99.1.213:5432: read: can't assign requested address
ERROR 2025/12/17 18:00:06 Failed to begin ES transaction: read tcp 192.168.68.65:61617->10.99.1.213:5432: read: can't assign requested address
ERROR 2025/12/17 18:00:21 Failed to create ES alert: read tcp 192.168.68.65:54365->10.99.1.213:5432: read: can't assign requested address
INFO 2025/12/17 18:00:21 ES monitor check completed for: NTU, status: warning
ERROR 2025/12/17 18:00:24 Failed to begin ES transaction: read tcp 192.168.68.65:61614->10.99.1.213:5432: read: can't assign requested address
INFO 2025/12/17 18:00:24 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:00:24 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:00:24 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:00:24 ES monitor check completed for: bimap123, status: offline
ERROR 2025/12/17 18:00:25 Failed to get ES client for index 1: failed to load index 1: invalid connection
WARNING 2025/12/17 18:00:25 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:00:25 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:00:25 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:00:25 Field: school_name.keyword
DEBUG 2025/12/17 18:00:25 Time From: 2025-12-17T17:59:00.000+08:00
DEBUG 2025/12/17 18:00:25 Time To: 2025-12-17T18:00:00.000+08:00
DEBUG 2025/12/17 18:00:25 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:59:00.000+08:00",
					"lte": "2025-12-17T18:00:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:00:42 Failed to begin ES transaction: read tcp 192.168.68.65:61615->10.99.1.213:5432: read: can't assign requested address
DEBUG 2025/12/17 18:00:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:00:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:00:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:00:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:00:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:00:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:00:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:00:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:00:45 Starting ES monitor check for: 93
INFO 2025/12/17 18:00:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:00:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:00:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:00:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:00:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:01:00 Failed to begin ES transaction: read tcp 192.168.68.65:56395->10.99.1.213:5432: read: can't assign requested address
ERROR 2025/12/17 18:01:18 Failed to begin ES transaction: read tcp 192.168.68.65:61616->10.99.1.213:5432: read: can't assign requested address
INFO 2025/12/17 18:01:18 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:01:18 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:01:18 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:01:18 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:01:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:01:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:01:45 Starting ES monitor check for: 93
INFO 2025/12/17 18:01:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:01:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:01:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:01:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:01:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:01:45 Starting ES monitor check for: 213
INFO 2025/12/17 18:01:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:01:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:01:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:02:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:02:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:02:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:02:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:02:15 Field: school_name.keyword
DEBUG 2025/12/17 18:02:15 Time From: 2025-12-17T18:00:00.000+08:00
DEBUG 2025/12/17 18:02:15 Time To: 2025-12-17T18:01:00.000+08:00
DEBUG 2025/12/17 18:02:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:00:00.000+08:00",
					"lte": "2025-12-17T18:01:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:02:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:02:33 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:03:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:03:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:03:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:03:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:03:15 Field: school_name.keyword
DEBUG 2025/12/17 18:03:15 Time From: 2025-12-17T18:01:00.000+08:00
DEBUG 2025/12/17 18:03:15 Time To: 2025-12-17T18:02:00.000+08:00
DEBUG 2025/12/17 18:03:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:01:00.000+08:00",
					"lte": "2025-12-17T18:02:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:03:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:03:48 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:03:48 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:03:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:03:48 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:03:48 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:03:48 Starting ES monitor check for: bimap123
INFO 2025/12/17 18:03:48 Starting ES monitor check for: 93
INFO 2025/12/17 18:03:48 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:03:48 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:03:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:03:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:03:48 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:03:48 Starting ES monitor check for: ncku
INFO 2025/12/17 18:03:48 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:03:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:03:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:03:48 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:03:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:03:48 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:03:48 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:03:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 18:03:49 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:04:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:04:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:04:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:04:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:04:15 Field: school_name.keyword
DEBUG 2025/12/17 18:04:15 Time From: 2025-12-17T18:02:00.000+08:00
DEBUG 2025/12/17 18:04:15 Time To: 2025-12-17T18:03:00.000+08:00
DEBUG 2025/12/17 18:04:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:02:00.000+08:00",
					"lte": "2025-12-17T18:03:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:04:39 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:05:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:05:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:05:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:05:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:05:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:05:15 Field: school_name.keyword
DEBUG 2025/12/17 18:05:15 Time From: 2025-12-17T18:03:00.000+08:00
DEBUG 2025/12/17 18:05:15 Time To: 2025-12-17T18:04:00.000+08:00
DEBUG 2025/12/17 18:05:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:03:00.000+08:00",
					"lte": "2025-12-17T18:04:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:05:54 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:05:54 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:05:54 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:06:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:06:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:06:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:06:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:06:15 Field: school_name.keyword
DEBUG 2025/12/17 18:06:15 Time From: 2025-12-17T18:04:00.000+08:00
DEBUG 2025/12/17 18:06:15 Time To: 2025-12-17T18:05:00.000+08:00
DEBUG 2025/12/17 18:06:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:04:00.000+08:00",
					"lte": "2025-12-17T18:05:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:06:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:06:18 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:06:18 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:06:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:06:18 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:06:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:06:18 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:06:18 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:06:18 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:06:18 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:06:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:06:18 Starting ES monitor check for: 93
INFO 2025/12/17 18:06:18 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:06:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:06:18 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:06:18 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:06:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 18:07:09 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:07:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:07:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:07:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:07:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:07:15 Field: school_name.keyword
DEBUG 2025/12/17 18:07:15 Time From: 2025-12-17T18:05:00.000+08:00
DEBUG 2025/12/17 18:07:15 Time To: 2025-12-17T18:06:00.000+08:00
DEBUG 2025/12/17 18:07:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:05:00.000+08:00",
					"lte": "2025-12-17T18:06:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:07:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:07:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:07:33 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:08:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:08:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:08:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:08:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:08:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:08:15 Field: school_name.keyword
DEBUG 2025/12/17 18:08:15 Time From: 2025-12-17T18:06:00.000+08:00
DEBUG 2025/12/17 18:08:15 Time To: 2025-12-17T18:07:00.000+08:00
DEBUG 2025/12/17 18:08:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:06:00.000+08:00",
					"lte": "2025-12-17T18:07:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:08:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:08:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:08:48 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:08:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:08:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:08:48 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:08:48 Starting ES monitor check for: NTU
INFO 2025/12/17 18:08:48 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:08:48 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:08:48 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:08:48 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:08:48 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:08:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:08:48 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:08:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 18:08:48 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:08:48 Starting ES monitor check for: bimap123
INFO 2025/12/17 18:08:48 Starting ES monitor check for: ncku
INFO 2025/12/17 18:08:48 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:08:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:08:48 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:08:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:08:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:08:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:08:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:09:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:09:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:09:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:09:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:09:15 Field: school_name.keyword
DEBUG 2025/12/17 18:09:15 Time From: 2025-12-17T18:07:00.000+08:00
DEBUG 2025/12/17 18:09:15 Time To: 2025-12-17T18:08:00.000+08:00
DEBUG 2025/12/17 18:09:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:07:00.000+08:00",
					"lte": "2025-12-17T18:08:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:09:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:09:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:09:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:09:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:10:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:10:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:10:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:10:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:10:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:10:15 Field: school_name.keyword
DEBUG 2025/12/17 18:10:15 Time From: 2025-12-17T18:08:00.000+08:00
DEBUG 2025/12/17 18:10:15 Time To: 2025-12-17T18:09:00.000+08:00
DEBUG 2025/12/17 18:10:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:08:00.000+08:00",
					"lte": "2025-12-17T18:09:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:10:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:10:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:10:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:10:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:10:45 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:11:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:11:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:11:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:11:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:11:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:11:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:11:15 Field: school_name.keyword
DEBUG 2025/12/17 18:11:15 Time From: 2025-12-17T18:09:00.000+08:00
DEBUG 2025/12/17 18:11:15 Time To: 2025-12-17T18:10:00.000+08:00
DEBUG 2025/12/17 18:11:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:09:00.000+08:00",
					"lte": "2025-12-17T18:10:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:11:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:11:18 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:11:18 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:11:18 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:11:18 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:11:18 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:11:18 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:11:18 Starting ES monitor check for: 213
INFO 2025/12/17 18:11:18 Starting ES monitor check for: ncku
INFO 2025/12/17 18:11:18 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:11:18 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:11:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:11:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:11:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:11:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:11:18 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:11:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
ERROR 2025/12/17 18:11:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:11:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:11:31 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:11:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:12:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:12:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:12:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:12:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:12:15 Field: school_name.keyword
DEBUG 2025/12/17 18:12:15 Time From: 2025-12-17T18:10:00.000+08:00
DEBUG 2025/12/17 18:12:15 Time To: 2025-12-17T18:11:00.000+08:00
DEBUG 2025/12/17 18:12:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:10:00.000+08:00",
					"lte": "2025-12-17T18:11:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:12:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:12:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:12:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:12:33 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:12:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:12:46 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:13:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:13:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:13:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:13:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:13:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:13:15 Field: school_name.keyword
DEBUG 2025/12/17 18:13:15 Time From: 2025-12-17T18:11:00.000+08:00
DEBUG 2025/12/17 18:13:15 Time To: 2025-12-17T18:12:00.000+08:00
DEBUG 2025/12/17 18:13:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:11:00.000+08:00",
					"lte": "2025-12-17T18:12:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:13:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:13:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:13:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:13:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:13:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:13:48 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:13:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:13:48 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:13:48 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:13:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:13:48 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:13:48 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:13:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:13:48 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:13:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:13:48 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:13:48 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:13:48 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:13:48 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:13:48 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:13:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:13:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:13:48 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:13:48 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:13:48 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:13:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:13:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:14:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:14:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:14:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:14:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:14:15 Field: school_name.keyword
DEBUG 2025/12/17 18:14:15 Time From: 2025-12-17T18:12:00.000+08:00
DEBUG 2025/12/17 18:14:15 Time To: 2025-12-17T18:13:00.000+08:00
DEBUG 2025/12/17 18:14:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:12:00.000+08:00",
					"lte": "2025-12-17T18:13:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:14:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:14:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:14:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:14:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:15:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:15:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:15:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:15:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:15:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:15:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:15:15 Field: school_name.keyword
DEBUG 2025/12/17 18:15:15 Time From: 2025-12-17T18:13:00.000+08:00
DEBUG 2025/12/17 18:15:15 Time To: 2025-12-17T18:14:00.000+08:00
DEBUG 2025/12/17 18:15:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:13:00.000+08:00",
					"lte": "2025-12-17T18:14:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:15:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:15:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:15:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:15:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:16:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:16:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:16:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:16:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:16:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:16:15 Field: school_name.keyword
DEBUG 2025/12/17 18:16:15 Time From: 2025-12-17T18:14:00.000+08:00
DEBUG 2025/12/17 18:16:15 Time To: 2025-12-17T18:15:00.000+08:00
DEBUG 2025/12/17 18:16:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:14:00.000+08:00",
					"lte": "2025-12-17T18:15:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:16:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:16:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:16:18 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:16:18 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:16:18 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:16:18 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:16:18 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:16:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:16:18 Starting ES monitor check for: ncku
INFO 2025/12/17 18:16:18 Starting ES monitor check for: 213
INFO 2025/12/17 18:16:18 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:16:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:16:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:16:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:16:18 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:16:18 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:16:18 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:16:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
ERROR 2025/12/17 18:16:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:16:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:16:35 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:16:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:17:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:17:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:17:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:17:15 Field: school_name.keyword
DEBUG 2025/12/17 18:17:15 Time From: 2025-12-17T18:15:00.000+08:00
DEBUG 2025/12/17 18:17:15 Time To: 2025-12-17T18:16:00.000+08:00
DEBUG 2025/12/17 18:17:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:15:00.000+08:00",
					"lte": "2025-12-17T18:16:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:17:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:33 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:17:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:17:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:50 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:17:50 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:18:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:18:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:18:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
WARNING 2025/12/17 18:18:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:18:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:18:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:18:15 Field: school_name.keyword
DEBUG 2025/12/17 18:18:15 Time From: 2025-12-17T18:16:00.000+08:00
DEBUG 2025/12/17 18:18:15 Time To: 2025-12-17T18:17:00.000+08:00
DEBUG 2025/12/17 18:18:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:16:00.000+08:00",
					"lte": "2025-12-17T18:17:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:18:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:18:48 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:18:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:18:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:18:48 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:18:48 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:18:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:18:48 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:18:48 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:18:48 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:18:48 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:18:48 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:18:48 Starting ES monitor check for: 93
INFO 2025/12/17 18:18:48 Starting ES monitor check for: ncku
INFO 2025/12/17 18:18:48 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:18:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:18:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:18:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:18:48 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:18:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:18:48 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:18:48 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:18:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:18:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:19:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:19:05 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:19:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:19:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:19:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:19:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:19:15 Field: school_name.keyword
DEBUG 2025/12/17 18:19:15 Time From: 2025-12-17T18:17:00.000+08:00
DEBUG 2025/12/17 18:19:15 Time To: 2025-12-17T18:18:00.000+08:00
DEBUG 2025/12/17 18:19:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:17:00.000+08:00",
					"lte": "2025-12-17T18:18:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:19:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:19:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:19:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:19:57 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:20:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:20:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:20:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:20:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:20:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:20:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:20:15 Field: school_name.keyword
DEBUG 2025/12/17 18:20:15 Time From: 2025-12-17T18:18:00.000+08:00
DEBUG 2025/12/17 18:20:15 Time To: 2025-12-17T18:19:00.000+08:00
DEBUG 2025/12/17 18:20:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:18:00.000+08:00",
					"lte": "2025-12-17T18:19:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:20:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:20:20 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:20:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:20:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:20:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:21:12 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:21:12 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:21:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:21:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:21:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:21:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:21:15 Field: school_name.keyword
DEBUG 2025/12/17 18:21:15 Time From: 2025-12-17T18:19:00.000+08:00
DEBUG 2025/12/17 18:21:15 Time To: 2025-12-17T18:20:00.000+08:00
DEBUG 2025/12/17 18:21:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:19:00.000+08:00",
					"lte": "2025-12-17T18:20:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:21:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:21:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:21:18 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:21:18 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:21:18 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:21:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:21:18 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:21:18 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:21:18 Starting ES monitor check for: bimap123
INFO 2025/12/17 18:21:18 Starting ES monitor check for: 93
INFO 2025/12/17 18:21:18 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:21:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:21:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:21:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:21:18 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:21:18 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:21:18 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:21:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 18:21:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:21:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:21:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:22:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:22:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:22:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:22:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:22:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:22:15 Field: school_name.keyword
DEBUG 2025/12/17 18:22:15 Time From: 2025-12-17T18:20:00.000+08:00
DEBUG 2025/12/17 18:22:15 Time To: 2025-12-17T18:21:00.000+08:00
DEBUG 2025/12/17 18:22:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:20:00.000+08:00",
					"lte": "2025-12-17T18:21:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:22:27 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:22:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:22:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:22:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:22:33 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:22:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:23:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:23:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:23:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:23:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:23:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:23:15 Field: school_name.keyword
DEBUG 2025/12/17 18:23:15 Time From: 2025-12-17T18:21:00.000+08:00
DEBUG 2025/12/17 18:23:15 Time To: 2025-12-17T18:22:00.000+08:00
DEBUG 2025/12/17 18:23:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:21:00.000+08:00",
					"lte": "2025-12-17T18:22:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:23:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:23:42 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:23:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:23:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:23:48 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:23:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:23:48 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:23:48 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:23:48 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:23:48 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:23:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:23:48 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:23:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:23:48 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:24:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:24:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:24:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:24:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:24:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:24:15 Field: school_name.keyword
DEBUG 2025/12/17 18:24:15 Time From: 2025-12-17T18:22:00.000+08:00
DEBUG 2025/12/17 18:24:15 Time To: 2025-12-17T18:23:00.000+08:00
DEBUG 2025/12/17 18:24:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:22:00.000+08:00",
					"lte": "2025-12-17T18:23:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:24:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:24:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:24:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:25:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:25:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:25:03 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:25:03 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:25:03 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:25:03 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:25:03 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:25:03 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:25:03 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:25:03 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:25:03 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:25:03 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:25:03 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:25:03 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:25:03 Starting ES monitor check for: bimap123
INFO 2025/12/17 18:25:03 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:25:03 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:25:03 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:25:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:25:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:25:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:25:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:25:15 Field: school_name.keyword
DEBUG 2025/12/17 18:25:15 Time From: 2025-12-17T18:23:00.000+08:00
DEBUG 2025/12/17 18:25:15 Time To: 2025-12-17T18:24:00.000+08:00
DEBUG 2025/12/17 18:25:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:23:00.000+08:00",
					"lte": "2025-12-17T18:24:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:25:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:25:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:25:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:25:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:26:03 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 18:26:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:26:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:26:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:26:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:26:15 Field: school_name.keyword
DEBUG 2025/12/17 18:26:15 Time From: 2025-12-17T18:24:00.000+08:00
DEBUG 2025/12/17 18:26:15 Time To: 2025-12-17T18:25:00.000+08:00
DEBUG 2025/12/17 18:26:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:24:00.000+08:00",
					"lte": "2025-12-17T18:25:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:26:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:26:18 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:26:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:26:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:26:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:26:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:26:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:26:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:26:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:27:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:27:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:27:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:27:15 Field: school_name.keyword
DEBUG 2025/12/17 18:27:15 Time From: 2025-12-17T18:25:00.000+08:00
DEBUG 2025/12/17 18:27:15 Time To: 2025-12-17T18:26:00.000+08:00
DEBUG 2025/12/17 18:27:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:25:00.000+08:00",
					"lte": "2025-12-17T18:26:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:27:18 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:18 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:27:33 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:27:33 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:27:33 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:27:33 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:27:33 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:27:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:27:33 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:27:33 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:27:33 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:27:33 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:27:33 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:27:33 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:27:33 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:27:33 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:27:33 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:27:33 Starting ES monitor check for: ncku
INFO 2025/12/17 18:27:33 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:27:33 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:27:33 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:27:33 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:27:33 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:27:33 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:27:33 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:27:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:28:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:28:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:28:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
WARNING 2025/12/17 18:28:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:28:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:28:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:28:15 Field: school_name.keyword
DEBUG 2025/12/17 18:28:15 Time From: 2025-12-17T18:26:00.000+08:00
DEBUG 2025/12/17 18:28:15 Time To: 2025-12-17T18:27:00.000+08:00
DEBUG 2025/12/17 18:28:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:26:00.000+08:00",
					"lte": "2025-12-17T18:27:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:28:33 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:28:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:28:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:28:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:28:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:28:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:28:48 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:28:48 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:28:48 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:28:48 Starting ES monitor check for: 213
INFO 2025/12/17 18:28:48 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:28:48 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:28:48 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:28:48 Starting ES monitor check for: ncku
INFO 2025/12/17 18:28:48 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:28:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:28:48 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:28:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:28:48 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:28:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:28:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:28:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:28:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:29:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:29:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:29:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:29:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:29:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:29:15 Field: school_name.keyword
DEBUG 2025/12/17 18:29:15 Time From: 2025-12-17T18:27:00.000+08:00
DEBUG 2025/12/17 18:29:15 Time To: 2025-12-17T18:28:00.000+08:00
DEBUG 2025/12/17 18:29:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:27:00.000+08:00",
					"lte": "2025-12-17T18:28:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:29:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:29:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:29:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:29:48 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:30:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:03 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:30:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:30:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:30:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:30:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:30:15 Field: school_name.keyword
DEBUG 2025/12/17 18:30:15 Time From: 2025-12-17T18:28:00.000+08:00
DEBUG 2025/12/17 18:30:15 Time To: 2025-12-17T18:29:00.000+08:00
DEBUG 2025/12/17 18:30:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:28:00.000+08:00",
					"lte": "2025-12-17T18:29:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:30:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:30:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:30:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:30:34 error find devices data: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:30:34 get devices data error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:30:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:31:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:31:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:31:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:31:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:31:15 Field: school_name.keyword
DEBUG 2025/12/17 18:31:15 Time From: 2025-12-17T18:29:00.000+08:00
DEBUG 2025/12/17 18:31:15 Time To: 2025-12-17T18:30:00.000+08:00
DEBUG 2025/12/17 18:31:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:29:00.000+08:00",
					"lte": "2025-12-17T18:30:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:31:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:31:18 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:31:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:31:18 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:31:18 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:31:18 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:31:18 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:31:18 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:31:18 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:31:18 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 18:31:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:31:18 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:31:18 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:31:18 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:31:18 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:31:18 Starting ES monitor check for: ncku
INFO 2025/12/17 18:31:18 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:31:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:31:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:31:18 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:31:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:31:18 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:31:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:31:19 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:31:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:31:49 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:32:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:32:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:32:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:32:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:32:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:32:15 Field: school_name.keyword
DEBUG 2025/12/17 18:32:15 Time From: 2025-12-17T18:30:00.000+08:00
DEBUG 2025/12/17 18:32:15 Time To: 2025-12-17T18:31:00.000+08:00
DEBUG 2025/12/17 18:32:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:30:00.000+08:00",
					"lte": "2025-12-17T18:31:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:32:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:32:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:32:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:32:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:32:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:32:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:32:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:32:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:33:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:04 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
WARNING 2025/12/17 18:33:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:33:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:33:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:33:15 Field: school_name.keyword
DEBUG 2025/12/17 18:33:15 Time From: 2025-12-17T18:31:00.000+08:00
DEBUG 2025/12/17 18:33:15 Time To: 2025-12-17T18:32:00.000+08:00
DEBUG 2025/12/17 18:33:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:31:00.000+08:00",
					"lte": "2025-12-17T18:32:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:33:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:33:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:33:48 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:33:48 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:33:48 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:33:48 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:33:48 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:33:48 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:33:48 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:33:48 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:33:48 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:33:48 Starting ES monitor check for: bimap123
INFO 2025/12/17 18:33:48 Starting ES monitor check for: 93
INFO 2025/12/17 18:33:48 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:33:48 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:33:48 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:33:48 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:33:48 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:34:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:34:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:34:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:34:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:34:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:34:15 Field: school_name.keyword
DEBUG 2025/12/17 18:34:15 Time From: 2025-12-17T18:32:00.000+08:00
DEBUG 2025/12/17 18:34:15 Time To: 2025-12-17T18:33:00.000+08:00
DEBUG 2025/12/17 18:34:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:32:00.000+08:00",
					"lte": "2025-12-17T18:33:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:34:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:34:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:34:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:35:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:35:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:35:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:35:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:35:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:35:15 Field: school_name.keyword
DEBUG 2025/12/17 18:35:15 Time From: 2025-12-17T18:33:00.000+08:00
DEBUG 2025/12/17 18:35:15 Time To: 2025-12-17T18:34:00.000+08:00
DEBUG 2025/12/17 18:35:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:33:00.000+08:00",
					"lte": "2025-12-17T18:34:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:35:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:35:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:35:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:35:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:36:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:36:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:36:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:36:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:36:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:36:15 Field: school_name.keyword
DEBUG 2025/12/17 18:36:15 Time From: 2025-12-17T18:34:00.000+08:00
DEBUG 2025/12/17 18:36:15 Time To: 2025-12-17T18:35:00.000+08:00
DEBUG 2025/12/17 18:36:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:34:00.000+08:00",
					"lte": "2025-12-17T18:35:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:36:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:36:18 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:36:18 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:36:18 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:36:18 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:36:18 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:36:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:36:18 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:36:18 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:36:18 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:36:18 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:36:18 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:36:18 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:36:18 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:36:18 Starting ES monitor check for: ncku
INFO 2025/12/17 18:36:18 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:36:18 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:36:18 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:36:18 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:36:18 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:36:18 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:36:18 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:36:18 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:36:19 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:36:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:36:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:36:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:37:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:37:07 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:37:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:37:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:37:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:37:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:37:15 Field: school_name.keyword
DEBUG 2025/12/17 18:37:15 Time From: 2025-12-17T18:35:00.000+08:00
DEBUG 2025/12/17 18:37:15 Time To: 2025-12-17T18:36:00.000+08:00
DEBUG 2025/12/17 18:37:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:35:00.000+08:00",
					"lte": "2025-12-17T18:36:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:37:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:37:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:37:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:37:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:37:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:37:33 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:37:33 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:37:33 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:37:33 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:37:33 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:37:33 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:37:33 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:37:33 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:37:33 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:37:33 ES monitor check completed for: 213, status: offline
ERROR 2025/12/17 18:37:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
DEBUG 2025/12/17 18:37:33 Scheduled monitoring check for ES: 93 (ID: 5)
ERROR 2025/12/17 18:37:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:37:33 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:37:33 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:37:33 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:37:33 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:37:33 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 18:37:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:37:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:38:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:38:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:38:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:38:15 Field: school_name.keyword
DEBUG 2025/12/17 18:38:15 Time From: 2025-12-17T18:36:00.000+08:00
DEBUG 2025/12/17 18:38:15 Time To: 2025-12-17T18:37:00.000+08:00
DEBUG 2025/12/17 18:38:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:36:00.000+08:00",
					"lte": "2025-12-17T18:37:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:38:22 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:22 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:38:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:39:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:39:07 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:39:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:39:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:39:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:39:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:39:15 Field: school_name.keyword
DEBUG 2025/12/17 18:39:15 Time From: 2025-12-17T18:37:00.000+08:00
DEBUG 2025/12/17 18:39:15 Time To: 2025-12-17T18:38:00.000+08:00
DEBUG 2025/12/17 18:39:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:37:00.000+08:00",
					"lte": "2025-12-17T18:38:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:39:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:39:37 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:39:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:03 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:40:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:40:03 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:40:03 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:40:03 Starting ES monitor check for: NTU
INFO 2025/12/17 18:40:03 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:40:03 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:40:03 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:40:03 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:40:03 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:40:03 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:40:03 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:40:03 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:40:03 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:40:03 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:40:03 Starting ES monitor check for: 93
INFO 2025/12/17 18:40:03 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:40:03 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 18:40:03 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:40:03 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:40:03 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:40:03 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 18:40:03 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:40:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:40:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:40:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:40:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:40:15 Field: school_name.keyword
DEBUG 2025/12/17 18:40:15 Time From: 2025-12-17T18:38:00.000+08:00
DEBUG 2025/12/17 18:40:15 Time To: 2025-12-17T18:39:00.000+08:00
DEBUG 2025/12/17 18:40:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:38:00.000+08:00",
					"lte": "2025-12-17T18:39:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:40:22 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:22 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:52 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:40:57 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 18:41:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:41:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:41:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:41:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:41:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:41:15 Field: school_name.keyword
DEBUG 2025/12/17 18:41:15 Time From: 2025-12-17T18:39:00.000+08:00
DEBUG 2025/12/17 18:41:15 Time To: 2025-12-17T18:40:00.000+08:00
DEBUG 2025/12/17 18:41:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:39:00.000+08:00",
					"lte": "2025-12-17T18:40:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:41:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:41:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:41:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:41:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:41:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:41:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:41:37 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:41:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:42:12 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:42:12 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:42:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:42:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:42:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:42:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:42:15 Field: school_name.keyword
DEBUG 2025/12/17 18:42:15 Time From: 2025-12-17T18:40:00.000+08:00
DEBUG 2025/12/17 18:42:15 Time To: 2025-12-17T18:41:00.000+08:00
DEBUG 2025/12/17 18:42:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:40:00.000+08:00",
					"lte": "2025-12-17T18:41:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:42:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:42:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:42:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:42:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:42:33 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 18:42:33 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:42:33 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:42:33 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:42:33 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:42:33 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:42:33 Starting ES monitor check for: ncku
INFO 2025/12/17 18:42:33 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:42:33 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:42:33 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:42:33 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:42:33 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:42:33 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:42:33 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:42:33 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:42:33 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 18:42:52 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:43:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:43:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:43:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:43:15 Field: school_name.keyword
DEBUG 2025/12/17 18:43:15 Time From: 2025-12-17T18:41:00.000+08:00
DEBUG 2025/12/17 18:43:15 Time To: 2025-12-17T18:42:00.000+08:00
DEBUG 2025/12/17 18:43:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:41:00.000+08:00",
					"lte": "2025-12-17T18:42:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:43:27 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:43:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:44:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:44:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:44:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:44:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:44:15 Field: school_name.keyword
DEBUG 2025/12/17 18:44:15 Time From: 2025-12-17T18:42:00.000+08:00
DEBUG 2025/12/17 18:44:15 Time To: 2025-12-17T18:43:00.000+08:00
DEBUG 2025/12/17 18:44:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:42:00.000+08:00",
					"lte": "2025-12-17T18:43:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:44:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:44:42 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:44:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:45:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:45:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:45:03 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:45:03 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 18:45:03 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:45:03 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:45:03 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:45:03 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:45:03 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:45:03 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:45:03 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:45:03 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:45:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:45:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:45:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:45:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:45:15 Field: school_name.keyword
DEBUG 2025/12/17 18:45:15 Time From: 2025-12-17T18:43:00.000+08:00
DEBUG 2025/12/17 18:45:15 Time To: 2025-12-17T18:44:00.000+08:00
DEBUG 2025/12/17 18:45:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:43:00.000+08:00",
					"lte": "2025-12-17T18:44:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:45:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:45:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:45:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:46:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:46:07 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:46:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:46:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:46:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:46:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:46:15 Field: school_name.keyword
DEBUG 2025/12/17 18:46:15 Time From: 2025-12-17T18:44:00.000+08:00
DEBUG 2025/12/17 18:46:15 Time To: 2025-12-17T18:45:00.000+08:00
DEBUG 2025/12/17 18:46:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:44:00.000+08:00",
					"lte": "2025-12-17T18:45:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:46:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:46:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:46:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:46:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:46:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:47:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:47:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:47:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:47:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:47:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:47:15 Field: school_name.keyword
DEBUG 2025/12/17 18:47:15 Time From: 2025-12-17T18:45:00.000+08:00
DEBUG 2025/12/17 18:47:15 Time To: 2025-12-17T18:46:00.000+08:00
DEBUG 2025/12/17 18:47:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:45:00.000+08:00",
					"lte": "2025-12-17T18:46:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:47:22 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:47:22 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:47:33 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:47:33 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:47:33 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:47:33 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:47:33 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:47:33 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:47:33 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:47:33 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 18:47:33 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:47:33 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:47:33 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:47:33 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:47:33 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:47:33 Starting ES monitor check for: 213
INFO 2025/12/17 18:47:33 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:47:33 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:47:33 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
ERROR 2025/12/17 18:47:36 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: connection refused
ERROR 2025/12/17 18:47:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:48:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:48:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:48:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:48:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:48:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:48:15 Field: school_name.keyword
DEBUG 2025/12/17 18:48:15 Time From: 2025-12-17T18:46:00.000+08:00
DEBUG 2025/12/17 18:48:15 Time To: 2025-12-17T18:47:00.000+08:00
DEBUG 2025/12/17 18:48:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:46:00.000+08:00",
					"lte": "2025-12-17T18:47:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:48:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:48:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:48:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:48:37 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:48:48 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:49:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:49:07 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: connection refused
INFO 2025/12/17 18:49:07 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:49:07 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:49:07 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:49:07 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 18:49:07 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:49:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:49:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:49:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:49:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:49:15 Field: school_name.keyword
DEBUG 2025/12/17 18:49:15 Time From: 2025-12-17T18:47:00.000+08:00
DEBUG 2025/12/17 18:49:15 Time To: 2025-12-17T18:48:00.000+08:00
DEBUG 2025/12/17 18:49:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:47:00.000+08:00",
					"lte": "2025-12-17T18:48:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:49:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:49:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:49:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:49:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:49:52 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:50:03 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:50:03 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:50:03 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:50:03 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:50:03 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:50:03 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:50:03 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 18:50:03 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:50:03 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:50:03 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:50:03 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:50:03 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:50:03 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:50:03 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:50:03 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:50:03 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:50:03 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 18:50:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:50:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:50:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:50:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:50:15 Field: school_name.keyword
DEBUG 2025/12/17 18:50:15 Time From: 2025-12-17T18:48:00.000+08:00
DEBUG 2025/12/17 18:50:15 Time To: 2025-12-17T18:49:00.000+08:00
DEBUG 2025/12/17 18:50:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:48:00.000+08:00",
					"lte": "2025-12-17T18:49:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:50:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:50:22 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: connection refused
ERROR 2025/12/17 18:50:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: connection refused
ERROR 2025/12/17 18:50:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:50:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:50:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:51:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:51:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:51:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:51:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:51:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:51:15 Field: school_name.keyword
DEBUG 2025/12/17 18:51:15 Time From: 2025-12-17T18:49:00.000+08:00
DEBUG 2025/12/17 18:51:15 Time To: 2025-12-17T18:50:00.000+08:00
DEBUG 2025/12/17 18:51:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:49:00.000+08:00",
					"lte": "2025-12-17T18:50:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:51:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:18 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:51:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:51:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:51:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:52:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:52:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:52:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:52:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:52:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:52:15 Field: school_name.keyword
DEBUG 2025/12/17 18:52:15 Time From: 2025-12-17T18:50:00.000+08:00
DEBUG 2025/12/17 18:52:15 Time To: 2025-12-17T18:51:00.000+08:00
DEBUG 2025/12/17 18:52:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:50:00.000+08:00",
					"lte": "2025-12-17T18:51:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:52:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:52:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:52:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:52:33 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:52:33 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:52:33 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:52:33 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:52:33 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 18:52:33 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:52:34 error find devices data: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:52:34 get devices data error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:52:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:52:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:52:53 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:52:53 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:52:53 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:52:53 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:52:53 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:52:53 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:52:53 Starting ES monitor check for: 213
INFO 2025/12/17 18:52:53 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:52:53 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:52:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:52:53 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:52:53 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:52:53 Starting ES monitor check for: 93
INFO 2025/12/17 18:52:53 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:52:53 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:52:53 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
ERROR 2025/12/17 18:53:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:53:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:53:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:53:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:53:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:53:15 Field: school_name.keyword
DEBUG 2025/12/17 18:53:15 Time From: 2025-12-17T18:51:00.000+08:00
DEBUG 2025/12/17 18:53:15 Time To: 2025-12-17T18:52:00.000+08:00
DEBUG 2025/12/17 18:53:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:51:00.000+08:00",
					"lte": "2025-12-17T18:52:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:53:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:53:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:53:49 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:54:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:54:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:54:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:54:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:54:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:54:15 Field: school_name.keyword
DEBUG 2025/12/17 18:54:15 Time From: 2025-12-17T18:52:00.000+08:00
DEBUG 2025/12/17 18:54:15 Time To: 2025-12-17T18:53:00.000+08:00
DEBUG 2025/12/17 18:54:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:52:00.000+08:00",
					"lte": "2025-12-17T18:53:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:54:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:54:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:54:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:55:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:55:04 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:55:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:55:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:55:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:55:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:55:15 Field: school_name.keyword
DEBUG 2025/12/17 18:55:15 Time From: 2025-12-17T18:53:00.000+08:00
DEBUG 2025/12/17 18:55:15 Time To: 2025-12-17T18:54:00.000+08:00
DEBUG 2025/12/17 18:55:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:53:00.000+08:00",
					"lte": "2025-12-17T18:54:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:55:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:55:21 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 18:55:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:55:23 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:55:23 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 18:55:23 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 18:55:23 Starting ES monitor check for: NTU
DEBUG 2025/12/17 18:55:23 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 18:55:23 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 18:55:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 18:55:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 18:55:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 18:55:23 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:55:23 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:55:23 Starting ES monitor check for: ncku
DEBUG 2025/12/17 18:55:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:55:23 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 18:55:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 18:55:23 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:55:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 18:55:23 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 18:55:23 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 18:55:23 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:55:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:55:24 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 18:55:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:55:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:55:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:56:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:56:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:56:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:56:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:56:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:56:15 Field: school_name.keyword
DEBUG 2025/12/17 18:56:15 Time From: 2025-12-17T18:54:00.000+08:00
DEBUG 2025/12/17 18:56:15 Time To: 2025-12-17T18:55:00.000+08:00
DEBUG 2025/12/17 18:56:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:54:00.000+08:00",
					"lte": "2025-12-17T18:55:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:56:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:56:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:56:30 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 18:56:36 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:56:36 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:56:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:56:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:56:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:56:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:56:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:56:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:57:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:57:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:57:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:57:15 Field: school_name.keyword
DEBUG 2025/12/17 18:57:15 Time From: 2025-12-17T18:55:00.000+08:00
DEBUG 2025/12/17 18:57:15 Time To: 2025-12-17T18:56:00.000+08:00
DEBUG 2025/12/17 18:57:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:55:00.000+08:00",
					"lte": "2025-12-17T18:56:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:57:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:45 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:51 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:57:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 18:57:53 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 18:57:53 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 18:57:53 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 18:57:53 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 18:57:53 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 18:57:53 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 18:57:53 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 18:57:53 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 18:57:53 Starting ES monitor check for: 213
INFO 2025/12/17 18:57:53 Starting ES monitor check for: ncku
INFO 2025/12/17 18:57:53 Starting ES monitor check for: 93
DEBUG 2025/12/17 18:57:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 18:57:53 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 18:57:53 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 18:57:53 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 18:57:53 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
ERROR 2025/12/17 18:58:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:58:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:58:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:58:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:58:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:58:15 Field: school_name.keyword
DEBUG 2025/12/17 18:58:15 Time From: 2025-12-17T18:56:00.000+08:00
DEBUG 2025/12/17 18:58:15 Time To: 2025-12-17T18:57:00.000+08:00
DEBUG 2025/12/17 18:58:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:56:00.000+08:00",
					"lte": "2025-12-17T18:57:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:58:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:58:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:59:00 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: connection refused
ERROR 2025/12/17 18:59:04 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: connection refused
WARNING 2025/12/17 18:59:04 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:59:04 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:59:04 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:59:04 Field: school_name.keyword
DEBUG 2025/12/17 18:59:04 Time From: 2025-12-17T18:58:00.000+08:00
DEBUG 2025/12/17 18:59:04 Time To: 2025-12-17T18:59:00.000+08:00
DEBUG 2025/12/17 18:59:04 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:58:00.000+08:00",
					"lte": "2025-12-17T18:59:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:59:06 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:08 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 18:59:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 18:59:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 18:59:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 18:59:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 18:59:15 Field: school_name.keyword
DEBUG 2025/12/17 18:59:15 Time From: 2025-12-17T18:57:00.000+08:00
DEBUG 2025/12/17 18:59:15 Time To: 2025-12-17T18:58:00.000+08:00
DEBUG 2025/12/17 18:59:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:57:00.000+08:00",
					"lte": "2025-12-17T18:58:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 18:59:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 18:59:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 18:59:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:00:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:00:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:00:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:00:23 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:00:23 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:00:23 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:00:23 Starting ES monitor check for: NTU
INFO 2025/12/17 19:00:23 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:00:23 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 19:00:23 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:00:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 19:00:23 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:00:23 Starting ES monitor check for: bimap123
INFO 2025/12/17 19:00:23 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:00:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 19:00:23 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:00:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:00:23 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:00:23 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:00:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 19:00:23 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 19:00:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:00:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:00:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:00:24 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:00:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:00:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:00:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:01:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:01:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:01:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:01:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:01:15 Field: school_name.keyword
DEBUG 2025/12/17 19:01:15 Time From: 2025-12-17T18:59:00.000+08:00
DEBUG 2025/12/17 19:01:15 Time To: 2025-12-17T19:00:00.000+08:00
DEBUG 2025/12/17 19:01:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T18:59:00.000+08:00",
					"lte": "2025-12-17T19:00:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:01:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:01:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:01:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:01:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:01:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:01:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:01:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:01:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:01:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:02:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:02:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:02:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:02:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:02:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:02:15 Field: school_name.keyword
DEBUG 2025/12/17 19:02:15 Time From: 2025-12-17T19:00:00.000+08:00
DEBUG 2025/12/17 19:02:15 Time To: 2025-12-17T19:01:00.000+08:00
DEBUG 2025/12/17 19:02:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:00:00.000+08:00",
					"lte": "2025-12-17T19:01:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:02:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:02:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:02:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:02:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:02:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:02:53 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 19:02:53 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:02:53 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:02:53 Starting ES monitor check for: 93
INFO 2025/12/17 19:02:53 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:02:53 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 19:02:53 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:02:53 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:02:53 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 19:02:53 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:02:53 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 19:02:53 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 19:02:53 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:02:53 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:02:53 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:02:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 19:03:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:03:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:03:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:03:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:03:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:03:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:03:15 Field: school_name.keyword
DEBUG 2025/12/17 19:03:15 Time From: 2025-12-17T19:01:00.000+08:00
DEBUG 2025/12/17 19:03:15 Time To: 2025-12-17T19:02:00.000+08:00
DEBUG 2025/12/17 19:03:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:01:00.000+08:00",
					"lte": "2025-12-17T19:02:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:03:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:03:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:03:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:03:52 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:04:04 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:04:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:04:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:04:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:04:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:04:15 Field: school_name.keyword
DEBUG 2025/12/17 19:04:15 Time From: 2025-12-17T19:02:00.000+08:00
DEBUG 2025/12/17 19:04:15 Time To: 2025-12-17T19:03:00.000+08:00
DEBUG 2025/12/17 19:04:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:02:00.000+08:00",
					"lte": "2025-12-17T19:03:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:04:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:04:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:04:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:04:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:05:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:05:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:05:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:05:15 Field: school_name.keyword
DEBUG 2025/12/17 19:05:15 Time From: 2025-12-17T19:03:00.000+08:00
DEBUG 2025/12/17 19:05:15 Time To: 2025-12-17T19:04:00.000+08:00
DEBUG 2025/12/17 19:05:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:03:00.000+08:00",
					"lte": "2025-12-17T19:04:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:05:19 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:19 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:05:23 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:05:23 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:05:23 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:05:23 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:05:23 Starting ES monitor check for: NTU
INFO 2025/12/17 19:05:23 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:05:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:05:23 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:05:23 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 19:05:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:05:23 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 19:05:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 19:05:23 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:05:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 19:05:23 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:05:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:05:23 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:05:23 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:05:23 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:05:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:05:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:05:24 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:05:26 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: connection refused
ERROR 2025/12/17 19:05:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:05:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:06:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:06:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:06:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:06:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:06:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:06:15 Field: school_name.keyword
DEBUG 2025/12/17 19:06:15 Time From: 2025-12-17T19:04:00.000+08:00
DEBUG 2025/12/17 19:06:15 Time To: 2025-12-17T19:05:00.000+08:00
DEBUG 2025/12/17 19:06:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:04:00.000+08:00",
					"lte": "2025-12-17T19:05:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:06:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:06:15 error find devices data: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:06:15 get devices data error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:06:34 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:06:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:06:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:06:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:06:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:06:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:07:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:07:04 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 19:07:06 error find devices data: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:07:06 get devices data error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:07:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:07:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:07:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:07:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:07:15 Field: school_name.keyword
DEBUG 2025/12/17 19:07:15 Time From: 2025-12-17T19:05:00.000+08:00
DEBUG 2025/12/17 19:07:15 Time To: 2025-12-17T19:06:00.000+08:00
DEBUG 2025/12/17 19:07:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:05:00.000+08:00",
					"lte": "2025-12-17T19:06:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:07:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:07:30 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:07:49 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:07:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:08:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:08:14 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:08:14 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:08:14 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:08:14 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:08:14 Field: school_name.keyword
DEBUG 2025/12/17 19:08:14 Time From: 2025-12-17T19:06:00.000+08:00
DEBUG 2025/12/17 19:08:14 Time To: 2025-12-17T19:07:00.000+08:00
DEBUG 2025/12/17 19:08:14 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:06:00.000+08:00",
					"lte": "2025-12-17T19:07:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:08:21 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:08:29 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:08:29 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:08:44 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:09:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:09:08 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:09:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:09:08 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 19:09:08 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:09:08 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 19:09:08 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:09:08 Starting ES monitor check for: ncku
INFO 2025/12/17 19:09:08 Starting ES monitor check for: bimap123
INFO 2025/12/17 19:09:08 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:09:08 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:09:08 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:09:08 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:09:08 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:09:08 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 19:09:08 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:09:08 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 19:09:08 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:09:08 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 19:09:14 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:09:14 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
WARNING 2025/12/17 19:09:14 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:09:14 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:09:14 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:09:14 Field: school_name.keyword
DEBUG 2025/12/17 19:09:14 Time From: 2025-12-17T19:07:00.000+08:00
DEBUG 2025/12/17 19:09:14 Time To: 2025-12-17T19:08:00.000+08:00
DEBUG 2025/12/17 19:09:14 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:07:00.000+08:00",
					"lte": "2025-12-17T19:08:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:09:36 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:09:44 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:10:14 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:10:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:10:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:10:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:10:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:10:15 Field: school_name.keyword
DEBUG 2025/12/17 19:10:15 Time From: 2025-12-17T19:08:00.000+08:00
DEBUG 2025/12/17 19:10:15 Time To: 2025-12-17T19:09:00.000+08:00
DEBUG 2025/12/17 19:10:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:08:00.000+08:00",
					"lte": "2025-12-17T19:09:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:10:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:10:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:10:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:10:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:10:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:10:23 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:10:23 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:10:23 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:10:23 Starting ES monitor check for: NTU
DEBUG 2025/12/17 19:10:23 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 19:10:24 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:10:29 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:10:29 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:10:59 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:11:14 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:11:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:11:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:11:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:11:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:11:15 Field: school_name.keyword
DEBUG 2025/12/17 19:11:15 Time From: 2025-12-17T19:09:00.000+08:00
DEBUG 2025/12/17 19:11:15 Time To: 2025-12-17T19:10:00.000+08:00
DEBUG 2025/12/17 19:11:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:09:00.000+08:00",
					"lte": "2025-12-17T19:10:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:11:29 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:11:29 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:11:35 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 19:11:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:11:38 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 19:11:38 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:11:38 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 19:11:38 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:11:38 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 19:11:38 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 19:11:38 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 19:11:38 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:11:38 Starting ES monitor check for: ncku
INFO 2025/12/17 19:11:38 Starting ES monitor check for: 93
INFO 2025/12/17 19:11:38 Starting ES monitor check for: 213
INFO 2025/12/17 19:11:38 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:11:38 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:11:38 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:11:38 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:11:38 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
ERROR 2025/12/17 19:11:44 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:12:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:12:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:12:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:12:15 Field: school_name.keyword
DEBUG 2025/12/17 19:12:15 Time From: 2025-12-17T19:10:00.000+08:00
DEBUG 2025/12/17 19:12:15 Time To: 2025-12-17T19:11:00.000+08:00
DEBUG 2025/12/17 19:12:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:10:00.000+08:00",
					"lte": "2025-12-17T19:11:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:12:29 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:29 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:44 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:50 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:50 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:12:59 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:13:14 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:13:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:13:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:13:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:13:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:13:15 Field: school_name.keyword
DEBUG 2025/12/17 19:13:15 Time From: 2025-12-17T19:11:00.000+08:00
DEBUG 2025/12/17 19:13:15 Time To: 2025-12-17T19:12:00.000+08:00
DEBUG 2025/12/17 19:13:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:11:00.000+08:00",
					"lte": "2025-12-17T19:12:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:13:34 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 19:13:44 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:13:59 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:05 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:08 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:14:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:14:08 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:14:08 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:14:08 Starting ES monitor check for: NTU
INFO 2025/12/17 19:14:08 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:14:08 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 19:14:08 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:14:08 Starting ES monitor check for: 93
INFO 2025/12/17 19:14:08 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:14:08 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:14:08 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:14:08 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 19:14:08 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:14:08 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:14:08 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:14:08 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 19:14:08 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 19:14:08 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:14:08 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:14:08 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:14:08 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:14:09 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:14:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:14:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:14:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:14:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:14:15 Field: school_name.keyword
DEBUG 2025/12/17 19:14:15 Time From: 2025-12-17T19:12:00.000+08:00
DEBUG 2025/12/17 19:14:15 Time To: 2025-12-17T19:13:00.000+08:00
DEBUG 2025/12/17 19:14:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:12:00.000+08:00",
					"lte": "2025-12-17T19:13:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:14:29 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:29 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:50 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:50 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:14:55 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:14:59 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:15:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:15:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:15:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:15:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:15:15 Field: school_name.keyword
DEBUG 2025/12/17 19:15:15 Time From: 2025-12-17T19:13:00.000+08:00
DEBUG 2025/12/17 19:15:15 Time To: 2025-12-17T19:14:00.000+08:00
DEBUG 2025/12/17 19:15:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:13:00.000+08:00",
					"lte": "2025-12-17T19:14:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:15:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:15:20 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:15:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:15:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:15:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:15:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:15:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:15:23 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:15:23 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:15:23 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:15:23 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:15:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 19:15:23 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:15:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:15:23 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:15:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:15:23 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:15:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 19:15:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:15:23 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:15:23 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:15:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:15:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
ERROR 2025/12/17 19:15:44 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:16:10 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:16:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:16:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:16:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:16:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:16:15 Field: school_name.keyword
DEBUG 2025/12/17 19:16:15 Time From: 2025-12-17T19:14:00.000+08:00
DEBUG 2025/12/17 19:16:15 Time To: 2025-12-17T19:15:00.000+08:00
DEBUG 2025/12/17 19:16:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:14:00.000+08:00",
					"lte": "2025-12-17T19:15:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:16:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:16:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:16:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:16:59 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:17:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:17:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:17:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:17:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:17:15 Field: school_name.keyword
DEBUG 2025/12/17 19:17:15 Time From: 2025-12-17T19:15:00.000+08:00
DEBUG 2025/12/17 19:17:15 Time To: 2025-12-17T19:16:00.000+08:00
DEBUG 2025/12/17 19:17:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:15:00.000+08:00",
					"lte": "2025-12-17T19:16:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:17:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:17:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:17:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:17:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:17:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:17:53 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:17:53 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:17:53 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:17:53 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 19:17:53 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:17:53 Starting ES monitor check for: NTU
DEBUG 2025/12/17 19:17:53 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:17:53 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:17:53 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 19:17:53 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:17:53 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:17:53 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 19:17:53 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:17:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:17:53 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:17:53 Starting ES monitor check for: bimap123
INFO 2025/12/17 19:17:53 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:17:53 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:17:53 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:17:53 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:17:53 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:17:54 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:18:07 ES connect error: dial tcp 10.99.1.213:9200: connect: connection refused
ERROR 2025/12/17 19:18:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:18:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:18:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:18:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:18:15 Field: school_name.keyword
DEBUG 2025/12/17 19:18:15 Time From: 2025-12-17T19:16:00.000+08:00
DEBUG 2025/12/17 19:18:15 Time To: 2025-12-17T19:17:00.000+08:00
DEBUG 2025/12/17 19:18:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:16:00.000+08:00",
					"lte": "2025-12-17T19:17:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:18:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:18:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:18:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:18:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:19:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:19:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:19:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:19:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:19:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:19:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:19:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:19:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:19:15 Field: school_name.keyword
DEBUG 2025/12/17 19:19:15 Time From: 2025-12-17T19:17:00.000+08:00
DEBUG 2025/12/17 19:19:15 Time To: 2025-12-17T19:18:00.000+08:00
DEBUG 2025/12/17 19:19:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:17:00.000+08:00",
					"lte": "2025-12-17T19:18:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:19:22 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:22 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:19:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:20:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:20:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:20:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:20:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:20:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:20:15 Field: school_name.keyword
DEBUG 2025/12/17 19:20:15 Time From: 2025-12-17T19:18:00.000+08:00
DEBUG 2025/12/17 19:20:15 Time To: 2025-12-17T19:19:00.000+08:00
DEBUG 2025/12/17 19:20:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:18:00.000+08:00",
					"lte": "2025-12-17T19:19:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:20:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:20:18 error find devices data: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:20:18 get devices data error: dial tcp 10.99.1.213:3306: connect: connection refused
ERROR 2025/12/17 19:20:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:20:23 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:20:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:20:23 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:20:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 19:20:23 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 19:20:23 ES monitor check completed for: ncku, status: offline
INFO 2025/12/17 19:20:23 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 19:20:23 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 19:20:23 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 19:20:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:20:23 Starting ES monitor check for: 93
INFO 2025/12/17 19:20:23 Starting ES monitor check for: ncku
INFO 2025/12/17 19:20:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:20:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 19:20:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:20:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
ERROR 2025/12/17 19:20:37 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:20:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:21:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:21:05 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:21:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:21:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:21:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:21:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:21:15 Field: school_name.keyword
DEBUG 2025/12/17 19:21:15 Time From: 2025-12-17T19:19:00.000+08:00
DEBUG 2025/12/17 19:21:15 Time To: 2025-12-17T19:20:00.000+08:00
DEBUG 2025/12/17 19:21:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:19:00.000+08:00",
					"lte": "2025-12-17T19:20:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:21:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:21:33 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:21:52 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:22:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:22:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:22:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:22:15 Field: school_name.keyword
DEBUG 2025/12/17 19:22:15 Time From: 2025-12-17T19:20:00.000+08:00
DEBUG 2025/12/17 19:22:15 Time To: 2025-12-17T19:21:00.000+08:00
DEBUG 2025/12/17 19:22:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:20:00.000+08:00",
					"lte": "2025-12-17T19:21:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:22:20 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:20 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:48 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:22:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:22:53 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:22:53 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:22:53 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:22:53 Starting ES monitor check for: NTU
INFO 2025/12/17 19:22:53 ES monitor check completed for: 213, status: offline
DEBUG 2025/12/17 19:22:53 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 19:22:53 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:22:53 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:22:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:22:54 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:23:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:23:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:23:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:23:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:23:15 Field: school_name.keyword
DEBUG 2025/12/17 19:23:15 Time From: 2025-12-17T19:21:00.000+08:00
DEBUG 2025/12/17 19:23:15 Time To: 2025-12-17T19:22:00.000+08:00
DEBUG 2025/12/17 19:23:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:21:00.000+08:00",
					"lte": "2025-12-17T19:22:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:23:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:23:35 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:23:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:24:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:24:08 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:24:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:24:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
WARNING 2025/12/17 19:24:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:24:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:24:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:24:15 Field: school_name.keyword
DEBUG 2025/12/17 19:24:15 Time From: 2025-12-17T19:22:00.000+08:00
DEBUG 2025/12/17 19:24:15 Time To: 2025-12-17T19:23:00.000+08:00
DEBUG 2025/12/17 19:24:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:22:00.000+08:00",
					"lte": "2025-12-17T19:23:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:24:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:24:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:24:50 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:25:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:25:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:25:15 Falling back to default ES client for index 1
ERROR 2025/12/17 19:25:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
DEBUG 2025/12/17 19:25:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:25:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:25:15 Field: school_name.keyword
DEBUG 2025/12/17 19:25:15 Time From: 2025-12-17T19:23:00.000+08:00
DEBUG 2025/12/17 19:25:15 Time To: 2025-12-17T19:24:00.000+08:00
DEBUG 2025/12/17 19:25:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:23:00.000+08:00",
					"lte": "2025-12-17T19:24:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:25:23 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:25:23 ES monitor check completed for: bimap123, status: offline
INFO 2025/12/17 19:25:23 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:25:23 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:25:23 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 19:25:23 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:25:23 Starting ES monitor check for: bimap123
INFO 2025/12/17 19:25:23 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:25:23 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:25:23 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:25:23 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:25:23 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:25:23 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 19:25:23 ES monitor check completed for: 93, status: offline
DEBUG 2025/12/17 19:25:23 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:25:23 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:25:23 Monitor 5 (93): using preloaded ESConnection 7 (93)
ERROR 2025/12/17 19:25:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:25:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:25:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:26:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:26:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:26:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:26:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:26:15 Field: school_name.keyword
DEBUG 2025/12/17 19:26:15 Time From: 2025-12-17T19:24:00.000+08:00
DEBUG 2025/12/17 19:26:15 Time To: 2025-12-17T19:25:00.000+08:00
DEBUG 2025/12/17 19:26:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:24:00.000+08:00",
					"lte": "2025-12-17T19:25:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:26:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:26:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:26:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to check duplicate alert: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:38 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
ERROR 2025/12/17 19:26:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:27:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:27:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:27:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:27:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:27:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:27:15 Field: school_name.keyword
DEBUG 2025/12/17 19:27:15 Time From: 2025-12-17T19:25:00.000+08:00
DEBUG 2025/12/17 19:27:15 Time To: 2025-12-17T19:26:00.000+08:00
DEBUG 2025/12/17 19:27:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:25:00.000+08:00",
					"lte": "2025-12-17T19:26:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:27:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:27:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:27:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:27:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:27:53 Failed to begin ES transaction: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:27:53 ES monitor check completed for: 93, status: offline
INFO 2025/12/17 19:27:53 ES monitor check completed for: 213, status: offline
INFO 2025/12/17 19:27:53 ES monitor check completed for: ncku, status: offline
DEBUG 2025/12/17 19:27:53 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 19:27:53 Starting ES monitor check for: 213
DEBUG 2025/12/17 19:27:53 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 19:27:53 Starting ES monitor check for: 93
DEBUG 2025/12/17 19:27:53 Monitor 5 (93): using preloaded ESConnection 7 (93)
ERROR 2025/12/17 19:27:53 Failed to create ES alert: dial tcp 10.99.1.213:5432: connect: operation timed out
INFO 2025/12/17 19:27:53 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 19:27:53 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 19:27:53 Starting ES monitor check for: NTU
DEBUG 2025/12/17 19:27:53 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 19:27:53 ES monitor check completed for: bimap123, status: offline
DEBUG 2025/12/17 19:27:53 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 19:27:53 Starting ES monitor check for: ncku
DEBUG 2025/12/17 19:27:53 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 19:27:53 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 19:27:53 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 19:27:53 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 19:27:53 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 19:27:54 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
ERROR 2025/12/17 19:28:00 error querying duplicate devices: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:28:02 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: connection refused
WARNING 2025/12/17 19:28:02 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:28:02 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:28:02 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:28:02 Field: school_name.keyword
DEBUG 2025/12/17 19:28:02 Time From: 2025-12-17T19:27:00.000+08:00
DEBUG 2025/12/17 19:28:02 Time To: 2025-12-17T19:28:00.000+08:00
DEBUG 2025/12/17 19:28:02 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:27:00.000+08:00",
					"lte": "2025-12-17T19:28:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:28:15 Failed to get ES client for index 1: failed to load index 1: dial tcp 10.99.1.213:3306: connect: operation timed out
WARNING 2025/12/17 19:28:15 Falling back to default ES client for index 1
DEBUG 2025/12/17 19:28:15 ==================== ES Query Debug ====================
DEBUG 2025/12/17 19:28:15 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 19:28:15 Field: school_name.keyword
DEBUG 2025/12/17 19:28:15 Time From: 2025-12-17T19:26:00.000+08:00
DEBUG 2025/12/17 19:28:15 Time To: 2025-12-17T19:27:00.000+08:00
DEBUG 2025/12/17 19:28:15 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T19:26:00.000+08:00",
					"lte": "2025-12-17T19:27:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
ERROR 2025/12/17 19:28:15 ES connect error: dial tcp 10.99.1.213:9200: connect: operation timed out
ERROR 2025/12/17 19:28:30 error find devices data: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:28:30 get devices data error: dial tcp 10.99.1.213:3306: connect: operation timed out
ERROR 2025/12/17 19:28:45 Create Device Fail error: dial tcp 10.99.1.213:3306: connect: operation timed out
