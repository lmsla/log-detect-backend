SQL  2025/12/17 16:51:43 SQL Database 連線成功
2025/12/17 16:51:43 ✅ BatchWriter initialized successfully
2025/12/17 16:51:43 Starting database migrations...
2025/12/17 16:51:43 Database migrations completed successfully
INFO 2025/12/17 16:51:43 Initializing ES client via Connection Manager...
INFO 2025/12/17 16:51:43 Initializing ES Connection Manager...
INFO 2025/12/17 16:51:43 Found 5 ES connection(s) in database
DEBUG 2025/12/17 16:51:43 Created ES client for connection '213': https://10.99.1.213:9200
INFO 2025/12/17 16:51:43 Set default ES connection: '213' (ID: 3)
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'ncku': https://203.68.92.162:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'NTU': https://163.28.16.201:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection 'bimap123': https://10.99.1.123:9200
DEBUG 2025/12/17 16:51:43 Created ES client for connection '93': https://10.99.1.93:9200
INFO 2025/12/17 16:51:43 Successfully initialized 5/5 ES connection(s)
INFO 2025/12/17 16:51:43 ES Connection Manager initialized successfully
INFO 2025/12/17 16:51:43 Default ES connection test successful
Elasticsearch 2025/12/17 16:51:43 ES 連線成功
INFO 2025/12/17 16:51:44 ES Monitor Scheduler initialized
INFO 2025/12/17 16:51:44 Loading all enabled ES monitors...
INFO 2025/12/17 16:51:45 Started monitoring ES: 213 (ID: 1) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: ncku (ID: 2) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: NTU (ID: 3) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: bimap123 (ID: 4) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Started monitoring ES: 93 (ID: 5) with interval: 60 seconds
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:51:45 Successfully started 5 ES monitors
INFO 2025/12/17 16:51:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:51:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: 93
INFO 2025/12/17 16:51:45 Initial monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:51:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:51:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:51:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:51:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:51:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 16:51:45 ES monitor check completed for: 213, status: online
排程  2025/12/17 16:51:45 標的名稱: 日誌告警-NCKU ,日誌名稱: NCKU-forti , 初始化成功
WARN 2025/12/17 16:51:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 16:51:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 16:51:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 16:51:45 ES Alert Created [high][performance]: Memory usage high: 87.72% (threshold: 80.00%)
DEBUG 2025/12/17 16:51:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 16:51:46 ES Alert Created [high][capacity]: Disk usage high: 93.21% (threshold: 85.00%)
WARN 2025/12/17 16:51:46 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 16:51:46 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 16:51:46 ES monitor check completed for: 93, status: error
WARN 2025/12/17 16:51:46 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 16:51:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 16:51:50 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 16:51:50 ES monitor check completed for: NTU, status: warning
WARN 2025/12/17 16:51:59 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 16:52:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:52:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:52:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:52:00 Field: school_name.keyword
DEBUG 2025/12/17 16:52:00 Time From: 2025-12-17T16:51:00.000+08:00
DEBUG 2025/12/17 16:52:00 Time To: 2025-12-17T16:52:00.000+08:00
DEBUG 2025/12/17 16:52:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:51:00.000+08:00",
					"lte": "2025-12-17T16:52:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 16:52:00 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 16:52:01 ES Response Status: 200 OK
DEBUG 2025/12/17 16:52:01 ES Response IsError: false
DEBUG 2025/12/17 16:52:01 ES Response Body:
{"took":1262,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":521,"buckets":[{"key":"仁愛高農","doc_count":1873},{"key":"黑快馬主機","doc_count":1539},{"key":"南投高商","doc_count":982},{"key":"花蓮高農","doc_count":841},{"key":"新竹女中","doc_count":742},{"key":"金門農工","doc_count":600},{"key":"竹北高中","doc_count":550},{"key":"金門高中","doc_count":510},{"key":"臺東高中","doc_count":498},{"key":"宜蘭高商","doc_count":480},{"key":"北門高中","doc_count":451},{"key":"華僑高中","doc_count":428},{"key":"中大壢中","doc_count":395},{"key":"清華附小","doc_count":383},{"key":"興大附中","doc_count":369},{"key":"竹南高中","doc_count":359},{"key":"旗美高中","doc_count":354},{"key":"新港藝高","doc_count":351},{"key":"後壁高中","doc_count":326},{"key":"花蓮高商","doc_count":318},{"key":"關西高中","doc_count":307},{"key":"斗六家商","doc_count":303},{"key":"屏東女中","doc_count":294},{"key":"內埔農工","doc_count":293},{"key":"苗栗農工","doc_count":274},{"key":"蘇澳海事","doc_count":262},{"key":"南投特教","doc_count":256},{"key":"員林家商","doc_count":256},{"key":"關山工商","doc_count":235},{"key":"新竹高工","doc_count":183},{"key":"新營高工","doc_count":178},{"key":"新化高中","doc_count":176},{"key":"羅東高商","doc_count":157},{"key":"玉里高中","doc_count":150},{"key":"屏東高中","doc_count":149},{"key":"北教大實小","doc_count":145},{"key":"北港高中","doc_count":143},{"key":"嘉科實中","doc_count":140},{"key":"政大附中","doc_count":140},{"key":"東港海事","doc_count":138},{"key":"北斗家商","doc_count":136},{"key":"新化高工","doc_count":136},{"key":"彰師附工","doc_count":125},{"key":"師大附中高中部","doc_count":122},{"key":"水里商工","doc_count":122},{"key":"苗栗高商","doc_count":116},{"key":"新營高中","doc_count":114},{"key":"草屯商工","doc_count":111},{"key":"虎尾高中","doc_count":110},{"key":"南大附聰","doc_count":107},{"key":"嘉義高商","doc_count":107},{"key":"彰化高商","doc_count":104},{"key":"南投高中","doc_count":98},{"key":"成大南工","doc_count":97},{"key":"嘉義高中","doc_count":93},{"key":"曾文農工","doc_count":92},{"key":"二林工商","doc_count":90},{"key":"新竹高中","doc_count":87},{"key":"華南高商","doc_count":86},{"key":"新竹高商","doc_count":82},{"key":"員林農工","doc_count":81},{"key":"鳳山高中","doc_count":81},{"key":"宜蘭高中","doc_count":77},{"key":"基隆商工","doc_count":76},{"key":"屏科實中","doc_count":73},{"key":"溪湖高中","doc_count":72},{"key":"臺東女中","doc_count":69},{"key":"花蓮高工","doc_count":69},{"key":"屏東高工","doc_count":67},{"key":"潮州高中","doc_count":67},{"key":"北港農工","doc_count":65},{"key":"臺南高商","doc_count":64},{"key":"南大附中","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"南大附小","doc_count":62},{"key":"雲林特教","doc_count":62},{"key":"善化高中","doc_count":61},{"key":"旗山農工","doc_count":61},{"key":"海大附中","doc_count":61},{"key":"暨大附中","doc_count":59},{"key":"羅東高工","doc_count":58},{"key":"竹山高中","doc_count":57},{"key":"埔里高工","doc_count":56},{"key":"臺東高商","doc_count":56},{"key":"蘭陽女中","doc_count":56},{"key":"興大附農","doc_count":55},{"key":"嘉義高工","doc_count":53},{"key":"花蓮高中","doc_count":53},{"key":"中興高中","doc_count":52},{"key":"屏北高中","doc_count":51},{"key":"新豐高中","doc_count":51},{"key":"東石高中","doc_count":51},{"key":"永靖高工","doc_count":51},{"key":"臺南一中","doc_count":49},{"key":"屏東特教","doc_count":47},{"key":"土庫商工","doc_count":46},{"key":"成功商水","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"頭城家商","doc_count":44},{"key":"高餐大附中","doc_count":44}]}}}
DEBUG 2025/12/17 16:52:01 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:52:01   Bucket[0]: Key=仁愛高農, DocCount=1873
DEBUG 2025/12/17 16:52:01   Bucket[1]: Key=黑快馬主機, DocCount=1539
DEBUG 2025/12/17 16:52:01   Bucket[2]: Key=南投高商, DocCount=982
DEBUG 2025/12/17 16:52:01   Bucket[3]: Key=花蓮高農, DocCount=841
DEBUG 2025/12/17 16:52:01   Bucket[4]: Key=新竹女中, DocCount=742
DEBUG 2025/12/17 16:52:01   Bucket[5]: Key=金門農工, DocCount=600
DEBUG 2025/12/17 16:52:01   Bucket[6]: Key=竹北高中, DocCount=550
DEBUG 2025/12/17 16:52:01   Bucket[7]: Key=金門高中, DocCount=510
DEBUG 2025/12/17 16:52:01   Bucket[8]: Key=臺東高中, DocCount=498
DEBUG 2025/12/17 16:52:01   Bucket[9]: Key=宜蘭高商, DocCount=480
DEBUG 2025/12/17 16:52:01   Bucket[10]: Key=北門高中, DocCount=451
DEBUG 2025/12/17 16:52:01   Bucket[11]: Key=華僑高中, DocCount=428
DEBUG 2025/12/17 16:52:01   Bucket[12]: Key=中大壢中, DocCount=395
DEBUG 2025/12/17 16:52:01   Bucket[13]: Key=清華附小, DocCount=383
DEBUG 2025/12/17 16:52:01   Bucket[14]: Key=興大附中, DocCount=369
DEBUG 2025/12/17 16:52:01   Bucket[15]: Key=竹南高中, DocCount=359
DEBUG 2025/12/17 16:52:01   Bucket[16]: Key=旗美高中, DocCount=354
DEBUG 2025/12/17 16:52:01   Bucket[17]: Key=新港藝高, DocCount=351
DEBUG 2025/12/17 16:52:01   Bucket[18]: Key=後壁高中, DocCount=326
DEBUG 2025/12/17 16:52:01   Bucket[19]: Key=花蓮高商, DocCount=318
DEBUG 2025/12/17 16:52:01   Bucket[20]: Key=關西高中, DocCount=307
DEBUG 2025/12/17 16:52:01   Bucket[21]: Key=斗六家商, DocCount=303
DEBUG 2025/12/17 16:52:01   Bucket[22]: Key=屏東女中, DocCount=294
DEBUG 2025/12/17 16:52:01   Bucket[23]: Key=內埔農工, DocCount=293
DEBUG 2025/12/17 16:52:01   Bucket[24]: Key=苗栗農工, DocCount=274
DEBUG 2025/12/17 16:52:01   Bucket[25]: Key=蘇澳海事, DocCount=262
DEBUG 2025/12/17 16:52:01   Bucket[26]: Key=南投特教, DocCount=256
DEBUG 2025/12/17 16:52:01   Bucket[27]: Key=員林家商, DocCount=256
DEBUG 2025/12/17 16:52:01   Bucket[28]: Key=關山工商, DocCount=235
DEBUG 2025/12/17 16:52:01   Bucket[29]: Key=新竹高工, DocCount=183
DEBUG 2025/12/17 16:52:01   Bucket[30]: Key=新營高工, DocCount=178
DEBUG 2025/12/17 16:52:01   Bucket[31]: Key=新化高中, DocCount=176
DEBUG 2025/12/17 16:52:01   Bucket[32]: Key=羅東高商, DocCount=157
DEBUG 2025/12/17 16:52:01   Bucket[33]: Key=玉里高中, DocCount=150
DEBUG 2025/12/17 16:52:01   Bucket[34]: Key=屏東高中, DocCount=149
DEBUG 2025/12/17 16:52:01   Bucket[35]: Key=北教大實小, DocCount=145
DEBUG 2025/12/17 16:52:01   Bucket[36]: Key=北港高中, DocCount=143
DEBUG 2025/12/17 16:52:01   Bucket[37]: Key=嘉科實中, DocCount=140
DEBUG 2025/12/17 16:52:01   Bucket[38]: Key=政大附中, DocCount=140
DEBUG 2025/12/17 16:52:01   Bucket[39]: Key=東港海事, DocCount=138
DEBUG 2025/12/17 16:52:01   Bucket[40]: Key=北斗家商, DocCount=136
DEBUG 2025/12/17 16:52:01   Bucket[41]: Key=新化高工, DocCount=136
DEBUG 2025/12/17 16:52:01   Bucket[42]: Key=彰師附工, DocCount=125
DEBUG 2025/12/17 16:52:01   Bucket[43]: Key=師大附中高中部, DocCount=122
DEBUG 2025/12/17 16:52:01   Bucket[44]: Key=水里商工, DocCount=122
DEBUG 2025/12/17 16:52:01   Bucket[45]: Key=苗栗高商, DocCount=116
DEBUG 2025/12/17 16:52:01   Bucket[46]: Key=新營高中, DocCount=114
DEBUG 2025/12/17 16:52:01   Bucket[47]: Key=草屯商工, DocCount=111
DEBUG 2025/12/17 16:52:01   Bucket[48]: Key=虎尾高中, DocCount=110
DEBUG 2025/12/17 16:52:01   Bucket[49]: Key=南大附聰, DocCount=107
DEBUG 2025/12/17 16:52:01   Bucket[50]: Key=嘉義高商, DocCount=107
DEBUG 2025/12/17 16:52:01   Bucket[51]: Key=彰化高商, DocCount=104
DEBUG 2025/12/17 16:52:01   Bucket[52]: Key=南投高中, DocCount=98
DEBUG 2025/12/17 16:52:01   Bucket[53]: Key=成大南工, DocCount=97
DEBUG 2025/12/17 16:52:01   Bucket[54]: Key=嘉義高中, DocCount=93
DEBUG 2025/12/17 16:52:01   Bucket[55]: Key=曾文農工, DocCount=92
DEBUG 2025/12/17 16:52:01   Bucket[56]: Key=二林工商, DocCount=90
DEBUG 2025/12/17 16:52:01   Bucket[57]: Key=新竹高中, DocCount=87
DEBUG 2025/12/17 16:52:01   Bucket[58]: Key=華南高商, DocCount=86
DEBUG 2025/12/17 16:52:01   Bucket[59]: Key=新竹高商, DocCount=82
DEBUG 2025/12/17 16:52:01   Bucket[60]: Key=員林農工, DocCount=81
DEBUG 2025/12/17 16:52:01   Bucket[61]: Key=鳳山高中, DocCount=81
DEBUG 2025/12/17 16:52:01   Bucket[62]: Key=宜蘭高中, DocCount=77
DEBUG 2025/12/17 16:52:01   Bucket[63]: Key=基隆商工, DocCount=76
DEBUG 2025/12/17 16:52:01   Bucket[64]: Key=屏科實中, DocCount=73
DEBUG 2025/12/17 16:52:01   Bucket[65]: Key=溪湖高中, DocCount=72
DEBUG 2025/12/17 16:52:01   Bucket[66]: Key=臺東女中, DocCount=69
DEBUG 2025/12/17 16:52:01   Bucket[67]: Key=花蓮高工, DocCount=69
DEBUG 2025/12/17 16:52:01   Bucket[68]: Key=屏東高工, DocCount=67
DEBUG 2025/12/17 16:52:01   Bucket[69]: Key=潮州高中, DocCount=67
DEBUG 2025/12/17 16:52:01   Bucket[70]: Key=北港農工, DocCount=65
DEBUG 2025/12/17 16:52:01   Bucket[71]: Key=臺南高商, DocCount=64
DEBUG 2025/12/17 16:52:01   Bucket[72]: Key=南大附中, DocCount=63
DEBUG 2025/12/17 16:52:01   Bucket[73]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:52:01   Bucket[74]: Key=南大附小, DocCount=62
DEBUG 2025/12/17 16:52:01   Bucket[75]: Key=雲林特教, DocCount=62
DEBUG 2025/12/17 16:52:01   Bucket[76]: Key=善化高中, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[77]: Key=旗山農工, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[78]: Key=海大附中, DocCount=61
DEBUG 2025/12/17 16:52:01   Bucket[79]: Key=暨大附中, DocCount=59
DEBUG 2025/12/17 16:52:01   Bucket[80]: Key=羅東高工, DocCount=58
DEBUG 2025/12/17 16:52:01   Bucket[81]: Key=竹山高中, DocCount=57
DEBUG 2025/12/17 16:52:01   Bucket[82]: Key=埔里高工, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[83]: Key=臺東高商, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[84]: Key=蘭陽女中, DocCount=56
DEBUG 2025/12/17 16:52:01   Bucket[85]: Key=興大附農, DocCount=55
DEBUG 2025/12/17 16:52:01   Bucket[86]: Key=嘉義高工, DocCount=53
DEBUG 2025/12/17 16:52:01   Bucket[87]: Key=花蓮高中, DocCount=53
DEBUG 2025/12/17 16:52:01   Bucket[88]: Key=中興高中, DocCount=52
DEBUG 2025/12/17 16:52:01   Bucket[89]: Key=屏北高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[90]: Key=新豐高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[91]: Key=東石高中, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[92]: Key=永靖高工, DocCount=51
DEBUG 2025/12/17 16:52:01   Bucket[93]: Key=臺南一中, DocCount=49
DEBUG 2025/12/17 16:52:01   Bucket[94]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 16:52:01   Bucket[95]: Key=土庫商工, DocCount=46
DEBUG 2025/12/17 16:52:01   Bucket[96]: Key=成功商水, DocCount=45
DEBUG 2025/12/17 16:52:01   Bucket[97]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 16:52:01   Bucket[98]: Key=頭城家商, DocCount=44
DEBUG 2025/12/17 16:52:01   Bucket[99]: Key=高餐大附中, DocCount=44
DEBUG 2025/12/17 16:52:01 ========================================================
INFO 2025/12/17 16:52:08 ✅ Successfully flushed 39/39 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:52:14 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:52:15 Processing 15 offline devices
INFO 2025/12/17 16:52:15 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:52:15 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:52:15 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:52:15 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:52:15 Creating history record for offline device: 崇實高工
INFO 2025/12/17 16:52:15 About to add history to batch for device: 崇實高工
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 16:52:15 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:52:15 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:52:15 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:52:15 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:52:15 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:52:16 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:52:16 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:52:16 Creating history record for offline device: 白河商工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 白河商工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 家齊高中
INFO 2025/12/17 16:52:16 About to add history to batch for device: 家齊高中
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 16:52:16 Creating history record for offline device: 秀水高工
INFO 2025/12/17 16:52:16 About to add history to batch for device: 秀水高工
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 16:52:16 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:52:16 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:52:16 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:52:18 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:52:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 16:52:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:52:45 Starting ES monitor check for: 93
INFO 2025/12/17 16:52:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:52:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:52:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:52:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:52:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:52:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:52:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 16:52:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.57% (threshold: 80.00%)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.24% (threshold: 85.00%)
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:52:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:52:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:52:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:52:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:52:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:53:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:53:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:53:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:53:00 Field: school_name.keyword
DEBUG 2025/12/17 16:53:00 Time From: 2025-12-17T16:52:00.000+08:00
DEBUG 2025/12/17 16:53:00 Time To: 2025-12-17T16:53:00.000+08:00
DEBUG 2025/12/17 16:53:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:52:00.000+08:00",
					"lte": "2025-12-17T16:53:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:53:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:53:00 ES Response IsError: false
DEBUG 2025/12/17 16:53:00 ES Response Body:
{"took":191,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":506,"buckets":[{"key":"黑快馬主機","doc_count":1509},{"key":"南投高商","doc_count":930},{"key":"花蓮高農","doc_count":803},{"key":"仁愛高農","doc_count":622},{"key":"新竹女中","doc_count":545},{"key":"臺東高中","doc_count":545},{"key":"華僑高中","doc_count":526},{"key":"中大壢中","doc_count":513},{"key":"金門高中","doc_count":510},{"key":"金門農工","doc_count":495},{"key":"宜蘭高商","doc_count":485},{"key":"竹北高中","doc_count":456},{"key":"北門高中","doc_count":429},{"key":"清華附小","doc_count":367},{"key":"興大附中","doc_count":358},{"key":"新港藝高","doc_count":346},{"key":"旗美高中","doc_count":311},{"key":"內埔農工","doc_count":303},{"key":"關西高中","doc_count":300},{"key":"後壁高中","doc_count":288},{"key":"竹南高中","doc_count":287},{"key":"斗六家商","doc_count":277},{"key":"花蓮高商","doc_count":263},{"key":"屏東女中","doc_count":258},{"key":"苗栗農工","doc_count":256},{"key":"蘇澳海事","doc_count":254},{"key":"南投特教","doc_count":234},{"key":"新化高中","doc_count":234},{"key":"員林家商","doc_count":220},{"key":"關山工商","doc_count":215},{"key":"嘉義高商","doc_count":193},{"key":"南大附聰","doc_count":172},{"key":"新化高工","doc_count":167},{"key":"新營高工","doc_count":167},{"key":"新竹高工","doc_count":165},{"key":"彰化高商","doc_count":162},{"key":"北港農工","doc_count":159},{"key":"政大附中","doc_count":157},{"key":"玉里高中","doc_count":156},{"key":"彰師附工","doc_count":153},{"key":"成大南工","doc_count":149},{"key":"屏東高中","doc_count":138},{"key":"東港海事","doc_count":138},{"key":"新竹高中","doc_count":137},{"key":"嘉科實中","doc_count":135},{"key":"蘭陽女中","doc_count":110},{"key":"南大附中","doc_count":105},{"key":"北斗家商","doc_count":99},{"key":"水里商工","doc_count":98},{"key":"師大附中高中部","doc_count":96},{"key":"苗栗高中","doc_count":95},{"key":"虎尾高中","doc_count":94},{"key":"臺東高商","doc_count":91},{"key":"花蓮高工","doc_count":89},{"key":"羅東高商","doc_count":88},{"key":"宜蘭高中","doc_count":87},{"key":"曾文農工","doc_count":85},{"key":"竹東高中","doc_count":85},{"key":"苗栗高商","doc_count":82},{"key":"屏科實中","doc_count":80},{"key":"新營高中","doc_count":80},{"key":"澎湖海事","doc_count":79},{"key":"北教大實小","doc_count":78},{"key":"基隆商工","doc_count":76},{"key":"玉井工商","doc_count":75},{"key":"南投高中","doc_count":73},{"key":"北港高中","doc_count":71},{"key":"崇實高工","doc_count":71},{"key":"埔里高工","doc_count":69},{"key":"中興高中","doc_count":68},{"key":"員林農工","doc_count":67},{"key":"嘉義高中","doc_count":67},{"key":"嘉義高工","doc_count":66},{"key":"雲林特教","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"東石高中","doc_count":63},{"key":"屏東高工","doc_count":61},{"key":"屏北高中","doc_count":56},{"key":"秀水高工","doc_count":56},{"key":"潮州高中","doc_count":54},{"key":"臺南一中","doc_count":54},{"key":"鳳山高中","doc_count":54},{"key":"善化高中","doc_count":50},{"key":"土庫商工","doc_count":50},{"key":"基隆特教","doc_count":49},{"key":"頭城家商","doc_count":49},{"key":"白河商工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"屏東特教","doc_count":47},{"key":"草屯商工","doc_count":47},{"key":"員林高中","doc_count":46},{"key":"溪湖高中","doc_count":46},{"key":"臺南高商","doc_count":46},{"key":"佳冬高農","doc_count":44},{"key":"花蓮特教","doc_count":44},{"key":"興大附農","doc_count":43},{"key":"家齊高中","doc_count":42},{"key":"成功商水","doc_count":42},{"key":"羅東高工","doc_count":42},{"key":"海大附中","doc_count":41}]}}}
DEBUG 2025/12/17 16:53:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:53:00   Bucket[0]: Key=黑快馬主機, DocCount=1509
DEBUG 2025/12/17 16:53:00   Bucket[1]: Key=南投高商, DocCount=930
DEBUG 2025/12/17 16:53:00   Bucket[2]: Key=花蓮高農, DocCount=803
DEBUG 2025/12/17 16:53:00   Bucket[3]: Key=仁愛高農, DocCount=622
DEBUG 2025/12/17 16:53:00   Bucket[4]: Key=新竹女中, DocCount=545
DEBUG 2025/12/17 16:53:00   Bucket[5]: Key=臺東高中, DocCount=545
DEBUG 2025/12/17 16:53:00   Bucket[6]: Key=華僑高中, DocCount=526
DEBUG 2025/12/17 16:53:00   Bucket[7]: Key=中大壢中, DocCount=513
DEBUG 2025/12/17 16:53:00   Bucket[8]: Key=金門高中, DocCount=510
DEBUG 2025/12/17 16:53:00   Bucket[9]: Key=金門農工, DocCount=495
DEBUG 2025/12/17 16:53:00   Bucket[10]: Key=宜蘭高商, DocCount=485
DEBUG 2025/12/17 16:53:00   Bucket[11]: Key=竹北高中, DocCount=456
DEBUG 2025/12/17 16:53:00   Bucket[12]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 16:53:00   Bucket[13]: Key=清華附小, DocCount=367
DEBUG 2025/12/17 16:53:00   Bucket[14]: Key=興大附中, DocCount=358
DEBUG 2025/12/17 16:53:00   Bucket[15]: Key=新港藝高, DocCount=346
DEBUG 2025/12/17 16:53:00   Bucket[16]: Key=旗美高中, DocCount=311
DEBUG 2025/12/17 16:53:00   Bucket[17]: Key=內埔農工, DocCount=303
DEBUG 2025/12/17 16:53:00   Bucket[18]: Key=關西高中, DocCount=300
DEBUG 2025/12/17 16:53:00   Bucket[19]: Key=後壁高中, DocCount=288
DEBUG 2025/12/17 16:53:00   Bucket[20]: Key=竹南高中, DocCount=287
DEBUG 2025/12/17 16:53:00   Bucket[21]: Key=斗六家商, DocCount=277
DEBUG 2025/12/17 16:53:00   Bucket[22]: Key=花蓮高商, DocCount=263
DEBUG 2025/12/17 16:53:00   Bucket[23]: Key=屏東女中, DocCount=258
DEBUG 2025/12/17 16:53:00   Bucket[24]: Key=苗栗農工, DocCount=256
DEBUG 2025/12/17 16:53:00   Bucket[25]: Key=蘇澳海事, DocCount=254
DEBUG 2025/12/17 16:53:00   Bucket[26]: Key=南投特教, DocCount=234
DEBUG 2025/12/17 16:53:00   Bucket[27]: Key=新化高中, DocCount=234
DEBUG 2025/12/17 16:53:00   Bucket[28]: Key=員林家商, DocCount=220
DEBUG 2025/12/17 16:53:00   Bucket[29]: Key=關山工商, DocCount=215
DEBUG 2025/12/17 16:53:00   Bucket[30]: Key=嘉義高商, DocCount=193
DEBUG 2025/12/17 16:53:00   Bucket[31]: Key=南大附聰, DocCount=172
DEBUG 2025/12/17 16:53:00   Bucket[32]: Key=新化高工, DocCount=167
DEBUG 2025/12/17 16:53:00   Bucket[33]: Key=新營高工, DocCount=167
DEBUG 2025/12/17 16:53:00   Bucket[34]: Key=新竹高工, DocCount=165
DEBUG 2025/12/17 16:53:00   Bucket[35]: Key=彰化高商, DocCount=162
DEBUG 2025/12/17 16:53:00   Bucket[36]: Key=北港農工, DocCount=159
DEBUG 2025/12/17 16:53:00   Bucket[37]: Key=政大附中, DocCount=157
DEBUG 2025/12/17 16:53:00   Bucket[38]: Key=玉里高中, DocCount=156
DEBUG 2025/12/17 16:53:00   Bucket[39]: Key=彰師附工, DocCount=153
DEBUG 2025/12/17 16:53:00   Bucket[40]: Key=成大南工, DocCount=149
DEBUG 2025/12/17 16:53:00   Bucket[41]: Key=屏東高中, DocCount=138
DEBUG 2025/12/17 16:53:00   Bucket[42]: Key=東港海事, DocCount=138
DEBUG 2025/12/17 16:53:00   Bucket[43]: Key=新竹高中, DocCount=137
DEBUG 2025/12/17 16:53:00   Bucket[44]: Key=嘉科實中, DocCount=135
DEBUG 2025/12/17 16:53:00   Bucket[45]: Key=蘭陽女中, DocCount=110
DEBUG 2025/12/17 16:53:00   Bucket[46]: Key=南大附中, DocCount=105
DEBUG 2025/12/17 16:53:00   Bucket[47]: Key=北斗家商, DocCount=99
DEBUG 2025/12/17 16:53:00   Bucket[48]: Key=水里商工, DocCount=98
DEBUG 2025/12/17 16:53:00   Bucket[49]: Key=師大附中高中部, DocCount=96
DEBUG 2025/12/17 16:53:00   Bucket[50]: Key=苗栗高中, DocCount=95
DEBUG 2025/12/17 16:53:00   Bucket[51]: Key=虎尾高中, DocCount=94
DEBUG 2025/12/17 16:53:00   Bucket[52]: Key=臺東高商, DocCount=91
DEBUG 2025/12/17 16:53:00   Bucket[53]: Key=花蓮高工, DocCount=89
DEBUG 2025/12/17 16:53:00   Bucket[54]: Key=羅東高商, DocCount=88
DEBUG 2025/12/17 16:53:00   Bucket[55]: Key=宜蘭高中, DocCount=87
DEBUG 2025/12/17 16:53:00   Bucket[56]: Key=曾文農工, DocCount=85
DEBUG 2025/12/17 16:53:00   Bucket[57]: Key=竹東高中, DocCount=85
DEBUG 2025/12/17 16:53:00   Bucket[58]: Key=苗栗高商, DocCount=82
DEBUG 2025/12/17 16:53:00   Bucket[59]: Key=屏科實中, DocCount=80
DEBUG 2025/12/17 16:53:00   Bucket[60]: Key=新營高中, DocCount=80
DEBUG 2025/12/17 16:53:00   Bucket[61]: Key=澎湖海事, DocCount=79
DEBUG 2025/12/17 16:53:00   Bucket[62]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 16:53:00   Bucket[63]: Key=基隆商工, DocCount=76
DEBUG 2025/12/17 16:53:00   Bucket[64]: Key=玉井工商, DocCount=75
DEBUG 2025/12/17 16:53:00   Bucket[65]: Key=南投高中, DocCount=73
DEBUG 2025/12/17 16:53:00   Bucket[66]: Key=北港高中, DocCount=71
DEBUG 2025/12/17 16:53:00   Bucket[67]: Key=崇實高工, DocCount=71
DEBUG 2025/12/17 16:53:00   Bucket[68]: Key=埔里高工, DocCount=69
DEBUG 2025/12/17 16:53:00   Bucket[69]: Key=中興高中, DocCount=68
DEBUG 2025/12/17 16:53:00   Bucket[70]: Key=員林農工, DocCount=67
DEBUG 2025/12/17 16:53:00   Bucket[71]: Key=嘉義高中, DocCount=67
DEBUG 2025/12/17 16:53:00   Bucket[72]: Key=嘉義高工, DocCount=66
DEBUG 2025/12/17 16:53:00   Bucket[73]: Key=雲林特教, DocCount=64
DEBUG 2025/12/17 16:53:00   Bucket[74]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 16:53:00   Bucket[75]: Key=東石高中, DocCount=63
DEBUG 2025/12/17 16:53:00   Bucket[76]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 16:53:00   Bucket[77]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 16:53:00   Bucket[78]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 16:53:00   Bucket[79]: Key=潮州高中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[80]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[81]: Key=鳳山高中, DocCount=54
DEBUG 2025/12/17 16:53:00   Bucket[82]: Key=善化高中, DocCount=50
DEBUG 2025/12/17 16:53:00   Bucket[83]: Key=土庫商工, DocCount=50
DEBUG 2025/12/17 16:53:00   Bucket[84]: Key=基隆特教, DocCount=49
DEBUG 2025/12/17 16:53:00   Bucket[85]: Key=頭城家商, DocCount=49
DEBUG 2025/12/17 16:53:00   Bucket[86]: Key=白河商工, DocCount=48
DEBUG 2025/12/17 16:53:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 16:53:00   Bucket[88]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 16:53:00   Bucket[89]: Key=草屯商工, DocCount=47
DEBUG 2025/12/17 16:53:00   Bucket[90]: Key=員林高中, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[91]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[92]: Key=臺南高商, DocCount=46
DEBUG 2025/12/17 16:53:00   Bucket[93]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 16:53:00   Bucket[94]: Key=花蓮特教, DocCount=44
DEBUG 2025/12/17 16:53:00   Bucket[95]: Key=興大附農, DocCount=43
DEBUG 2025/12/17 16:53:00   Bucket[96]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[97]: Key=成功商水, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[98]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 16:53:00   Bucket[99]: Key=海大附中, DocCount=41
DEBUG 2025/12/17 16:53:00 ========================================================
INFO 2025/12/17 16:53:03 ✅ Successfully flushed 15/15 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:53:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 16:53:08 ✅ Successfully flushed 4/4 history records to TimescaleDB
INFO 2025/12/17 16:53:09 Processing 15 offline devices
INFO 2025/12/17 16:53:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:53:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:53:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:53:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:53:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新竹高商
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新竹高商
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 16:53:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 16:53:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 16:53:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 16:53:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 16:53:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:53:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:53:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:53:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:53:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:53:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:53:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:53:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:53:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:53:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:53:10 Creating history record for offline device: 永靖高工
INFO 2025/12/17 16:53:10 About to add history to batch for device: 永靖高工
INFO 2025/12/17 16:53:10 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 16:53:13 ✅ Successfully flushed 32/32 history records to TimescaleDB
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:53:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:53:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:53:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:53:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:53:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:53:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:53:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:53:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:53:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:53:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:53:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:53:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.77% (threshold: 80.00%)
INFO 2025/12/17 16:53:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:53:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:53:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:53:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:53:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:53:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:54:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:54:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:54:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:54:00 Field: school_name.keyword
DEBUG 2025/12/17 16:54:00 Time From: 2025-12-17T16:53:00.000+08:00
DEBUG 2025/12/17 16:54:00 Time To: 2025-12-17T16:54:00.000+08:00
DEBUG 2025/12/17 16:54:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:53:00.000+08:00",
					"lte": "2025-12-17T16:54:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:54:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:54:00 ES Response IsError: false
DEBUG 2025/12/17 16:54:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":1753},{"key":"南投高商","doc_count":822},{"key":"花蓮高農","doc_count":813},{"key":"金門農工","doc_count":723},{"key":"仁愛高農","doc_count":609},{"key":"金門高中","doc_count":585},{"key":"竹北高中","doc_count":541},{"key":"新竹女中","doc_count":538},{"key":"臺東高中","doc_count":520},{"key":"華僑高中","doc_count":438},{"key":"北門高中","doc_count":429},{"key":"宜蘭高商","doc_count":414},{"key":"政大附中","doc_count":380},{"key":"新港藝高","doc_count":375},{"key":"興大附中","doc_count":366},{"key":"蘇澳海事","doc_count":320},{"key":"旗美高中","doc_count":310},{"key":"清華附小","doc_count":310},{"key":"內埔農工","doc_count":300},{"key":"新化高中","doc_count":299},{"key":"關西高中","doc_count":288},{"key":"後壁高中","doc_count":268},{"key":"竹南高中","doc_count":264},{"key":"花蓮高商","doc_count":256},{"key":"苗栗農工","doc_count":249},{"key":"南投特教","doc_count":248},{"key":"中大壢中","doc_count":241},{"key":"斗六家商","doc_count":228},{"key":"屏東女中","doc_count":199},{"key":"東港海事","doc_count":197},{"key":"關山工商","doc_count":197},{"key":"新化高工","doc_count":184},{"key":"南大附聰","doc_count":183},{"key":"嘉義高商","doc_count":171},{"key":"員林家商","doc_count":169},{"key":"北斗家商","doc_count":151},{"key":"苗栗高中","doc_count":149},{"key":"玉里高中","doc_count":146},{"key":"新營高工","doc_count":137},{"key":"苗栗高商","doc_count":124},{"key":"師大附中高中部","doc_count":119},{"key":"虎尾高中","doc_count":116},{"key":"南投高中","doc_count":115},{"key":"彰師附工","doc_count":112},{"key":"臺東女中","doc_count":112},{"key":"彰化高商","doc_count":110},{"key":"崇實高工","doc_count":100},{"key":"新竹高工","doc_count":100},{"key":"員林農工","doc_count":96},{"key":"宜蘭高中","doc_count":92},{"key":"花蓮高工","doc_count":90},{"key":"成大南工","doc_count":89},{"key":"北港高中","doc_count":88},{"key":"員林高中","doc_count":87},{"key":"北教大實小","doc_count":85},{"key":"南大附中","doc_count":85},{"key":"臺東高商","doc_count":83},{"key":"二林工商","doc_count":81},{"key":"新營高中","doc_count":77},{"key":"永靖高工","doc_count":77},{"key":"嘉科實中","doc_count":76},{"key":"羅東高商","doc_count":76},{"key":"水里商工","doc_count":72},{"key":"埔里高工","doc_count":70},{"key":"屏科實中","doc_count":70},{"key":"北港農工","doc_count":68},{"key":"屏東高工","doc_count":65},{"key":"嘉義高中","doc_count":63},{"key":"新竹高中","doc_count":62},{"key":"中興高中","doc_count":60},{"key":"雲林特教","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"東石高中","doc_count":59},{"key":"草屯商工","doc_count":55},{"key":"佳冬高農","doc_count":54},{"key":"花蓮特教","doc_count":54},{"key":"羅東高工","doc_count":53},{"key":"屏東特教","doc_count":52},{"key":"嘉義家職","doc_count":51},{"key":"華南高商","doc_count":51},{"key":"基隆商工","doc_count":50},{"key":"成功商水","doc_count":49},{"key":"臺南高商","doc_count":48},{"key":"頭城家商","doc_count":48},{"key":"興大附農","doc_count":47},{"key":"旗山農工","doc_count":46},{"key":"海大附中","doc_count":46},{"key":"屏東高中","doc_count":45},{"key":"潮州高中","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"家齊高中","doc_count":43},{"key":"善化高中","doc_count":42},{"key":"新豐高中","doc_count":42},{"key":"秀水高工","doc_count":42},{"key":"南大附小","doc_count":41},{"key":"白河商工","doc_count":41},{"key":"玉井工商","doc_count":40},{"key":"嘉義高工","doc_count":39},{"key":"曾文農工","doc_count":39},{"key":"竹東高中","doc_count":39}]}}}
DEBUG 2025/12/17 16:54:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:54:00   Bucket[0]: Key=黑快馬主機, DocCount=1753
DEBUG 2025/12/17 16:54:00   Bucket[1]: Key=南投高商, DocCount=822
DEBUG 2025/12/17 16:54:00   Bucket[2]: Key=花蓮高農, DocCount=813
DEBUG 2025/12/17 16:54:00   Bucket[3]: Key=金門農工, DocCount=723
DEBUG 2025/12/17 16:54:00   Bucket[4]: Key=仁愛高農, DocCount=609
DEBUG 2025/12/17 16:54:00   Bucket[5]: Key=金門高中, DocCount=585
DEBUG 2025/12/17 16:54:00   Bucket[6]: Key=竹北高中, DocCount=541
DEBUG 2025/12/17 16:54:00   Bucket[7]: Key=新竹女中, DocCount=538
DEBUG 2025/12/17 16:54:00   Bucket[8]: Key=臺東高中, DocCount=520
DEBUG 2025/12/17 16:54:00   Bucket[9]: Key=華僑高中, DocCount=438
DEBUG 2025/12/17 16:54:00   Bucket[10]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 16:54:00   Bucket[11]: Key=宜蘭高商, DocCount=414
DEBUG 2025/12/17 16:54:00   Bucket[12]: Key=政大附中, DocCount=380
DEBUG 2025/12/17 16:54:00   Bucket[13]: Key=新港藝高, DocCount=375
DEBUG 2025/12/17 16:54:00   Bucket[14]: Key=興大附中, DocCount=366
DEBUG 2025/12/17 16:54:00   Bucket[15]: Key=蘇澳海事, DocCount=320
DEBUG 2025/12/17 16:54:00   Bucket[16]: Key=旗美高中, DocCount=310
DEBUG 2025/12/17 16:54:00   Bucket[17]: Key=清華附小, DocCount=310
DEBUG 2025/12/17 16:54:00   Bucket[18]: Key=內埔農工, DocCount=300
DEBUG 2025/12/17 16:54:00   Bucket[19]: Key=新化高中, DocCount=299
DEBUG 2025/12/17 16:54:00   Bucket[20]: Key=關西高中, DocCount=288
DEBUG 2025/12/17 16:54:00   Bucket[21]: Key=後壁高中, DocCount=268
DEBUG 2025/12/17 16:54:00   Bucket[22]: Key=竹南高中, DocCount=264
DEBUG 2025/12/17 16:54:00   Bucket[23]: Key=花蓮高商, DocCount=256
DEBUG 2025/12/17 16:54:00   Bucket[24]: Key=苗栗農工, DocCount=249
DEBUG 2025/12/17 16:54:00   Bucket[25]: Key=南投特教, DocCount=248
DEBUG 2025/12/17 16:54:00   Bucket[26]: Key=中大壢中, DocCount=241
DEBUG 2025/12/17 16:54:00   Bucket[27]: Key=斗六家商, DocCount=228
DEBUG 2025/12/17 16:54:00   Bucket[28]: Key=屏東女中, DocCount=199
DEBUG 2025/12/17 16:54:00   Bucket[29]: Key=東港海事, DocCount=197
DEBUG 2025/12/17 16:54:00   Bucket[30]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 16:54:00   Bucket[31]: Key=新化高工, DocCount=184
DEBUG 2025/12/17 16:54:00   Bucket[32]: Key=南大附聰, DocCount=183
DEBUG 2025/12/17 16:54:00   Bucket[33]: Key=嘉義高商, DocCount=171
DEBUG 2025/12/17 16:54:00   Bucket[34]: Key=員林家商, DocCount=169
DEBUG 2025/12/17 16:54:00   Bucket[35]: Key=北斗家商, DocCount=151
DEBUG 2025/12/17 16:54:00   Bucket[36]: Key=苗栗高中, DocCount=149
DEBUG 2025/12/17 16:54:00   Bucket[37]: Key=玉里高中, DocCount=146
DEBUG 2025/12/17 16:54:00   Bucket[38]: Key=新營高工, DocCount=137
DEBUG 2025/12/17 16:54:00   Bucket[39]: Key=苗栗高商, DocCount=124
DEBUG 2025/12/17 16:54:00   Bucket[40]: Key=師大附中高中部, DocCount=119
DEBUG 2025/12/17 16:54:00   Bucket[41]: Key=虎尾高中, DocCount=116
DEBUG 2025/12/17 16:54:00   Bucket[42]: Key=南投高中, DocCount=115
DEBUG 2025/12/17 16:54:00   Bucket[43]: Key=彰師附工, DocCount=112
DEBUG 2025/12/17 16:54:00   Bucket[44]: Key=臺東女中, DocCount=112
DEBUG 2025/12/17 16:54:00   Bucket[45]: Key=彰化高商, DocCount=110
DEBUG 2025/12/17 16:54:00   Bucket[46]: Key=崇實高工, DocCount=100
DEBUG 2025/12/17 16:54:00   Bucket[47]: Key=新竹高工, DocCount=100
DEBUG 2025/12/17 16:54:00   Bucket[48]: Key=員林農工, DocCount=96
DEBUG 2025/12/17 16:54:00   Bucket[49]: Key=宜蘭高中, DocCount=92
DEBUG 2025/12/17 16:54:00   Bucket[50]: Key=花蓮高工, DocCount=90
DEBUG 2025/12/17 16:54:00   Bucket[51]: Key=成大南工, DocCount=89
DEBUG 2025/12/17 16:54:00   Bucket[52]: Key=北港高中, DocCount=88
DEBUG 2025/12/17 16:54:00   Bucket[53]: Key=員林高中, DocCount=87
DEBUG 2025/12/17 16:54:00   Bucket[54]: Key=北教大實小, DocCount=85
DEBUG 2025/12/17 16:54:00   Bucket[55]: Key=南大附中, DocCount=85
DEBUG 2025/12/17 16:54:00   Bucket[56]: Key=臺東高商, DocCount=83
DEBUG 2025/12/17 16:54:00   Bucket[57]: Key=二林工商, DocCount=81
DEBUG 2025/12/17 16:54:00   Bucket[58]: Key=新營高中, DocCount=77
DEBUG 2025/12/17 16:54:00   Bucket[59]: Key=永靖高工, DocCount=77
DEBUG 2025/12/17 16:54:00   Bucket[60]: Key=嘉科實中, DocCount=76
DEBUG 2025/12/17 16:54:00   Bucket[61]: Key=羅東高商, DocCount=76
DEBUG 2025/12/17 16:54:00   Bucket[62]: Key=水里商工, DocCount=72
DEBUG 2025/12/17 16:54:00   Bucket[63]: Key=埔里高工, DocCount=70
DEBUG 2025/12/17 16:54:00   Bucket[64]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 16:54:00   Bucket[65]: Key=北港農工, DocCount=68
DEBUG 2025/12/17 16:54:00   Bucket[66]: Key=屏東高工, DocCount=65
DEBUG 2025/12/17 16:54:00   Bucket[67]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 16:54:00   Bucket[68]: Key=新竹高中, DocCount=62
DEBUG 2025/12/17 16:54:00   Bucket[69]: Key=中興高中, DocCount=60
DEBUG 2025/12/17 16:54:00   Bucket[70]: Key=雲林特教, DocCount=60
DEBUG 2025/12/17 16:54:00   Bucket[71]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 16:54:00   Bucket[72]: Key=東石高中, DocCount=59
DEBUG 2025/12/17 16:54:00   Bucket[73]: Key=草屯商工, DocCount=55
DEBUG 2025/12/17 16:54:00   Bucket[74]: Key=佳冬高農, DocCount=54
DEBUG 2025/12/17 16:54:00   Bucket[75]: Key=花蓮特教, DocCount=54
DEBUG 2025/12/17 16:54:00   Bucket[76]: Key=羅東高工, DocCount=53
DEBUG 2025/12/17 16:54:00   Bucket[77]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 16:54:00   Bucket[78]: Key=嘉義家職, DocCount=51
DEBUG 2025/12/17 16:54:00   Bucket[79]: Key=華南高商, DocCount=51
DEBUG 2025/12/17 16:54:00   Bucket[80]: Key=基隆商工, DocCount=50
DEBUG 2025/12/17 16:54:00   Bucket[81]: Key=成功商水, DocCount=49
DEBUG 2025/12/17 16:54:00   Bucket[82]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 16:54:00   Bucket[83]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 16:54:00   Bucket[84]: Key=興大附農, DocCount=47
DEBUG 2025/12/17 16:54:00   Bucket[85]: Key=旗山農工, DocCount=46
DEBUG 2025/12/17 16:54:00   Bucket[86]: Key=海大附中, DocCount=46
DEBUG 2025/12/17 16:54:00   Bucket[87]: Key=屏東高中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[88]: Key=潮州高中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[89]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 16:54:00   Bucket[90]: Key=家齊高中, DocCount=43
DEBUG 2025/12/17 16:54:00   Bucket[91]: Key=善化高中, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[92]: Key=新豐高中, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[93]: Key=秀水高工, DocCount=42
DEBUG 2025/12/17 16:54:00   Bucket[94]: Key=南大附小, DocCount=41
DEBUG 2025/12/17 16:54:00   Bucket[95]: Key=白河商工, DocCount=41
DEBUG 2025/12/17 16:54:00   Bucket[96]: Key=玉井工商, DocCount=40
DEBUG 2025/12/17 16:54:00   Bucket[97]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 16:54:00   Bucket[98]: Key=曾文農工, DocCount=39
DEBUG 2025/12/17 16:54:00   Bucket[99]: Key=竹東高中, DocCount=39
DEBUG 2025/12/17 16:54:00 ========================================================
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:54:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 16:54:08 ✅ Successfully flushed 32/32 history records to TimescaleDB
INFO 2025/12/17 16:54:08 Processing 15 offline devices
INFO 2025/12/17 16:54:08 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:54:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:54:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:54:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:54:08 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 16:54:08 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 16:54:08 Creating history record for offline device: 新竹高商
INFO 2025/12/17 16:54:08 About to add history to batch for device: 新竹高商
INFO 2025/12/17 16:54:08 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 16:54:08 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 16:54:08 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 鳳山高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 鳳山高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 鳳山高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:54:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:54:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:54:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:54:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:54:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:54:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:54:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:54:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:54:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:54:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:54:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:54:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:54:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:54:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:54:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:54:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:54:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:54:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.45% (threshold: 80.00%)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.31% (threshold: 85.00%)
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:54:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 16:54:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:54:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:54:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:54:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:54:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:55:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:55:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:55:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:55:00 Field: school_name.keyword
DEBUG 2025/12/17 16:55:00 Time From: 2025-12-17T16:54:00.000+08:00
DEBUG 2025/12/17 16:55:00 Time To: 2025-12-17T16:55:00.000+08:00
DEBUG 2025/12/17 16:55:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:54:00.000+08:00",
					"lte": "2025-12-17T16:55:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:55:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:55:00 ES Response IsError: false
DEBUG 2025/12/17 16:55:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":510,"buckets":[{"key":"黑快馬主機","doc_count":1395},{"key":"南投高商","doc_count":876},{"key":"花蓮高農","doc_count":776},{"key":"仁愛高農","doc_count":665},{"key":"金門高中","doc_count":640},{"key":"臺東高中","doc_count":635},{"key":"新竹女中","doc_count":594},{"key":"竹北高中","doc_count":589},{"key":"金門農工","doc_count":521},{"key":"華僑高中","doc_count":467},{"key":"新港藝高","doc_count":426},{"key":"北門高中","doc_count":406},{"key":"興大附中","doc_count":405},{"key":"中大壢中","doc_count":397},{"key":"宜蘭高商","doc_count":396},{"key":"竹南高中","doc_count":351},{"key":"旗美高中","doc_count":326},{"key":"清華附小","doc_count":324},{"key":"內埔農工","doc_count":294},{"key":"蘇澳海事","doc_count":292},{"key":"新化高中","doc_count":291},{"key":"花蓮高商","doc_count":284},{"key":"後壁高中","doc_count":282},{"key":"南投特教","doc_count":275},{"key":"苗栗農工","doc_count":273},{"key":"關西高中","doc_count":264},{"key":"斗六家商","doc_count":231},{"key":"嘉義高商","doc_count":215},{"key":"成大南工","doc_count":202},{"key":"關山工商","doc_count":196},{"key":"東港海事","doc_count":186},{"key":"新竹高工","doc_count":179},{"key":"新化高工","doc_count":172},{"key":"屏東女中","doc_count":170},{"key":"員林家商","doc_count":160},{"key":"北斗家商","doc_count":154},{"key":"南大附中","doc_count":145},{"key":"南大附聰","doc_count":144},{"key":"新營高工","doc_count":144},{"key":"玉里高中","doc_count":143},{"key":"嘉科實中","doc_count":142},{"key":"彰師附工","doc_count":137},{"key":"鳳山高中","doc_count":135},{"key":"員林高中","doc_count":134},{"key":"虎尾高中","doc_count":131},{"key":"宜蘭高中","doc_count":127},{"key":"政大附中","doc_count":126},{"key":"花蓮高工","doc_count":120},{"key":"苗栗高商","doc_count":115},{"key":"秀水高工","doc_count":111},{"key":"南投高中","doc_count":107},{"key":"北港高中","doc_count":106},{"key":"臺東女中","doc_count":105},{"key":"永靖高工","doc_count":104},{"key":"苗栗高中","doc_count":100},{"key":"臺東高商","doc_count":99},{"key":"羅東高商","doc_count":98},{"key":"彰化高商","doc_count":96},{"key":"基隆商工","doc_count":93},{"key":"屏東高中","doc_count":91},{"key":"員林農工","doc_count":88},{"key":"屏科實中","doc_count":85},{"key":"水里商工","doc_count":85},{"key":"師大附中高中部","doc_count":81},{"key":"澎湖海事","doc_count":77},{"key":"旗山農工","doc_count":76},{"key":"臺南高商","doc_count":74},{"key":"新營高中","doc_count":72},{"key":"善化高中","doc_count":64},{"key":"屏東特教","doc_count":63},{"key":"草屯商工","doc_count":62},{"key":"土庫商工","doc_count":60},{"key":"中興高中","doc_count":59},{"key":"興大附農","doc_count":59},{"key":"二林工商","doc_count":58},{"key":"成功商水","doc_count":58},{"key":"花蓮特教","doc_count":58},{"key":"新竹高中","doc_count":57},{"key":"東石高中","doc_count":55},{"key":"羅東高工","doc_count":55},{"key":"嘉義特教","doc_count":54},{"key":"埔里高工","doc_count":54},{"key":"家齊高中","doc_count":53},{"key":"曾文農工","doc_count":53},{"key":"竹山高中","doc_count":53},{"key":"屏北高中","doc_count":52},{"key":"竹東高中","doc_count":52},{"key":"雲林特教","doc_count":52},{"key":"北教大實小","doc_count":51},{"key":"高餐大附中","doc_count":50},{"key":"嘉義高中","doc_count":48},{"key":"崇實高工","doc_count":47},{"key":"新竹高商","doc_count":47},{"key":"華南高商","doc_count":46},{"key":"溪湖高中","doc_count":45},{"key":"臺南一中","doc_count":45},{"key":"北港農工","doc_count":44},{"key":"暨大附中","doc_count":44},{"key":"白河商工","doc_count":44},{"key":"新豐高中","doc_count":43}]}}}
DEBUG 2025/12/17 16:55:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:55:00   Bucket[0]: Key=黑快馬主機, DocCount=1395
DEBUG 2025/12/17 16:55:00   Bucket[1]: Key=南投高商, DocCount=876
DEBUG 2025/12/17 16:55:00   Bucket[2]: Key=花蓮高農, DocCount=776
DEBUG 2025/12/17 16:55:00   Bucket[3]: Key=仁愛高農, DocCount=665
DEBUG 2025/12/17 16:55:00   Bucket[4]: Key=金門高中, DocCount=640
DEBUG 2025/12/17 16:55:00   Bucket[5]: Key=臺東高中, DocCount=635
DEBUG 2025/12/17 16:55:00   Bucket[6]: Key=新竹女中, DocCount=594
DEBUG 2025/12/17 16:55:00   Bucket[7]: Key=竹北高中, DocCount=589
DEBUG 2025/12/17 16:55:00   Bucket[8]: Key=金門農工, DocCount=521
DEBUG 2025/12/17 16:55:00   Bucket[9]: Key=華僑高中, DocCount=467
DEBUG 2025/12/17 16:55:00   Bucket[10]: Key=新港藝高, DocCount=426
DEBUG 2025/12/17 16:55:00   Bucket[11]: Key=北門高中, DocCount=406
DEBUG 2025/12/17 16:55:00   Bucket[12]: Key=興大附中, DocCount=405
DEBUG 2025/12/17 16:55:00   Bucket[13]: Key=中大壢中, DocCount=397
DEBUG 2025/12/17 16:55:00   Bucket[14]: Key=宜蘭高商, DocCount=396
DEBUG 2025/12/17 16:55:00   Bucket[15]: Key=竹南高中, DocCount=351
DEBUG 2025/12/17 16:55:00   Bucket[16]: Key=旗美高中, DocCount=326
DEBUG 2025/12/17 16:55:00   Bucket[17]: Key=清華附小, DocCount=324
DEBUG 2025/12/17 16:55:00   Bucket[18]: Key=內埔農工, DocCount=294
DEBUG 2025/12/17 16:55:00   Bucket[19]: Key=蘇澳海事, DocCount=292
DEBUG 2025/12/17 16:55:00   Bucket[20]: Key=新化高中, DocCount=291
DEBUG 2025/12/17 16:55:00   Bucket[21]: Key=花蓮高商, DocCount=284
DEBUG 2025/12/17 16:55:00   Bucket[22]: Key=後壁高中, DocCount=282
DEBUG 2025/12/17 16:55:00   Bucket[23]: Key=南投特教, DocCount=275
DEBUG 2025/12/17 16:55:00   Bucket[24]: Key=苗栗農工, DocCount=273
DEBUG 2025/12/17 16:55:00   Bucket[25]: Key=關西高中, DocCount=264
DEBUG 2025/12/17 16:55:00   Bucket[26]: Key=斗六家商, DocCount=231
DEBUG 2025/12/17 16:55:00   Bucket[27]: Key=嘉義高商, DocCount=215
DEBUG 2025/12/17 16:55:00   Bucket[28]: Key=成大南工, DocCount=202
DEBUG 2025/12/17 16:55:00   Bucket[29]: Key=關山工商, DocCount=196
DEBUG 2025/12/17 16:55:00   Bucket[30]: Key=東港海事, DocCount=186
DEBUG 2025/12/17 16:55:00   Bucket[31]: Key=新竹高工, DocCount=179
DEBUG 2025/12/17 16:55:00   Bucket[32]: Key=新化高工, DocCount=172
DEBUG 2025/12/17 16:55:00   Bucket[33]: Key=屏東女中, DocCount=170
DEBUG 2025/12/17 16:55:00   Bucket[34]: Key=員林家商, DocCount=160
DEBUG 2025/12/17 16:55:00   Bucket[35]: Key=北斗家商, DocCount=154
DEBUG 2025/12/17 16:55:00   Bucket[36]: Key=南大附中, DocCount=145
DEBUG 2025/12/17 16:55:00   Bucket[37]: Key=南大附聰, DocCount=144
DEBUG 2025/12/17 16:55:00   Bucket[38]: Key=新營高工, DocCount=144
DEBUG 2025/12/17 16:55:00   Bucket[39]: Key=玉里高中, DocCount=143
DEBUG 2025/12/17 16:55:00   Bucket[40]: Key=嘉科實中, DocCount=142
DEBUG 2025/12/17 16:55:00   Bucket[41]: Key=彰師附工, DocCount=137
DEBUG 2025/12/17 16:55:00   Bucket[42]: Key=鳳山高中, DocCount=135
DEBUG 2025/12/17 16:55:00   Bucket[43]: Key=員林高中, DocCount=134
DEBUG 2025/12/17 16:55:00   Bucket[44]: Key=虎尾高中, DocCount=131
DEBUG 2025/12/17 16:55:00   Bucket[45]: Key=宜蘭高中, DocCount=127
DEBUG 2025/12/17 16:55:00   Bucket[46]: Key=政大附中, DocCount=126
DEBUG 2025/12/17 16:55:00   Bucket[47]: Key=花蓮高工, DocCount=120
DEBUG 2025/12/17 16:55:00   Bucket[48]: Key=苗栗高商, DocCount=115
DEBUG 2025/12/17 16:55:00   Bucket[49]: Key=秀水高工, DocCount=111
DEBUG 2025/12/17 16:55:00   Bucket[50]: Key=南投高中, DocCount=107
DEBUG 2025/12/17 16:55:00   Bucket[51]: Key=北港高中, DocCount=106
DEBUG 2025/12/17 16:55:00   Bucket[52]: Key=臺東女中, DocCount=105
DEBUG 2025/12/17 16:55:00   Bucket[53]: Key=永靖高工, DocCount=104
DEBUG 2025/12/17 16:55:00   Bucket[54]: Key=苗栗高中, DocCount=100
DEBUG 2025/12/17 16:55:00   Bucket[55]: Key=臺東高商, DocCount=99
DEBUG 2025/12/17 16:55:00   Bucket[56]: Key=羅東高商, DocCount=98
DEBUG 2025/12/17 16:55:00   Bucket[57]: Key=彰化高商, DocCount=96
DEBUG 2025/12/17 16:55:00   Bucket[58]: Key=基隆商工, DocCount=93
DEBUG 2025/12/17 16:55:00   Bucket[59]: Key=屏東高中, DocCount=91
DEBUG 2025/12/17 16:55:00   Bucket[60]: Key=員林農工, DocCount=88
DEBUG 2025/12/17 16:55:00   Bucket[61]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 16:55:00   Bucket[62]: Key=水里商工, DocCount=85
DEBUG 2025/12/17 16:55:00   Bucket[63]: Key=師大附中高中部, DocCount=81
DEBUG 2025/12/17 16:55:00   Bucket[64]: Key=澎湖海事, DocCount=77
DEBUG 2025/12/17 16:55:00   Bucket[65]: Key=旗山農工, DocCount=76
DEBUG 2025/12/17 16:55:00   Bucket[66]: Key=臺南高商, DocCount=74
DEBUG 2025/12/17 16:55:00   Bucket[67]: Key=新營高中, DocCount=72
DEBUG 2025/12/17 16:55:00   Bucket[68]: Key=善化高中, DocCount=64
DEBUG 2025/12/17 16:55:00   Bucket[69]: Key=屏東特教, DocCount=63
DEBUG 2025/12/17 16:55:00   Bucket[70]: Key=草屯商工, DocCount=62
DEBUG 2025/12/17 16:55:00   Bucket[71]: Key=土庫商工, DocCount=60
DEBUG 2025/12/17 16:55:00   Bucket[72]: Key=中興高中, DocCount=59
DEBUG 2025/12/17 16:55:00   Bucket[73]: Key=興大附農, DocCount=59
DEBUG 2025/12/17 16:55:00   Bucket[74]: Key=二林工商, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[75]: Key=成功商水, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[76]: Key=花蓮特教, DocCount=58
DEBUG 2025/12/17 16:55:00   Bucket[77]: Key=新竹高中, DocCount=57
DEBUG 2025/12/17 16:55:00   Bucket[78]: Key=東石高中, DocCount=55
DEBUG 2025/12/17 16:55:00   Bucket[79]: Key=羅東高工, DocCount=55
DEBUG 2025/12/17 16:55:00   Bucket[80]: Key=嘉義特教, DocCount=54
DEBUG 2025/12/17 16:55:00   Bucket[81]: Key=埔里高工, DocCount=54
DEBUG 2025/12/17 16:55:00   Bucket[82]: Key=家齊高中, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[83]: Key=曾文農工, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[84]: Key=竹山高中, DocCount=53
DEBUG 2025/12/17 16:55:00   Bucket[85]: Key=屏北高中, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[86]: Key=竹東高中, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[87]: Key=雲林特教, DocCount=52
DEBUG 2025/12/17 16:55:00   Bucket[88]: Key=北教大實小, DocCount=51
DEBUG 2025/12/17 16:55:00   Bucket[89]: Key=高餐大附中, DocCount=50
DEBUG 2025/12/17 16:55:00   Bucket[90]: Key=嘉義高中, DocCount=48
DEBUG 2025/12/17 16:55:00   Bucket[91]: Key=崇實高工, DocCount=47
DEBUG 2025/12/17 16:55:00   Bucket[92]: Key=新竹高商, DocCount=47
DEBUG 2025/12/17 16:55:00   Bucket[93]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 16:55:00   Bucket[94]: Key=溪湖高中, DocCount=45
DEBUG 2025/12/17 16:55:00   Bucket[95]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 16:55:00   Bucket[96]: Key=北港農工, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[97]: Key=暨大附中, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[98]: Key=白河商工, DocCount=44
DEBUG 2025/12/17 16:55:00   Bucket[99]: Key=新豐高中, DocCount=43
DEBUG 2025/12/17 16:55:00 ========================================================
INFO 2025/12/17 16:55:08 ✅ Successfully flushed 37/37 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:55:11 Processing 15 offline devices
INFO 2025/12/17 16:55:11 Creating history record for offline device: 頭城家商
INFO 2025/12/17 16:55:11 About to add history to batch for device: 頭城家商
INFO 2025/12/17 16:55:11 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:55:12 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 16:55:12 Creating history record for offline device: 屏東高工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 屏東高工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 16:55:12 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:55:12 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:55:12 Creating history record for offline device: 海大附中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 海大附中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 海大附中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:55:12 Creating history record for offline device: 潮州高中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 潮州高中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:55:12 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:55:12 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:55:12 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:55:12 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:55:12 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:55:12 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:55:12 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:55:12 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:55:12 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:55:12 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:55:12 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:55:12 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:55:12 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:55:12 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:55:12 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:55:12 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:55:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:55:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:55:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
INFO 2025/12/17 16:55:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:55:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:55:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:55:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:55:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:55:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:55:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.46% (threshold: 80.00%)
INFO 2025/12/17 16:55:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.34% (threshold: 85.00%)
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:55:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:55:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:55:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:55:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:55:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:56:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:56:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:56:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:56:00 Field: school_name.keyword
DEBUG 2025/12/17 16:56:00 Time From: 2025-12-17T16:55:00.000+08:00
DEBUG 2025/12/17 16:56:00 Time To: 2025-12-17T16:56:00.000+08:00
DEBUG 2025/12/17 16:56:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:55:00.000+08:00",
					"lte": "2025-12-17T16:56:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:56:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:56:00 ES Response IsError: false
DEBUG 2025/12/17 16:56:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":511,"buckets":[{"key":"黑快馬主機","doc_count":1742},{"key":"花蓮高農","doc_count":877},{"key":"南投高商","doc_count":800},{"key":"新竹女中","doc_count":640},{"key":"仁愛高農","doc_count":588},{"key":"金門高中","doc_count":581},{"key":"金門農工","doc_count":562},{"key":"竹北高中","doc_count":546},{"key":"新港藝高","doc_count":509},{"key":"宜蘭高商","doc_count":489},{"key":"華僑高中","doc_count":474},{"key":"北門高中","doc_count":440},{"key":"臺東高中","doc_count":415},{"key":"興大附中","doc_count":351},{"key":"中大壢中","doc_count":337},{"key":"清華附小","doc_count":320},{"key":"旗美高中","doc_count":309},{"key":"竹南高中","doc_count":298},{"key":"蘇澳海事","doc_count":282},{"key":"埔里高工","doc_count":276},{"key":"玉里高中","doc_count":263},{"key":"南投特教","doc_count":251},{"key":"後壁高中","doc_count":241},{"key":"內埔農工","doc_count":239},{"key":"關山工商","doc_count":235},{"key":"關西高中","doc_count":231},{"key":"花蓮高商","doc_count":221},{"key":"苗栗農工","doc_count":220},{"key":"東港海事","doc_count":205},{"key":"斗六家商","doc_count":196},{"key":"新營高工","doc_count":191},{"key":"屏東女中","doc_count":184},{"key":"北斗家商","doc_count":171},{"key":"彰師附工","doc_count":167},{"key":"新化高中","doc_count":160},{"key":"虎尾高中","doc_count":158},{"key":"員林家商","doc_count":144},{"key":"成大南工","doc_count":144},{"key":"新化高工","doc_count":131},{"key":"嘉義高商","doc_count":126},{"key":"新竹高工","doc_count":126},{"key":"苗栗高商","doc_count":120},{"key":"南大附聰","doc_count":112},{"key":"嘉科實中","doc_count":101},{"key":"員林農工","doc_count":100},{"key":"屏東高工","doc_count":98},{"key":"員林高中","doc_count":97},{"key":"南投高中","doc_count":94},{"key":"水里商工","doc_count":94},{"key":"花蓮高工","doc_count":91},{"key":"南大附中","doc_count":90},{"key":"宜蘭高中","doc_count":90},{"key":"臺東高商","doc_count":90},{"key":"中興高中","doc_count":85},{"key":"師大附中高中部","doc_count":84},{"key":"屏北高中","doc_count":82},{"key":"屏科實中","doc_count":81},{"key":"秀水高工","doc_count":81},{"key":"土庫商工","doc_count":78},{"key":"雲林特教","doc_count":78},{"key":"彰化高商","doc_count":77},{"key":"新營高中","doc_count":75},{"key":"北教大實小","doc_count":74},{"key":"基隆商工","doc_count":74},{"key":"頭城家商","doc_count":71},{"key":"二林工商","doc_count":70},{"key":"嘉義家職","doc_count":69},{"key":"臺東女中","doc_count":69},{"key":"南大附小","doc_count":66},{"key":"高餐大附中","doc_count":65},{"key":"新豐高中","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"臺南一中","doc_count":63},{"key":"暨大附中","doc_count":60},{"key":"羅東高商","doc_count":60},{"key":"北港高中","doc_count":59},{"key":"嘉義特教","doc_count":59},{"key":"苗栗高中","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"竹山高中","doc_count":57},{"key":"華南高商","doc_count":57},{"key":"北港農工","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"鳳山高中","doc_count":56},{"key":"東石高中","doc_count":54},{"key":"善化高中","doc_count":53},{"key":"草屯商工","doc_count":53},{"key":"屏東高中","doc_count":52},{"key":"旗山農工","doc_count":52},{"key":"曾文農工","doc_count":52},{"key":"永靖高工","doc_count":51},{"key":"家齊高中","doc_count":50},{"key":"海大附中","doc_count":48},{"key":"師大附中國中部","doc_count":46},{"key":"白河商工","doc_count":46},{"key":"成功商水","doc_count":44},{"key":"新竹高商","doc_count":44},{"key":"興大附農","doc_count":44},{"key":"屏東特教","doc_count":43},{"key":"政大附中","doc_count":42}]}}}
DEBUG 2025/12/17 16:56:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:56:00   Bucket[0]: Key=黑快馬主機, DocCount=1742
DEBUG 2025/12/17 16:56:00   Bucket[1]: Key=花蓮高農, DocCount=877
DEBUG 2025/12/17 16:56:00   Bucket[2]: Key=南投高商, DocCount=800
DEBUG 2025/12/17 16:56:00   Bucket[3]: Key=新竹女中, DocCount=640
DEBUG 2025/12/17 16:56:00   Bucket[4]: Key=仁愛高農, DocCount=588
DEBUG 2025/12/17 16:56:00   Bucket[5]: Key=金門高中, DocCount=581
DEBUG 2025/12/17 16:56:00   Bucket[6]: Key=金門農工, DocCount=562
DEBUG 2025/12/17 16:56:00   Bucket[7]: Key=竹北高中, DocCount=546
DEBUG 2025/12/17 16:56:00   Bucket[8]: Key=新港藝高, DocCount=509
DEBUG 2025/12/17 16:56:00   Bucket[9]: Key=宜蘭高商, DocCount=489
DEBUG 2025/12/17 16:56:00   Bucket[10]: Key=華僑高中, DocCount=474
DEBUG 2025/12/17 16:56:00   Bucket[11]: Key=北門高中, DocCount=440
DEBUG 2025/12/17 16:56:00   Bucket[12]: Key=臺東高中, DocCount=415
DEBUG 2025/12/17 16:56:00   Bucket[13]: Key=興大附中, DocCount=351
DEBUG 2025/12/17 16:56:00   Bucket[14]: Key=中大壢中, DocCount=337
DEBUG 2025/12/17 16:56:00   Bucket[15]: Key=清華附小, DocCount=320
DEBUG 2025/12/17 16:56:00   Bucket[16]: Key=旗美高中, DocCount=309
DEBUG 2025/12/17 16:56:00   Bucket[17]: Key=竹南高中, DocCount=298
DEBUG 2025/12/17 16:56:00   Bucket[18]: Key=蘇澳海事, DocCount=282
DEBUG 2025/12/17 16:56:00   Bucket[19]: Key=埔里高工, DocCount=276
DEBUG 2025/12/17 16:56:00   Bucket[20]: Key=玉里高中, DocCount=263
DEBUG 2025/12/17 16:56:00   Bucket[21]: Key=南投特教, DocCount=251
DEBUG 2025/12/17 16:56:00   Bucket[22]: Key=後壁高中, DocCount=241
DEBUG 2025/12/17 16:56:00   Bucket[23]: Key=內埔農工, DocCount=239
DEBUG 2025/12/17 16:56:00   Bucket[24]: Key=關山工商, DocCount=235
DEBUG 2025/12/17 16:56:00   Bucket[25]: Key=關西高中, DocCount=231
DEBUG 2025/12/17 16:56:00   Bucket[26]: Key=花蓮高商, DocCount=221
DEBUG 2025/12/17 16:56:00   Bucket[27]: Key=苗栗農工, DocCount=220
DEBUG 2025/12/17 16:56:00   Bucket[28]: Key=東港海事, DocCount=205
DEBUG 2025/12/17 16:56:00   Bucket[29]: Key=斗六家商, DocCount=196
DEBUG 2025/12/17 16:56:00   Bucket[30]: Key=新營高工, DocCount=191
DEBUG 2025/12/17 16:56:00   Bucket[31]: Key=屏東女中, DocCount=184
DEBUG 2025/12/17 16:56:00   Bucket[32]: Key=北斗家商, DocCount=171
DEBUG 2025/12/17 16:56:00   Bucket[33]: Key=彰師附工, DocCount=167
DEBUG 2025/12/17 16:56:00   Bucket[34]: Key=新化高中, DocCount=160
DEBUG 2025/12/17 16:56:00   Bucket[35]: Key=虎尾高中, DocCount=158
DEBUG 2025/12/17 16:56:00   Bucket[36]: Key=員林家商, DocCount=144
DEBUG 2025/12/17 16:56:00   Bucket[37]: Key=成大南工, DocCount=144
DEBUG 2025/12/17 16:56:00   Bucket[38]: Key=新化高工, DocCount=131
DEBUG 2025/12/17 16:56:00   Bucket[39]: Key=嘉義高商, DocCount=126
DEBUG 2025/12/17 16:56:00   Bucket[40]: Key=新竹高工, DocCount=126
DEBUG 2025/12/17 16:56:00   Bucket[41]: Key=苗栗高商, DocCount=120
DEBUG 2025/12/17 16:56:00   Bucket[42]: Key=南大附聰, DocCount=112
DEBUG 2025/12/17 16:56:00   Bucket[43]: Key=嘉科實中, DocCount=101
DEBUG 2025/12/17 16:56:00   Bucket[44]: Key=員林農工, DocCount=100
DEBUG 2025/12/17 16:56:00   Bucket[45]: Key=屏東高工, DocCount=98
DEBUG 2025/12/17 16:56:00   Bucket[46]: Key=員林高中, DocCount=97
DEBUG 2025/12/17 16:56:00   Bucket[47]: Key=南投高中, DocCount=94
DEBUG 2025/12/17 16:56:00   Bucket[48]: Key=水里商工, DocCount=94
DEBUG 2025/12/17 16:56:00   Bucket[49]: Key=花蓮高工, DocCount=91
DEBUG 2025/12/17 16:56:00   Bucket[50]: Key=南大附中, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[51]: Key=宜蘭高中, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[52]: Key=臺東高商, DocCount=90
DEBUG 2025/12/17 16:56:00   Bucket[53]: Key=中興高中, DocCount=85
DEBUG 2025/12/17 16:56:00   Bucket[54]: Key=師大附中高中部, DocCount=84
DEBUG 2025/12/17 16:56:00   Bucket[55]: Key=屏北高中, DocCount=82
DEBUG 2025/12/17 16:56:00   Bucket[56]: Key=屏科實中, DocCount=81
DEBUG 2025/12/17 16:56:00   Bucket[57]: Key=秀水高工, DocCount=81
DEBUG 2025/12/17 16:56:00   Bucket[58]: Key=土庫商工, DocCount=78
DEBUG 2025/12/17 16:56:00   Bucket[59]: Key=雲林特教, DocCount=78
DEBUG 2025/12/17 16:56:00   Bucket[60]: Key=彰化高商, DocCount=77
DEBUG 2025/12/17 16:56:00   Bucket[61]: Key=新營高中, DocCount=75
DEBUG 2025/12/17 16:56:00   Bucket[62]: Key=北教大實小, DocCount=74
DEBUG 2025/12/17 16:56:00   Bucket[63]: Key=基隆商工, DocCount=74
DEBUG 2025/12/17 16:56:00   Bucket[64]: Key=頭城家商, DocCount=71
DEBUG 2025/12/17 16:56:00   Bucket[65]: Key=二林工商, DocCount=70
DEBUG 2025/12/17 16:56:00   Bucket[66]: Key=嘉義家職, DocCount=69
DEBUG 2025/12/17 16:56:00   Bucket[67]: Key=臺東女中, DocCount=69
DEBUG 2025/12/17 16:56:00   Bucket[68]: Key=南大附小, DocCount=66
DEBUG 2025/12/17 16:56:00   Bucket[69]: Key=高餐大附中, DocCount=65
DEBUG 2025/12/17 16:56:00   Bucket[70]: Key=新豐高中, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[71]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[72]: Key=臺南一中, DocCount=63
DEBUG 2025/12/17 16:56:00   Bucket[73]: Key=暨大附中, DocCount=60
DEBUG 2025/12/17 16:56:00   Bucket[74]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 16:56:00   Bucket[75]: Key=北港高中, DocCount=59
DEBUG 2025/12/17 16:56:00   Bucket[76]: Key=嘉義特教, DocCount=59
DEBUG 2025/12/17 16:56:00   Bucket[77]: Key=苗栗高中, DocCount=58
DEBUG 2025/12/17 16:56:00   Bucket[78]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[79]: Key=竹山高中, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[80]: Key=華南高商, DocCount=57
DEBUG 2025/12/17 16:56:00   Bucket[81]: Key=北港農工, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[82]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[83]: Key=鳳山高中, DocCount=56
DEBUG 2025/12/17 16:56:00   Bucket[84]: Key=東石高中, DocCount=54
DEBUG 2025/12/17 16:56:00   Bucket[85]: Key=善化高中, DocCount=53
DEBUG 2025/12/17 16:56:00   Bucket[86]: Key=草屯商工, DocCount=53
DEBUG 2025/12/17 16:56:00   Bucket[87]: Key=屏東高中, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[88]: Key=旗山農工, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[89]: Key=曾文農工, DocCount=52
DEBUG 2025/12/17 16:56:00   Bucket[90]: Key=永靖高工, DocCount=51
DEBUG 2025/12/17 16:56:00   Bucket[91]: Key=家齊高中, DocCount=50
DEBUG 2025/12/17 16:56:00   Bucket[92]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 16:56:00   Bucket[93]: Key=師大附中國中部, DocCount=46
DEBUG 2025/12/17 16:56:00   Bucket[94]: Key=白河商工, DocCount=46
DEBUG 2025/12/17 16:56:00   Bucket[95]: Key=成功商水, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[96]: Key=新竹高商, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[97]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 16:56:00   Bucket[98]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 16:56:00   Bucket[99]: Key=政大附中, DocCount=42
DEBUG 2025/12/17 16:56:00 ========================================================
INFO 2025/12/17 16:56:03 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 16:56:06 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:56:08 Processing 15 offline devices
INFO 2025/12/17 16:56:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 16:56:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 16:56:08 ✅ Successfully flushed 33/33 history records to TimescaleDB
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 16:56:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:56:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:56:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 16:56:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 16:56:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 16:56:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:56:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 嘉義高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 嘉義高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 嘉義高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:56:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 新竹高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 新竹高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:56:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:56:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 潮州高中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 潮州高中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 潮州高中
INFO 2025/12/17 16:56:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:56:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:56:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:56:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:56:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 16:56:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 16:56:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 16:56:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:56:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:56:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:56:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:56:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:56:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:56:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:56:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:56:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:56:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:56:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:56:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:56:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 16:56:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 16:56:45 ES Alert Created [critical][performance]: Memory usage critical: 91.13% (threshold: 90.00%)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.37% (threshold: 85.00%)
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:56:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:56:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:56:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:56:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:56:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:57:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:57:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:57:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:57:00 Field: school_name.keyword
DEBUG 2025/12/17 16:57:00 Time From: 2025-12-17T16:56:00.000+08:00
DEBUG 2025/12/17 16:57:00 Time To: 2025-12-17T16:57:00.000+08:00
DEBUG 2025/12/17 16:57:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:56:00.000+08:00",
					"lte": "2025-12-17T16:57:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:57:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:57:00 ES Response IsError: false
DEBUG 2025/12/17 16:57:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":490,"buckets":[{"key":"黑快馬主機","doc_count":947},{"key":"玉里高中","doc_count":824},{"key":"南投高商","doc_count":822},{"key":"花蓮高農","doc_count":809},{"key":"新竹女中","doc_count":793},{"key":"新港藝高","doc_count":792},{"key":"仁愛高農","doc_count":688},{"key":"中大壢中","doc_count":644},{"key":"竹北高中","doc_count":638},{"key":"金門高中","doc_count":599},{"key":"金門農工","doc_count":526},{"key":"華僑高中","doc_count":480},{"key":"臺東高中","doc_count":471},{"key":"宜蘭高商","doc_count":468},{"key":"北門高中","doc_count":441},{"key":"旗美高中","doc_count":400},{"key":"興大附中","doc_count":362},{"key":"清華附小","doc_count":349},{"key":"師大附中高中部","doc_count":330},{"key":"竹南高中","doc_count":282},{"key":"蘇澳海事","doc_count":271},{"key":"花蓮高商","doc_count":255},{"key":"新營高工","doc_count":254},{"key":"埔里高工","doc_count":248},{"key":"苗栗農工","doc_count":246},{"key":"南投特教","doc_count":242},{"key":"新化高中","doc_count":239},{"key":"屏東女中","doc_count":233},{"key":"關西高中","doc_count":230},{"key":"後壁高中","doc_count":225},{"key":"關山工商","doc_count":222},{"key":"斗六家商","doc_count":211},{"key":"內埔農工","doc_count":205},{"key":"員林家商","doc_count":187},{"key":"東港海事","doc_count":171},{"key":"北斗家商","doc_count":157},{"key":"新化高工","doc_count":153},{"key":"南大附聰","doc_count":126},{"key":"嘉義高商","doc_count":125},{"key":"新竹高工","doc_count":111},{"key":"苗栗高商","doc_count":106},{"key":"成大南工","doc_count":101},{"key":"北港高中","doc_count":98},{"key":"嘉科實中","doc_count":97},{"key":"屏北高中","doc_count":95},{"key":"虎尾高中","doc_count":94},{"key":"彰化高商","doc_count":93},{"key":"彰師附工","doc_count":91},{"key":"南大附中","doc_count":89},{"key":"高餐大附中","doc_count":88},{"key":"屏東高工","doc_count":86},{"key":"苗栗高中","doc_count":86},{"key":"華南高商","doc_count":86},{"key":"土庫商工","doc_count":85},{"key":"佳冬高農","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"新豐高中","doc_count":80},{"key":"二林工商","doc_count":79},{"key":"政大附中","doc_count":79},{"key":"水里商工","doc_count":78},{"key":"屏科實中","doc_count":77},{"key":"永靖高工","doc_count":77},{"key":"曾文農工","doc_count":75},{"key":"興大附農","doc_count":75},{"key":"宜蘭高中","doc_count":73},{"key":"新竹高商","doc_count":73},{"key":"鳳山高中","doc_count":73},{"key":"北教大實小","doc_count":72},{"key":"蘭陽女中","doc_count":72},{"key":"基隆商工","doc_count":70},{"key":"北港農工","doc_count":69},{"key":"臺東高商","doc_count":69},{"key":"頭城家商","doc_count":69},{"key":"澎湖海事","doc_count":66},{"key":"羅東高工","doc_count":66},{"key":"南投高中","doc_count":65},{"key":"新竹高中","doc_count":63},{"key":"家齊高中","doc_count":61},{"key":"臺南一中","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"暨大附中","doc_count":57},{"key":"花蓮高工","doc_count":57},{"key":"海大附中","doc_count":56},{"key":"雲林特教","doc_count":56},{"key":"草屯商工","doc_count":55},{"key":"屏東特教","doc_count":54},{"key":"嘉義高中","doc_count":53},{"key":"臺東女中","doc_count":53},{"key":"員林農工","doc_count":51},{"key":"秀水高工","doc_count":51},{"key":"花蓮特教","doc_count":51},{"key":"善化高中","doc_count":50},{"key":"南大附小","doc_count":49},{"key":"東石高中","doc_count":47},{"key":"成功商水","doc_count":46},{"key":"員林高中","doc_count":44},{"key":"嘉義特教","doc_count":44},{"key":"潮州高中","doc_count":43},{"key":"羅東高商","doc_count":43},{"key":"旗山農工","doc_count":41}]}}}
DEBUG 2025/12/17 16:57:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:57:00   Bucket[0]: Key=黑快馬主機, DocCount=947
DEBUG 2025/12/17 16:57:00   Bucket[1]: Key=玉里高中, DocCount=824
DEBUG 2025/12/17 16:57:00   Bucket[2]: Key=南投高商, DocCount=822
DEBUG 2025/12/17 16:57:00   Bucket[3]: Key=花蓮高農, DocCount=809
DEBUG 2025/12/17 16:57:00   Bucket[4]: Key=新竹女中, DocCount=793
DEBUG 2025/12/17 16:57:00   Bucket[5]: Key=新港藝高, DocCount=792
DEBUG 2025/12/17 16:57:00   Bucket[6]: Key=仁愛高農, DocCount=688
DEBUG 2025/12/17 16:57:00   Bucket[7]: Key=中大壢中, DocCount=644
DEBUG 2025/12/17 16:57:00   Bucket[8]: Key=竹北高中, DocCount=638
DEBUG 2025/12/17 16:57:00   Bucket[9]: Key=金門高中, DocCount=599
DEBUG 2025/12/17 16:57:00   Bucket[10]: Key=金門農工, DocCount=526
DEBUG 2025/12/17 16:57:00   Bucket[11]: Key=華僑高中, DocCount=480
DEBUG 2025/12/17 16:57:00   Bucket[12]: Key=臺東高中, DocCount=471
DEBUG 2025/12/17 16:57:00   Bucket[13]: Key=宜蘭高商, DocCount=468
DEBUG 2025/12/17 16:57:00   Bucket[14]: Key=北門高中, DocCount=441
DEBUG 2025/12/17 16:57:00   Bucket[15]: Key=旗美高中, DocCount=400
DEBUG 2025/12/17 16:57:00   Bucket[16]: Key=興大附中, DocCount=362
DEBUG 2025/12/17 16:57:00   Bucket[17]: Key=清華附小, DocCount=349
DEBUG 2025/12/17 16:57:00   Bucket[18]: Key=師大附中高中部, DocCount=330
DEBUG 2025/12/17 16:57:00   Bucket[19]: Key=竹南高中, DocCount=282
DEBUG 2025/12/17 16:57:00   Bucket[20]: Key=蘇澳海事, DocCount=271
DEBUG 2025/12/17 16:57:00   Bucket[21]: Key=花蓮高商, DocCount=255
DEBUG 2025/12/17 16:57:00   Bucket[22]: Key=新營高工, DocCount=254
DEBUG 2025/12/17 16:57:00   Bucket[23]: Key=埔里高工, DocCount=248
DEBUG 2025/12/17 16:57:00   Bucket[24]: Key=苗栗農工, DocCount=246
DEBUG 2025/12/17 16:57:00   Bucket[25]: Key=南投特教, DocCount=242
DEBUG 2025/12/17 16:57:00   Bucket[26]: Key=新化高中, DocCount=239
DEBUG 2025/12/17 16:57:00   Bucket[27]: Key=屏東女中, DocCount=233
DEBUG 2025/12/17 16:57:00   Bucket[28]: Key=關西高中, DocCount=230
DEBUG 2025/12/17 16:57:00   Bucket[29]: Key=後壁高中, DocCount=225
DEBUG 2025/12/17 16:57:00   Bucket[30]: Key=關山工商, DocCount=222
DEBUG 2025/12/17 16:57:00   Bucket[31]: Key=斗六家商, DocCount=211
DEBUG 2025/12/17 16:57:00   Bucket[32]: Key=內埔農工, DocCount=205
DEBUG 2025/12/17 16:57:00   Bucket[33]: Key=員林家商, DocCount=187
DEBUG 2025/12/17 16:57:00   Bucket[34]: Key=東港海事, DocCount=171
DEBUG 2025/12/17 16:57:00   Bucket[35]: Key=北斗家商, DocCount=157
DEBUG 2025/12/17 16:57:00   Bucket[36]: Key=新化高工, DocCount=153
DEBUG 2025/12/17 16:57:00   Bucket[37]: Key=南大附聰, DocCount=126
DEBUG 2025/12/17 16:57:00   Bucket[38]: Key=嘉義高商, DocCount=125
DEBUG 2025/12/17 16:57:00   Bucket[39]: Key=新竹高工, DocCount=111
DEBUG 2025/12/17 16:57:00   Bucket[40]: Key=苗栗高商, DocCount=106
DEBUG 2025/12/17 16:57:00   Bucket[41]: Key=成大南工, DocCount=101
DEBUG 2025/12/17 16:57:00   Bucket[42]: Key=北港高中, DocCount=98
DEBUG 2025/12/17 16:57:00   Bucket[43]: Key=嘉科實中, DocCount=97
DEBUG 2025/12/17 16:57:00   Bucket[44]: Key=屏北高中, DocCount=95
DEBUG 2025/12/17 16:57:00   Bucket[45]: Key=虎尾高中, DocCount=94
DEBUG 2025/12/17 16:57:00   Bucket[46]: Key=彰化高商, DocCount=93
DEBUG 2025/12/17 16:57:00   Bucket[47]: Key=彰師附工, DocCount=91
DEBUG 2025/12/17 16:57:00   Bucket[48]: Key=南大附中, DocCount=89
DEBUG 2025/12/17 16:57:00   Bucket[49]: Key=高餐大附中, DocCount=88
DEBUG 2025/12/17 16:57:00   Bucket[50]: Key=屏東高工, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[51]: Key=苗栗高中, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[52]: Key=華南高商, DocCount=86
DEBUG 2025/12/17 16:57:00   Bucket[53]: Key=土庫商工, DocCount=85
DEBUG 2025/12/17 16:57:00   Bucket[54]: Key=佳冬高農, DocCount=82
DEBUG 2025/12/17 16:57:00   Bucket[55]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 16:57:00   Bucket[56]: Key=新豐高中, DocCount=80
DEBUG 2025/12/17 16:57:00   Bucket[57]: Key=二林工商, DocCount=79
DEBUG 2025/12/17 16:57:00   Bucket[58]: Key=政大附中, DocCount=79
DEBUG 2025/12/17 16:57:00   Bucket[59]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 16:57:00   Bucket[60]: Key=屏科實中, DocCount=77
DEBUG 2025/12/17 16:57:00   Bucket[61]: Key=永靖高工, DocCount=77
DEBUG 2025/12/17 16:57:00   Bucket[62]: Key=曾文農工, DocCount=75
DEBUG 2025/12/17 16:57:00   Bucket[63]: Key=興大附農, DocCount=75
DEBUG 2025/12/17 16:57:00   Bucket[64]: Key=宜蘭高中, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[65]: Key=新竹高商, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[66]: Key=鳳山高中, DocCount=73
DEBUG 2025/12/17 16:57:00   Bucket[67]: Key=北教大實小, DocCount=72
DEBUG 2025/12/17 16:57:00   Bucket[68]: Key=蘭陽女中, DocCount=72
DEBUG 2025/12/17 16:57:00   Bucket[69]: Key=基隆商工, DocCount=70
DEBUG 2025/12/17 16:57:00   Bucket[70]: Key=北港農工, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[71]: Key=臺東高商, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[72]: Key=頭城家商, DocCount=69
DEBUG 2025/12/17 16:57:00   Bucket[73]: Key=澎湖海事, DocCount=66
DEBUG 2025/12/17 16:57:00   Bucket[74]: Key=羅東高工, DocCount=66
DEBUG 2025/12/17 16:57:00   Bucket[75]: Key=南投高中, DocCount=65
DEBUG 2025/12/17 16:57:00   Bucket[76]: Key=新竹高中, DocCount=63
DEBUG 2025/12/17 16:57:00   Bucket[77]: Key=家齊高中, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[78]: Key=臺南一中, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[79]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 16:57:00   Bucket[80]: Key=暨大附中, DocCount=57
DEBUG 2025/12/17 16:57:00   Bucket[81]: Key=花蓮高工, DocCount=57
DEBUG 2025/12/17 16:57:00   Bucket[82]: Key=海大附中, DocCount=56
DEBUG 2025/12/17 16:57:00   Bucket[83]: Key=雲林特教, DocCount=56
DEBUG 2025/12/17 16:57:00   Bucket[84]: Key=草屯商工, DocCount=55
DEBUG 2025/12/17 16:57:00   Bucket[85]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 16:57:00   Bucket[86]: Key=嘉義高中, DocCount=53
DEBUG 2025/12/17 16:57:00   Bucket[87]: Key=臺東女中, DocCount=53
DEBUG 2025/12/17 16:57:00   Bucket[88]: Key=員林農工, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[89]: Key=秀水高工, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[90]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 16:57:00   Bucket[91]: Key=善化高中, DocCount=50
DEBUG 2025/12/17 16:57:00   Bucket[92]: Key=南大附小, DocCount=49
DEBUG 2025/12/17 16:57:00   Bucket[93]: Key=東石高中, DocCount=47
DEBUG 2025/12/17 16:57:00   Bucket[94]: Key=成功商水, DocCount=46
DEBUG 2025/12/17 16:57:00   Bucket[95]: Key=員林高中, DocCount=44
DEBUG 2025/12/17 16:57:00   Bucket[96]: Key=嘉義特教, DocCount=44
DEBUG 2025/12/17 16:57:00   Bucket[97]: Key=潮州高中, DocCount=43
DEBUG 2025/12/17 16:57:00   Bucket[98]: Key=羅東高商, DocCount=43
DEBUG 2025/12/17 16:57:00   Bucket[99]: Key=旗山農工, DocCount=41
DEBUG 2025/12/17 16:57:00 ========================================================
INFO 2025/12/17 16:57:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 16:57:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 16:57:08 ✅ Successfully flushed 20/20 history records to TimescaleDB
INFO 2025/12/17 16:57:08 Processing 15 offline devices
INFO 2025/12/17 16:57:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:57:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:57:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:57:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:57:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:57:09 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:57:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:57:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:57:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:57:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 中興高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 中興高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 中興高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 16:57:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 16:57:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:57:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:57:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 16:57:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 16:57:10 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 16:57:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:57:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:57:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:57:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 16:57:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 16:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 16:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:57:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:57:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 16:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:57:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:57:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:57:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:57:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:57:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 16:57:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:57:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.36% (threshold: 90.00%)
INFO 2025/12/17 16:57:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 16:57:45 ES Alert Created [high][capacity]: Disk usage high: 93.41% (threshold: 85.00%)
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 16:57:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 16:57:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 16:57:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 16:57:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:57:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 16:57:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:57:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:58:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:58:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:58:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:58:00 Field: school_name.keyword
DEBUG 2025/12/17 16:58:00 Time From: 2025-12-17T16:57:00.000+08:00
DEBUG 2025/12/17 16:58:00 Time To: 2025-12-17T16:58:00.000+08:00
DEBUG 2025/12/17 16:58:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:57:00.000+08:00",
					"lte": "2025-12-17T16:58:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:58:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:58:00 ES Response IsError: false
DEBUG 2025/12/17 16:58:00 ES Response Body:
{"took":76,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":487,"buckets":[{"key":"黑快馬主機","doc_count":1284},{"key":"南投高商","doc_count":773},{"key":"花蓮高農","doc_count":723},{"key":"新竹女中","doc_count":702},{"key":"仁愛高農","doc_count":694},{"key":"金門高中","doc_count":655},{"key":"臺東高中","doc_count":527},{"key":"竹北高中","doc_count":524},{"key":"金門農工","doc_count":506},{"key":"華僑高中","doc_count":489},{"key":"北門高中","doc_count":428},{"key":"旗美高中","doc_count":424},{"key":"宜蘭高商","doc_count":403},{"key":"清華附小","doc_count":363},{"key":"師大附中高中部","doc_count":360},{"key":"興大附中","doc_count":337},{"key":"花蓮高商","doc_count":320},{"key":"新港藝高","doc_count":317},{"key":"屏東女中","doc_count":297},{"key":"竹南高中","doc_count":290},{"key":"內埔農工","doc_count":288},{"key":"南大附聰","doc_count":261},{"key":"關西高中","doc_count":260},{"key":"埔里高工","doc_count":258},{"key":"玉里高中","doc_count":253},{"key":"中大壢中","doc_count":250},{"key":"蘇澳海事","doc_count":248},{"key":"南投特教","doc_count":229},{"key":"關山工商","doc_count":222},{"key":"新化高中","doc_count":221},{"key":"後壁高中","doc_count":220},{"key":"苗栗農工","doc_count":216},{"key":"北斗家商","doc_count":210},{"key":"新營高工","doc_count":198},{"key":"員林家商","doc_count":193},{"key":"東港海事","doc_count":172},{"key":"斗六家商","doc_count":166},{"key":"嘉義高商","doc_count":154},{"key":"政大附中","doc_count":138},{"key":"新化高工","doc_count":123},{"key":"嘉科實中","doc_count":122},{"key":"臺東女中","doc_count":121},{"key":"彰化高商","doc_count":118},{"key":"彰師附工","doc_count":116},{"key":"虎尾高中","doc_count":111},{"key":"草屯商工","doc_count":109},{"key":"新營高中","doc_count":104},{"key":"北港高中","doc_count":100},{"key":"新竹高工","doc_count":99},{"key":"苗栗高商","doc_count":97},{"key":"南大附中","doc_count":91},{"key":"中興高中","doc_count":90},{"key":"頭城家商","doc_count":90},{"key":"花蓮高工","doc_count":87},{"key":"北港農工","doc_count":86},{"key":"屏科實中","doc_count":85},{"key":"員林農工","doc_count":82},{"key":"華南高商","doc_count":78},{"key":"南投高中","doc_count":77},{"key":"成大南工","doc_count":77},{"key":"嘉義高中","doc_count":72},{"key":"新竹高中","doc_count":71},{"key":"苗栗高中","doc_count":68},{"key":"水里商工","doc_count":67},{"key":"雲林特教","doc_count":67},{"key":"羅東高商","doc_count":65},{"key":"北教大實小","doc_count":64},{"key":"成功商水","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"澎湖海事","doc_count":63},{"key":"白河商工","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"鳳山高中","doc_count":60},{"key":"宜蘭高中","doc_count":58},{"key":"永靖高工","doc_count":58},{"key":"臺東高商","doc_count":57},{"key":"蘭陽女中","doc_count":57},{"key":"基隆商工","doc_count":56},{"key":"新豐高中","doc_count":56},{"key":"秀水高工","doc_count":56},{"key":"土庫商工","doc_count":55},{"key":"新竹高商","doc_count":54},{"key":"臺南一中","doc_count":54},{"key":"羅東高工","doc_count":53},{"key":"高餐大附中","doc_count":53},{"key":"東石高中","doc_count":52},{"key":"興大附農","doc_count":51},{"key":"屏北高中","doc_count":49},{"key":"花蓮高中","doc_count":48},{"key":"玉井工商","doc_count":47},{"key":"善化高中","doc_count":45},{"key":"嘉義高工","doc_count":45},{"key":"屏東特教","doc_count":44},{"key":"暨大附中","doc_count":44},{"key":"崇實高工","doc_count":43},{"key":"旗山農工","doc_count":43},{"key":"潮州高中","doc_count":43},{"key":"家齊高中","doc_count":42},{"key":"溪湖高中","doc_count":41},{"key":"佳冬高農","doc_count":40}]}}}
DEBUG 2025/12/17 16:58:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:58:00   Bucket[0]: Key=黑快馬主機, DocCount=1284
DEBUG 2025/12/17 16:58:00   Bucket[1]: Key=南投高商, DocCount=773
DEBUG 2025/12/17 16:58:00   Bucket[2]: Key=花蓮高農, DocCount=723
DEBUG 2025/12/17 16:58:00   Bucket[3]: Key=新竹女中, DocCount=702
DEBUG 2025/12/17 16:58:00   Bucket[4]: Key=仁愛高農, DocCount=694
DEBUG 2025/12/17 16:58:00   Bucket[5]: Key=金門高中, DocCount=655
DEBUG 2025/12/17 16:58:00   Bucket[6]: Key=臺東高中, DocCount=527
DEBUG 2025/12/17 16:58:00   Bucket[7]: Key=竹北高中, DocCount=524
DEBUG 2025/12/17 16:58:00   Bucket[8]: Key=金門農工, DocCount=506
DEBUG 2025/12/17 16:58:00   Bucket[9]: Key=華僑高中, DocCount=489
DEBUG 2025/12/17 16:58:00   Bucket[10]: Key=北門高中, DocCount=428
DEBUG 2025/12/17 16:58:00   Bucket[11]: Key=旗美高中, DocCount=424
DEBUG 2025/12/17 16:58:00   Bucket[12]: Key=宜蘭高商, DocCount=403
DEBUG 2025/12/17 16:58:00   Bucket[13]: Key=清華附小, DocCount=363
DEBUG 2025/12/17 16:58:00   Bucket[14]: Key=師大附中高中部, DocCount=360
DEBUG 2025/12/17 16:58:00   Bucket[15]: Key=興大附中, DocCount=337
DEBUG 2025/12/17 16:58:00   Bucket[16]: Key=花蓮高商, DocCount=320
DEBUG 2025/12/17 16:58:00   Bucket[17]: Key=新港藝高, DocCount=317
DEBUG 2025/12/17 16:58:00   Bucket[18]: Key=屏東女中, DocCount=297
DEBUG 2025/12/17 16:58:00   Bucket[19]: Key=竹南高中, DocCount=290
DEBUG 2025/12/17 16:58:00   Bucket[20]: Key=內埔農工, DocCount=288
DEBUG 2025/12/17 16:58:00   Bucket[21]: Key=南大附聰, DocCount=261
DEBUG 2025/12/17 16:58:00   Bucket[22]: Key=關西高中, DocCount=260
DEBUG 2025/12/17 16:58:00   Bucket[23]: Key=埔里高工, DocCount=258
DEBUG 2025/12/17 16:58:00   Bucket[24]: Key=玉里高中, DocCount=253
DEBUG 2025/12/17 16:58:00   Bucket[25]: Key=中大壢中, DocCount=250
DEBUG 2025/12/17 16:58:00   Bucket[26]: Key=蘇澳海事, DocCount=248
DEBUG 2025/12/17 16:58:00   Bucket[27]: Key=南投特教, DocCount=229
DEBUG 2025/12/17 16:58:00   Bucket[28]: Key=關山工商, DocCount=222
DEBUG 2025/12/17 16:58:00   Bucket[29]: Key=新化高中, DocCount=221
DEBUG 2025/12/17 16:58:00   Bucket[30]: Key=後壁高中, DocCount=220
DEBUG 2025/12/17 16:58:00   Bucket[31]: Key=苗栗農工, DocCount=216
DEBUG 2025/12/17 16:58:00   Bucket[32]: Key=北斗家商, DocCount=210
DEBUG 2025/12/17 16:58:00   Bucket[33]: Key=新營高工, DocCount=198
DEBUG 2025/12/17 16:58:00   Bucket[34]: Key=員林家商, DocCount=193
DEBUG 2025/12/17 16:58:00   Bucket[35]: Key=東港海事, DocCount=172
DEBUG 2025/12/17 16:58:00   Bucket[36]: Key=斗六家商, DocCount=166
DEBUG 2025/12/17 16:58:00   Bucket[37]: Key=嘉義高商, DocCount=154
DEBUG 2025/12/17 16:58:00   Bucket[38]: Key=政大附中, DocCount=138
DEBUG 2025/12/17 16:58:00   Bucket[39]: Key=新化高工, DocCount=123
DEBUG 2025/12/17 16:58:00   Bucket[40]: Key=嘉科實中, DocCount=122
DEBUG 2025/12/17 16:58:00   Bucket[41]: Key=臺東女中, DocCount=121
DEBUG 2025/12/17 16:58:00   Bucket[42]: Key=彰化高商, DocCount=118
DEBUG 2025/12/17 16:58:00   Bucket[43]: Key=彰師附工, DocCount=116
DEBUG 2025/12/17 16:58:00   Bucket[44]: Key=虎尾高中, DocCount=111
DEBUG 2025/12/17 16:58:00   Bucket[45]: Key=草屯商工, DocCount=109
DEBUG 2025/12/17 16:58:00   Bucket[46]: Key=新營高中, DocCount=104
DEBUG 2025/12/17 16:58:00   Bucket[47]: Key=北港高中, DocCount=100
DEBUG 2025/12/17 16:58:00   Bucket[48]: Key=新竹高工, DocCount=99
DEBUG 2025/12/17 16:58:00   Bucket[49]: Key=苗栗高商, DocCount=97
DEBUG 2025/12/17 16:58:00   Bucket[50]: Key=南大附中, DocCount=91
DEBUG 2025/12/17 16:58:00   Bucket[51]: Key=中興高中, DocCount=90
DEBUG 2025/12/17 16:58:00   Bucket[52]: Key=頭城家商, DocCount=90
DEBUG 2025/12/17 16:58:00   Bucket[53]: Key=花蓮高工, DocCount=87
DEBUG 2025/12/17 16:58:00   Bucket[54]: Key=北港農工, DocCount=86
DEBUG 2025/12/17 16:58:00   Bucket[55]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 16:58:00   Bucket[56]: Key=員林農工, DocCount=82
DEBUG 2025/12/17 16:58:00   Bucket[57]: Key=華南高商, DocCount=78
DEBUG 2025/12/17 16:58:00   Bucket[58]: Key=南投高中, DocCount=77
DEBUG 2025/12/17 16:58:00   Bucket[59]: Key=成大南工, DocCount=77
DEBUG 2025/12/17 16:58:00   Bucket[60]: Key=嘉義高中, DocCount=72
DEBUG 2025/12/17 16:58:00   Bucket[61]: Key=新竹高中, DocCount=71
DEBUG 2025/12/17 16:58:00   Bucket[62]: Key=苗栗高中, DocCount=68
DEBUG 2025/12/17 16:58:00   Bucket[63]: Key=水里商工, DocCount=67
DEBUG 2025/12/17 16:58:00   Bucket[64]: Key=雲林特教, DocCount=67
DEBUG 2025/12/17 16:58:00   Bucket[65]: Key=羅東高商, DocCount=65
DEBUG 2025/12/17 16:58:00   Bucket[66]: Key=北教大實小, DocCount=64
DEBUG 2025/12/17 16:58:00   Bucket[67]: Key=成功商水, DocCount=64
DEBUG 2025/12/17 16:58:00   Bucket[68]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 16:58:00   Bucket[69]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 16:58:00   Bucket[70]: Key=白河商工, DocCount=61
DEBUG 2025/12/17 16:58:00   Bucket[71]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 16:58:00   Bucket[72]: Key=鳳山高中, DocCount=60
DEBUG 2025/12/17 16:58:00   Bucket[73]: Key=宜蘭高中, DocCount=58
DEBUG 2025/12/17 16:58:00   Bucket[74]: Key=永靖高工, DocCount=58
DEBUG 2025/12/17 16:58:00   Bucket[75]: Key=臺東高商, DocCount=57
DEBUG 2025/12/17 16:58:00   Bucket[76]: Key=蘭陽女中, DocCount=57
DEBUG 2025/12/17 16:58:00   Bucket[77]: Key=基隆商工, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[78]: Key=新豐高中, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[79]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 16:58:00   Bucket[80]: Key=土庫商工, DocCount=55
DEBUG 2025/12/17 16:58:00   Bucket[81]: Key=新竹高商, DocCount=54
DEBUG 2025/12/17 16:58:00   Bucket[82]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 16:58:00   Bucket[83]: Key=羅東高工, DocCount=53
DEBUG 2025/12/17 16:58:00   Bucket[84]: Key=高餐大附中, DocCount=53
DEBUG 2025/12/17 16:58:00   Bucket[85]: Key=東石高中, DocCount=52
DEBUG 2025/12/17 16:58:00   Bucket[86]: Key=興大附農, DocCount=51
DEBUG 2025/12/17 16:58:00   Bucket[87]: Key=屏北高中, DocCount=49
DEBUG 2025/12/17 16:58:00   Bucket[88]: Key=花蓮高中, DocCount=48
DEBUG 2025/12/17 16:58:00   Bucket[89]: Key=玉井工商, DocCount=47
DEBUG 2025/12/17 16:58:00   Bucket[90]: Key=善化高中, DocCount=45
DEBUG 2025/12/17 16:58:00   Bucket[91]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 16:58:00   Bucket[92]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 16:58:00   Bucket[93]: Key=暨大附中, DocCount=44
DEBUG 2025/12/17 16:58:00   Bucket[94]: Key=崇實高工, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[95]: Key=旗山農工, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[96]: Key=潮州高中, DocCount=43
DEBUG 2025/12/17 16:58:00   Bucket[97]: Key=家齊高中, DocCount=42
DEBUG 2025/12/17 16:58:00   Bucket[98]: Key=溪湖高中, DocCount=41
DEBUG 2025/12/17 16:58:00   Bucket[99]: Key=佳冬高農, DocCount=40
DEBUG 2025/12/17 16:58:00 ========================================================
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:58:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 16:58:08 ✅ Successfully flushed 31/31 history records to TimescaleDB
INFO 2025/12/17 16:58:08 Processing 15 offline devices
INFO 2025/12/17 16:58:08 Creating history record for offline device: 屏東高工
INFO 2025/12/17 16:58:08 About to add history to batch for device: 屏東高工
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 16:58:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:58:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:58:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:58:08 Creating history record for offline device: 海大附中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 海大附中
INFO 2025/12/17 16:58:08 Successfully added history record for offline device: 海大附中
INFO 2025/12/17 16:58:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 16:58:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 16:58:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 16:58:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 16:58:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 16:58:09 Creating history record for offline device: 曾文農工
INFO 2025/12/17 16:58:09 About to add history to batch for device: 曾文農工
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 16:58:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:58:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:58:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:58:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:58:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:58:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 16:58:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 16:58:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:58:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:58:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:58:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:58:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:58:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:58:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:58:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:58:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 16:58:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:58:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:58:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:58:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:58:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:58:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:58:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 16:58:45 ES Alert Created [high][performance]: Memory usage high: 88.28% (threshold: 80.00%)
INFO 2025/12/17 16:58:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.41% (threshold: 85.00%)
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:58:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:58:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:58:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:58:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:58:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 16:59:00 Index 1 using ES connection 4
DEBUG 2025/12/17 16:59:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 16:59:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 16:59:00 Field: school_name.keyword
DEBUG 2025/12/17 16:59:00 Time From: 2025-12-17T16:58:00.000+08:00
DEBUG 2025/12/17 16:59:00 Time To: 2025-12-17T16:59:00.000+08:00
DEBUG 2025/12/17 16:59:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:58:00.000+08:00",
					"lte": "2025-12-17T16:59:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 16:59:00 ES Response Status: 200 OK
DEBUG 2025/12/17 16:59:00 ES Response IsError: false
DEBUG 2025/12/17 16:59:00 ES Response Body:
{"took":76,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":456,"buckets":[{"key":"黑快馬主機","doc_count":1191},{"key":"花蓮高農","doc_count":777},{"key":"南投高商","doc_count":670},{"key":"仁愛高農","doc_count":632},{"key":"新竹女中","doc_count":605},{"key":"金門農工","doc_count":602},{"key":"華僑高中","doc_count":571},{"key":"金門高中","doc_count":524},{"key":"竹北高中","doc_count":519},{"key":"臺東高中","doc_count":478},{"key":"宜蘭高商","doc_count":405},{"key":"北門高中","doc_count":392},{"key":"旗美高中","doc_count":364},{"key":"蘇澳海事","doc_count":307},{"key":"興大附中","doc_count":305},{"key":"南大附聰","doc_count":297},{"key":"花蓮高商","doc_count":288},{"key":"北斗家商","doc_count":286},{"key":"中大壢中","doc_count":284},{"key":"清華附小","doc_count":283},{"key":"新港藝高","doc_count":276},{"key":"關西高中","doc_count":273},{"key":"屏東女中","doc_count":263},{"key":"玉里高中","doc_count":259},{"key":"中興高中","doc_count":254},{"key":"內埔農工","doc_count":248},{"key":"南投特教","doc_count":243},{"key":"竹南高中","doc_count":242},{"key":"嘉義高商","doc_count":234},{"key":"苗栗農工","doc_count":224},{"key":"後壁高中","doc_count":212},{"key":"斗六家商","doc_count":190},{"key":"草屯商工","doc_count":185},{"key":"新化高中","doc_count":184},{"key":"關山工商","doc_count":177},{"key":"東港海事","doc_count":163},{"key":"員林家商","doc_count":147},{"key":"新營高工","doc_count":137},{"key":"屏東高工","doc_count":127},{"key":"虎尾高中","doc_count":122},{"key":"苗栗高中","doc_count":120},{"key":"新化高工","doc_count":113},{"key":"員林農工","doc_count":107},{"key":"師大附中高中部","doc_count":104},{"key":"新竹高工","doc_count":104},{"key":"嘉科實中","doc_count":99},{"key":"屏科實中","doc_count":97},{"key":"新營高中","doc_count":96},{"key":"彰師附工","doc_count":95},{"key":"南大附中","doc_count":91},{"key":"花蓮高工","doc_count":86},{"key":"臺南高商","doc_count":85},{"key":"苗栗高商","doc_count":84},{"key":"彰化高商","doc_count":81},{"key":"新竹高中","doc_count":81},{"key":"臺東高商","doc_count":78},{"key":"鳳山高中","doc_count":77},{"key":"善化高中","doc_count":72},{"key":"土庫商工","doc_count":71},{"key":"永靖高工","doc_count":70},{"key":"南投高中","doc_count":69},{"key":"北教大實小","doc_count":67},{"key":"溪湖高中","doc_count":67},{"key":"嘉義高中","doc_count":65},{"key":"興大附農","doc_count":65},{"key":"成功商水","doc_count":64},{"key":"高餐大附中","doc_count":64},{"key":"水里商工","doc_count":62},{"key":"潮州高中","doc_count":60},{"key":"白河商工","doc_count":58},{"key":"屏東高中","doc_count":57},{"key":"華南高商","doc_count":57},{"key":"臺南一中","doc_count":56},{"key":"雲林特教","doc_count":56},{"key":"北港高中","doc_count":55},{"key":"羅東高工","doc_count":55},{"key":"海大附中","doc_count":54},{"key":"花蓮高中","doc_count":51},{"key":"基隆商工","doc_count":50},{"key":"蘭陽女中","doc_count":50},{"key":"埔里高工","doc_count":49},{"key":"新竹高商","doc_count":49},{"key":"頭城家商","doc_count":48},{"key":"宜蘭高中","doc_count":46},{"key":"家齊高中","doc_count":46},{"key":"東石高中","doc_count":46},{"key":"臺東女中","doc_count":46},{"key":"崇實高工","doc_count":45},{"key":"師大附中國中部","doc_count":45},{"key":"成大南工","doc_count":45},{"key":"嘉義高工","doc_count":44},{"key":"羅東高商","doc_count":44},{"key":"佳冬高農","doc_count":43},{"key":"屏東特教","doc_count":43},{"key":"二林工商","doc_count":42},{"key":"南大附小","doc_count":41},{"key":"竹東高中","doc_count":41},{"key":"新豐高中","doc_count":40},{"key":"澎湖海事","doc_count":40},{"key":"嘉義特教","doc_count":39}]}}}
DEBUG 2025/12/17 16:59:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 16:59:00   Bucket[0]: Key=黑快馬主機, DocCount=1191
DEBUG 2025/12/17 16:59:00   Bucket[1]: Key=花蓮高農, DocCount=777
DEBUG 2025/12/17 16:59:00   Bucket[2]: Key=南投高商, DocCount=670
DEBUG 2025/12/17 16:59:00   Bucket[3]: Key=仁愛高農, DocCount=632
DEBUG 2025/12/17 16:59:00   Bucket[4]: Key=新竹女中, DocCount=605
DEBUG 2025/12/17 16:59:00   Bucket[5]: Key=金門農工, DocCount=602
DEBUG 2025/12/17 16:59:00   Bucket[6]: Key=華僑高中, DocCount=571
DEBUG 2025/12/17 16:59:00   Bucket[7]: Key=金門高中, DocCount=524
DEBUG 2025/12/17 16:59:00   Bucket[8]: Key=竹北高中, DocCount=519
DEBUG 2025/12/17 16:59:00   Bucket[9]: Key=臺東高中, DocCount=478
DEBUG 2025/12/17 16:59:00   Bucket[10]: Key=宜蘭高商, DocCount=405
DEBUG 2025/12/17 16:59:00   Bucket[11]: Key=北門高中, DocCount=392
DEBUG 2025/12/17 16:59:00   Bucket[12]: Key=旗美高中, DocCount=364
DEBUG 2025/12/17 16:59:00   Bucket[13]: Key=蘇澳海事, DocCount=307
DEBUG 2025/12/17 16:59:00   Bucket[14]: Key=興大附中, DocCount=305
DEBUG 2025/12/17 16:59:00   Bucket[15]: Key=南大附聰, DocCount=297
DEBUG 2025/12/17 16:59:00   Bucket[16]: Key=花蓮高商, DocCount=288
DEBUG 2025/12/17 16:59:00   Bucket[17]: Key=北斗家商, DocCount=286
DEBUG 2025/12/17 16:59:00   Bucket[18]: Key=中大壢中, DocCount=284
DEBUG 2025/12/17 16:59:00   Bucket[19]: Key=清華附小, DocCount=283
DEBUG 2025/12/17 16:59:00   Bucket[20]: Key=新港藝高, DocCount=276
DEBUG 2025/12/17 16:59:00   Bucket[21]: Key=關西高中, DocCount=273
DEBUG 2025/12/17 16:59:00   Bucket[22]: Key=屏東女中, DocCount=263
DEBUG 2025/12/17 16:59:00   Bucket[23]: Key=玉里高中, DocCount=259
DEBUG 2025/12/17 16:59:00   Bucket[24]: Key=中興高中, DocCount=254
DEBUG 2025/12/17 16:59:00   Bucket[25]: Key=內埔農工, DocCount=248
DEBUG 2025/12/17 16:59:00   Bucket[26]: Key=南投特教, DocCount=243
DEBUG 2025/12/17 16:59:00   Bucket[27]: Key=竹南高中, DocCount=242
DEBUG 2025/12/17 16:59:00   Bucket[28]: Key=嘉義高商, DocCount=234
DEBUG 2025/12/17 16:59:00   Bucket[29]: Key=苗栗農工, DocCount=224
DEBUG 2025/12/17 16:59:00   Bucket[30]: Key=後壁高中, DocCount=212
DEBUG 2025/12/17 16:59:00   Bucket[31]: Key=斗六家商, DocCount=190
DEBUG 2025/12/17 16:59:00   Bucket[32]: Key=草屯商工, DocCount=185
DEBUG 2025/12/17 16:59:00   Bucket[33]: Key=新化高中, DocCount=184
DEBUG 2025/12/17 16:59:00   Bucket[34]: Key=關山工商, DocCount=177
DEBUG 2025/12/17 16:59:00   Bucket[35]: Key=東港海事, DocCount=163
DEBUG 2025/12/17 16:59:00   Bucket[36]: Key=員林家商, DocCount=147
DEBUG 2025/12/17 16:59:00   Bucket[37]: Key=新營高工, DocCount=137
DEBUG 2025/12/17 16:59:00   Bucket[38]: Key=屏東高工, DocCount=127
DEBUG 2025/12/17 16:59:00   Bucket[39]: Key=虎尾高中, DocCount=122
DEBUG 2025/12/17 16:59:00   Bucket[40]: Key=苗栗高中, DocCount=120
DEBUG 2025/12/17 16:59:00   Bucket[41]: Key=新化高工, DocCount=113
DEBUG 2025/12/17 16:59:00   Bucket[42]: Key=員林農工, DocCount=107
DEBUG 2025/12/17 16:59:00   Bucket[43]: Key=師大附中高中部, DocCount=104
DEBUG 2025/12/17 16:59:00   Bucket[44]: Key=新竹高工, DocCount=104
DEBUG 2025/12/17 16:59:00   Bucket[45]: Key=嘉科實中, DocCount=99
DEBUG 2025/12/17 16:59:00   Bucket[46]: Key=屏科實中, DocCount=97
DEBUG 2025/12/17 16:59:00   Bucket[47]: Key=新營高中, DocCount=96
DEBUG 2025/12/17 16:59:00   Bucket[48]: Key=彰師附工, DocCount=95
DEBUG 2025/12/17 16:59:00   Bucket[49]: Key=南大附中, DocCount=91
DEBUG 2025/12/17 16:59:00   Bucket[50]: Key=花蓮高工, DocCount=86
DEBUG 2025/12/17 16:59:00   Bucket[51]: Key=臺南高商, DocCount=85
DEBUG 2025/12/17 16:59:00   Bucket[52]: Key=苗栗高商, DocCount=84
DEBUG 2025/12/17 16:59:00   Bucket[53]: Key=彰化高商, DocCount=81
DEBUG 2025/12/17 16:59:00   Bucket[54]: Key=新竹高中, DocCount=81
DEBUG 2025/12/17 16:59:00   Bucket[55]: Key=臺東高商, DocCount=78
DEBUG 2025/12/17 16:59:00   Bucket[56]: Key=鳳山高中, DocCount=77
DEBUG 2025/12/17 16:59:00   Bucket[57]: Key=善化高中, DocCount=72
DEBUG 2025/12/17 16:59:00   Bucket[58]: Key=土庫商工, DocCount=71
DEBUG 2025/12/17 16:59:00   Bucket[59]: Key=永靖高工, DocCount=70
DEBUG 2025/12/17 16:59:00   Bucket[60]: Key=南投高中, DocCount=69
DEBUG 2025/12/17 16:59:00   Bucket[61]: Key=北教大實小, DocCount=67
DEBUG 2025/12/17 16:59:00   Bucket[62]: Key=溪湖高中, DocCount=67
DEBUG 2025/12/17 16:59:00   Bucket[63]: Key=嘉義高中, DocCount=65
DEBUG 2025/12/17 16:59:00   Bucket[64]: Key=興大附農, DocCount=65
DEBUG 2025/12/17 16:59:00   Bucket[65]: Key=成功商水, DocCount=64
DEBUG 2025/12/17 16:59:00   Bucket[66]: Key=高餐大附中, DocCount=64
DEBUG 2025/12/17 16:59:00   Bucket[67]: Key=水里商工, DocCount=62
DEBUG 2025/12/17 16:59:00   Bucket[68]: Key=潮州高中, DocCount=60
DEBUG 2025/12/17 16:59:00   Bucket[69]: Key=白河商工, DocCount=58
DEBUG 2025/12/17 16:59:00   Bucket[70]: Key=屏東高中, DocCount=57
DEBUG 2025/12/17 16:59:00   Bucket[71]: Key=華南高商, DocCount=57
DEBUG 2025/12/17 16:59:00   Bucket[72]: Key=臺南一中, DocCount=56
DEBUG 2025/12/17 16:59:00   Bucket[73]: Key=雲林特教, DocCount=56
DEBUG 2025/12/17 16:59:00   Bucket[74]: Key=北港高中, DocCount=55
DEBUG 2025/12/17 16:59:00   Bucket[75]: Key=羅東高工, DocCount=55
DEBUG 2025/12/17 16:59:00   Bucket[76]: Key=海大附中, DocCount=54
DEBUG 2025/12/17 16:59:00   Bucket[77]: Key=花蓮高中, DocCount=51
DEBUG 2025/12/17 16:59:00   Bucket[78]: Key=基隆商工, DocCount=50
DEBUG 2025/12/17 16:59:00   Bucket[79]: Key=蘭陽女中, DocCount=50
DEBUG 2025/12/17 16:59:00   Bucket[80]: Key=埔里高工, DocCount=49
DEBUG 2025/12/17 16:59:00   Bucket[81]: Key=新竹高商, DocCount=49
DEBUG 2025/12/17 16:59:00   Bucket[82]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 16:59:00   Bucket[83]: Key=宜蘭高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[84]: Key=家齊高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[85]: Key=東石高中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[86]: Key=臺東女中, DocCount=46
DEBUG 2025/12/17 16:59:00   Bucket[87]: Key=崇實高工, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[88]: Key=師大附中國中部, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[89]: Key=成大南工, DocCount=45
DEBUG 2025/12/17 16:59:00   Bucket[90]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 16:59:00   Bucket[91]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 16:59:00   Bucket[92]: Key=佳冬高農, DocCount=43
DEBUG 2025/12/17 16:59:00   Bucket[93]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 16:59:00   Bucket[94]: Key=二林工商, DocCount=42
DEBUG 2025/12/17 16:59:00   Bucket[95]: Key=南大附小, DocCount=41
DEBUG 2025/12/17 16:59:00   Bucket[96]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 16:59:00   Bucket[97]: Key=新豐高中, DocCount=40
DEBUG 2025/12/17 16:59:00   Bucket[98]: Key=澎湖海事, DocCount=40
DEBUG 2025/12/17 16:59:00   Bucket[99]: Key=嘉義特教, DocCount=39
DEBUG 2025/12/17 16:59:00 ========================================================
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 16:59:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 16:59:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 16:59:08 Processing 15 offline devices
INFO 2025/12/17 16:59:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 北港農工
INFO 2025/12/17 16:59:08 About to add history to batch for device: 北港農工
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 16:59:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 曾文農工
INFO 2025/12/17 16:59:08 About to add history to batch for device: 曾文農工
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 16:59:08 Creating history record for offline device: 政大附中
INFO 2025/12/17 16:59:08 About to add history to batch for device: 政大附中
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 16:59:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 16:59:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 16:59:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 16:59:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 16:59:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 16:59:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 16:59:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 16:59:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 16:59:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 16:59:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 16:59:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 16:59:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 16:59:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 16:59:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 16:59:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 16:59:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 16:59:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 16:59:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 16:59:13 ✅ Successfully flushed 16/16 history records to TimescaleDB
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 16:59:45 Starting ES monitor check for: ncku
INFO 2025/12/17 16:59:45 Starting ES monitor check for: 213
INFO 2025/12/17 16:59:45 Starting ES monitor check for: NTU
INFO 2025/12/17 16:59:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 16:59:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:59:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:59:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:59:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 16:59:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 16:59:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:59:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 16:59:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 16:59:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 16:59:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 16:59:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 16:59:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.15% (threshold: 80.00%)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.44% (threshold: 85.00%)
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 16:59:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 16:59:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 16:59:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 16:59:45 ES monitor check completed for: 213, status: online
INFO 2025/12/17 16:59:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 16:59:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:00:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:00:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:00:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:00:00 Field: school_name.keyword
DEBUG 2025/12/17 17:00:00 Time From: 2025-12-17T16:59:00.000+08:00
DEBUG 2025/12/17 17:00:00 Time To: 2025-12-17T17:00:00.000+08:00
DEBUG 2025/12/17 17:00:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T16:59:00.000+08:00",
					"lte": "2025-12-17T17:00:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:00:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:00:00 ES Response IsError: false
DEBUG 2025/12/17 17:00:00 ES Response Body:
{"took":81,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":490,"buckets":[{"key":"黑快馬主機","doc_count":1377},{"key":"花蓮高農","doc_count":799},{"key":"南投高商","doc_count":743},{"key":"新竹女中","doc_count":637},{"key":"仁愛高農","doc_count":559},{"key":"金門農工","doc_count":550},{"key":"金門高中","doc_count":542},{"key":"華僑高中","doc_count":461},{"key":"竹北高中","doc_count":441},{"key":"宜蘭高商","doc_count":433},{"key":"旗美高中","doc_count":398},{"key":"北門高中","doc_count":389},{"key":"臺東高中","doc_count":359},{"key":"南大附聰","doc_count":340},{"key":"興大附中","doc_count":300},{"key":"新港藝高","doc_count":282},{"key":"中大壢中","doc_count":281},{"key":"關山工商","doc_count":274},{"key":"清華附小","doc_count":268},{"key":"政大附中","doc_count":262},{"key":"蘇澳海事","doc_count":250},{"key":"內埔農工","doc_count":234},{"key":"南投特教","doc_count":233},{"key":"竹南高中","doc_count":229},{"key":"苗栗農工","doc_count":219},{"key":"花蓮高商","doc_count":213},{"key":"後壁高中","doc_count":197},{"key":"新化高中","doc_count":194},{"key":"中興高中","doc_count":186},{"key":"關西高中","doc_count":182},{"key":"嘉義高商","doc_count":179},{"key":"東港海事","doc_count":167},{"key":"北斗家商","doc_count":163},{"key":"新營高工","doc_count":163},{"key":"屏東女中","doc_count":155},{"key":"虎尾高中","doc_count":148},{"key":"斗六家商","doc_count":145},{"key":"玉里高中","doc_count":142},{"key":"員林家商","doc_count":140},{"key":"草屯商工","doc_count":133},{"key":"師大附中高中部","doc_count":126},{"key":"新化高工","doc_count":120},{"key":"彰化高商","doc_count":106},{"key":"潮州高中","doc_count":106},{"key":"土庫商工","doc_count":98},{"key":"新竹高中","doc_count":98},{"key":"嘉科實中","doc_count":97},{"key":"屏東高中","doc_count":94},{"key":"南投高中","doc_count":86},{"key":"北教大實小","doc_count":85},{"key":"苗栗高商","doc_count":85},{"key":"曾文農工","doc_count":82},{"key":"新竹高工","doc_count":80},{"key":"海大附中","doc_count":80},{"key":"基隆特教","doc_count":79},{"key":"南大附中","doc_count":75},{"key":"宜蘭高中","doc_count":72},{"key":"屏科實中","doc_count":71},{"key":"南大附小","doc_count":70},{"key":"嘉義高中","doc_count":70},{"key":"雲林特教","doc_count":68},{"key":"東石高中","doc_count":67},{"key":"澎湖海事","doc_count":67},{"key":"彰師附工","doc_count":65},{"key":"新營高中","doc_count":65},{"key":"員林高中","doc_count":64},{"key":"埔里高工","doc_count":64},{"key":"善化高中","doc_count":63},{"key":"成大南工","doc_count":63},{"key":"白河商工","doc_count":63},{"key":"臺南高商","doc_count":63},{"key":"北港高中","doc_count":62},{"key":"屏北高中","doc_count":62},{"key":"苗栗高中","doc_count":62},{"key":"花蓮高工","doc_count":61},{"key":"羅東高商","doc_count":60},{"key":"水里商工","doc_count":58},{"key":"二林工商","doc_count":57},{"key":"鳳山高中","doc_count":57},{"key":"嘉義家職","doc_count":55},{"key":"華南高商","doc_count":55},{"key":"臺東高商","doc_count":54},{"key":"屏東高工","doc_count":53},{"key":"嘉義高工","doc_count":52},{"key":"溪湖高中","doc_count":52},{"key":"北港農工","doc_count":50},{"key":"蘭陽女中","doc_count":49},{"key":"佳冬高農","doc_count":47},{"key":"成功商水","doc_count":47},{"key":"新豐高中","doc_count":46},{"key":"臺東女中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"新竹高商","doc_count":43},{"key":"臺南一中","doc_count":43},{"key":"頭城家商","doc_count":43},{"key":"竹山高中","doc_count":42},{"key":"羅東高工","doc_count":42},{"key":"旗山農工","doc_count":41},{"key":"竹東高中","doc_count":41}]}}}
DEBUG 2025/12/17 17:00:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:00:00   Bucket[0]: Key=黑快馬主機, DocCount=1377
DEBUG 2025/12/17 17:00:00   Bucket[1]: Key=花蓮高農, DocCount=799
DEBUG 2025/12/17 17:00:00   Bucket[2]: Key=南投高商, DocCount=743
DEBUG 2025/12/17 17:00:00   Bucket[3]: Key=新竹女中, DocCount=637
DEBUG 2025/12/17 17:00:00   Bucket[4]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:00:00   Bucket[5]: Key=金門農工, DocCount=550
DEBUG 2025/12/17 17:00:00   Bucket[6]: Key=金門高中, DocCount=542
DEBUG 2025/12/17 17:00:00   Bucket[7]: Key=華僑高中, DocCount=461
DEBUG 2025/12/17 17:00:00   Bucket[8]: Key=竹北高中, DocCount=441
DEBUG 2025/12/17 17:00:00   Bucket[9]: Key=宜蘭高商, DocCount=433
DEBUG 2025/12/17 17:00:00   Bucket[10]: Key=旗美高中, DocCount=398
DEBUG 2025/12/17 17:00:00   Bucket[11]: Key=北門高中, DocCount=389
DEBUG 2025/12/17 17:00:00   Bucket[12]: Key=臺東高中, DocCount=359
DEBUG 2025/12/17 17:00:00   Bucket[13]: Key=南大附聰, DocCount=340
DEBUG 2025/12/17 17:00:00   Bucket[14]: Key=興大附中, DocCount=300
DEBUG 2025/12/17 17:00:00   Bucket[15]: Key=新港藝高, DocCount=282
DEBUG 2025/12/17 17:00:00   Bucket[16]: Key=中大壢中, DocCount=281
DEBUG 2025/12/17 17:00:00   Bucket[17]: Key=關山工商, DocCount=274
DEBUG 2025/12/17 17:00:00   Bucket[18]: Key=清華附小, DocCount=268
DEBUG 2025/12/17 17:00:00   Bucket[19]: Key=政大附中, DocCount=262
DEBUG 2025/12/17 17:00:00   Bucket[20]: Key=蘇澳海事, DocCount=250
DEBUG 2025/12/17 17:00:00   Bucket[21]: Key=內埔農工, DocCount=234
DEBUG 2025/12/17 17:00:00   Bucket[22]: Key=南投特教, DocCount=233
DEBUG 2025/12/17 17:00:00   Bucket[23]: Key=竹南高中, DocCount=229
DEBUG 2025/12/17 17:00:00   Bucket[24]: Key=苗栗農工, DocCount=219
DEBUG 2025/12/17 17:00:00   Bucket[25]: Key=花蓮高商, DocCount=213
DEBUG 2025/12/17 17:00:00   Bucket[26]: Key=後壁高中, DocCount=197
DEBUG 2025/12/17 17:00:00   Bucket[27]: Key=新化高中, DocCount=194
DEBUG 2025/12/17 17:00:00   Bucket[28]: Key=中興高中, DocCount=186
DEBUG 2025/12/17 17:00:00   Bucket[29]: Key=關西高中, DocCount=182
DEBUG 2025/12/17 17:00:00   Bucket[30]: Key=嘉義高商, DocCount=179
DEBUG 2025/12/17 17:00:00   Bucket[31]: Key=東港海事, DocCount=167
DEBUG 2025/12/17 17:00:00   Bucket[32]: Key=北斗家商, DocCount=163
DEBUG 2025/12/17 17:00:00   Bucket[33]: Key=新營高工, DocCount=163
DEBUG 2025/12/17 17:00:00   Bucket[34]: Key=屏東女中, DocCount=155
DEBUG 2025/12/17 17:00:00   Bucket[35]: Key=虎尾高中, DocCount=148
DEBUG 2025/12/17 17:00:00   Bucket[36]: Key=斗六家商, DocCount=145
DEBUG 2025/12/17 17:00:00   Bucket[37]: Key=玉里高中, DocCount=142
DEBUG 2025/12/17 17:00:00   Bucket[38]: Key=員林家商, DocCount=140
DEBUG 2025/12/17 17:00:00   Bucket[39]: Key=草屯商工, DocCount=133
DEBUG 2025/12/17 17:00:00   Bucket[40]: Key=師大附中高中部, DocCount=126
DEBUG 2025/12/17 17:00:00   Bucket[41]: Key=新化高工, DocCount=120
DEBUG 2025/12/17 17:00:00   Bucket[42]: Key=彰化高商, DocCount=106
DEBUG 2025/12/17 17:00:00   Bucket[43]: Key=潮州高中, DocCount=106
DEBUG 2025/12/17 17:00:00   Bucket[44]: Key=土庫商工, DocCount=98
DEBUG 2025/12/17 17:00:00   Bucket[45]: Key=新竹高中, DocCount=98
DEBUG 2025/12/17 17:00:00   Bucket[46]: Key=嘉科實中, DocCount=97
DEBUG 2025/12/17 17:00:00   Bucket[47]: Key=屏東高中, DocCount=94
DEBUG 2025/12/17 17:00:00   Bucket[48]: Key=南投高中, DocCount=86
DEBUG 2025/12/17 17:00:00   Bucket[49]: Key=北教大實小, DocCount=85
DEBUG 2025/12/17 17:00:00   Bucket[50]: Key=苗栗高商, DocCount=85
DEBUG 2025/12/17 17:00:00   Bucket[51]: Key=曾文農工, DocCount=82
DEBUG 2025/12/17 17:00:00   Bucket[52]: Key=新竹高工, DocCount=80
DEBUG 2025/12/17 17:00:00   Bucket[53]: Key=海大附中, DocCount=80
DEBUG 2025/12/17 17:00:00   Bucket[54]: Key=基隆特教, DocCount=79
DEBUG 2025/12/17 17:00:00   Bucket[55]: Key=南大附中, DocCount=75
DEBUG 2025/12/17 17:00:00   Bucket[56]: Key=宜蘭高中, DocCount=72
DEBUG 2025/12/17 17:00:00   Bucket[57]: Key=屏科實中, DocCount=71
DEBUG 2025/12/17 17:00:00   Bucket[58]: Key=南大附小, DocCount=70
DEBUG 2025/12/17 17:00:00   Bucket[59]: Key=嘉義高中, DocCount=70
DEBUG 2025/12/17 17:00:00   Bucket[60]: Key=雲林特教, DocCount=68
DEBUG 2025/12/17 17:00:00   Bucket[61]: Key=東石高中, DocCount=67
DEBUG 2025/12/17 17:00:00   Bucket[62]: Key=澎湖海事, DocCount=67
DEBUG 2025/12/17 17:00:00   Bucket[63]: Key=彰師附工, DocCount=65
DEBUG 2025/12/17 17:00:00   Bucket[64]: Key=新營高中, DocCount=65
DEBUG 2025/12/17 17:00:00   Bucket[65]: Key=員林高中, DocCount=64
DEBUG 2025/12/17 17:00:00   Bucket[66]: Key=埔里高工, DocCount=64
DEBUG 2025/12/17 17:00:00   Bucket[67]: Key=善化高中, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[68]: Key=成大南工, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[69]: Key=白河商工, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[70]: Key=臺南高商, DocCount=63
DEBUG 2025/12/17 17:00:00   Bucket[71]: Key=北港高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[72]: Key=屏北高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[73]: Key=苗栗高中, DocCount=62
DEBUG 2025/12/17 17:00:00   Bucket[74]: Key=花蓮高工, DocCount=61
DEBUG 2025/12/17 17:00:00   Bucket[75]: Key=羅東高商, DocCount=60
DEBUG 2025/12/17 17:00:00   Bucket[76]: Key=水里商工, DocCount=58
DEBUG 2025/12/17 17:00:00   Bucket[77]: Key=二林工商, DocCount=57
DEBUG 2025/12/17 17:00:00   Bucket[78]: Key=鳳山高中, DocCount=57
DEBUG 2025/12/17 17:00:00   Bucket[79]: Key=嘉義家職, DocCount=55
DEBUG 2025/12/17 17:00:00   Bucket[80]: Key=華南高商, DocCount=55
DEBUG 2025/12/17 17:00:00   Bucket[81]: Key=臺東高商, DocCount=54
DEBUG 2025/12/17 17:00:00   Bucket[82]: Key=屏東高工, DocCount=53
DEBUG 2025/12/17 17:00:00   Bucket[83]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:00:00   Bucket[84]: Key=溪湖高中, DocCount=52
DEBUG 2025/12/17 17:00:00   Bucket[85]: Key=北港農工, DocCount=50
DEBUG 2025/12/17 17:00:00   Bucket[86]: Key=蘭陽女中, DocCount=49
DEBUG 2025/12/17 17:00:00   Bucket[87]: Key=佳冬高農, DocCount=47
DEBUG 2025/12/17 17:00:00   Bucket[88]: Key=成功商水, DocCount=47
DEBUG 2025/12/17 17:00:00   Bucket[89]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:00:00   Bucket[90]: Key=臺東女中, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[91]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[92]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:00:00   Bucket[93]: Key=新竹高商, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[94]: Key=臺南一中, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[95]: Key=頭城家商, DocCount=43
DEBUG 2025/12/17 17:00:00   Bucket[96]: Key=竹山高中, DocCount=42
DEBUG 2025/12/17 17:00:00   Bucket[97]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 17:00:00   Bucket[98]: Key=旗山農工, DocCount=41
DEBUG 2025/12/17 17:00:00   Bucket[99]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 17:00:00 ========================================================
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:00:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:00:08 ✅ Successfully flushed 31/31 history records to TimescaleDB
INFO 2025/12/17 17:00:08 Processing 15 offline devices
INFO 2025/12/17 17:00:08 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:00:08 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:00:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:00:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:00:08 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:00:08 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:00:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:00:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:00:08 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:00:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:00:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:00:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:00:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:00:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:00:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:00:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:00:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:00:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:00:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:00:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:00:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:00:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:00:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:00:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:00:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:00:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:00:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:00:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:00:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:00:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:00:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:00:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:00:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:00:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:00:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:00:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:00:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.42% (threshold: 80.00%)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.48% (threshold: 85.00%)
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:00:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:00:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:00:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:00:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:00:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:01:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:01:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:01:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:01:00 Field: school_name.keyword
DEBUG 2025/12/17 17:01:00 Time From: 2025-12-17T17:00:00.000+08:00
DEBUG 2025/12/17 17:01:00 Time To: 2025-12-17T17:01:00.000+08:00
DEBUG 2025/12/17 17:01:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:00:00.000+08:00",
					"lte": "2025-12-17T17:01:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:01:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:01:00 ES Response IsError: false
DEBUG 2025/12/17 17:01:00 ES Response Body:
{"took":86,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"黑快馬主機","doc_count":1556},{"key":"花蓮高農","doc_count":767},{"key":"新竹女中","doc_count":671},{"key":"南投高商","doc_count":575},{"key":"仁愛高農","doc_count":573},{"key":"金門高中","doc_count":557},{"key":"金門農工","doc_count":549},{"key":"北門高中","doc_count":495},{"key":"華僑高中","doc_count":448},{"key":"宜蘭高商","doc_count":419},{"key":"旗美高中","doc_count":416},{"key":"興大附中","doc_count":406},{"key":"竹北高中","doc_count":385},{"key":"臺東高中","doc_count":383},{"key":"新化高中","doc_count":320},{"key":"中大壢中","doc_count":291},{"key":"清華附小","doc_count":272},{"key":"後壁高中","doc_count":262},{"key":"新港藝高","doc_count":262},{"key":"南投特教","doc_count":250},{"key":"蘇澳海事","doc_count":241},{"key":"嘉義高商","doc_count":238},{"key":"內埔農工","doc_count":235},{"key":"關山工商","doc_count":233},{"key":"竹南高中","doc_count":221},{"key":"關西高中","doc_count":212},{"key":"花蓮高商","doc_count":205},{"key":"玉里高中","doc_count":203},{"key":"師大附中高中部","doc_count":196},{"key":"屏東女中","doc_count":186},{"key":"新營高工","doc_count":184},{"key":"苗栗農工","doc_count":174},{"key":"新竹高工","doc_count":160},{"key":"東港海事","doc_count":148},{"key":"員林家商","doc_count":139},{"key":"新化高工","doc_count":138},{"key":"虎尾高中","doc_count":138},{"key":"斗六家商","doc_count":137},{"key":"北斗家商","doc_count":135},{"key":"苗栗高中","doc_count":131},{"key":"南大附中","doc_count":130},{"key":"白河商工","doc_count":130},{"key":"屏東高工","doc_count":127},{"key":"彰化高商","doc_count":113},{"key":"新營高中","doc_count":105},{"key":"南大附聰","doc_count":104},{"key":"屏科實中","doc_count":98},{"key":"彰師附工","doc_count":98},{"key":"成功商水","doc_count":92},{"key":"埔里高工","doc_count":90},{"key":"南投高中","doc_count":89},{"key":"成大南工","doc_count":86},{"key":"政大附中","doc_count":84},{"key":"羅東高商","doc_count":83},{"key":"苗栗高商","doc_count":83},{"key":"嘉義家職","doc_count":82},{"key":"中興高中","doc_count":81},{"key":"南大附小","doc_count":79},{"key":"曾文農工","doc_count":75},{"key":"北教大實小","doc_count":74},{"key":"員林高中","doc_count":74},{"key":"善化高中","doc_count":71},{"key":"秀水高工","doc_count":70},{"key":"嘉科實中","doc_count":67},{"key":"鳳山高中","doc_count":64},{"key":"北港高中","doc_count":61},{"key":"員林農工","doc_count":61},{"key":"東石高中","doc_count":61},{"key":"水里商工","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"嘉義高中","doc_count":60},{"key":"屏東高中","doc_count":60},{"key":"蘭陽女中","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"花蓮高工","doc_count":59},{"key":"新竹高商","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"屏北高中","doc_count":56},{"key":"旗山農工","doc_count":56},{"key":"澎湖海事","doc_count":56},{"key":"北港農工","doc_count":55},{"key":"雲林特教","doc_count":55},{"key":"草屯商工","doc_count":52},{"key":"溪湖高中","doc_count":51},{"key":"新竹高中","doc_count":49},{"key":"臺東高商","doc_count":49},{"key":"二林工商","doc_count":48},{"key":"海大附中","doc_count":47},{"key":"臺南一中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"宜蘭高中","doc_count":43},{"key":"基隆商工","doc_count":42},{"key":"花蓮高中","doc_count":42},{"key":"永靖高工","doc_count":41},{"key":"高餐大附中","doc_count":41},{"key":"屏東特教","doc_count":40},{"key":"頭城家商","doc_count":40},{"key":"師大附中國中部","doc_count":39},{"key":"華南高商","doc_count":39}]}}}
DEBUG 2025/12/17 17:01:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:01:00   Bucket[0]: Key=黑快馬主機, DocCount=1556
DEBUG 2025/12/17 17:01:00   Bucket[1]: Key=花蓮高農, DocCount=767
DEBUG 2025/12/17 17:01:00   Bucket[2]: Key=新竹女中, DocCount=671
DEBUG 2025/12/17 17:01:00   Bucket[3]: Key=南投高商, DocCount=575
DEBUG 2025/12/17 17:01:00   Bucket[4]: Key=仁愛高農, DocCount=573
DEBUG 2025/12/17 17:01:00   Bucket[5]: Key=金門高中, DocCount=557
DEBUG 2025/12/17 17:01:00   Bucket[6]: Key=金門農工, DocCount=549
DEBUG 2025/12/17 17:01:00   Bucket[7]: Key=北門高中, DocCount=495
DEBUG 2025/12/17 17:01:00   Bucket[8]: Key=華僑高中, DocCount=448
DEBUG 2025/12/17 17:01:00   Bucket[9]: Key=宜蘭高商, DocCount=419
DEBUG 2025/12/17 17:01:00   Bucket[10]: Key=旗美高中, DocCount=416
DEBUG 2025/12/17 17:01:00   Bucket[11]: Key=興大附中, DocCount=406
DEBUG 2025/12/17 17:01:00   Bucket[12]: Key=竹北高中, DocCount=385
DEBUG 2025/12/17 17:01:00   Bucket[13]: Key=臺東高中, DocCount=383
DEBUG 2025/12/17 17:01:00   Bucket[14]: Key=新化高中, DocCount=320
DEBUG 2025/12/17 17:01:00   Bucket[15]: Key=中大壢中, DocCount=291
DEBUG 2025/12/17 17:01:00   Bucket[16]: Key=清華附小, DocCount=272
DEBUG 2025/12/17 17:01:00   Bucket[17]: Key=後壁高中, DocCount=262
DEBUG 2025/12/17 17:01:00   Bucket[18]: Key=新港藝高, DocCount=262
DEBUG 2025/12/17 17:01:00   Bucket[19]: Key=南投特教, DocCount=250
DEBUG 2025/12/17 17:01:00   Bucket[20]: Key=蘇澳海事, DocCount=241
DEBUG 2025/12/17 17:01:00   Bucket[21]: Key=嘉義高商, DocCount=238
DEBUG 2025/12/17 17:01:00   Bucket[22]: Key=內埔農工, DocCount=235
DEBUG 2025/12/17 17:01:00   Bucket[23]: Key=關山工商, DocCount=233
DEBUG 2025/12/17 17:01:00   Bucket[24]: Key=竹南高中, DocCount=221
DEBUG 2025/12/17 17:01:00   Bucket[25]: Key=關西高中, DocCount=212
DEBUG 2025/12/17 17:01:00   Bucket[26]: Key=花蓮高商, DocCount=205
DEBUG 2025/12/17 17:01:00   Bucket[27]: Key=玉里高中, DocCount=203
DEBUG 2025/12/17 17:01:00   Bucket[28]: Key=師大附中高中部, DocCount=196
DEBUG 2025/12/17 17:01:00   Bucket[29]: Key=屏東女中, DocCount=186
DEBUG 2025/12/17 17:01:00   Bucket[30]: Key=新營高工, DocCount=184
DEBUG 2025/12/17 17:01:00   Bucket[31]: Key=苗栗農工, DocCount=174
DEBUG 2025/12/17 17:01:00   Bucket[32]: Key=新竹高工, DocCount=160
DEBUG 2025/12/17 17:01:00   Bucket[33]: Key=東港海事, DocCount=148
DEBUG 2025/12/17 17:01:00   Bucket[34]: Key=員林家商, DocCount=139
DEBUG 2025/12/17 17:01:00   Bucket[35]: Key=新化高工, DocCount=138
DEBUG 2025/12/17 17:01:00   Bucket[36]: Key=虎尾高中, DocCount=138
DEBUG 2025/12/17 17:01:00   Bucket[37]: Key=斗六家商, DocCount=137
DEBUG 2025/12/17 17:01:00   Bucket[38]: Key=北斗家商, DocCount=135
DEBUG 2025/12/17 17:01:00   Bucket[39]: Key=苗栗高中, DocCount=131
DEBUG 2025/12/17 17:01:00   Bucket[40]: Key=南大附中, DocCount=130
DEBUG 2025/12/17 17:01:00   Bucket[41]: Key=白河商工, DocCount=130
DEBUG 2025/12/17 17:01:00   Bucket[42]: Key=屏東高工, DocCount=127
DEBUG 2025/12/17 17:01:00   Bucket[43]: Key=彰化高商, DocCount=113
DEBUG 2025/12/17 17:01:00   Bucket[44]: Key=新營高中, DocCount=105
DEBUG 2025/12/17 17:01:00   Bucket[45]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:01:00   Bucket[46]: Key=屏科實中, DocCount=98
DEBUG 2025/12/17 17:01:00   Bucket[47]: Key=彰師附工, DocCount=98
DEBUG 2025/12/17 17:01:00   Bucket[48]: Key=成功商水, DocCount=92
DEBUG 2025/12/17 17:01:00   Bucket[49]: Key=埔里高工, DocCount=90
DEBUG 2025/12/17 17:01:00   Bucket[50]: Key=南投高中, DocCount=89
DEBUG 2025/12/17 17:01:00   Bucket[51]: Key=成大南工, DocCount=86
DEBUG 2025/12/17 17:01:00   Bucket[52]: Key=政大附中, DocCount=84
DEBUG 2025/12/17 17:01:00   Bucket[53]: Key=羅東高商, DocCount=83
DEBUG 2025/12/17 17:01:00   Bucket[54]: Key=苗栗高商, DocCount=83
DEBUG 2025/12/17 17:01:00   Bucket[55]: Key=嘉義家職, DocCount=82
DEBUG 2025/12/17 17:01:00   Bucket[56]: Key=中興高中, DocCount=81
DEBUG 2025/12/17 17:01:00   Bucket[57]: Key=南大附小, DocCount=79
DEBUG 2025/12/17 17:01:00   Bucket[58]: Key=曾文農工, DocCount=75
DEBUG 2025/12/17 17:01:00   Bucket[59]: Key=北教大實小, DocCount=74
DEBUG 2025/12/17 17:01:00   Bucket[60]: Key=員林高中, DocCount=74
DEBUG 2025/12/17 17:01:00   Bucket[61]: Key=善化高中, DocCount=71
DEBUG 2025/12/17 17:01:00   Bucket[62]: Key=秀水高工, DocCount=70
DEBUG 2025/12/17 17:01:00   Bucket[63]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:01:00   Bucket[64]: Key=鳳山高中, DocCount=64
DEBUG 2025/12/17 17:01:00   Bucket[65]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[66]: Key=員林農工, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[67]: Key=東石高中, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[68]: Key=水里商工, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[69]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 17:01:00   Bucket[70]: Key=嘉義高中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[71]: Key=屏東高中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[72]: Key=蘭陽女中, DocCount=60
DEBUG 2025/12/17 17:01:00   Bucket[73]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 17:01:00   Bucket[74]: Key=花蓮高工, DocCount=59
DEBUG 2025/12/17 17:01:00   Bucket[75]: Key=新竹高商, DocCount=57
DEBUG 2025/12/17 17:01:00   Bucket[76]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:01:00   Bucket[77]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[78]: Key=旗山農工, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[79]: Key=澎湖海事, DocCount=56
DEBUG 2025/12/17 17:01:00   Bucket[80]: Key=北港農工, DocCount=55
DEBUG 2025/12/17 17:01:00   Bucket[81]: Key=雲林特教, DocCount=55
DEBUG 2025/12/17 17:01:00   Bucket[82]: Key=草屯商工, DocCount=52
DEBUG 2025/12/17 17:01:00   Bucket[83]: Key=溪湖高中, DocCount=51
DEBUG 2025/12/17 17:01:00   Bucket[84]: Key=新竹高中, DocCount=49
DEBUG 2025/12/17 17:01:00   Bucket[85]: Key=臺東高商, DocCount=49
DEBUG 2025/12/17 17:01:00   Bucket[86]: Key=二林工商, DocCount=48
DEBUG 2025/12/17 17:01:00   Bucket[87]: Key=海大附中, DocCount=47
DEBUG 2025/12/17 17:01:00   Bucket[88]: Key=臺南一中, DocCount=45
DEBUG 2025/12/17 17:01:00   Bucket[89]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:01:00   Bucket[90]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:01:00   Bucket[91]: Key=宜蘭高中, DocCount=43
DEBUG 2025/12/17 17:01:00   Bucket[92]: Key=基隆商工, DocCount=42
DEBUG 2025/12/17 17:01:00   Bucket[93]: Key=花蓮高中, DocCount=42
DEBUG 2025/12/17 17:01:00   Bucket[94]: Key=永靖高工, DocCount=41
DEBUG 2025/12/17 17:01:00   Bucket[95]: Key=高餐大附中, DocCount=41
DEBUG 2025/12/17 17:01:00   Bucket[96]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:01:00   Bucket[97]: Key=頭城家商, DocCount=40
DEBUG 2025/12/17 17:01:00   Bucket[98]: Key=師大附中國中部, DocCount=39
DEBUG 2025/12/17 17:01:00   Bucket[99]: Key=華南高商, DocCount=39
DEBUG 2025/12/17 17:01:00 ========================================================
INFO 2025/12/17 17:01:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
ERROR 2025/12/17 17:01:06 Invalid password for user admin
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:01:06 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:01:07 Processing 15 offline devices
INFO 2025/12/17 17:01:07 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:01:07 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:01:07 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:01:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:01:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:01:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:01:07 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:01:07 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:01:08 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:01:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:01:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:01:08 ✅ Successfully flushed 34/34 history records to TimescaleDB
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:01:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:01:08 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:01:08 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:01:08 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:01:08 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:01:08 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:01:13 ✅ Successfully flushed 4/4 history records to TimescaleDB
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:32 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:01:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:01:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:01:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:01:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:01:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:01:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:01:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:01:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:01:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:01:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:01:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:01:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:01:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:01:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:01:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:01:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:01:45 ES Alert Created [critical][performance]: Memory usage critical: 91.37% (threshold: 90.00%)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:01:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:01:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:01:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:01:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:01:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:01:49 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:02:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:02:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:02:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:02:00 Field: school_name.keyword
DEBUG 2025/12/17 17:02:00 Time From: 2025-12-17T17:01:00.000+08:00
DEBUG 2025/12/17 17:02:00 Time To: 2025-12-17T17:02:00.000+08:00
DEBUG 2025/12/17 17:02:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:01:00.000+08:00",
					"lte": "2025-12-17T17:02:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:02:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:02:00 ES Response IsError: false
DEBUG 2025/12/17 17:02:00 ES Response Body:
{"took":57,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":414,"buckets":[{"key":"黑快馬主機","doc_count":2695},{"key":"花蓮高農","doc_count":800},{"key":"新竹女中","doc_count":597},{"key":"金門農工","doc_count":584},{"key":"仁愛高農","doc_count":564},{"key":"華僑高中","doc_count":518},{"key":"金門高中","doc_count":495},{"key":"南投高商","doc_count":428},{"key":"旗美高中","doc_count":398},{"key":"竹北高中","doc_count":379},{"key":"北門高中","doc_count":373},{"key":"臺東高中","doc_count":370},{"key":"玉里高中","doc_count":343},{"key":"宜蘭高商","doc_count":327},{"key":"興大附中","doc_count":311},{"key":"關西高中","doc_count":281},{"key":"嘉義高商","doc_count":265},{"key":"竹南高中","doc_count":257},{"key":"新港藝高","doc_count":249},{"key":"蘇澳海事","doc_count":246},{"key":"花蓮高商","doc_count":238},{"key":"內埔農工","doc_count":232},{"key":"中大壢中","doc_count":223},{"key":"清華附小","doc_count":219},{"key":"新竹高中","doc_count":211},{"key":"斗六家商","doc_count":207},{"key":"南投特教","doc_count":204},{"key":"關山工商","doc_count":197},{"key":"後壁高中","doc_count":195},{"key":"苗栗農工","doc_count":195},{"key":"新化高中","doc_count":175},{"key":"屏東女中","doc_count":156},{"key":"南大附中","doc_count":146},{"key":"員林家商","doc_count":146},{"key":"東港海事","doc_count":139},{"key":"虎尾高中","doc_count":130},{"key":"新化高工","doc_count":123},{"key":"臺南一中","doc_count":118},{"key":"南投高中","doc_count":115},{"key":"彰師附工","doc_count":112},{"key":"新營高工","doc_count":112},{"key":"新竹高工","doc_count":110},{"key":"南大附聰","doc_count":104},{"key":"臺東高商","doc_count":104},{"key":"水里商工","doc_count":99},{"key":"秀水高工","doc_count":99},{"key":"苗栗高商","doc_count":97},{"key":"草屯商工","doc_count":95},{"key":"北斗家商","doc_count":93},{"key":"員林高中","doc_count":91},{"key":"成大南工","doc_count":91},{"key":"臺東女中","doc_count":91},{"key":"中興高中","doc_count":86},{"key":"嘉義家職","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"埔里高工","doc_count":77},{"key":"屏科實中","doc_count":74},{"key":"北港農工","doc_count":71},{"key":"土庫商工","doc_count":71},{"key":"暨大附中","doc_count":71},{"key":"師大附中高中部","doc_count":67},{"key":"政大附中","doc_count":66},{"key":"苗栗高中","doc_count":66},{"key":"屏東高中","doc_count":62},{"key":"白河商工","doc_count":61},{"key":"宜蘭高中","doc_count":60},{"key":"嘉科實中","doc_count":58},{"key":"永靖高工","doc_count":55},{"key":"潮州高中","doc_count":55},{"key":"興大附農","doc_count":55},{"key":"二林工商","doc_count":54},{"key":"嘉義高中","doc_count":54},{"key":"佳冬高農","doc_count":53},{"key":"北教大實小","doc_count":52},{"key":"鳳山高中","doc_count":52},{"key":"花蓮高工","doc_count":51},{"key":"北港高中","doc_count":50},{"key":"臺南高商","doc_count":49},{"key":"善化高中","doc_count":48},{"key":"頭城家商","doc_count":48},{"key":"華南高商","doc_count":47},{"key":"員林農工","doc_count":46},{"key":"蘭陽女中","doc_count":46},{"key":"屏東高工","doc_count":45},{"key":"彰化高商","doc_count":45},{"key":"高餐大附中","doc_count":45},{"key":"玉井工商","doc_count":44},{"key":"溪湖高中","doc_count":43},{"key":"旗山農工","doc_count":42},{"key":"竹山高中","doc_count":41},{"key":"曾文農工","doc_count":40},{"key":"羅東高工","doc_count":40},{"key":"基隆商工","doc_count":39},{"key":"海大附中","doc_count":38},{"key":"雲林特教","doc_count":38},{"key":"東石高中","doc_count":37},{"key":"澎湖海事","doc_count":36},{"key":"崇實高工","doc_count":35},{"key":"羅東高商","doc_count":35},{"key":"南大附小","doc_count":34}]}}}
DEBUG 2025/12/17 17:02:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:02:00   Bucket[0]: Key=黑快馬主機, DocCount=2695
DEBUG 2025/12/17 17:02:00   Bucket[1]: Key=花蓮高農, DocCount=800
DEBUG 2025/12/17 17:02:00   Bucket[2]: Key=新竹女中, DocCount=597
DEBUG 2025/12/17 17:02:00   Bucket[3]: Key=金門農工, DocCount=584
DEBUG 2025/12/17 17:02:00   Bucket[4]: Key=仁愛高農, DocCount=564
DEBUG 2025/12/17 17:02:00   Bucket[5]: Key=華僑高中, DocCount=518
DEBUG 2025/12/17 17:02:00   Bucket[6]: Key=金門高中, DocCount=495
DEBUG 2025/12/17 17:02:00   Bucket[7]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:02:00   Bucket[8]: Key=旗美高中, DocCount=398
DEBUG 2025/12/17 17:02:00   Bucket[9]: Key=竹北高中, DocCount=379
DEBUG 2025/12/17 17:02:00   Bucket[10]: Key=北門高中, DocCount=373
DEBUG 2025/12/17 17:02:00   Bucket[11]: Key=臺東高中, DocCount=370
DEBUG 2025/12/17 17:02:00   Bucket[12]: Key=玉里高中, DocCount=343
DEBUG 2025/12/17 17:02:00   Bucket[13]: Key=宜蘭高商, DocCount=327
DEBUG 2025/12/17 17:02:00   Bucket[14]: Key=興大附中, DocCount=311
DEBUG 2025/12/17 17:02:00   Bucket[15]: Key=關西高中, DocCount=281
DEBUG 2025/12/17 17:02:00   Bucket[16]: Key=嘉義高商, DocCount=265
DEBUG 2025/12/17 17:02:00   Bucket[17]: Key=竹南高中, DocCount=257
DEBUG 2025/12/17 17:02:00   Bucket[18]: Key=新港藝高, DocCount=249
DEBUG 2025/12/17 17:02:00   Bucket[19]: Key=蘇澳海事, DocCount=246
DEBUG 2025/12/17 17:02:00   Bucket[20]: Key=花蓮高商, DocCount=238
DEBUG 2025/12/17 17:02:00   Bucket[21]: Key=內埔農工, DocCount=232
DEBUG 2025/12/17 17:02:00   Bucket[22]: Key=中大壢中, DocCount=223
DEBUG 2025/12/17 17:02:00   Bucket[23]: Key=清華附小, DocCount=219
DEBUG 2025/12/17 17:02:00   Bucket[24]: Key=新竹高中, DocCount=211
DEBUG 2025/12/17 17:02:00   Bucket[25]: Key=斗六家商, DocCount=207
DEBUG 2025/12/17 17:02:00   Bucket[26]: Key=南投特教, DocCount=204
DEBUG 2025/12/17 17:02:00   Bucket[27]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 17:02:00   Bucket[28]: Key=後壁高中, DocCount=195
DEBUG 2025/12/17 17:02:00   Bucket[29]: Key=苗栗農工, DocCount=195
DEBUG 2025/12/17 17:02:00   Bucket[30]: Key=新化高中, DocCount=175
DEBUG 2025/12/17 17:02:00   Bucket[31]: Key=屏東女中, DocCount=156
DEBUG 2025/12/17 17:02:00   Bucket[32]: Key=南大附中, DocCount=146
DEBUG 2025/12/17 17:02:00   Bucket[33]: Key=員林家商, DocCount=146
DEBUG 2025/12/17 17:02:00   Bucket[34]: Key=東港海事, DocCount=139
DEBUG 2025/12/17 17:02:00   Bucket[35]: Key=虎尾高中, DocCount=130
DEBUG 2025/12/17 17:02:00   Bucket[36]: Key=新化高工, DocCount=123
DEBUG 2025/12/17 17:02:00   Bucket[37]: Key=臺南一中, DocCount=118
DEBUG 2025/12/17 17:02:00   Bucket[38]: Key=南投高中, DocCount=115
DEBUG 2025/12/17 17:02:00   Bucket[39]: Key=彰師附工, DocCount=112
DEBUG 2025/12/17 17:02:00   Bucket[40]: Key=新營高工, DocCount=112
DEBUG 2025/12/17 17:02:00   Bucket[41]: Key=新竹高工, DocCount=110
DEBUG 2025/12/17 17:02:00   Bucket[42]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:02:00   Bucket[43]: Key=臺東高商, DocCount=104
DEBUG 2025/12/17 17:02:00   Bucket[44]: Key=水里商工, DocCount=99
DEBUG 2025/12/17 17:02:00   Bucket[45]: Key=秀水高工, DocCount=99
DEBUG 2025/12/17 17:02:00   Bucket[46]: Key=苗栗高商, DocCount=97
DEBUG 2025/12/17 17:02:00   Bucket[47]: Key=草屯商工, DocCount=95
DEBUG 2025/12/17 17:02:00   Bucket[48]: Key=北斗家商, DocCount=93
DEBUG 2025/12/17 17:02:00   Bucket[49]: Key=員林高中, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[50]: Key=成大南工, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[51]: Key=臺東女中, DocCount=91
DEBUG 2025/12/17 17:02:00   Bucket[52]: Key=中興高中, DocCount=86
DEBUG 2025/12/17 17:02:00   Bucket[53]: Key=嘉義家職, DocCount=82
DEBUG 2025/12/17 17:02:00   Bucket[54]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 17:02:00   Bucket[55]: Key=埔里高工, DocCount=77
DEBUG 2025/12/17 17:02:00   Bucket[56]: Key=屏科實中, DocCount=74
DEBUG 2025/12/17 17:02:00   Bucket[57]: Key=北港農工, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[58]: Key=土庫商工, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[59]: Key=暨大附中, DocCount=71
DEBUG 2025/12/17 17:02:00   Bucket[60]: Key=師大附中高中部, DocCount=67
DEBUG 2025/12/17 17:02:00   Bucket[61]: Key=政大附中, DocCount=66
DEBUG 2025/12/17 17:02:00   Bucket[62]: Key=苗栗高中, DocCount=66
DEBUG 2025/12/17 17:02:00   Bucket[63]: Key=屏東高中, DocCount=62
DEBUG 2025/12/17 17:02:00   Bucket[64]: Key=白河商工, DocCount=61
DEBUG 2025/12/17 17:02:00   Bucket[65]: Key=宜蘭高中, DocCount=60
DEBUG 2025/12/17 17:02:00   Bucket[66]: Key=嘉科實中, DocCount=58
DEBUG 2025/12/17 17:02:00   Bucket[67]: Key=永靖高工, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[68]: Key=潮州高中, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[69]: Key=興大附農, DocCount=55
DEBUG 2025/12/17 17:02:00   Bucket[70]: Key=二林工商, DocCount=54
DEBUG 2025/12/17 17:02:00   Bucket[71]: Key=嘉義高中, DocCount=54
DEBUG 2025/12/17 17:02:00   Bucket[72]: Key=佳冬高農, DocCount=53
DEBUG 2025/12/17 17:02:00   Bucket[73]: Key=北教大實小, DocCount=52
DEBUG 2025/12/17 17:02:00   Bucket[74]: Key=鳳山高中, DocCount=52
DEBUG 2025/12/17 17:02:00   Bucket[75]: Key=花蓮高工, DocCount=51
DEBUG 2025/12/17 17:02:00   Bucket[76]: Key=北港高中, DocCount=50
DEBUG 2025/12/17 17:02:00   Bucket[77]: Key=臺南高商, DocCount=49
DEBUG 2025/12/17 17:02:00   Bucket[78]: Key=善化高中, DocCount=48
DEBUG 2025/12/17 17:02:00   Bucket[79]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 17:02:00   Bucket[80]: Key=華南高商, DocCount=47
DEBUG 2025/12/17 17:02:00   Bucket[81]: Key=員林農工, DocCount=46
DEBUG 2025/12/17 17:02:00   Bucket[82]: Key=蘭陽女中, DocCount=46
DEBUG 2025/12/17 17:02:00   Bucket[83]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[84]: Key=彰化高商, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[85]: Key=高餐大附中, DocCount=45
DEBUG 2025/12/17 17:02:00   Bucket[86]: Key=玉井工商, DocCount=44
DEBUG 2025/12/17 17:02:00   Bucket[87]: Key=溪湖高中, DocCount=43
DEBUG 2025/12/17 17:02:00   Bucket[88]: Key=旗山農工, DocCount=42
DEBUG 2025/12/17 17:02:00   Bucket[89]: Key=竹山高中, DocCount=41
DEBUG 2025/12/17 17:02:00   Bucket[90]: Key=曾文農工, DocCount=40
DEBUG 2025/12/17 17:02:00   Bucket[91]: Key=羅東高工, DocCount=40
DEBUG 2025/12/17 17:02:00   Bucket[92]: Key=基隆商工, DocCount=39
DEBUG 2025/12/17 17:02:00   Bucket[93]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:02:00   Bucket[94]: Key=雲林特教, DocCount=38
DEBUG 2025/12/17 17:02:00   Bucket[95]: Key=東石高中, DocCount=37
DEBUG 2025/12/17 17:02:00   Bucket[96]: Key=澎湖海事, DocCount=36
DEBUG 2025/12/17 17:02:00   Bucket[97]: Key=崇實高工, DocCount=35
DEBUG 2025/12/17 17:02:00   Bucket[98]: Key=羅東高商, DocCount=35
DEBUG 2025/12/17 17:02:00   Bucket[99]: Key=南大附小, DocCount=34
DEBUG 2025/12/17 17:02:00 ========================================================
INFO 2025/12/17 17:02:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:02:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:02:08 ✅ Successfully flushed 11/11 history records to TimescaleDB
INFO 2025/12/17 17:02:10 Processing 15 offline devices
INFO 2025/12/17 17:02:10 Creating history record for offline device: 新竹高商
INFO 2025/12/17 17:02:10 About to add history to batch for device: 新竹高商
INFO 2025/12/17 17:02:10 Successfully added history record for offline device: 新竹高商
INFO 2025/12/17 17:02:10 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:02:10 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:02:11 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:02:11 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:02:11 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:02:11 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:02:11 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:02:11 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:02:11 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:02:11 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:02:11 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:02:11 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:02:11 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:02:12 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:02:12 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:02:12 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:02:12 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:02:12 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:02:12 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:02:12 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:02:12 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:02:12 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:02:12 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:02:12 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:02:13 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:02:13 ✅ Successfully flushed 33/33 history records to TimescaleDB
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:22 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:23 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:37 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:38 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:02:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:02:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:02:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:02:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:02:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:02:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:02:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:02:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:02:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:02:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:02:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:02:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:02:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:02:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:02:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:02:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:02:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.01% (threshold: 90.00%)
WARN 2025/12/17 17:02:45 ES Alert Created [high][capacity]: Disk usage high: 93.31% (threshold: 85.00%)
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:02:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:02:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:02:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:02:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:02:46 JWT_SECRET environment variable not set, using default key (NOT SECURE)
INFO 2025/12/17 17:02:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:02:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:02:48 ES monitor check completed for: NTU, status: warning
WARN 2025/12/17 17:02:59 JWT_SECRET environment variable not set, using default key (NOT SECURE)
DEBUG 2025/12/17 17:03:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:03:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:03:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:03:00 Field: school_name.keyword
DEBUG 2025/12/17 17:03:00 Time From: 2025-12-17T17:02:00.000+08:00
DEBUG 2025/12/17 17:03:00 Time To: 2025-12-17T17:03:00.000+08:00
DEBUG 2025/12/17 17:03:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:02:00.000+08:00",
					"lte": "2025-12-17T17:03:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:03:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:03:00 ES Response IsError: false
DEBUG 2025/12/17 17:03:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":92,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":445,"buckets":[{"key":"黑快馬主機","doc_count":2443},{"key":"花蓮高農","doc_count":759},{"key":"新竹女中","doc_count":758},{"key":"金門農工","doc_count":592},{"key":"仁愛高農","doc_count":576},{"key":"竹北高中","doc_count":501},{"key":"華僑高中","doc_count":486},{"key":"玉里高中","doc_count":461},{"key":"金門高中","doc_count":448},{"key":"南投高商","doc_count":428},{"key":"旗美高中","doc_count":418},{"key":"北門高中","doc_count":408},{"key":"宜蘭高商","doc_count":383},{"key":"新港藝高","doc_count":347},{"key":"臺東高中","doc_count":328},{"key":"興大附中","doc_count":301},{"key":"清華附小","doc_count":295},{"key":"竹南高中","doc_count":285},{"key":"蘇澳海事","doc_count":282},{"key":"內埔農工","doc_count":275},{"key":"中大壢中","doc_count":274},{"key":"嘉義高商","doc_count":265},{"key":"關西高中","doc_count":253},{"key":"苗栗農工","doc_count":238},{"key":"北斗家商","doc_count":232},{"key":"花蓮高商","doc_count":232},{"key":"關山工商","doc_count":217},{"key":"南投特教","doc_count":207},{"key":"後壁高中","doc_count":203},{"key":"草屯商工","doc_count":177},{"key":"成大南工","doc_count":176},{"key":"新化高中","doc_count":176},{"key":"東港海事","doc_count":176},{"key":"屏東女中","doc_count":175},{"key":"斗六家商","doc_count":154},{"key":"花蓮高中","doc_count":153},{"key":"虎尾高中","doc_count":146},{"key":"新化高工","doc_count":142},{"key":"彰師附工","doc_count":136},{"key":"政大附中","doc_count":136},{"key":"南大附中","doc_count":131},{"key":"南大附聰","doc_count":131},{"key":"新營高工","doc_count":130},{"key":"員林家商","doc_count":126},{"key":"員林高中","doc_count":125},{"key":"新竹高中","doc_count":125},{"key":"北港高中","doc_count":111},{"key":"新竹高工","doc_count":111},{"key":"師大附中高中部","doc_count":92},{"key":"員林農工","doc_count":91},{"key":"永靖高工","doc_count":84},{"key":"南投高中","doc_count":83},{"key":"北教大實小","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"苗栗高商","doc_count":80},{"key":"北港農工","doc_count":72},{"key":"嘉科實中","doc_count":72},{"key":"新營高中","doc_count":72},{"key":"新竹高商","doc_count":72},{"key":"頭城家商","doc_count":72},{"key":"竹山高中","doc_count":71},{"key":"屏科實中","doc_count":70},{"key":"臺東高商","doc_count":69},{"key":"宜蘭高中","doc_count":66},{"key":"彰化高商","doc_count":65},{"key":"二林工商","doc_count":63},{"key":"基隆商工","doc_count":59},{"key":"埔里高工","doc_count":58},{"key":"崇實高工","doc_count":58},{"key":"羅東高商","doc_count":58},{"key":"暨大附中","doc_count":53},{"key":"雲林特教","doc_count":53},{"key":"中興高中","doc_count":52},{"key":"海大附中","doc_count":52},{"key":"水里商工","doc_count":51},{"key":"花蓮高工","doc_count":51},{"key":"蘭陽女中","doc_count":51},{"key":"東石高中","doc_count":49},{"key":"苗栗高中","doc_count":49},{"key":"臺南一中","doc_count":48},{"key":"羅東高工","doc_count":47},{"key":"臺南高商","doc_count":47},{"key":"華南高商","doc_count":46},{"key":"興大附農","doc_count":44},{"key":"鳳山高中","doc_count":44},{"key":"臺東女中","doc_count":42},{"key":"曾文農工","doc_count":41},{"key":"竹東高中","doc_count":41},{"key":"嘉義特教","doc_count":40},{"key":"花蓮特教","doc_count":40},{"key":"嘉義高中","doc_count":39},{"key":"白河商工","doc_count":39},{"key":"南大附小","doc_count":38},{"key":"嘉義高工","doc_count":38},{"key":"土庫商工","doc_count":37},{"key":"屏東高中","doc_count":37},{"key":"旗山農工","doc_count":37},{"key":"潮州高中","doc_count":37},{"key":"屏東特教","doc_count":36},{"key":"嘉義家職","doc_count":35}]}}}
DEBUG 2025/12/17 17:03:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:03:00   Bucket[0]: Key=黑快馬主機, DocCount=2443
DEBUG 2025/12/17 17:03:00   Bucket[1]: Key=花蓮高農, DocCount=759
DEBUG 2025/12/17 17:03:00   Bucket[2]: Key=新竹女中, DocCount=758
DEBUG 2025/12/17 17:03:00   Bucket[3]: Key=金門農工, DocCount=592
DEBUG 2025/12/17 17:03:00   Bucket[4]: Key=仁愛高農, DocCount=576
DEBUG 2025/12/17 17:03:00   Bucket[5]: Key=竹北高中, DocCount=501
DEBUG 2025/12/17 17:03:00   Bucket[6]: Key=華僑高中, DocCount=486
DEBUG 2025/12/17 17:03:00   Bucket[7]: Key=玉里高中, DocCount=461
DEBUG 2025/12/17 17:03:00   Bucket[8]: Key=金門高中, DocCount=448
DEBUG 2025/12/17 17:03:00   Bucket[9]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:03:00   Bucket[10]: Key=旗美高中, DocCount=418
DEBUG 2025/12/17 17:03:00   Bucket[11]: Key=北門高中, DocCount=408
DEBUG 2025/12/17 17:03:00   Bucket[12]: Key=宜蘭高商, DocCount=383
DEBUG 2025/12/17 17:03:00   Bucket[13]: Key=新港藝高, DocCount=347
DEBUG 2025/12/17 17:03:00   Bucket[14]: Key=臺東高中, DocCount=328
DEBUG 2025/12/17 17:03:00   Bucket[15]: Key=興大附中, DocCount=301
DEBUG 2025/12/17 17:03:00   Bucket[16]: Key=清華附小, DocCount=295
DEBUG 2025/12/17 17:03:00   Bucket[17]: Key=竹南高中, DocCount=285
DEBUG 2025/12/17 17:03:00   Bucket[18]: Key=蘇澳海事, DocCount=282
DEBUG 2025/12/17 17:03:00   Bucket[19]: Key=內埔農工, DocCount=275
DEBUG 2025/12/17 17:03:00   Bucket[20]: Key=中大壢中, DocCount=274
DEBUG 2025/12/17 17:03:00   Bucket[21]: Key=嘉義高商, DocCount=265
DEBUG 2025/12/17 17:03:00   Bucket[22]: Key=關西高中, DocCount=253
DEBUG 2025/12/17 17:03:00   Bucket[23]: Key=苗栗農工, DocCount=238
DEBUG 2025/12/17 17:03:00   Bucket[24]: Key=北斗家商, DocCount=232
DEBUG 2025/12/17 17:03:00   Bucket[25]: Key=花蓮高商, DocCount=232
DEBUG 2025/12/17 17:03:00   Bucket[26]: Key=關山工商, DocCount=217
DEBUG 2025/12/17 17:03:00   Bucket[27]: Key=南投特教, DocCount=207
DEBUG 2025/12/17 17:03:00   Bucket[28]: Key=後壁高中, DocCount=203
DEBUG 2025/12/17 17:03:00   Bucket[29]: Key=草屯商工, DocCount=177
DEBUG 2025/12/17 17:03:00   Bucket[30]: Key=成大南工, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[31]: Key=新化高中, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[32]: Key=東港海事, DocCount=176
DEBUG 2025/12/17 17:03:00   Bucket[33]: Key=屏東女中, DocCount=175
DEBUG 2025/12/17 17:03:00   Bucket[34]: Key=斗六家商, DocCount=154
DEBUG 2025/12/17 17:03:00   Bucket[35]: Key=花蓮高中, DocCount=153
DEBUG 2025/12/17 17:03:00   Bucket[36]: Key=虎尾高中, DocCount=146
DEBUG 2025/12/17 17:03:00   Bucket[37]: Key=新化高工, DocCount=142
DEBUG 2025/12/17 17:03:00   Bucket[38]: Key=彰師附工, DocCount=136
DEBUG 2025/12/17 17:03:00   Bucket[39]: Key=政大附中, DocCount=136
DEBUG 2025/12/17 17:03:00   Bucket[40]: Key=南大附中, DocCount=131
DEBUG 2025/12/17 17:03:00   Bucket[41]: Key=南大附聰, DocCount=131
DEBUG 2025/12/17 17:03:00   Bucket[42]: Key=新營高工, DocCount=130
DEBUG 2025/12/17 17:03:00   Bucket[43]: Key=員林家商, DocCount=126
DEBUG 2025/12/17 17:03:00   Bucket[44]: Key=員林高中, DocCount=125
DEBUG 2025/12/17 17:03:00   Bucket[45]: Key=新竹高中, DocCount=125
DEBUG 2025/12/17 17:03:00   Bucket[46]: Key=北港高中, DocCount=111
DEBUG 2025/12/17 17:03:00   Bucket[47]: Key=新竹高工, DocCount=111
DEBUG 2025/12/17 17:03:00   Bucket[48]: Key=師大附中高中部, DocCount=92
DEBUG 2025/12/17 17:03:00   Bucket[49]: Key=員林農工, DocCount=91
DEBUG 2025/12/17 17:03:00   Bucket[50]: Key=永靖高工, DocCount=84
DEBUG 2025/12/17 17:03:00   Bucket[51]: Key=南投高中, DocCount=83
DEBUG 2025/12/17 17:03:00   Bucket[52]: Key=北教大實小, DocCount=82
DEBUG 2025/12/17 17:03:00   Bucket[53]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:03:00   Bucket[54]: Key=苗栗高商, DocCount=80
DEBUG 2025/12/17 17:03:00   Bucket[55]: Key=北港農工, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[56]: Key=嘉科實中, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[57]: Key=新營高中, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[58]: Key=新竹高商, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[59]: Key=頭城家商, DocCount=72
DEBUG 2025/12/17 17:03:00   Bucket[60]: Key=竹山高中, DocCount=71
DEBUG 2025/12/17 17:03:00   Bucket[61]: Key=屏科實中, DocCount=70
DEBUG 2025/12/17 17:03:00   Bucket[62]: Key=臺東高商, DocCount=69
DEBUG 2025/12/17 17:03:00   Bucket[63]: Key=宜蘭高中, DocCount=66
DEBUG 2025/12/17 17:03:00   Bucket[64]: Key=彰化高商, DocCount=65
DEBUG 2025/12/17 17:03:00   Bucket[65]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 17:03:00   Bucket[66]: Key=基隆商工, DocCount=59
DEBUG 2025/12/17 17:03:00   Bucket[67]: Key=埔里高工, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[68]: Key=崇實高工, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[69]: Key=羅東高商, DocCount=58
DEBUG 2025/12/17 17:03:00   Bucket[70]: Key=暨大附中, DocCount=53
DEBUG 2025/12/17 17:03:00   Bucket[71]: Key=雲林特教, DocCount=53
DEBUG 2025/12/17 17:03:00   Bucket[72]: Key=中興高中, DocCount=52
DEBUG 2025/12/17 17:03:00   Bucket[73]: Key=海大附中, DocCount=52
DEBUG 2025/12/17 17:03:00   Bucket[74]: Key=水里商工, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[75]: Key=花蓮高工, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[76]: Key=蘭陽女中, DocCount=51
DEBUG 2025/12/17 17:03:00   Bucket[77]: Key=東石高中, DocCount=49
DEBUG 2025/12/17 17:03:00   Bucket[78]: Key=苗栗高中, DocCount=49
DEBUG 2025/12/17 17:03:00   Bucket[79]: Key=臺南一中, DocCount=48
DEBUG 2025/12/17 17:03:00   Bucket[80]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:03:00   Bucket[81]: Key=臺南高商, DocCount=47
DEBUG 2025/12/17 17:03:00   Bucket[82]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:03:00   Bucket[83]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 17:03:00   Bucket[84]: Key=鳳山高中, DocCount=44
DEBUG 2025/12/17 17:03:00   Bucket[85]: Key=臺東女中, DocCount=42
DEBUG 2025/12/17 17:03:00   Bucket[86]: Key=曾文農工, DocCount=41
DEBUG 2025/12/17 17:03:00   Bucket[87]: Key=竹東高中, DocCount=41
DEBUG 2025/12/17 17:03:00   Bucket[88]: Key=嘉義特教, DocCount=40
DEBUG 2025/12/17 17:03:00   Bucket[89]: Key=花蓮特教, DocCount=40
DEBUG 2025/12/17 17:03:00   Bucket[90]: Key=嘉義高中, DocCount=39
DEBUG 2025/12/17 17:03:00   Bucket[91]: Key=白河商工, DocCount=39
DEBUG 2025/12/17 17:03:00   Bucket[92]: Key=南大附小, DocCount=38
DEBUG 2025/12/17 17:03:00   Bucket[93]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:03:00   Bucket[94]: Key=土庫商工, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[95]: Key=屏東高中, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[96]: Key=旗山農工, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[97]: Key=潮州高中, DocCount=37
DEBUG 2025/12/17 17:03:00   Bucket[98]: Key=屏東特教, DocCount=36
DEBUG 2025/12/17 17:03:00   Bucket[99]: Key=嘉義家職, DocCount=35
DEBUG 2025/12/17 17:03:00 ========================================================
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:02 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
WARN 2025/12/17 17:03:03 JWT_SECRET environment variable not set, using default key (NOT SECURE)
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 0/0 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:03:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:03:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:03:08 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:03:09 Processing 15 offline devices
INFO 2025/12/17 17:03:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:03:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:03:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:03:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:03:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:03:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:03:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:03:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:03:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:03:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:03:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:03:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:03:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:03:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:03:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:03:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:03:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:03:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:03:10 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:03:10 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:03:10 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:03:10 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:03:10 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:03:13 ✅ Successfully flushed 36/36 history records to TimescaleDB
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:03:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:03:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:03:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:03:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:03:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:03:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:03:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:03:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:03:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:03:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:03:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:03:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:03:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:03:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:03:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:03:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:03:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.90% (threshold: 80.00%)
INFO 2025/12/17 17:03:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:03:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:03:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:03:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:03:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:03:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:04:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:04:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:04:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:04:00 Field: school_name.keyword
DEBUG 2025/12/17 17:04:00 Time From: 2025-12-17T17:03:00.000+08:00
DEBUG 2025/12/17 17:04:00 Time To: 2025-12-17T17:04:00.000+08:00
DEBUG 2025/12/17 17:04:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:03:00.000+08:00",
					"lte": "2025-12-17T17:04:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:04:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:04:00 ES Response IsError: false
DEBUG 2025/12/17 17:04:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":493,"buckets":[{"key":"黑快馬主機","doc_count":2134},{"key":"花蓮高農","doc_count":779},{"key":"金門農工","doc_count":656},{"key":"新竹女中","doc_count":625},{"key":"仁愛高農","doc_count":612},{"key":"竹北高中","doc_count":532},{"key":"金門高中","doc_count":518},{"key":"華僑高中","doc_count":469},{"key":"宜蘭高商","doc_count":426},{"key":"中大壢中","doc_count":388},{"key":"北門高中","doc_count":388},{"key":"南投高商","doc_count":364},{"key":"旗美高中","doc_count":364},{"key":"內埔農工","doc_count":358},{"key":"臺東高中","doc_count":349},{"key":"玉里高中","doc_count":343},{"key":"新港藝高","doc_count":334},{"key":"清華附小","doc_count":300},{"key":"興大附中","doc_count":299},{"key":"嘉義高商","doc_count":287},{"key":"蘇澳海事","doc_count":279},{"key":"屏東女中","doc_count":273},{"key":"竹南高中","doc_count":273},{"key":"關西高中","doc_count":259},{"key":"花蓮高商","doc_count":249},{"key":"南投特教","doc_count":212},{"key":"後壁高中","doc_count":205},{"key":"斗六家商","doc_count":194},{"key":"苗栗農工","doc_count":193},{"key":"關山工商","doc_count":190},{"key":"彰師附工","doc_count":180},{"key":"北港農工","doc_count":176},{"key":"南大附中","doc_count":165},{"key":"東港海事","doc_count":154},{"key":"成大南工","doc_count":151},{"key":"虎尾高中","doc_count":147},{"key":"員林家商","doc_count":141},{"key":"新營高工","doc_count":136},{"key":"師大附中高中部","doc_count":134},{"key":"嘉科實中","doc_count":125},{"key":"新化高中","doc_count":125},{"key":"新化高工","doc_count":122},{"key":"員林高中","doc_count":120},{"key":"南大附聰","doc_count":118},{"key":"花蓮高中","doc_count":110},{"key":"水里商工","doc_count":107},{"key":"北斗家商","doc_count":104},{"key":"潮州高中","doc_count":100},{"key":"東石高中","doc_count":89},{"key":"蘭陽女中","doc_count":89},{"key":"臺南一中","doc_count":88},{"key":"北教大實小","doc_count":84},{"key":"北港高中","doc_count":84},{"key":"宜蘭高中","doc_count":82},{"key":"新營高中","doc_count":81},{"key":"暨大附中","doc_count":80},{"key":"曾文農工","doc_count":79},{"key":"屏科實中","doc_count":75},{"key":"新竹高工","doc_count":75},{"key":"苗栗高商","doc_count":74},{"key":"興大附農","doc_count":73},{"key":"草屯商工","doc_count":72},{"key":"員林農工","doc_count":71},{"key":"嘉義家職","doc_count":71},{"key":"屏東高中","doc_count":71},{"key":"南大附小","doc_count":70},{"key":"屏東高工","doc_count":67},{"key":"白河商工","doc_count":67},{"key":"二林工商","doc_count":66},{"key":"成功商水","doc_count":66},{"key":"嘉義特教","doc_count":65},{"key":"旗山農工","doc_count":64},{"key":"中興高中","doc_count":63},{"key":"屏北高中","doc_count":60},{"key":"新竹高商","doc_count":60},{"key":"永靖高工","doc_count":59},{"key":"埔里高工","doc_count":57},{"key":"南投高中","doc_count":55},{"key":"彰化高商","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"花蓮高工","doc_count":54},{"key":"臺南高商","doc_count":52},{"key":"溪湖高中","doc_count":48},{"key":"鳳山高中","doc_count":48},{"key":"善化高中","doc_count":47},{"key":"屏東特教","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"新豐高中","doc_count":46},{"key":"嘉義高中","doc_count":45},{"key":"崇實高工","doc_count":45},{"key":"竹東高中","doc_count":45},{"key":"秀水高工","doc_count":44},{"key":"臺東高商","doc_count":44},{"key":"雲林特教","doc_count":44},{"key":"高餐大附中","doc_count":44},{"key":"嘉義高工","doc_count":43},{"key":"澎湖海事","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"羅東高商","doc_count":41}]}}}
DEBUG 2025/12/17 17:04:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:04:00   Bucket[0]: Key=黑快馬主機, DocCount=2134
DEBUG 2025/12/17 17:04:00   Bucket[1]: Key=花蓮高農, DocCount=779
DEBUG 2025/12/17 17:04:00   Bucket[2]: Key=金門農工, DocCount=656
DEBUG 2025/12/17 17:04:00   Bucket[3]: Key=新竹女中, DocCount=625
DEBUG 2025/12/17 17:04:00   Bucket[4]: Key=仁愛高農, DocCount=612
DEBUG 2025/12/17 17:04:00   Bucket[5]: Key=竹北高中, DocCount=532
DEBUG 2025/12/17 17:04:00   Bucket[6]: Key=金門高中, DocCount=518
DEBUG 2025/12/17 17:04:00   Bucket[7]: Key=華僑高中, DocCount=469
DEBUG 2025/12/17 17:04:00   Bucket[8]: Key=宜蘭高商, DocCount=426
DEBUG 2025/12/17 17:04:00   Bucket[9]: Key=中大壢中, DocCount=388
DEBUG 2025/12/17 17:04:00   Bucket[10]: Key=北門高中, DocCount=388
DEBUG 2025/12/17 17:04:00   Bucket[11]: Key=南投高商, DocCount=364
DEBUG 2025/12/17 17:04:00   Bucket[12]: Key=旗美高中, DocCount=364
DEBUG 2025/12/17 17:04:00   Bucket[13]: Key=內埔農工, DocCount=358
DEBUG 2025/12/17 17:04:00   Bucket[14]: Key=臺東高中, DocCount=349
DEBUG 2025/12/17 17:04:00   Bucket[15]: Key=玉里高中, DocCount=343
DEBUG 2025/12/17 17:04:00   Bucket[16]: Key=新港藝高, DocCount=334
DEBUG 2025/12/17 17:04:00   Bucket[17]: Key=清華附小, DocCount=300
DEBUG 2025/12/17 17:04:00   Bucket[18]: Key=興大附中, DocCount=299
DEBUG 2025/12/17 17:04:00   Bucket[19]: Key=嘉義高商, DocCount=287
DEBUG 2025/12/17 17:04:00   Bucket[20]: Key=蘇澳海事, DocCount=279
DEBUG 2025/12/17 17:04:00   Bucket[21]: Key=屏東女中, DocCount=273
DEBUG 2025/12/17 17:04:00   Bucket[22]: Key=竹南高中, DocCount=273
DEBUG 2025/12/17 17:04:00   Bucket[23]: Key=關西高中, DocCount=259
DEBUG 2025/12/17 17:04:00   Bucket[24]: Key=花蓮高商, DocCount=249
DEBUG 2025/12/17 17:04:00   Bucket[25]: Key=南投特教, DocCount=212
DEBUG 2025/12/17 17:04:00   Bucket[26]: Key=後壁高中, DocCount=205
DEBUG 2025/12/17 17:04:00   Bucket[27]: Key=斗六家商, DocCount=194
DEBUG 2025/12/17 17:04:00   Bucket[28]: Key=苗栗農工, DocCount=193
DEBUG 2025/12/17 17:04:00   Bucket[29]: Key=關山工商, DocCount=190
DEBUG 2025/12/17 17:04:00   Bucket[30]: Key=彰師附工, DocCount=180
DEBUG 2025/12/17 17:04:00   Bucket[31]: Key=北港農工, DocCount=176
DEBUG 2025/12/17 17:04:00   Bucket[32]: Key=南大附中, DocCount=165
DEBUG 2025/12/17 17:04:00   Bucket[33]: Key=東港海事, DocCount=154
DEBUG 2025/12/17 17:04:00   Bucket[34]: Key=成大南工, DocCount=151
DEBUG 2025/12/17 17:04:00   Bucket[35]: Key=虎尾高中, DocCount=147
DEBUG 2025/12/17 17:04:00   Bucket[36]: Key=員林家商, DocCount=141
DEBUG 2025/12/17 17:04:00   Bucket[37]: Key=新營高工, DocCount=136
DEBUG 2025/12/17 17:04:00   Bucket[38]: Key=師大附中高中部, DocCount=134
DEBUG 2025/12/17 17:04:00   Bucket[39]: Key=嘉科實中, DocCount=125
DEBUG 2025/12/17 17:04:00   Bucket[40]: Key=新化高中, DocCount=125
DEBUG 2025/12/17 17:04:00   Bucket[41]: Key=新化高工, DocCount=122
DEBUG 2025/12/17 17:04:00   Bucket[42]: Key=員林高中, DocCount=120
DEBUG 2025/12/17 17:04:00   Bucket[43]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:04:00   Bucket[44]: Key=花蓮高中, DocCount=110
DEBUG 2025/12/17 17:04:00   Bucket[45]: Key=水里商工, DocCount=107
DEBUG 2025/12/17 17:04:00   Bucket[46]: Key=北斗家商, DocCount=104
DEBUG 2025/12/17 17:04:00   Bucket[47]: Key=潮州高中, DocCount=100
DEBUG 2025/12/17 17:04:00   Bucket[48]: Key=東石高中, DocCount=89
DEBUG 2025/12/17 17:04:00   Bucket[49]: Key=蘭陽女中, DocCount=89
DEBUG 2025/12/17 17:04:00   Bucket[50]: Key=臺南一中, DocCount=88
DEBUG 2025/12/17 17:04:00   Bucket[51]: Key=北教大實小, DocCount=84
DEBUG 2025/12/17 17:04:00   Bucket[52]: Key=北港高中, DocCount=84
DEBUG 2025/12/17 17:04:00   Bucket[53]: Key=宜蘭高中, DocCount=82
DEBUG 2025/12/17 17:04:00   Bucket[54]: Key=新營高中, DocCount=81
DEBUG 2025/12/17 17:04:00   Bucket[55]: Key=暨大附中, DocCount=80
DEBUG 2025/12/17 17:04:00   Bucket[56]: Key=曾文農工, DocCount=79
DEBUG 2025/12/17 17:04:00   Bucket[57]: Key=屏科實中, DocCount=75
DEBUG 2025/12/17 17:04:00   Bucket[58]: Key=新竹高工, DocCount=75
DEBUG 2025/12/17 17:04:00   Bucket[59]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:04:00   Bucket[60]: Key=興大附農, DocCount=73
DEBUG 2025/12/17 17:04:00   Bucket[61]: Key=草屯商工, DocCount=72
DEBUG 2025/12/17 17:04:00   Bucket[62]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[63]: Key=嘉義家職, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[64]: Key=屏東高中, DocCount=71
DEBUG 2025/12/17 17:04:00   Bucket[65]: Key=南大附小, DocCount=70
DEBUG 2025/12/17 17:04:00   Bucket[66]: Key=屏東高工, DocCount=67
DEBUG 2025/12/17 17:04:00   Bucket[67]: Key=白河商工, DocCount=67
DEBUG 2025/12/17 17:04:00   Bucket[68]: Key=二林工商, DocCount=66
DEBUG 2025/12/17 17:04:00   Bucket[69]: Key=成功商水, DocCount=66
DEBUG 2025/12/17 17:04:00   Bucket[70]: Key=嘉義特教, DocCount=65
DEBUG 2025/12/17 17:04:00   Bucket[71]: Key=旗山農工, DocCount=64
DEBUG 2025/12/17 17:04:00   Bucket[72]: Key=中興高中, DocCount=63
DEBUG 2025/12/17 17:04:00   Bucket[73]: Key=屏北高中, DocCount=60
DEBUG 2025/12/17 17:04:00   Bucket[74]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:04:00   Bucket[75]: Key=永靖高工, DocCount=59
DEBUG 2025/12/17 17:04:00   Bucket[76]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:04:00   Bucket[77]: Key=南投高中, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[78]: Key=彰化高商, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[79]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[80]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:04:00   Bucket[81]: Key=花蓮高工, DocCount=54
DEBUG 2025/12/17 17:04:00   Bucket[82]: Key=臺南高商, DocCount=52
DEBUG 2025/12/17 17:04:00   Bucket[83]: Key=溪湖高中, DocCount=48
DEBUG 2025/12/17 17:04:00   Bucket[84]: Key=鳳山高中, DocCount=48
DEBUG 2025/12/17 17:04:00   Bucket[85]: Key=善化高中, DocCount=47
DEBUG 2025/12/17 17:04:00   Bucket[86]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:04:00   Bucket[87]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:04:00   Bucket[88]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:04:00   Bucket[89]: Key=嘉義高中, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[90]: Key=崇實高工, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[91]: Key=竹東高中, DocCount=45
DEBUG 2025/12/17 17:04:00   Bucket[92]: Key=秀水高工, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[93]: Key=臺東高商, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[94]: Key=雲林特教, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[95]: Key=高餐大附中, DocCount=44
DEBUG 2025/12/17 17:04:00   Bucket[96]: Key=嘉義高工, DocCount=43
DEBUG 2025/12/17 17:04:00   Bucket[97]: Key=澎湖海事, DocCount=42
DEBUG 2025/12/17 17:04:00   Bucket[98]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:04:00   Bucket[99]: Key=羅東高商, DocCount=41
DEBUG 2025/12/17 17:04:00 ========================================================
INFO 2025/12/17 17:04:03 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:04:06 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:04:07 Processing 15 offline devices
INFO 2025/12/17 17:04:07 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:04:07 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:04:07 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:04:07 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:04:07 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:04:07 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:04:07 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:04:07 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:04:07 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:04:07 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:04:07 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:04:07 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:04:07 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:04:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:04:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:04:08 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:04:08 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:04:08 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:04:08 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:04:08 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:04:08 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:04:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:04:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:04:08 ✅ Successfully flushed 33/33 history records to TimescaleDB
INFO 2025/12/17 17:04:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:04:13 ✅ Successfully flushed 1/1 history records to TimescaleDB
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:04:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:04:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:04:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:04:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:04:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:04:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:04:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:04:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:04:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:04:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:04:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:04:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:04:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:04:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:04:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:04:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:04:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:04:45 ES Alert Created [high][performance]: Memory usage high: 87.04% (threshold: 80.00%)
INFO 2025/12/17 17:04:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.15% (threshold: 85.00%)
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:04:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:04:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:04:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:04:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:04:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:05:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:05:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:05:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:05:00 Field: school_name.keyword
DEBUG 2025/12/17 17:05:00 Time From: 2025-12-17T17:04:00.000+08:00
DEBUG 2025/12/17 17:05:00 Time To: 2025-12-17T17:05:00.000+08:00
DEBUG 2025/12/17 17:05:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:04:00.000+08:00",
					"lte": "2025-12-17T17:05:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:05:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:05:00 ES Response IsError: false
DEBUG 2025/12/17 17:05:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":465,"buckets":[{"key":"黑快馬主機","doc_count":2499},{"key":"花蓮高農","doc_count":791},{"key":"金門農工","doc_count":623},{"key":"仁愛高農","doc_count":576},{"key":"新竹女中","doc_count":533},{"key":"華僑高中","doc_count":510},{"key":"金門高中","doc_count":481},{"key":"竹北高中","doc_count":429},{"key":"北門高中","doc_count":388},{"key":"玉里高中","doc_count":359},{"key":"宜蘭高商","doc_count":350},{"key":"旗美高中","doc_count":320},{"key":"南投高商","doc_count":319},{"key":"中大壢中","doc_count":314},{"key":"新港藝高","doc_count":313},{"key":"臺東高中","doc_count":311},{"key":"內埔農工","doc_count":294},{"key":"師大附中高中部","doc_count":289},{"key":"蘇澳海事","doc_count":288},{"key":"嘉義高商","doc_count":277},{"key":"竹南高中","doc_count":259},{"key":"興大附中","doc_count":248},{"key":"清華附小","doc_count":236},{"key":"關西高中","doc_count":229},{"key":"後壁高中","doc_count":207},{"key":"斗六家商","doc_count":205},{"key":"花蓮高商","doc_count":201},{"key":"東港海事","doc_count":194},{"key":"關山工商","doc_count":194},{"key":"南投特教","doc_count":186},{"key":"苗栗農工","doc_count":184},{"key":"屏東女中","doc_count":161},{"key":"成大南工","doc_count":157},{"key":"新化高工","doc_count":155},{"key":"虎尾高中","doc_count":141},{"key":"屏東高工","doc_count":140},{"key":"新營高工","doc_count":132},{"key":"南大附聰","doc_count":122},{"key":"員林家商","doc_count":122},{"key":"南大附中","doc_count":117},{"key":"北港農工","doc_count":109},{"key":"澎湖海事","doc_count":109},{"key":"北斗家商","doc_count":107},{"key":"中興高中","doc_count":105},{"key":"新竹高工","doc_count":97},{"key":"彰師附工","doc_count":95},{"key":"苗栗高商","doc_count":94},{"key":"鳳山高中","doc_count":93},{"key":"新化高中","doc_count":91},{"key":"彰化高商","doc_count":90},{"key":"新營高中","doc_count":90},{"key":"二林工商","doc_count":88},{"key":"屏科實中","doc_count":86},{"key":"員林高中","doc_count":85},{"key":"北港高中","doc_count":84},{"key":"曾文農工","doc_count":84},{"key":"北教大實小","doc_count":82},{"key":"嘉義高中","doc_count":82},{"key":"臺東高商","doc_count":82},{"key":"旗山農工","doc_count":73},{"key":"嘉科實中","doc_count":69},{"key":"嘉義家職","doc_count":69},{"key":"永靖高工","doc_count":68},{"key":"苗栗高中","doc_count":68},{"key":"員林農工","doc_count":66},{"key":"蘭陽女中","doc_count":65},{"key":"南投高中","doc_count":64},{"key":"興大附農","doc_count":62},{"key":"新竹高中","doc_count":61},{"key":"竹東高中","doc_count":61},{"key":"臺南一中","doc_count":61},{"key":"新竹高商","doc_count":60},{"key":"羅東高商","doc_count":59},{"key":"海大附中","doc_count":57},{"key":"宜蘭高中","doc_count":56},{"key":"屏東高中","doc_count":55},{"key":"潮州高中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"埔里高工","doc_count":52},{"key":"基隆商工","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"南大附小","doc_count":51},{"key":"水里商工","doc_count":51},{"key":"花蓮高中","doc_count":48},{"key":"臺東女中","doc_count":47},{"key":"土庫商工","doc_count":45},{"key":"屏北高中","doc_count":45},{"key":"屏東特教","doc_count":45},{"key":"花蓮特教","doc_count":45},{"key":"嘉義高工","doc_count":44},{"key":"高餐大附中","doc_count":41},{"key":"善化高中","doc_count":40},{"key":"東石高中","doc_count":40},{"key":"臺南高商","doc_count":39},{"key":"雲林特教","doc_count":39},{"key":"白河商工","doc_count":38},{"key":"羅東高工","doc_count":36},{"key":"溪湖高中","doc_count":35},{"key":"玉井工商","doc_count":35},{"key":"政大附中","doc_count":34}]}}}
DEBUG 2025/12/17 17:05:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:05:00   Bucket[0]: Key=黑快馬主機, DocCount=2499
DEBUG 2025/12/17 17:05:00   Bucket[1]: Key=花蓮高農, DocCount=791
DEBUG 2025/12/17 17:05:00   Bucket[2]: Key=金門農工, DocCount=623
DEBUG 2025/12/17 17:05:00   Bucket[3]: Key=仁愛高農, DocCount=576
DEBUG 2025/12/17 17:05:00   Bucket[4]: Key=新竹女中, DocCount=533
DEBUG 2025/12/17 17:05:00   Bucket[5]: Key=華僑高中, DocCount=510
DEBUG 2025/12/17 17:05:00   Bucket[6]: Key=金門高中, DocCount=481
DEBUG 2025/12/17 17:05:00   Bucket[7]: Key=竹北高中, DocCount=429
DEBUG 2025/12/17 17:05:00   Bucket[8]: Key=北門高中, DocCount=388
DEBUG 2025/12/17 17:05:00   Bucket[9]: Key=玉里高中, DocCount=359
DEBUG 2025/12/17 17:05:00   Bucket[10]: Key=宜蘭高商, DocCount=350
DEBUG 2025/12/17 17:05:00   Bucket[11]: Key=旗美高中, DocCount=320
DEBUG 2025/12/17 17:05:00   Bucket[12]: Key=南投高商, DocCount=319
DEBUG 2025/12/17 17:05:00   Bucket[13]: Key=中大壢中, DocCount=314
DEBUG 2025/12/17 17:05:00   Bucket[14]: Key=新港藝高, DocCount=313
DEBUG 2025/12/17 17:05:00   Bucket[15]: Key=臺東高中, DocCount=311
DEBUG 2025/12/17 17:05:00   Bucket[16]: Key=內埔農工, DocCount=294
DEBUG 2025/12/17 17:05:00   Bucket[17]: Key=師大附中高中部, DocCount=289
DEBUG 2025/12/17 17:05:00   Bucket[18]: Key=蘇澳海事, DocCount=288
DEBUG 2025/12/17 17:05:00   Bucket[19]: Key=嘉義高商, DocCount=277
DEBUG 2025/12/17 17:05:00   Bucket[20]: Key=竹南高中, DocCount=259
DEBUG 2025/12/17 17:05:00   Bucket[21]: Key=興大附中, DocCount=248
DEBUG 2025/12/17 17:05:00   Bucket[22]: Key=清華附小, DocCount=236
DEBUG 2025/12/17 17:05:00   Bucket[23]: Key=關西高中, DocCount=229
DEBUG 2025/12/17 17:05:00   Bucket[24]: Key=後壁高中, DocCount=207
DEBUG 2025/12/17 17:05:00   Bucket[25]: Key=斗六家商, DocCount=205
DEBUG 2025/12/17 17:05:00   Bucket[26]: Key=花蓮高商, DocCount=201
DEBUG 2025/12/17 17:05:00   Bucket[27]: Key=東港海事, DocCount=194
DEBUG 2025/12/17 17:05:00   Bucket[28]: Key=關山工商, DocCount=194
DEBUG 2025/12/17 17:05:00   Bucket[29]: Key=南投特教, DocCount=186
DEBUG 2025/12/17 17:05:00   Bucket[30]: Key=苗栗農工, DocCount=184
DEBUG 2025/12/17 17:05:00   Bucket[31]: Key=屏東女中, DocCount=161
DEBUG 2025/12/17 17:05:00   Bucket[32]: Key=成大南工, DocCount=157
DEBUG 2025/12/17 17:05:00   Bucket[33]: Key=新化高工, DocCount=155
DEBUG 2025/12/17 17:05:00   Bucket[34]: Key=虎尾高中, DocCount=141
DEBUG 2025/12/17 17:05:00   Bucket[35]: Key=屏東高工, DocCount=140
DEBUG 2025/12/17 17:05:00   Bucket[36]: Key=新營高工, DocCount=132
DEBUG 2025/12/17 17:05:00   Bucket[37]: Key=南大附聰, DocCount=122
DEBUG 2025/12/17 17:05:00   Bucket[38]: Key=員林家商, DocCount=122
DEBUG 2025/12/17 17:05:00   Bucket[39]: Key=南大附中, DocCount=117
DEBUG 2025/12/17 17:05:00   Bucket[40]: Key=北港農工, DocCount=109
DEBUG 2025/12/17 17:05:00   Bucket[41]: Key=澎湖海事, DocCount=109
DEBUG 2025/12/17 17:05:00   Bucket[42]: Key=北斗家商, DocCount=107
DEBUG 2025/12/17 17:05:00   Bucket[43]: Key=中興高中, DocCount=105
DEBUG 2025/12/17 17:05:00   Bucket[44]: Key=新竹高工, DocCount=97
DEBUG 2025/12/17 17:05:00   Bucket[45]: Key=彰師附工, DocCount=95
DEBUG 2025/12/17 17:05:00   Bucket[46]: Key=苗栗高商, DocCount=94
DEBUG 2025/12/17 17:05:00   Bucket[47]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:05:00   Bucket[48]: Key=新化高中, DocCount=91
DEBUG 2025/12/17 17:05:00   Bucket[49]: Key=彰化高商, DocCount=90
DEBUG 2025/12/17 17:05:00   Bucket[50]: Key=新營高中, DocCount=90
DEBUG 2025/12/17 17:05:00   Bucket[51]: Key=二林工商, DocCount=88
DEBUG 2025/12/17 17:05:00   Bucket[52]: Key=屏科實中, DocCount=86
DEBUG 2025/12/17 17:05:00   Bucket[53]: Key=員林高中, DocCount=85
DEBUG 2025/12/17 17:05:00   Bucket[54]: Key=北港高中, DocCount=84
DEBUG 2025/12/17 17:05:00   Bucket[55]: Key=曾文農工, DocCount=84
DEBUG 2025/12/17 17:05:00   Bucket[56]: Key=北教大實小, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[57]: Key=嘉義高中, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[58]: Key=臺東高商, DocCount=82
DEBUG 2025/12/17 17:05:00   Bucket[59]: Key=旗山農工, DocCount=73
DEBUG 2025/12/17 17:05:00   Bucket[60]: Key=嘉科實中, DocCount=69
DEBUG 2025/12/17 17:05:00   Bucket[61]: Key=嘉義家職, DocCount=69
DEBUG 2025/12/17 17:05:00   Bucket[62]: Key=永靖高工, DocCount=68
DEBUG 2025/12/17 17:05:00   Bucket[63]: Key=苗栗高中, DocCount=68
DEBUG 2025/12/17 17:05:00   Bucket[64]: Key=員林農工, DocCount=66
DEBUG 2025/12/17 17:05:00   Bucket[65]: Key=蘭陽女中, DocCount=65
DEBUG 2025/12/17 17:05:00   Bucket[66]: Key=南投高中, DocCount=64
DEBUG 2025/12/17 17:05:00   Bucket[67]: Key=興大附農, DocCount=62
DEBUG 2025/12/17 17:05:00   Bucket[68]: Key=新竹高中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[69]: Key=竹東高中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[70]: Key=臺南一中, DocCount=61
DEBUG 2025/12/17 17:05:00   Bucket[71]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:05:00   Bucket[72]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:05:00   Bucket[73]: Key=海大附中, DocCount=57
DEBUG 2025/12/17 17:05:00   Bucket[74]: Key=宜蘭高中, DocCount=56
DEBUG 2025/12/17 17:05:00   Bucket[75]: Key=屏東高中, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[76]: Key=潮州高中, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[77]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:05:00   Bucket[78]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[79]: Key=基隆商工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[80]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:05:00   Bucket[81]: Key=南大附小, DocCount=51
DEBUG 2025/12/17 17:05:00   Bucket[82]: Key=水里商工, DocCount=51
DEBUG 2025/12/17 17:05:00   Bucket[83]: Key=花蓮高中, DocCount=48
DEBUG 2025/12/17 17:05:00   Bucket[84]: Key=臺東女中, DocCount=47
DEBUG 2025/12/17 17:05:00   Bucket[85]: Key=土庫商工, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[86]: Key=屏北高中, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[87]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[88]: Key=花蓮特教, DocCount=45
DEBUG 2025/12/17 17:05:00   Bucket[89]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 17:05:00   Bucket[90]: Key=高餐大附中, DocCount=41
DEBUG 2025/12/17 17:05:00   Bucket[91]: Key=善化高中, DocCount=40
DEBUG 2025/12/17 17:05:00   Bucket[92]: Key=東石高中, DocCount=40
DEBUG 2025/12/17 17:05:00   Bucket[93]: Key=臺南高商, DocCount=39
DEBUG 2025/12/17 17:05:00   Bucket[94]: Key=雲林特教, DocCount=39
DEBUG 2025/12/17 17:05:00   Bucket[95]: Key=白河商工, DocCount=38
DEBUG 2025/12/17 17:05:00   Bucket[96]: Key=羅東高工, DocCount=36
DEBUG 2025/12/17 17:05:00   Bucket[97]: Key=溪湖高中, DocCount=35
DEBUG 2025/12/17 17:05:00   Bucket[98]: Key=玉井工商, DocCount=35
DEBUG 2025/12/17 17:05:00   Bucket[99]: Key=政大附中, DocCount=34
DEBUG 2025/12/17 17:05:00 ========================================================
INFO 2025/12/17 17:05:03 ✅ Successfully flushed 3/3 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 17:05:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:05:08 ✅ Successfully flushed 17/17 history records to TimescaleDB
INFO 2025/12/17 17:05:09 Processing 15 offline devices
INFO 2025/12/17 17:05:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:05:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:05:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:05:09 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:05:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:05:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:05:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:05:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:05:09 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:05:09 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:05:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:05:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:05:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:05:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:05:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:05:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:05:10 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:05:10 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:05:10 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:05:13 ✅ Successfully flushed 29/29 history records to TimescaleDB
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:05:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:05:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:05:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:05:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:05:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:05:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:05:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:05:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:05:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:05:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:05:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:05:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:05:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:05:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.63% (threshold: 80.00%)
INFO 2025/12/17 17:05:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.15% (threshold: 85.00%)
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:05:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:05:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:05:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:05:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:05:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:06:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:06:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:06:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:06:00 Field: school_name.keyword
DEBUG 2025/12/17 17:06:00 Time From: 2025-12-17T17:05:00.000+08:00
DEBUG 2025/12/17 17:06:00 Time To: 2025-12-17T17:06:00.000+08:00
DEBUG 2025/12/17 17:06:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:05:00.000+08:00",
					"lte": "2025-12-17T17:06:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:06:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:06:00 ES Response IsError: false
DEBUG 2025/12/17 17:06:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":450,"buckets":[{"key":"黑快馬主機","doc_count":1689},{"key":"花蓮高農","doc_count":752},{"key":"新竹女中","doc_count":571},{"key":"仁愛高農","doc_count":559},{"key":"金門農工","doc_count":529},{"key":"金門高中","doc_count":528},{"key":"華僑高中","doc_count":458},{"key":"玉里高中","doc_count":446},{"key":"南投高商","doc_count":423},{"key":"竹北高中","doc_count":409},{"key":"北門高中","doc_count":382},{"key":"宜蘭高商","doc_count":368},{"key":"臺東高中","doc_count":351},{"key":"花蓮高商","doc_count":344},{"key":"新港藝高","doc_count":343},{"key":"旗美高中","doc_count":325},{"key":"興大附中","doc_count":280},{"key":"內埔農工","doc_count":271},{"key":"蘇澳海事","doc_count":265},{"key":"關西高中","doc_count":245},{"key":"關山工商","doc_count":238},{"key":"中大壢中","doc_count":232},{"key":"清華附小","doc_count":228},{"key":"屏東女中","doc_count":226},{"key":"竹南高中","doc_count":225},{"key":"後壁高中","doc_count":224},{"key":"斗六家商","doc_count":190},{"key":"南投特教","doc_count":173},{"key":"苗栗農工","doc_count":164},{"key":"虎尾高中","doc_count":160},{"key":"東港海事","doc_count":153},{"key":"彰化高商","doc_count":150},{"key":"新竹高工","doc_count":149},{"key":"師大附中高中部","doc_count":144},{"key":"嘉義高商","doc_count":140},{"key":"新化高中","doc_count":139},{"key":"新營高工","doc_count":139},{"key":"員林家商","doc_count":131},{"key":"南大附聰","doc_count":120},{"key":"二林工商","doc_count":119},{"key":"宜蘭高中","doc_count":112},{"key":"成大南工","doc_count":111},{"key":"中興高中","doc_count":110},{"key":"彰師附工","doc_count":109},{"key":"鳳山高中","doc_count":108},{"key":"新化高工","doc_count":105},{"key":"北教大實小","doc_count":96},{"key":"屏科實中","doc_count":85},{"key":"土庫商工","doc_count":84},{"key":"員林農工","doc_count":82},{"key":"羅東高工","doc_count":82},{"key":"興大附農","doc_count":82},{"key":"屏東高中","doc_count":81},{"key":"嘉科實中","doc_count":79},{"key":"南大附小","doc_count":75},{"key":"北港高中","doc_count":72},{"key":"南大附中","doc_count":72},{"key":"北斗家商","doc_count":71},{"key":"嘉義高中","doc_count":71},{"key":"新營高中","doc_count":71},{"key":"高餐大附中","doc_count":70},{"key":"苗栗高商","doc_count":69},{"key":"曾文農工","doc_count":67},{"key":"臺南高商","doc_count":66},{"key":"南投高中","doc_count":64},{"key":"澎湖海事","doc_count":64},{"key":"頭城家商","doc_count":63},{"key":"北港農工","doc_count":62},{"key":"花蓮高工","doc_count":62},{"key":"潮州高中","doc_count":61},{"key":"永靖高工","doc_count":59},{"key":"臺東高商","doc_count":59},{"key":"暨大附中","doc_count":56},{"key":"華南高商","doc_count":54},{"key":"屏東高工","doc_count":53},{"key":"政大附中","doc_count":52},{"key":"臺南一中","doc_count":52},{"key":"竹東高中","doc_count":51},{"key":"苗栗高中","doc_count":51},{"key":"埔里高工","doc_count":50},{"key":"秀水高工","doc_count":50},{"key":"員林高中","doc_count":49},{"key":"草屯商工","doc_count":49},{"key":"嘉義高工","doc_count":48},{"key":"東石高中","doc_count":48},{"key":"水里商工","doc_count":48},{"key":"海大附中","doc_count":48},{"key":"白河商工","doc_count":47},{"key":"屏東特教","doc_count":45},{"key":"基隆商工","doc_count":42},{"key":"溪湖高中","doc_count":42},{"key":"雲林特教","doc_count":42},{"key":"師大附中國中部","doc_count":41},{"key":"羅東高商","doc_count":41},{"key":"家齊高中","doc_count":40},{"key":"佳冬高農","doc_count":39},{"key":"嘉義特教","doc_count":39},{"key":"新豐高中","doc_count":37},{"key":"玉井工商","doc_count":37},{"key":"新竹高商","doc_count":35}]}}}
DEBUG 2025/12/17 17:06:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:06:00   Bucket[0]: Key=黑快馬主機, DocCount=1689
DEBUG 2025/12/17 17:06:00   Bucket[1]: Key=花蓮高農, DocCount=752
DEBUG 2025/12/17 17:06:00   Bucket[2]: Key=新竹女中, DocCount=571
DEBUG 2025/12/17 17:06:00   Bucket[3]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:06:00   Bucket[4]: Key=金門農工, DocCount=529
DEBUG 2025/12/17 17:06:00   Bucket[5]: Key=金門高中, DocCount=528
DEBUG 2025/12/17 17:06:00   Bucket[6]: Key=華僑高中, DocCount=458
DEBUG 2025/12/17 17:06:00   Bucket[7]: Key=玉里高中, DocCount=446
DEBUG 2025/12/17 17:06:00   Bucket[8]: Key=南投高商, DocCount=423
DEBUG 2025/12/17 17:06:00   Bucket[9]: Key=竹北高中, DocCount=409
DEBUG 2025/12/17 17:06:00   Bucket[10]: Key=北門高中, DocCount=382
DEBUG 2025/12/17 17:06:00   Bucket[11]: Key=宜蘭高商, DocCount=368
DEBUG 2025/12/17 17:06:00   Bucket[12]: Key=臺東高中, DocCount=351
DEBUG 2025/12/17 17:06:00   Bucket[13]: Key=花蓮高商, DocCount=344
DEBUG 2025/12/17 17:06:00   Bucket[14]: Key=新港藝高, DocCount=343
DEBUG 2025/12/17 17:06:00   Bucket[15]: Key=旗美高中, DocCount=325
DEBUG 2025/12/17 17:06:00   Bucket[16]: Key=興大附中, DocCount=280
DEBUG 2025/12/17 17:06:00   Bucket[17]: Key=內埔農工, DocCount=271
DEBUG 2025/12/17 17:06:00   Bucket[18]: Key=蘇澳海事, DocCount=265
DEBUG 2025/12/17 17:06:00   Bucket[19]: Key=關西高中, DocCount=245
DEBUG 2025/12/17 17:06:00   Bucket[20]: Key=關山工商, DocCount=238
DEBUG 2025/12/17 17:06:00   Bucket[21]: Key=中大壢中, DocCount=232
DEBUG 2025/12/17 17:06:00   Bucket[22]: Key=清華附小, DocCount=228
DEBUG 2025/12/17 17:06:00   Bucket[23]: Key=屏東女中, DocCount=226
DEBUG 2025/12/17 17:06:00   Bucket[24]: Key=竹南高中, DocCount=225
DEBUG 2025/12/17 17:06:00   Bucket[25]: Key=後壁高中, DocCount=224
DEBUG 2025/12/17 17:06:00   Bucket[26]: Key=斗六家商, DocCount=190
DEBUG 2025/12/17 17:06:00   Bucket[27]: Key=南投特教, DocCount=173
DEBUG 2025/12/17 17:06:00   Bucket[28]: Key=苗栗農工, DocCount=164
DEBUG 2025/12/17 17:06:00   Bucket[29]: Key=虎尾高中, DocCount=160
DEBUG 2025/12/17 17:06:00   Bucket[30]: Key=東港海事, DocCount=153
DEBUG 2025/12/17 17:06:00   Bucket[31]: Key=彰化高商, DocCount=150
DEBUG 2025/12/17 17:06:00   Bucket[32]: Key=新竹高工, DocCount=149
DEBUG 2025/12/17 17:06:00   Bucket[33]: Key=師大附中高中部, DocCount=144
DEBUG 2025/12/17 17:06:00   Bucket[34]: Key=嘉義高商, DocCount=140
DEBUG 2025/12/17 17:06:00   Bucket[35]: Key=新化高中, DocCount=139
DEBUG 2025/12/17 17:06:00   Bucket[36]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:06:00   Bucket[37]: Key=員林家商, DocCount=131
DEBUG 2025/12/17 17:06:00   Bucket[38]: Key=南大附聰, DocCount=120
DEBUG 2025/12/17 17:06:00   Bucket[39]: Key=二林工商, DocCount=119
DEBUG 2025/12/17 17:06:00   Bucket[40]: Key=宜蘭高中, DocCount=112
DEBUG 2025/12/17 17:06:00   Bucket[41]: Key=成大南工, DocCount=111
DEBUG 2025/12/17 17:06:00   Bucket[42]: Key=中興高中, DocCount=110
DEBUG 2025/12/17 17:06:00   Bucket[43]: Key=彰師附工, DocCount=109
DEBUG 2025/12/17 17:06:00   Bucket[44]: Key=鳳山高中, DocCount=108
DEBUG 2025/12/17 17:06:00   Bucket[45]: Key=新化高工, DocCount=105
DEBUG 2025/12/17 17:06:00   Bucket[46]: Key=北教大實小, DocCount=96
DEBUG 2025/12/17 17:06:00   Bucket[47]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:06:00   Bucket[48]: Key=土庫商工, DocCount=84
DEBUG 2025/12/17 17:06:00   Bucket[49]: Key=員林農工, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[50]: Key=羅東高工, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[51]: Key=興大附農, DocCount=82
DEBUG 2025/12/17 17:06:00   Bucket[52]: Key=屏東高中, DocCount=81
DEBUG 2025/12/17 17:06:00   Bucket[53]: Key=嘉科實中, DocCount=79
DEBUG 2025/12/17 17:06:00   Bucket[54]: Key=南大附小, DocCount=75
DEBUG 2025/12/17 17:06:00   Bucket[55]: Key=北港高中, DocCount=72
DEBUG 2025/12/17 17:06:00   Bucket[56]: Key=南大附中, DocCount=72
DEBUG 2025/12/17 17:06:00   Bucket[57]: Key=北斗家商, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[58]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[59]: Key=新營高中, DocCount=71
DEBUG 2025/12/17 17:06:00   Bucket[60]: Key=高餐大附中, DocCount=70
DEBUG 2025/12/17 17:06:00   Bucket[61]: Key=苗栗高商, DocCount=69
DEBUG 2025/12/17 17:06:00   Bucket[62]: Key=曾文農工, DocCount=67
DEBUG 2025/12/17 17:06:00   Bucket[63]: Key=臺南高商, DocCount=66
DEBUG 2025/12/17 17:06:00   Bucket[64]: Key=南投高中, DocCount=64
DEBUG 2025/12/17 17:06:00   Bucket[65]: Key=澎湖海事, DocCount=64
DEBUG 2025/12/17 17:06:00   Bucket[66]: Key=頭城家商, DocCount=63
DEBUG 2025/12/17 17:06:00   Bucket[67]: Key=北港農工, DocCount=62
DEBUG 2025/12/17 17:06:00   Bucket[68]: Key=花蓮高工, DocCount=62
DEBUG 2025/12/17 17:06:00   Bucket[69]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:06:00   Bucket[70]: Key=永靖高工, DocCount=59
DEBUG 2025/12/17 17:06:00   Bucket[71]: Key=臺東高商, DocCount=59
DEBUG 2025/12/17 17:06:00   Bucket[72]: Key=暨大附中, DocCount=56
DEBUG 2025/12/17 17:06:00   Bucket[73]: Key=華南高商, DocCount=54
DEBUG 2025/12/17 17:06:00   Bucket[74]: Key=屏東高工, DocCount=53
DEBUG 2025/12/17 17:06:00   Bucket[75]: Key=政大附中, DocCount=52
DEBUG 2025/12/17 17:06:00   Bucket[76]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:06:00   Bucket[77]: Key=竹東高中, DocCount=51
DEBUG 2025/12/17 17:06:00   Bucket[78]: Key=苗栗高中, DocCount=51
DEBUG 2025/12/17 17:06:00   Bucket[79]: Key=埔里高工, DocCount=50
DEBUG 2025/12/17 17:06:00   Bucket[80]: Key=秀水高工, DocCount=50
DEBUG 2025/12/17 17:06:00   Bucket[81]: Key=員林高中, DocCount=49
DEBUG 2025/12/17 17:06:00   Bucket[82]: Key=草屯商工, DocCount=49
DEBUG 2025/12/17 17:06:00   Bucket[83]: Key=嘉義高工, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[84]: Key=東石高中, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[85]: Key=水里商工, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[86]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 17:06:00   Bucket[87]: Key=白河商工, DocCount=47
DEBUG 2025/12/17 17:06:00   Bucket[88]: Key=屏東特教, DocCount=45
DEBUG 2025/12/17 17:06:00   Bucket[89]: Key=基隆商工, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[90]: Key=溪湖高中, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[91]: Key=雲林特教, DocCount=42
DEBUG 2025/12/17 17:06:00   Bucket[92]: Key=師大附中國中部, DocCount=41
DEBUG 2025/12/17 17:06:00   Bucket[93]: Key=羅東高商, DocCount=41
DEBUG 2025/12/17 17:06:00   Bucket[94]: Key=家齊高中, DocCount=40
DEBUG 2025/12/17 17:06:00   Bucket[95]: Key=佳冬高農, DocCount=39
DEBUG 2025/12/17 17:06:00   Bucket[96]: Key=嘉義特教, DocCount=39
DEBUG 2025/12/17 17:06:00   Bucket[97]: Key=新豐高中, DocCount=37
DEBUG 2025/12/17 17:06:00   Bucket[98]: Key=玉井工商, DocCount=37
DEBUG 2025/12/17 17:06:00   Bucket[99]: Key=新竹高商, DocCount=35
DEBUG 2025/12/17 17:06:00 ========================================================
INFO 2025/12/17 17:06:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 57/0 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:06:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:06:08 ✅ Successfully flushed 17/17 history records to TimescaleDB
INFO 2025/12/17 17:06:09 Processing 15 offline devices
INFO 2025/12/17 17:06:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:06:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 新竹高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 新竹高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 新竹高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:06:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:06:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:06:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:06:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:06:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:06:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:06:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:06:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:06:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:06:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:06:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:06:13 ✅ Successfully flushed 28/28 history records to TimescaleDB
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:06:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:06:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:06:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:06:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:06:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:06:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:06:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:06:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:06:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:06:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:06:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:06:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:06:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:06:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:06:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.13% (threshold: 80.00%)
INFO 2025/12/17 17:06:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.19% (threshold: 85.00%)
INFO 2025/12/17 17:06:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:06:45 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:06:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:06:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:06:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:07:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:07:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:07:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:07:00 Field: school_name.keyword
DEBUG 2025/12/17 17:07:00 Time From: 2025-12-17T17:06:00.000+08:00
DEBUG 2025/12/17 17:07:00 Time To: 2025-12-17T17:07:00.000+08:00
DEBUG 2025/12/17 17:07:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:06:00.000+08:00",
					"lte": "2025-12-17T17:07:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:07:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:07:00 ES Response IsError: false
DEBUG 2025/12/17 17:07:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":520,"buckets":[{"key":"黑快馬主機","doc_count":1517},{"key":"花蓮高農","doc_count":771},{"key":"仁愛高農","doc_count":605},{"key":"金門農工","doc_count":605},{"key":"新竹女中","doc_count":582},{"key":"南投高商","doc_count":549},{"key":"花蓮高商","doc_count":526},{"key":"金門高中","doc_count":504},{"key":"旗美高中","doc_count":503},{"key":"宜蘭高商","doc_count":418},{"key":"華僑高中","doc_count":415},{"key":"北門高中","doc_count":392},{"key":"竹北高中","doc_count":388},{"key":"中大壢中","doc_count":381},{"key":"新港藝高","doc_count":364},{"key":"內埔農工","doc_count":362},{"key":"臺東高中","doc_count":321},{"key":"蘇澳海事","doc_count":318},{"key":"興大附中","doc_count":304},{"key":"後壁高中","doc_count":294},{"key":"玉里高中","doc_count":250},{"key":"竹南高中","doc_count":248},{"key":"清華附小","doc_count":221},{"key":"關西高中","doc_count":202},{"key":"關山工商","doc_count":201},{"key":"北斗家商","doc_count":195},{"key":"南投特教","doc_count":191},{"key":"斗六家商","doc_count":187},{"key":"屏東女中","doc_count":185},{"key":"東港海事","doc_count":172},{"key":"苗栗農工","doc_count":170},{"key":"成大南工","doc_count":166},{"key":"嘉義高商","doc_count":150},{"key":"新營高工","doc_count":146},{"key":"新化高中","doc_count":135},{"key":"新化高工","doc_count":125},{"key":"員林家商","doc_count":124},{"key":"中興高中","doc_count":122},{"key":"虎尾高中","doc_count":117},{"key":"師大附中高中部","doc_count":111},{"key":"南大附聰","doc_count":105},{"key":"屏科實中","doc_count":103},{"key":"草屯商工","doc_count":97},{"key":"二林工商","doc_count":93},{"key":"北港高中","doc_count":92},{"key":"南投高中","doc_count":92},{"key":"雲林特教","doc_count":91},{"key":"彰師附工","doc_count":90},{"key":"鳳山高中","doc_count":89},{"key":"員林農工","doc_count":86},{"key":"臺南高商","doc_count":86},{"key":"新營高中","doc_count":85},{"key":"新竹高工","doc_count":85},{"key":"花蓮高工","doc_count":83},{"key":"北教大實小","doc_count":79},{"key":"員林高中","doc_count":78},{"key":"南大附中","doc_count":77},{"key":"南大附小","doc_count":74},{"key":"屏東高中","doc_count":74},{"key":"苗栗高商","doc_count":74},{"key":"嘉義家職","doc_count":73},{"key":"嘉義高中","doc_count":71},{"key":"新竹高中","doc_count":70},{"key":"北港農工","doc_count":69},{"key":"嘉科實中","doc_count":69},{"key":"永靖高工","doc_count":67},{"key":"基隆商工","doc_count":64},{"key":"水里商工","doc_count":64},{"key":"政大附中","doc_count":63},{"key":"潮州高中","doc_count":63},{"key":"興大附農","doc_count":63},{"key":"秀水高工","doc_count":62},{"key":"善化高中","doc_count":61},{"key":"新竹特教","doc_count":60},{"key":"頭城家商","doc_count":60},{"key":"彰化高商","doc_count":59},{"key":"臺東高商","doc_count":59},{"key":"崇實高工","doc_count":58},{"key":"羅東高商","doc_count":58},{"key":"嘉義高工","doc_count":57},{"key":"曾文農工","doc_count":56},{"key":"溪湖高中","doc_count":56},{"key":"臺南一中","doc_count":55},{"key":"宜蘭高中","doc_count":51},{"key":"白河商工","doc_count":51},{"key":"竹山高中","doc_count":49},{"key":"暨大附中","doc_count":48},{"key":"澎湖海事","doc_count":46},{"key":"竹東高中","doc_count":46},{"key":"華南高商","doc_count":46},{"key":"嘉義特教","doc_count":45},{"key":"新竹高商","doc_count":45},{"key":"海大附中","doc_count":44},{"key":"羅東高工","doc_count":44},{"key":"花蓮特教","doc_count":42},{"key":"高餐大附中","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"屏東特教","doc_count":41},{"key":"土庫商工","doc_count":40},{"key":"旗山農工","doc_count":40}]}}}
DEBUG 2025/12/17 17:07:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:07:00   Bucket[0]: Key=黑快馬主機, DocCount=1517
DEBUG 2025/12/17 17:07:00   Bucket[1]: Key=花蓮高農, DocCount=771
DEBUG 2025/12/17 17:07:00   Bucket[2]: Key=仁愛高農, DocCount=605
DEBUG 2025/12/17 17:07:00   Bucket[3]: Key=金門農工, DocCount=605
DEBUG 2025/12/17 17:07:00   Bucket[4]: Key=新竹女中, DocCount=582
DEBUG 2025/12/17 17:07:00   Bucket[5]: Key=南投高商, DocCount=549
DEBUG 2025/12/17 17:07:00   Bucket[6]: Key=花蓮高商, DocCount=526
DEBUG 2025/12/17 17:07:00   Bucket[7]: Key=金門高中, DocCount=504
DEBUG 2025/12/17 17:07:00   Bucket[8]: Key=旗美高中, DocCount=503
DEBUG 2025/12/17 17:07:00   Bucket[9]: Key=宜蘭高商, DocCount=418
DEBUG 2025/12/17 17:07:00   Bucket[10]: Key=華僑高中, DocCount=415
DEBUG 2025/12/17 17:07:00   Bucket[11]: Key=北門高中, DocCount=392
DEBUG 2025/12/17 17:07:00   Bucket[12]: Key=竹北高中, DocCount=388
DEBUG 2025/12/17 17:07:00   Bucket[13]: Key=中大壢中, DocCount=381
DEBUG 2025/12/17 17:07:00   Bucket[14]: Key=新港藝高, DocCount=364
DEBUG 2025/12/17 17:07:00   Bucket[15]: Key=內埔農工, DocCount=362
DEBUG 2025/12/17 17:07:00   Bucket[16]: Key=臺東高中, DocCount=321
DEBUG 2025/12/17 17:07:00   Bucket[17]: Key=蘇澳海事, DocCount=318
DEBUG 2025/12/17 17:07:00   Bucket[18]: Key=興大附中, DocCount=304
DEBUG 2025/12/17 17:07:00   Bucket[19]: Key=後壁高中, DocCount=294
DEBUG 2025/12/17 17:07:00   Bucket[20]: Key=玉里高中, DocCount=250
DEBUG 2025/12/17 17:07:00   Bucket[21]: Key=竹南高中, DocCount=248
DEBUG 2025/12/17 17:07:00   Bucket[22]: Key=清華附小, DocCount=221
DEBUG 2025/12/17 17:07:00   Bucket[23]: Key=關西高中, DocCount=202
DEBUG 2025/12/17 17:07:00   Bucket[24]: Key=關山工商, DocCount=201
DEBUG 2025/12/17 17:07:00   Bucket[25]: Key=北斗家商, DocCount=195
DEBUG 2025/12/17 17:07:00   Bucket[26]: Key=南投特教, DocCount=191
DEBUG 2025/12/17 17:07:00   Bucket[27]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:07:00   Bucket[28]: Key=屏東女中, DocCount=185
DEBUG 2025/12/17 17:07:00   Bucket[29]: Key=東港海事, DocCount=172
DEBUG 2025/12/17 17:07:00   Bucket[30]: Key=苗栗農工, DocCount=170
DEBUG 2025/12/17 17:07:00   Bucket[31]: Key=成大南工, DocCount=166
DEBUG 2025/12/17 17:07:00   Bucket[32]: Key=嘉義高商, DocCount=150
DEBUG 2025/12/17 17:07:00   Bucket[33]: Key=新營高工, DocCount=146
DEBUG 2025/12/17 17:07:00   Bucket[34]: Key=新化高中, DocCount=135
DEBUG 2025/12/17 17:07:00   Bucket[35]: Key=新化高工, DocCount=125
DEBUG 2025/12/17 17:07:00   Bucket[36]: Key=員林家商, DocCount=124
DEBUG 2025/12/17 17:07:00   Bucket[37]: Key=中興高中, DocCount=122
DEBUG 2025/12/17 17:07:00   Bucket[38]: Key=虎尾高中, DocCount=117
DEBUG 2025/12/17 17:07:00   Bucket[39]: Key=師大附中高中部, DocCount=111
DEBUG 2025/12/17 17:07:00   Bucket[40]: Key=南大附聰, DocCount=105
DEBUG 2025/12/17 17:07:00   Bucket[41]: Key=屏科實中, DocCount=103
DEBUG 2025/12/17 17:07:00   Bucket[42]: Key=草屯商工, DocCount=97
DEBUG 2025/12/17 17:07:00   Bucket[43]: Key=二林工商, DocCount=93
DEBUG 2025/12/17 17:07:00   Bucket[44]: Key=北港高中, DocCount=92
DEBUG 2025/12/17 17:07:00   Bucket[45]: Key=南投高中, DocCount=92
DEBUG 2025/12/17 17:07:00   Bucket[46]: Key=雲林特教, DocCount=91
DEBUG 2025/12/17 17:07:00   Bucket[47]: Key=彰師附工, DocCount=90
DEBUG 2025/12/17 17:07:00   Bucket[48]: Key=鳳山高中, DocCount=89
DEBUG 2025/12/17 17:07:00   Bucket[49]: Key=員林農工, DocCount=86
DEBUG 2025/12/17 17:07:00   Bucket[50]: Key=臺南高商, DocCount=86
DEBUG 2025/12/17 17:07:00   Bucket[51]: Key=新營高中, DocCount=85
DEBUG 2025/12/17 17:07:00   Bucket[52]: Key=新竹高工, DocCount=85
DEBUG 2025/12/17 17:07:00   Bucket[53]: Key=花蓮高工, DocCount=83
DEBUG 2025/12/17 17:07:00   Bucket[54]: Key=北教大實小, DocCount=79
DEBUG 2025/12/17 17:07:00   Bucket[55]: Key=員林高中, DocCount=78
DEBUG 2025/12/17 17:07:00   Bucket[56]: Key=南大附中, DocCount=77
DEBUG 2025/12/17 17:07:00   Bucket[57]: Key=南大附小, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[58]: Key=屏東高中, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[59]: Key=苗栗高商, DocCount=74
DEBUG 2025/12/17 17:07:00   Bucket[60]: Key=嘉義家職, DocCount=73
DEBUG 2025/12/17 17:07:00   Bucket[61]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:07:00   Bucket[62]: Key=新竹高中, DocCount=70
DEBUG 2025/12/17 17:07:00   Bucket[63]: Key=北港農工, DocCount=69
DEBUG 2025/12/17 17:07:00   Bucket[64]: Key=嘉科實中, DocCount=69
DEBUG 2025/12/17 17:07:00   Bucket[65]: Key=永靖高工, DocCount=67
DEBUG 2025/12/17 17:07:00   Bucket[66]: Key=基隆商工, DocCount=64
DEBUG 2025/12/17 17:07:00   Bucket[67]: Key=水里商工, DocCount=64
DEBUG 2025/12/17 17:07:00   Bucket[68]: Key=政大附中, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[69]: Key=潮州高中, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[70]: Key=興大附農, DocCount=63
DEBUG 2025/12/17 17:07:00   Bucket[71]: Key=秀水高工, DocCount=62
DEBUG 2025/12/17 17:07:00   Bucket[72]: Key=善化高中, DocCount=61
DEBUG 2025/12/17 17:07:00   Bucket[73]: Key=新竹特教, DocCount=60
DEBUG 2025/12/17 17:07:00   Bucket[74]: Key=頭城家商, DocCount=60
DEBUG 2025/12/17 17:07:00   Bucket[75]: Key=彰化高商, DocCount=59
DEBUG 2025/12/17 17:07:00   Bucket[76]: Key=臺東高商, DocCount=59
DEBUG 2025/12/17 17:07:00   Bucket[77]: Key=崇實高工, DocCount=58
DEBUG 2025/12/17 17:07:00   Bucket[78]: Key=羅東高商, DocCount=58
DEBUG 2025/12/17 17:07:00   Bucket[79]: Key=嘉義高工, DocCount=57
DEBUG 2025/12/17 17:07:00   Bucket[80]: Key=曾文農工, DocCount=56
DEBUG 2025/12/17 17:07:00   Bucket[81]: Key=溪湖高中, DocCount=56
DEBUG 2025/12/17 17:07:00   Bucket[82]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:07:00   Bucket[83]: Key=宜蘭高中, DocCount=51
DEBUG 2025/12/17 17:07:00   Bucket[84]: Key=白河商工, DocCount=51
DEBUG 2025/12/17 17:07:00   Bucket[85]: Key=竹山高中, DocCount=49
DEBUG 2025/12/17 17:07:00   Bucket[86]: Key=暨大附中, DocCount=48
DEBUG 2025/12/17 17:07:00   Bucket[87]: Key=澎湖海事, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[88]: Key=竹東高中, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[89]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:07:00   Bucket[90]: Key=嘉義特教, DocCount=45
DEBUG 2025/12/17 17:07:00   Bucket[91]: Key=新竹高商, DocCount=45
DEBUG 2025/12/17 17:07:00   Bucket[92]: Key=海大附中, DocCount=44
DEBUG 2025/12/17 17:07:00   Bucket[93]: Key=羅東高工, DocCount=44
DEBUG 2025/12/17 17:07:00   Bucket[94]: Key=花蓮特教, DocCount=42
DEBUG 2025/12/17 17:07:00   Bucket[95]: Key=高餐大附中, DocCount=42
DEBUG 2025/12/17 17:07:00   Bucket[96]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:07:00   Bucket[97]: Key=屏東特教, DocCount=41
DEBUG 2025/12/17 17:07:00   Bucket[98]: Key=土庫商工, DocCount=40
DEBUG 2025/12/17 17:07:00   Bucket[99]: Key=旗山農工, DocCount=40
DEBUG 2025/12/17 17:07:00 ========================================================
INFO 2025/12/17 17:07:08 ✅ Successfully flushed 26/26 history records to TimescaleDB
INFO 2025/12/17 17:07:13 ✅ Successfully flushed 44/44 history records to TimescaleDB
INFO 2025/12/17 17:07:17 Processing 15 offline devices
INFO 2025/12/17 17:07:17 Creating history record for offline device: 屏東高工
INFO 2025/12/17 17:07:17 About to add history to batch for device: 屏東高工
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 屏東高工
INFO 2025/12/17 17:07:17 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:07:17 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:07:17 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:07:17 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:07:17 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:07:17 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:07:17 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:07:17 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:07:17 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:07:18 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:07:18 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:07:18 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:07:18 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:07:18 ✅ Successfully flushed 36/36 history records to TimescaleDB
INFO 2025/12/17 17:07:18 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:07:18 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:07:18 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:07:19 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:07:19 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:07:19 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:07:19 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:07:19 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:07:19 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:07:19 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:07:19 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:07:19 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:07:19 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:07:20 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:07:23 ✅ Successfully flushed 9/9 history records to TimescaleDB
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:07:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:07:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:07:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:07:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:07:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:07:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:07:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:07:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:07:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:07:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:07:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:07:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:07:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:07:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:07:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:07:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:07:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:07:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:07:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.80% (threshold: 80.00%)
INFO 2025/12/17 17:07:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:07:45 ES Alert Created [high][capacity]: Disk usage high: 93.22% (threshold: 85.00%)
WARN 2025/12/17 17:07:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:07:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:07:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:07:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:07:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:07:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:07:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:07:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:08:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:08:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:08:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:08:00 Field: school_name.keyword
DEBUG 2025/12/17 17:08:00 Time From: 2025-12-17T17:07:00.000+08:00
DEBUG 2025/12/17 17:08:00 Time To: 2025-12-17T17:08:00.000+08:00
DEBUG 2025/12/17 17:08:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:07:00.000+08:00",
					"lte": "2025-12-17T17:08:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:08:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:08:00 ES Response IsError: false
DEBUG 2025/12/17 17:08:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":481,"buckets":[{"key":"黑快馬主機","doc_count":1724},{"key":"花蓮高農","doc_count":796},{"key":"新竹女中","doc_count":681},{"key":"金門農工","doc_count":630},{"key":"仁愛高農","doc_count":588},{"key":"南投高商","doc_count":529},{"key":"旗美高中","doc_count":483},{"key":"金門高中","doc_count":481},{"key":"宜蘭高商","doc_count":480},{"key":"竹北高中","doc_count":458},{"key":"花蓮高商","doc_count":431},{"key":"北門高中","doc_count":380},{"key":"華僑高中","doc_count":380},{"key":"興大附中","doc_count":367},{"key":"清華附小","doc_count":355},{"key":"臺東高中","doc_count":353},{"key":"政大附中","doc_count":334},{"key":"內埔農工","doc_count":317},{"key":"中大壢中","doc_count":303},{"key":"關西高中","doc_count":290},{"key":"新港藝高","doc_count":288},{"key":"蘇澳海事","doc_count":280},{"key":"竹南高中","doc_count":275},{"key":"關山工商","doc_count":233},{"key":"後壁高中","doc_count":218},{"key":"成大南工","doc_count":208},{"key":"南投特教","doc_count":201},{"key":"新化高中","doc_count":187},{"key":"斗六家商","doc_count":177},{"key":"新化高工","doc_count":177},{"key":"苗栗農工","doc_count":174},{"key":"玉里高中","doc_count":170},{"key":"東港海事","doc_count":162},{"key":"屏東女中","doc_count":147},{"key":"嘉義高商","doc_count":144},{"key":"虎尾高中","doc_count":142},{"key":"南大附聰","doc_count":126},{"key":"新營高工","doc_count":121},{"key":"彰師附工","doc_count":117},{"key":"苗栗高商","doc_count":116},{"key":"員林家商","doc_count":113},{"key":"新豐高中","doc_count":113},{"key":"師大附中高中部","doc_count":109},{"key":"中興高中","doc_count":100},{"key":"暨大附中","doc_count":98},{"key":"員林農工","doc_count":88},{"key":"屏科實中","doc_count":86},{"key":"臺南高商","doc_count":86},{"key":"北港高中","doc_count":80},{"key":"南投高中","doc_count":80},{"key":"新營高中","doc_count":79},{"key":"草屯商工","doc_count":79},{"key":"嘉義高中","doc_count":78},{"key":"南大附中","doc_count":77},{"key":"北斗家商","doc_count":76},{"key":"水里商工","doc_count":76},{"key":"嘉義家職","doc_count":73},{"key":"曾文農工","doc_count":73},{"key":"白河商工","doc_count":72},{"key":"臺南一中","doc_count":67},{"key":"秀水高工","doc_count":66},{"key":"潮州高中","doc_count":65},{"key":"北教大實小","doc_count":63},{"key":"嘉科實中","doc_count":63},{"key":"雲林特教","doc_count":63},{"key":"溪湖高中","doc_count":62},{"key":"臺東高商","doc_count":62},{"key":"花蓮高工","doc_count":62},{"key":"鳳山高中","doc_count":62},{"key":"基隆商工","doc_count":61},{"key":"屏東高工","doc_count":60},{"key":"新竹高工","doc_count":59},{"key":"彰化高商","doc_count":58},{"key":"新竹高中","doc_count":58},{"key":"高餐大附中","doc_count":58},{"key":"員林高中","doc_count":57},{"key":"苗栗高中","doc_count":56},{"key":"崇實高工","doc_count":55},{"key":"東石高中","doc_count":55},{"key":"屏東高中","doc_count":54},{"key":"新竹高商","doc_count":54},{"key":"海大附中","doc_count":54},{"key":"北港農工","doc_count":53},{"key":"花蓮特教","doc_count":51},{"key":"土庫商工","doc_count":50},{"key":"頭城家商","doc_count":50},{"key":"二林工商","doc_count":48},{"key":"竹山高中","doc_count":48},{"key":"屏東特教","doc_count":46},{"key":"羅東高商","doc_count":46},{"key":"佳冬高農","doc_count":45},{"key":"嘉義高工","doc_count":45},{"key":"嘉義特教","doc_count":44},{"key":"家齊高中","doc_count":44},{"key":"永靖高工","doc_count":44},{"key":"埔里高工","doc_count":43},{"key":"師大附中國中部","doc_count":43},{"key":"興大附農","doc_count":43},{"key":"南大附小","doc_count":42},{"key":"善化高中","doc_count":41}]}}}
DEBUG 2025/12/17 17:08:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:08:00   Bucket[0]: Key=黑快馬主機, DocCount=1724
DEBUG 2025/12/17 17:08:00   Bucket[1]: Key=花蓮高農, DocCount=796
DEBUG 2025/12/17 17:08:00   Bucket[2]: Key=新竹女中, DocCount=681
DEBUG 2025/12/17 17:08:00   Bucket[3]: Key=金門農工, DocCount=630
DEBUG 2025/12/17 17:08:00   Bucket[4]: Key=仁愛高農, DocCount=588
DEBUG 2025/12/17 17:08:00   Bucket[5]: Key=南投高商, DocCount=529
DEBUG 2025/12/17 17:08:00   Bucket[6]: Key=旗美高中, DocCount=483
DEBUG 2025/12/17 17:08:00   Bucket[7]: Key=金門高中, DocCount=481
DEBUG 2025/12/17 17:08:00   Bucket[8]: Key=宜蘭高商, DocCount=480
DEBUG 2025/12/17 17:08:00   Bucket[9]: Key=竹北高中, DocCount=458
DEBUG 2025/12/17 17:08:00   Bucket[10]: Key=花蓮高商, DocCount=431
DEBUG 2025/12/17 17:08:00   Bucket[11]: Key=北門高中, DocCount=380
DEBUG 2025/12/17 17:08:00   Bucket[12]: Key=華僑高中, DocCount=380
DEBUG 2025/12/17 17:08:00   Bucket[13]: Key=興大附中, DocCount=367
DEBUG 2025/12/17 17:08:00   Bucket[14]: Key=清華附小, DocCount=355
DEBUG 2025/12/17 17:08:00   Bucket[15]: Key=臺東高中, DocCount=353
DEBUG 2025/12/17 17:08:00   Bucket[16]: Key=政大附中, DocCount=334
DEBUG 2025/12/17 17:08:00   Bucket[17]: Key=內埔農工, DocCount=317
DEBUG 2025/12/17 17:08:00   Bucket[18]: Key=中大壢中, DocCount=303
DEBUG 2025/12/17 17:08:00   Bucket[19]: Key=關西高中, DocCount=290
DEBUG 2025/12/17 17:08:00   Bucket[20]: Key=新港藝高, DocCount=288
DEBUG 2025/12/17 17:08:00   Bucket[21]: Key=蘇澳海事, DocCount=280
DEBUG 2025/12/17 17:08:00   Bucket[22]: Key=竹南高中, DocCount=275
DEBUG 2025/12/17 17:08:00   Bucket[23]: Key=關山工商, DocCount=233
DEBUG 2025/12/17 17:08:00   Bucket[24]: Key=後壁高中, DocCount=218
DEBUG 2025/12/17 17:08:00   Bucket[25]: Key=成大南工, DocCount=208
DEBUG 2025/12/17 17:08:00   Bucket[26]: Key=南投特教, DocCount=201
DEBUG 2025/12/17 17:08:00   Bucket[27]: Key=新化高中, DocCount=187
DEBUG 2025/12/17 17:08:00   Bucket[28]: Key=斗六家商, DocCount=177
DEBUG 2025/12/17 17:08:00   Bucket[29]: Key=新化高工, DocCount=177
DEBUG 2025/12/17 17:08:00   Bucket[30]: Key=苗栗農工, DocCount=174
DEBUG 2025/12/17 17:08:00   Bucket[31]: Key=玉里高中, DocCount=170
DEBUG 2025/12/17 17:08:00   Bucket[32]: Key=東港海事, DocCount=162
DEBUG 2025/12/17 17:08:00   Bucket[33]: Key=屏東女中, DocCount=147
DEBUG 2025/12/17 17:08:00   Bucket[34]: Key=嘉義高商, DocCount=144
DEBUG 2025/12/17 17:08:00   Bucket[35]: Key=虎尾高中, DocCount=142
DEBUG 2025/12/17 17:08:00   Bucket[36]: Key=南大附聰, DocCount=126
DEBUG 2025/12/17 17:08:00   Bucket[37]: Key=新營高工, DocCount=121
DEBUG 2025/12/17 17:08:00   Bucket[38]: Key=彰師附工, DocCount=117
DEBUG 2025/12/17 17:08:00   Bucket[39]: Key=苗栗高商, DocCount=116
DEBUG 2025/12/17 17:08:00   Bucket[40]: Key=員林家商, DocCount=113
DEBUG 2025/12/17 17:08:00   Bucket[41]: Key=新豐高中, DocCount=113
DEBUG 2025/12/17 17:08:00   Bucket[42]: Key=師大附中高中部, DocCount=109
DEBUG 2025/12/17 17:08:00   Bucket[43]: Key=中興高中, DocCount=100
DEBUG 2025/12/17 17:08:00   Bucket[44]: Key=暨大附中, DocCount=98
DEBUG 2025/12/17 17:08:00   Bucket[45]: Key=員林農工, DocCount=88
DEBUG 2025/12/17 17:08:00   Bucket[46]: Key=屏科實中, DocCount=86
DEBUG 2025/12/17 17:08:00   Bucket[47]: Key=臺南高商, DocCount=86
DEBUG 2025/12/17 17:08:00   Bucket[48]: Key=北港高中, DocCount=80
DEBUG 2025/12/17 17:08:00   Bucket[49]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:08:00   Bucket[50]: Key=新營高中, DocCount=79
DEBUG 2025/12/17 17:08:00   Bucket[51]: Key=草屯商工, DocCount=79
DEBUG 2025/12/17 17:08:00   Bucket[52]: Key=嘉義高中, DocCount=78
DEBUG 2025/12/17 17:08:00   Bucket[53]: Key=南大附中, DocCount=77
DEBUG 2025/12/17 17:08:00   Bucket[54]: Key=北斗家商, DocCount=76
DEBUG 2025/12/17 17:08:00   Bucket[55]: Key=水里商工, DocCount=76
DEBUG 2025/12/17 17:08:00   Bucket[56]: Key=嘉義家職, DocCount=73
DEBUG 2025/12/17 17:08:00   Bucket[57]: Key=曾文農工, DocCount=73
DEBUG 2025/12/17 17:08:00   Bucket[58]: Key=白河商工, DocCount=72
DEBUG 2025/12/17 17:08:00   Bucket[59]: Key=臺南一中, DocCount=67
DEBUG 2025/12/17 17:08:00   Bucket[60]: Key=秀水高工, DocCount=66
DEBUG 2025/12/17 17:08:00   Bucket[61]: Key=潮州高中, DocCount=65
DEBUG 2025/12/17 17:08:00   Bucket[62]: Key=北教大實小, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[63]: Key=嘉科實中, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[64]: Key=雲林特教, DocCount=63
DEBUG 2025/12/17 17:08:00   Bucket[65]: Key=溪湖高中, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[66]: Key=臺東高商, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[67]: Key=花蓮高工, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[68]: Key=鳳山高中, DocCount=62
DEBUG 2025/12/17 17:08:00   Bucket[69]: Key=基隆商工, DocCount=61
DEBUG 2025/12/17 17:08:00   Bucket[70]: Key=屏東高工, DocCount=60
DEBUG 2025/12/17 17:08:00   Bucket[71]: Key=新竹高工, DocCount=59
DEBUG 2025/12/17 17:08:00   Bucket[72]: Key=彰化高商, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[73]: Key=新竹高中, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[74]: Key=高餐大附中, DocCount=58
DEBUG 2025/12/17 17:08:00   Bucket[75]: Key=員林高中, DocCount=57
DEBUG 2025/12/17 17:08:00   Bucket[76]: Key=苗栗高中, DocCount=56
DEBUG 2025/12/17 17:08:00   Bucket[77]: Key=崇實高工, DocCount=55
DEBUG 2025/12/17 17:08:00   Bucket[78]: Key=東石高中, DocCount=55
DEBUG 2025/12/17 17:08:00   Bucket[79]: Key=屏東高中, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[80]: Key=新竹高商, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[81]: Key=海大附中, DocCount=54
DEBUG 2025/12/17 17:08:00   Bucket[82]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:08:00   Bucket[83]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 17:08:00   Bucket[84]: Key=土庫商工, DocCount=50
DEBUG 2025/12/17 17:08:00   Bucket[85]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:08:00   Bucket[86]: Key=二林工商, DocCount=48
DEBUG 2025/12/17 17:08:00   Bucket[87]: Key=竹山高中, DocCount=48
DEBUG 2025/12/17 17:08:00   Bucket[88]: Key=屏東特教, DocCount=46
DEBUG 2025/12/17 17:08:00   Bucket[89]: Key=羅東高商, DocCount=46
DEBUG 2025/12/17 17:08:00   Bucket[90]: Key=佳冬高農, DocCount=45
DEBUG 2025/12/17 17:08:00   Bucket[91]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:08:00   Bucket[92]: Key=嘉義特教, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[93]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[94]: Key=永靖高工, DocCount=44
DEBUG 2025/12/17 17:08:00   Bucket[95]: Key=埔里高工, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[96]: Key=師大附中國中部, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[97]: Key=興大附農, DocCount=43
DEBUG 2025/12/17 17:08:00   Bucket[98]: Key=南大附小, DocCount=42
DEBUG 2025/12/17 17:08:00   Bucket[99]: Key=善化高中, DocCount=41
DEBUG 2025/12/17 17:08:00 ========================================================
INFO 2025/12/17 17:08:03 ✅ Successfully flushed 10/10 history records to TimescaleDB
INFO 2025/12/17 17:08:06 ✅ Successfully flushed 50/60 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:08:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:08:08 Processing 15 offline devices
INFO 2025/12/17 17:08:08 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:08:08 ✅ Successfully flushed 20/20 history records to TimescaleDB
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:08:08 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:08:08 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:08:08 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:08:08 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:08:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:08:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:08:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:08:08 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:08:08 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:08:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:08:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:08:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:08:08 Creating history record for offline device: 宜蘭高中
INFO 2025/12/17 17:08:08 About to add history to batch for device: 宜蘭高中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 宜蘭高中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:08:09 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:08:09 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:08:09 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:08:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:08:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:08:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:08:09 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:08:09 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:08:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:08:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:08:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:08:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:08:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:08:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:08:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:08:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:08:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:08:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:08:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:08:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:08:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:08:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:08:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:08:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:08:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:08:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:08:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:08:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:08:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:08:45 ES Alert Created [critical][performance]: Memory usage critical: 90.01% (threshold: 90.00%)
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.25% (threshold: 85.00%)
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:08:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:08:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:08:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:08:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:08:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:09:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:09:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:09:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:09:00 Field: school_name.keyword
DEBUG 2025/12/17 17:09:00 Time From: 2025-12-17T17:08:00.000+08:00
DEBUG 2025/12/17 17:09:00 Time To: 2025-12-17T17:09:00.000+08:00
DEBUG 2025/12/17 17:09:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:08:00.000+08:00",
					"lte": "2025-12-17T17:09:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:09:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:09:00 ES Response IsError: false
DEBUG 2025/12/17 17:09:00 ES Response Body:
{"took":61,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":1279},{"key":"花蓮高農","doc_count":733},{"key":"新竹女中","doc_count":625},{"key":"仁愛高農","doc_count":591},{"key":"金門農工","doc_count":522},{"key":"旗美高中","doc_count":487},{"key":"金門高中","doc_count":471},{"key":"宜蘭高商","doc_count":426},{"key":"花蓮高商","doc_count":396},{"key":"南投高商","doc_count":381},{"key":"竹北高中","doc_count":379},{"key":"華僑高中","doc_count":345},{"key":"清華附小","doc_count":344},{"key":"竹南高中","doc_count":340},{"key":"中大壢中","doc_count":322},{"key":"臺東高中","doc_count":322},{"key":"興大附中","doc_count":309},{"key":"新港藝高","doc_count":300},{"key":"內埔農工","doc_count":286},{"key":"蘇澳海事","doc_count":270},{"key":"關山工商","doc_count":253},{"key":"關西高中","doc_count":244},{"key":"斗六家商","doc_count":243},{"key":"玉里高中","doc_count":221},{"key":"高餐大附中","doc_count":203},{"key":"後壁高中","doc_count":195},{"key":"新化高工","doc_count":172},{"key":"苗栗農工","doc_count":167},{"key":"嘉義高商","doc_count":161},{"key":"嘉科實中","doc_count":158},{"key":"新營高工","doc_count":156},{"key":"新化高中","doc_count":154},{"key":"虎尾高中","doc_count":153},{"key":"南投特教","doc_count":150},{"key":"屏東女中","doc_count":147},{"key":"水里商工","doc_count":146},{"key":"北斗家商","doc_count":145},{"key":"新竹高工","doc_count":144},{"key":"南大附中","doc_count":143},{"key":"成大南工","doc_count":135},{"key":"東港海事","doc_count":132},{"key":"澎湖海事","doc_count":130},{"key":"彰師附工","doc_count":126},{"key":"南大附聰","doc_count":115},{"key":"員林家商","doc_count":115},{"key":"政大附中","doc_count":106},{"key":"師大附中高中部","doc_count":101},{"key":"苗栗高商","doc_count":100},{"key":"員林農工","doc_count":94},{"key":"新竹高中","doc_count":91},{"key":"新營高中","doc_count":89},{"key":"南投高中","doc_count":80},{"key":"中興高中","doc_count":79},{"key":"北教大實小","doc_count":79},{"key":"屏科實中","doc_count":77},{"key":"雲林特教","doc_count":75},{"key":"苗栗高中","doc_count":73},{"key":"草屯商工","doc_count":72},{"key":"秀水高工","doc_count":71},{"key":"北港農工","doc_count":68},{"key":"鳳山高中","doc_count":67},{"key":"二林工商","doc_count":66},{"key":"嘉義高中","doc_count":65},{"key":"北港高中","doc_count":64},{"key":"屏東高工","doc_count":63},{"key":"永靖高工","doc_count":63},{"key":"白河商工","doc_count":62},{"key":"蘭陽女中","doc_count":62},{"key":"彰化高商","doc_count":61},{"key":"北門高中","doc_count":60},{"key":"員林高中","doc_count":60},{"key":"海大附中","doc_count":60},{"key":"嘉義特教","doc_count":58},{"key":"頭城家商","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"東石高中","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"臺南一中","doc_count":55},{"key":"竹東高中","doc_count":54},{"key":"埔里高工","doc_count":53},{"key":"溪湖高中","doc_count":53},{"key":"興大附農","doc_count":53},{"key":"新竹高商","doc_count":52},{"key":"佳冬高農","doc_count":51},{"key":"新豐高中","doc_count":51},{"key":"竹山高中","doc_count":51},{"key":"潮州高中","doc_count":50},{"key":"嘉義家職","doc_count":49},{"key":"屏東高中","doc_count":49},{"key":"南大附小","doc_count":47},{"key":"花蓮高工","doc_count":47},{"key":"花蓮特教","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"基隆商工","doc_count":45},{"key":"暨大附中","doc_count":45},{"key":"羅東高商","doc_count":45},{"key":"屏東特教","doc_count":43},{"key":"羅東高工","doc_count":42},{"key":"華南高商","doc_count":40},{"key":"土庫商工","doc_count":39}]}}}
DEBUG 2025/12/17 17:09:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:09:00   Bucket[0]: Key=黑快馬主機, DocCount=1279
DEBUG 2025/12/17 17:09:00   Bucket[1]: Key=花蓮高農, DocCount=733
DEBUG 2025/12/17 17:09:00   Bucket[2]: Key=新竹女中, DocCount=625
DEBUG 2025/12/17 17:09:00   Bucket[3]: Key=仁愛高農, DocCount=591
DEBUG 2025/12/17 17:09:00   Bucket[4]: Key=金門農工, DocCount=522
DEBUG 2025/12/17 17:09:00   Bucket[5]: Key=旗美高中, DocCount=487
DEBUG 2025/12/17 17:09:00   Bucket[6]: Key=金門高中, DocCount=471
DEBUG 2025/12/17 17:09:00   Bucket[7]: Key=宜蘭高商, DocCount=426
DEBUG 2025/12/17 17:09:00   Bucket[8]: Key=花蓮高商, DocCount=396
DEBUG 2025/12/17 17:09:00   Bucket[9]: Key=南投高商, DocCount=381
DEBUG 2025/12/17 17:09:00   Bucket[10]: Key=竹北高中, DocCount=379
DEBUG 2025/12/17 17:09:00   Bucket[11]: Key=華僑高中, DocCount=345
DEBUG 2025/12/17 17:09:00   Bucket[12]: Key=清華附小, DocCount=344
DEBUG 2025/12/17 17:09:00   Bucket[13]: Key=竹南高中, DocCount=340
DEBUG 2025/12/17 17:09:00   Bucket[14]: Key=中大壢中, DocCount=322
DEBUG 2025/12/17 17:09:00   Bucket[15]: Key=臺東高中, DocCount=322
DEBUG 2025/12/17 17:09:00   Bucket[16]: Key=興大附中, DocCount=309
DEBUG 2025/12/17 17:09:00   Bucket[17]: Key=新港藝高, DocCount=300
DEBUG 2025/12/17 17:09:00   Bucket[18]: Key=內埔農工, DocCount=286
DEBUG 2025/12/17 17:09:00   Bucket[19]: Key=蘇澳海事, DocCount=270
DEBUG 2025/12/17 17:09:00   Bucket[20]: Key=關山工商, DocCount=253
DEBUG 2025/12/17 17:09:00   Bucket[21]: Key=關西高中, DocCount=244
DEBUG 2025/12/17 17:09:00   Bucket[22]: Key=斗六家商, DocCount=243
DEBUG 2025/12/17 17:09:00   Bucket[23]: Key=玉里高中, DocCount=221
DEBUG 2025/12/17 17:09:00   Bucket[24]: Key=高餐大附中, DocCount=203
DEBUG 2025/12/17 17:09:00   Bucket[25]: Key=後壁高中, DocCount=195
DEBUG 2025/12/17 17:09:00   Bucket[26]: Key=新化高工, DocCount=172
DEBUG 2025/12/17 17:09:00   Bucket[27]: Key=苗栗農工, DocCount=167
DEBUG 2025/12/17 17:09:00   Bucket[28]: Key=嘉義高商, DocCount=161
DEBUG 2025/12/17 17:09:00   Bucket[29]: Key=嘉科實中, DocCount=158
DEBUG 2025/12/17 17:09:00   Bucket[30]: Key=新營高工, DocCount=156
DEBUG 2025/12/17 17:09:00   Bucket[31]: Key=新化高中, DocCount=154
DEBUG 2025/12/17 17:09:00   Bucket[32]: Key=虎尾高中, DocCount=153
DEBUG 2025/12/17 17:09:00   Bucket[33]: Key=南投特教, DocCount=150
DEBUG 2025/12/17 17:09:00   Bucket[34]: Key=屏東女中, DocCount=147
DEBUG 2025/12/17 17:09:00   Bucket[35]: Key=水里商工, DocCount=146
DEBUG 2025/12/17 17:09:00   Bucket[36]: Key=北斗家商, DocCount=145
DEBUG 2025/12/17 17:09:00   Bucket[37]: Key=新竹高工, DocCount=144
DEBUG 2025/12/17 17:09:00   Bucket[38]: Key=南大附中, DocCount=143
DEBUG 2025/12/17 17:09:00   Bucket[39]: Key=成大南工, DocCount=135
DEBUG 2025/12/17 17:09:00   Bucket[40]: Key=東港海事, DocCount=132
DEBUG 2025/12/17 17:09:00   Bucket[41]: Key=澎湖海事, DocCount=130
DEBUG 2025/12/17 17:09:00   Bucket[42]: Key=彰師附工, DocCount=126
DEBUG 2025/12/17 17:09:00   Bucket[43]: Key=南大附聰, DocCount=115
DEBUG 2025/12/17 17:09:00   Bucket[44]: Key=員林家商, DocCount=115
DEBUG 2025/12/17 17:09:00   Bucket[45]: Key=政大附中, DocCount=106
DEBUG 2025/12/17 17:09:00   Bucket[46]: Key=師大附中高中部, DocCount=101
DEBUG 2025/12/17 17:09:00   Bucket[47]: Key=苗栗高商, DocCount=100
DEBUG 2025/12/17 17:09:00   Bucket[48]: Key=員林農工, DocCount=94
DEBUG 2025/12/17 17:09:00   Bucket[49]: Key=新竹高中, DocCount=91
DEBUG 2025/12/17 17:09:00   Bucket[50]: Key=新營高中, DocCount=89
DEBUG 2025/12/17 17:09:00   Bucket[51]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:09:00   Bucket[52]: Key=中興高中, DocCount=79
DEBUG 2025/12/17 17:09:00   Bucket[53]: Key=北教大實小, DocCount=79
DEBUG 2025/12/17 17:09:00   Bucket[54]: Key=屏科實中, DocCount=77
DEBUG 2025/12/17 17:09:00   Bucket[55]: Key=雲林特教, DocCount=75
DEBUG 2025/12/17 17:09:00   Bucket[56]: Key=苗栗高中, DocCount=73
DEBUG 2025/12/17 17:09:00   Bucket[57]: Key=草屯商工, DocCount=72
DEBUG 2025/12/17 17:09:00   Bucket[58]: Key=秀水高工, DocCount=71
DEBUG 2025/12/17 17:09:00   Bucket[59]: Key=北港農工, DocCount=68
DEBUG 2025/12/17 17:09:00   Bucket[60]: Key=鳳山高中, DocCount=67
DEBUG 2025/12/17 17:09:00   Bucket[61]: Key=二林工商, DocCount=66
DEBUG 2025/12/17 17:09:00   Bucket[62]: Key=嘉義高中, DocCount=65
DEBUG 2025/12/17 17:09:00   Bucket[63]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:09:00   Bucket[64]: Key=屏東高工, DocCount=63
DEBUG 2025/12/17 17:09:00   Bucket[65]: Key=永靖高工, DocCount=63
DEBUG 2025/12/17 17:09:00   Bucket[66]: Key=白河商工, DocCount=62
DEBUG 2025/12/17 17:09:00   Bucket[67]: Key=蘭陽女中, DocCount=62
DEBUG 2025/12/17 17:09:00   Bucket[68]: Key=彰化高商, DocCount=61
DEBUG 2025/12/17 17:09:00   Bucket[69]: Key=北門高中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[70]: Key=員林高中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[71]: Key=海大附中, DocCount=60
DEBUG 2025/12/17 17:09:00   Bucket[72]: Key=嘉義特教, DocCount=58
DEBUG 2025/12/17 17:09:00   Bucket[73]: Key=頭城家商, DocCount=58
DEBUG 2025/12/17 17:09:00   Bucket[74]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 17:09:00   Bucket[75]: Key=東石高中, DocCount=56
DEBUG 2025/12/17 17:09:00   Bucket[76]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 17:09:00   Bucket[77]: Key=臺南一中, DocCount=55
DEBUG 2025/12/17 17:09:00   Bucket[78]: Key=竹東高中, DocCount=54
DEBUG 2025/12/17 17:09:00   Bucket[79]: Key=埔里高工, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[80]: Key=溪湖高中, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[81]: Key=興大附農, DocCount=53
DEBUG 2025/12/17 17:09:00   Bucket[82]: Key=新竹高商, DocCount=52
DEBUG 2025/12/17 17:09:00   Bucket[83]: Key=佳冬高農, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[84]: Key=新豐高中, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[85]: Key=竹山高中, DocCount=51
DEBUG 2025/12/17 17:09:00   Bucket[86]: Key=潮州高中, DocCount=50
DEBUG 2025/12/17 17:09:00   Bucket[87]: Key=嘉義家職, DocCount=49
DEBUG 2025/12/17 17:09:00   Bucket[88]: Key=屏東高中, DocCount=49
DEBUG 2025/12/17 17:09:00   Bucket[89]: Key=南大附小, DocCount=47
DEBUG 2025/12/17 17:09:00   Bucket[90]: Key=花蓮高工, DocCount=47
DEBUG 2025/12/17 17:09:00   Bucket[91]: Key=花蓮特教, DocCount=46
DEBUG 2025/12/17 17:09:00   Bucket[92]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[93]: Key=基隆商工, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[94]: Key=暨大附中, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[95]: Key=羅東高商, DocCount=45
DEBUG 2025/12/17 17:09:00   Bucket[96]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 17:09:00   Bucket[97]: Key=羅東高工, DocCount=42
DEBUG 2025/12/17 17:09:00   Bucket[98]: Key=華南高商, DocCount=40
DEBUG 2025/12/17 17:09:00   Bucket[99]: Key=土庫商工, DocCount=39
DEBUG 2025/12/17 17:09:00 ========================================================
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:09:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:09:08 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:09:09 Processing 15 offline devices
INFO 2025/12/17 17:09:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:09:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:09:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:09:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:09:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:09:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:09:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:09:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:09:09 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:09:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:09:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:09:10 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:09:10 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:09:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:09:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:09:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:09:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:09:10 Creating history record for offline device: 宜蘭高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 宜蘭高中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 宜蘭高中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:09:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:09:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:09:10 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:09:10 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:09:10 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:09:10 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:09:10 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:09:11 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:09:11 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:09:11 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:09:11 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:09:13 ✅ Successfully flushed 40/40 history records to TimescaleDB
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:09:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:09:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:09:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:09:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:09:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:09:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:09:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:09:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:09:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:09:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:09:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:09:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:09:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:09:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:09:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:09:45 ES Alert Created [high][performance]: Memory usage high: 88.50% (threshold: 80.00%)
INFO 2025/12/17 17:09:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.28% (threshold: 85.00%)
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:09:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:09:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:09:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:09:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:09:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:10:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:10:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:10:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:10:00 Field: school_name.keyword
DEBUG 2025/12/17 17:10:00 Time From: 2025-12-17T17:09:00.000+08:00
DEBUG 2025/12/17 17:10:00 Time To: 2025-12-17T17:10:00.000+08:00
DEBUG 2025/12/17 17:10:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:09:00.000+08:00",
					"lte": "2025-12-17T17:10:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:10:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:10:00 ES Response IsError: false
DEBUG 2025/12/17 17:10:00 ES Response Body:
{"took":126,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":495,"buckets":[{"key":"黑快馬主機","doc_count":1152},{"key":"花蓮高農","doc_count":800},{"key":"新竹女中","doc_count":735},{"key":"仁愛高農","doc_count":626},{"key":"金門農工","doc_count":543},{"key":"金門高中","doc_count":527},{"key":"中大壢中","doc_count":499},{"key":"旗美高中","doc_count":454},{"key":"南投高商","doc_count":447},{"key":"竹北高中","doc_count":433},{"key":"花蓮高商","doc_count":398},{"key":"宜蘭高商","doc_count":382},{"key":"華僑高中","doc_count":333},{"key":"北斗家商","doc_count":325},{"key":"政大附中","doc_count":306},{"key":"臺東高中","doc_count":304},{"key":"興大附中","doc_count":297},{"key":"中興高中","doc_count":291},{"key":"斗六家商","doc_count":288},{"key":"清華附小","doc_count":277},{"key":"新港藝高","doc_count":270},{"key":"內埔農工","doc_count":266},{"key":"蘇澳海事","doc_count":250},{"key":"竹南高中","doc_count":231},{"key":"南大附中","doc_count":215},{"key":"關西高中","doc_count":215},{"key":"澎湖海事","doc_count":212},{"key":"關山工商","doc_count":208},{"key":"師大附中高中部","doc_count":205},{"key":"後壁高中","doc_count":203},{"key":"玉里高中","doc_count":198},{"key":"基隆商工","doc_count":168},{"key":"虎尾高中","doc_count":168},{"key":"苗栗農工","doc_count":160},{"key":"東港海事","doc_count":155},{"key":"鳳山高中","doc_count":153},{"key":"彰師附工","doc_count":150},{"key":"新化高中","doc_count":149},{"key":"南投特教","doc_count":147},{"key":"嘉科實中","doc_count":146},{"key":"南投高中","doc_count":144},{"key":"新化高工","doc_count":142},{"key":"新營高中","doc_count":142},{"key":"員林農工","doc_count":138},{"key":"嘉義高商","doc_count":136},{"key":"屏東女中","doc_count":126},{"key":"新營高工","doc_count":126},{"key":"員林家商","doc_count":121},{"key":"成大南工","doc_count":120},{"key":"南大附聰","doc_count":119},{"key":"苗栗高商","doc_count":118},{"key":"苗栗高中","doc_count":116},{"key":"彰化高商","doc_count":110},{"key":"草屯商工","doc_count":99},{"key":"水里商工","doc_count":93},{"key":"新竹高工","doc_count":91},{"key":"屏科實中","doc_count":85},{"key":"雲林特教","doc_count":82},{"key":"北港農工","doc_count":79},{"key":"潮州高中","doc_count":79},{"key":"北教大實小","doc_count":78},{"key":"屏東高中","doc_count":78},{"key":"羅東高商","doc_count":78},{"key":"新竹高中","doc_count":76},{"key":"玉井工商","doc_count":76},{"key":"蘭陽女中","doc_count":75},{"key":"東石高中","doc_count":72},{"key":"臺南一中","doc_count":72},{"key":"嘉義高中","doc_count":71},{"key":"南大附小","doc_count":69},{"key":"高餐大附中","doc_count":67},{"key":"崇實高工","doc_count":65},{"key":"臺南高商","doc_count":65},{"key":"北港高中","doc_count":64},{"key":"二林工商","doc_count":63},{"key":"員林高中","doc_count":63},{"key":"屏東高工","doc_count":62},{"key":"北門高中","doc_count":61},{"key":"竹東高中","doc_count":61},{"key":"新竹高商","doc_count":60},{"key":"華南高商","doc_count":60},{"key":"土庫商工","doc_count":59},{"key":"溪湖高中","doc_count":59},{"key":"海大附中","doc_count":58},{"key":"興大附農","doc_count":54},{"key":"頭城家商","doc_count":54},{"key":"埔里高工","doc_count":52},{"key":"白河商工","doc_count":52},{"key":"嘉義家職","doc_count":51},{"key":"暨大附中","doc_count":50},{"key":"旗山農工","doc_count":47},{"key":"新豐高中","doc_count":46},{"key":"羅東高工","doc_count":46},{"key":"佳冬高農","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"臺東高商","doc_count":42},{"key":"花蓮高工","doc_count":41},{"key":"宜蘭高中","doc_count":39},{"key":"嘉義高工","doc_count":38},{"key":"師大附中國中部","doc_count":38}]}}}
DEBUG 2025/12/17 17:10:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:10:00   Bucket[0]: Key=黑快馬主機, DocCount=1152
DEBUG 2025/12/17 17:10:00   Bucket[1]: Key=花蓮高農, DocCount=800
DEBUG 2025/12/17 17:10:00   Bucket[2]: Key=新竹女中, DocCount=735
DEBUG 2025/12/17 17:10:00   Bucket[3]: Key=仁愛高農, DocCount=626
DEBUG 2025/12/17 17:10:00   Bucket[4]: Key=金門農工, DocCount=543
DEBUG 2025/12/17 17:10:00   Bucket[5]: Key=金門高中, DocCount=527
DEBUG 2025/12/17 17:10:00   Bucket[6]: Key=中大壢中, DocCount=499
DEBUG 2025/12/17 17:10:00   Bucket[7]: Key=旗美高中, DocCount=454
DEBUG 2025/12/17 17:10:00   Bucket[8]: Key=南投高商, DocCount=447
DEBUG 2025/12/17 17:10:00   Bucket[9]: Key=竹北高中, DocCount=433
DEBUG 2025/12/17 17:10:00   Bucket[10]: Key=花蓮高商, DocCount=398
DEBUG 2025/12/17 17:10:00   Bucket[11]: Key=宜蘭高商, DocCount=382
DEBUG 2025/12/17 17:10:00   Bucket[12]: Key=華僑高中, DocCount=333
DEBUG 2025/12/17 17:10:00   Bucket[13]: Key=北斗家商, DocCount=325
DEBUG 2025/12/17 17:10:00   Bucket[14]: Key=政大附中, DocCount=306
DEBUG 2025/12/17 17:10:00   Bucket[15]: Key=臺東高中, DocCount=304
DEBUG 2025/12/17 17:10:00   Bucket[16]: Key=興大附中, DocCount=297
DEBUG 2025/12/17 17:10:00   Bucket[17]: Key=中興高中, DocCount=291
DEBUG 2025/12/17 17:10:00   Bucket[18]: Key=斗六家商, DocCount=288
DEBUG 2025/12/17 17:10:00   Bucket[19]: Key=清華附小, DocCount=277
DEBUG 2025/12/17 17:10:00   Bucket[20]: Key=新港藝高, DocCount=270
DEBUG 2025/12/17 17:10:00   Bucket[21]: Key=內埔農工, DocCount=266
DEBUG 2025/12/17 17:10:00   Bucket[22]: Key=蘇澳海事, DocCount=250
DEBUG 2025/12/17 17:10:00   Bucket[23]: Key=竹南高中, DocCount=231
DEBUG 2025/12/17 17:10:00   Bucket[24]: Key=南大附中, DocCount=215
DEBUG 2025/12/17 17:10:00   Bucket[25]: Key=關西高中, DocCount=215
DEBUG 2025/12/17 17:10:00   Bucket[26]: Key=澎湖海事, DocCount=212
DEBUG 2025/12/17 17:10:00   Bucket[27]: Key=關山工商, DocCount=208
DEBUG 2025/12/17 17:10:00   Bucket[28]: Key=師大附中高中部, DocCount=205
DEBUG 2025/12/17 17:10:00   Bucket[29]: Key=後壁高中, DocCount=203
DEBUG 2025/12/17 17:10:00   Bucket[30]: Key=玉里高中, DocCount=198
DEBUG 2025/12/17 17:10:00   Bucket[31]: Key=基隆商工, DocCount=168
DEBUG 2025/12/17 17:10:00   Bucket[32]: Key=虎尾高中, DocCount=168
DEBUG 2025/12/17 17:10:00   Bucket[33]: Key=苗栗農工, DocCount=160
DEBUG 2025/12/17 17:10:00   Bucket[34]: Key=東港海事, DocCount=155
DEBUG 2025/12/17 17:10:00   Bucket[35]: Key=鳳山高中, DocCount=153
DEBUG 2025/12/17 17:10:00   Bucket[36]: Key=彰師附工, DocCount=150
DEBUG 2025/12/17 17:10:00   Bucket[37]: Key=新化高中, DocCount=149
DEBUG 2025/12/17 17:10:00   Bucket[38]: Key=南投特教, DocCount=147
DEBUG 2025/12/17 17:10:00   Bucket[39]: Key=嘉科實中, DocCount=146
DEBUG 2025/12/17 17:10:00   Bucket[40]: Key=南投高中, DocCount=144
DEBUG 2025/12/17 17:10:00   Bucket[41]: Key=新化高工, DocCount=142
DEBUG 2025/12/17 17:10:00   Bucket[42]: Key=新營高中, DocCount=142
DEBUG 2025/12/17 17:10:00   Bucket[43]: Key=員林農工, DocCount=138
DEBUG 2025/12/17 17:10:00   Bucket[44]: Key=嘉義高商, DocCount=136
DEBUG 2025/12/17 17:10:00   Bucket[45]: Key=屏東女中, DocCount=126
DEBUG 2025/12/17 17:10:00   Bucket[46]: Key=新營高工, DocCount=126
DEBUG 2025/12/17 17:10:00   Bucket[47]: Key=員林家商, DocCount=121
DEBUG 2025/12/17 17:10:00   Bucket[48]: Key=成大南工, DocCount=120
DEBUG 2025/12/17 17:10:00   Bucket[49]: Key=南大附聰, DocCount=119
DEBUG 2025/12/17 17:10:00   Bucket[50]: Key=苗栗高商, DocCount=118
DEBUG 2025/12/17 17:10:00   Bucket[51]: Key=苗栗高中, DocCount=116
DEBUG 2025/12/17 17:10:00   Bucket[52]: Key=彰化高商, DocCount=110
DEBUG 2025/12/17 17:10:00   Bucket[53]: Key=草屯商工, DocCount=99
DEBUG 2025/12/17 17:10:00   Bucket[54]: Key=水里商工, DocCount=93
DEBUG 2025/12/17 17:10:00   Bucket[55]: Key=新竹高工, DocCount=91
DEBUG 2025/12/17 17:10:00   Bucket[56]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:10:00   Bucket[57]: Key=雲林特教, DocCount=82
DEBUG 2025/12/17 17:10:00   Bucket[58]: Key=北港農工, DocCount=79
DEBUG 2025/12/17 17:10:00   Bucket[59]: Key=潮州高中, DocCount=79
DEBUG 2025/12/17 17:10:00   Bucket[60]: Key=北教大實小, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[61]: Key=屏東高中, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[62]: Key=羅東高商, DocCount=78
DEBUG 2025/12/17 17:10:00   Bucket[63]: Key=新竹高中, DocCount=76
DEBUG 2025/12/17 17:10:00   Bucket[64]: Key=玉井工商, DocCount=76
DEBUG 2025/12/17 17:10:00   Bucket[65]: Key=蘭陽女中, DocCount=75
DEBUG 2025/12/17 17:10:00   Bucket[66]: Key=東石高中, DocCount=72
DEBUG 2025/12/17 17:10:00   Bucket[67]: Key=臺南一中, DocCount=72
DEBUG 2025/12/17 17:10:00   Bucket[68]: Key=嘉義高中, DocCount=71
DEBUG 2025/12/17 17:10:00   Bucket[69]: Key=南大附小, DocCount=69
DEBUG 2025/12/17 17:10:00   Bucket[70]: Key=高餐大附中, DocCount=67
DEBUG 2025/12/17 17:10:00   Bucket[71]: Key=崇實高工, DocCount=65
DEBUG 2025/12/17 17:10:00   Bucket[72]: Key=臺南高商, DocCount=65
DEBUG 2025/12/17 17:10:00   Bucket[73]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:10:00   Bucket[74]: Key=二林工商, DocCount=63
DEBUG 2025/12/17 17:10:00   Bucket[75]: Key=員林高中, DocCount=63
DEBUG 2025/12/17 17:10:00   Bucket[76]: Key=屏東高工, DocCount=62
DEBUG 2025/12/17 17:10:00   Bucket[77]: Key=北門高中, DocCount=61
DEBUG 2025/12/17 17:10:00   Bucket[78]: Key=竹東高中, DocCount=61
DEBUG 2025/12/17 17:10:00   Bucket[79]: Key=新竹高商, DocCount=60
DEBUG 2025/12/17 17:10:00   Bucket[80]: Key=華南高商, DocCount=60
DEBUG 2025/12/17 17:10:00   Bucket[81]: Key=土庫商工, DocCount=59
DEBUG 2025/12/17 17:10:00   Bucket[82]: Key=溪湖高中, DocCount=59
DEBUG 2025/12/17 17:10:00   Bucket[83]: Key=海大附中, DocCount=58
DEBUG 2025/12/17 17:10:00   Bucket[84]: Key=興大附農, DocCount=54
DEBUG 2025/12/17 17:10:00   Bucket[85]: Key=頭城家商, DocCount=54
DEBUG 2025/12/17 17:10:00   Bucket[86]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:10:00   Bucket[87]: Key=白河商工, DocCount=52
DEBUG 2025/12/17 17:10:00   Bucket[88]: Key=嘉義家職, DocCount=51
DEBUG 2025/12/17 17:10:00   Bucket[89]: Key=暨大附中, DocCount=50
DEBUG 2025/12/17 17:10:00   Bucket[90]: Key=旗山農工, DocCount=47
DEBUG 2025/12/17 17:10:00   Bucket[91]: Key=新豐高中, DocCount=46
DEBUG 2025/12/17 17:10:00   Bucket[92]: Key=羅東高工, DocCount=46
DEBUG 2025/12/17 17:10:00   Bucket[93]: Key=佳冬高農, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[94]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[95]: Key=臺東高商, DocCount=42
DEBUG 2025/12/17 17:10:00   Bucket[96]: Key=花蓮高工, DocCount=41
DEBUG 2025/12/17 17:10:00   Bucket[97]: Key=宜蘭高中, DocCount=39
DEBUG 2025/12/17 17:10:00   Bucket[98]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:10:00   Bucket[99]: Key=師大附中國中部, DocCount=38
DEBUG 2025/12/17 17:10:00 ========================================================
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:10:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:10:07 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:10:07 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:10:08 ✅ Successfully flushed 28/28 history records to TimescaleDB
INFO 2025/12/17 17:10:08 Processing 15 offline devices
INFO 2025/12/17 17:10:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:10:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:10:08 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:10:08 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:10:08 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:10:08 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:10:08 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:10:08 Creating history record for offline device: 秀水高工
INFO 2025/12/17 17:10:08 About to add history to batch for device: 秀水高工
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 秀水高工
INFO 2025/12/17 17:10:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:10:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:10:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:10:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:10:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:10:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:10:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:10:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:10:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:10:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:10:13 ✅ Successfully flushed 17/17 history records to TimescaleDB
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:10:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:10:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:10:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:10:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:10:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:10:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:10:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:10:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:10:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:10:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:10:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:10:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:10:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:10:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:10:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:10:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:10:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Memory usage critical: 91.14% (threshold: 90.00%)
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.32% (threshold: 85.00%)
INFO 2025/12/17 17:10:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:10:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:10:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:10:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:10:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:10:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:11:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:11:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:11:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:11:00 Field: school_name.keyword
DEBUG 2025/12/17 17:11:00 Time From: 2025-12-17T17:10:00.000+08:00
DEBUG 2025/12/17 17:11:00 Time To: 2025-12-17T17:11:00.000+08:00
DEBUG 2025/12/17 17:11:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:10:00.000+08:00",
					"lte": "2025-12-17T17:11:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:11:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:11:00 ES Response IsError: false
DEBUG 2025/12/17 17:11:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":513,"buckets":[{"key":"花蓮高農","doc_count":790},{"key":"黑快馬主機","doc_count":775},{"key":"新竹女中","doc_count":743},{"key":"仁愛高農","doc_count":652},{"key":"金門農工","doc_count":574},{"key":"金門高中","doc_count":539},{"key":"旗美高中","doc_count":478},{"key":"中大壢中","doc_count":457},{"key":"宜蘭高商","doc_count":453},{"key":"南投高商","doc_count":441},{"key":"臺東高中","doc_count":401},{"key":"華僑高中","doc_count":400},{"key":"竹北高中","doc_count":337},{"key":"花蓮高商","doc_count":336},{"key":"興大附中","doc_count":335},{"key":"內埔農工","doc_count":284},{"key":"清華附小","doc_count":281},{"key":"關山工商","doc_count":274},{"key":"關西高中","doc_count":268},{"key":"新港藝高","doc_count":260},{"key":"苗栗農工","doc_count":255},{"key":"蘇澳海事","doc_count":239},{"key":"師大附中高中部","doc_count":235},{"key":"玉里高中","doc_count":225},{"key":"後壁高中","doc_count":219},{"key":"斗六家商","doc_count":208},{"key":"竹南高中","doc_count":208},{"key":"虎尾高中","doc_count":194},{"key":"新營高工","doc_count":175},{"key":"屏東女中","doc_count":169},{"key":"中興高中","doc_count":168},{"key":"新化高中","doc_count":164},{"key":"南投特教","doc_count":157},{"key":"新化高工","doc_count":149},{"key":"澎湖海事","doc_count":144},{"key":"東港海事","doc_count":139},{"key":"員林家商","doc_count":138},{"key":"北斗家商","doc_count":127},{"key":"頭城家商","doc_count":126},{"key":"嘉義高商","doc_count":120},{"key":"二林工商","doc_count":115},{"key":"竹山高中","doc_count":113},{"key":"溪湖高中","doc_count":108},{"key":"北港高中","doc_count":104},{"key":"南大附聰","doc_count":99},{"key":"曾文農工","doc_count":99},{"key":"彰師附工","doc_count":98},{"key":"政大附中","doc_count":94},{"key":"嘉科實中","doc_count":88},{"key":"屏科實中","doc_count":85},{"key":"新營高中","doc_count":83},{"key":"基隆商工","doc_count":81},{"key":"北教大實小","doc_count":80},{"key":"南大附小","doc_count":80},{"key":"南投高中","doc_count":80},{"key":"彰化高商","doc_count":78},{"key":"水里商工","doc_count":78},{"key":"新竹高中","doc_count":77},{"key":"雲林特教","doc_count":77},{"key":"臺南高商","doc_count":76},{"key":"暨大附中","doc_count":74},{"key":"南大附中","doc_count":73},{"key":"苗栗高商","doc_count":71},{"key":"成大南工","doc_count":67},{"key":"新竹高工","doc_count":67},{"key":"羅東高商","doc_count":67},{"key":"臺東高商","doc_count":67},{"key":"花蓮高工","doc_count":65},{"key":"新豐高中","doc_count":64},{"key":"崇實高工","doc_count":63},{"key":"白河商工","doc_count":63},{"key":"嘉義高中","doc_count":62},{"key":"屏東高工","doc_count":61},{"key":"秀水高工","doc_count":60},{"key":"高餐大附中","doc_count":58},{"key":"屏東高中","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"臺南一中","doc_count":57},{"key":"土庫商工","doc_count":56},{"key":"海大附中","doc_count":56},{"key":"員林農工","doc_count":55},{"key":"新竹高商","doc_count":55},{"key":"屏東特教","doc_count":52},{"key":"苗栗高中","doc_count":52},{"key":"員林高中","doc_count":51},{"key":"華南高商","doc_count":50},{"key":"旗山農工","doc_count":49},{"key":"永靖高工","doc_count":49},{"key":"臺東女中","doc_count":49},{"key":"善化高中","doc_count":46},{"key":"北港農工","doc_count":45},{"key":"埔里高工","doc_count":45},{"key":"東石高中","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"花蓮高中","doc_count":45},{"key":"北門高中","doc_count":44},{"key":"嘉義高工","doc_count":44},{"key":"羅東高工","doc_count":43},{"key":"宜蘭高中","doc_count":41},{"key":"花蓮特教","doc_count":41}]}}}
DEBUG 2025/12/17 17:11:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:11:00   Bucket[0]: Key=花蓮高農, DocCount=790
DEBUG 2025/12/17 17:11:00   Bucket[1]: Key=黑快馬主機, DocCount=775
DEBUG 2025/12/17 17:11:00   Bucket[2]: Key=新竹女中, DocCount=743
DEBUG 2025/12/17 17:11:00   Bucket[3]: Key=仁愛高農, DocCount=652
DEBUG 2025/12/17 17:11:00   Bucket[4]: Key=金門農工, DocCount=574
DEBUG 2025/12/17 17:11:00   Bucket[5]: Key=金門高中, DocCount=539
DEBUG 2025/12/17 17:11:00   Bucket[6]: Key=旗美高中, DocCount=478
DEBUG 2025/12/17 17:11:00   Bucket[7]: Key=中大壢中, DocCount=457
DEBUG 2025/12/17 17:11:00   Bucket[8]: Key=宜蘭高商, DocCount=453
DEBUG 2025/12/17 17:11:00   Bucket[9]: Key=南投高商, DocCount=441
DEBUG 2025/12/17 17:11:00   Bucket[10]: Key=臺東高中, DocCount=401
DEBUG 2025/12/17 17:11:00   Bucket[11]: Key=華僑高中, DocCount=400
DEBUG 2025/12/17 17:11:00   Bucket[12]: Key=竹北高中, DocCount=337
DEBUG 2025/12/17 17:11:00   Bucket[13]: Key=花蓮高商, DocCount=336
DEBUG 2025/12/17 17:11:00   Bucket[14]: Key=興大附中, DocCount=335
DEBUG 2025/12/17 17:11:00   Bucket[15]: Key=內埔農工, DocCount=284
DEBUG 2025/12/17 17:11:00   Bucket[16]: Key=清華附小, DocCount=281
DEBUG 2025/12/17 17:11:00   Bucket[17]: Key=關山工商, DocCount=274
DEBUG 2025/12/17 17:11:00   Bucket[18]: Key=關西高中, DocCount=268
DEBUG 2025/12/17 17:11:00   Bucket[19]: Key=新港藝高, DocCount=260
DEBUG 2025/12/17 17:11:00   Bucket[20]: Key=苗栗農工, DocCount=255
DEBUG 2025/12/17 17:11:00   Bucket[21]: Key=蘇澳海事, DocCount=239
DEBUG 2025/12/17 17:11:00   Bucket[22]: Key=師大附中高中部, DocCount=235
DEBUG 2025/12/17 17:11:00   Bucket[23]: Key=玉里高中, DocCount=225
DEBUG 2025/12/17 17:11:00   Bucket[24]: Key=後壁高中, DocCount=219
DEBUG 2025/12/17 17:11:00   Bucket[25]: Key=斗六家商, DocCount=208
DEBUG 2025/12/17 17:11:00   Bucket[26]: Key=竹南高中, DocCount=208
DEBUG 2025/12/17 17:11:00   Bucket[27]: Key=虎尾高中, DocCount=194
DEBUG 2025/12/17 17:11:00   Bucket[28]: Key=新營高工, DocCount=175
DEBUG 2025/12/17 17:11:00   Bucket[29]: Key=屏東女中, DocCount=169
DEBUG 2025/12/17 17:11:00   Bucket[30]: Key=中興高中, DocCount=168
DEBUG 2025/12/17 17:11:00   Bucket[31]: Key=新化高中, DocCount=164
DEBUG 2025/12/17 17:11:00   Bucket[32]: Key=南投特教, DocCount=157
DEBUG 2025/12/17 17:11:00   Bucket[33]: Key=新化高工, DocCount=149
DEBUG 2025/12/17 17:11:00   Bucket[34]: Key=澎湖海事, DocCount=144
DEBUG 2025/12/17 17:11:00   Bucket[35]: Key=東港海事, DocCount=139
DEBUG 2025/12/17 17:11:00   Bucket[36]: Key=員林家商, DocCount=138
DEBUG 2025/12/17 17:11:00   Bucket[37]: Key=北斗家商, DocCount=127
DEBUG 2025/12/17 17:11:00   Bucket[38]: Key=頭城家商, DocCount=126
DEBUG 2025/12/17 17:11:00   Bucket[39]: Key=嘉義高商, DocCount=120
DEBUG 2025/12/17 17:11:00   Bucket[40]: Key=二林工商, DocCount=115
DEBUG 2025/12/17 17:11:00   Bucket[41]: Key=竹山高中, DocCount=113
DEBUG 2025/12/17 17:11:00   Bucket[42]: Key=溪湖高中, DocCount=108
DEBUG 2025/12/17 17:11:00   Bucket[43]: Key=北港高中, DocCount=104
DEBUG 2025/12/17 17:11:00   Bucket[44]: Key=南大附聰, DocCount=99
DEBUG 2025/12/17 17:11:00   Bucket[45]: Key=曾文農工, DocCount=99
DEBUG 2025/12/17 17:11:00   Bucket[46]: Key=彰師附工, DocCount=98
DEBUG 2025/12/17 17:11:00   Bucket[47]: Key=政大附中, DocCount=94
DEBUG 2025/12/17 17:11:00   Bucket[48]: Key=嘉科實中, DocCount=88
DEBUG 2025/12/17 17:11:00   Bucket[49]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:11:00   Bucket[50]: Key=新營高中, DocCount=83
DEBUG 2025/12/17 17:11:00   Bucket[51]: Key=基隆商工, DocCount=81
DEBUG 2025/12/17 17:11:00   Bucket[52]: Key=北教大實小, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[53]: Key=南大附小, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[54]: Key=南投高中, DocCount=80
DEBUG 2025/12/17 17:11:00   Bucket[55]: Key=彰化高商, DocCount=78
DEBUG 2025/12/17 17:11:00   Bucket[56]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 17:11:00   Bucket[57]: Key=新竹高中, DocCount=77
DEBUG 2025/12/17 17:11:00   Bucket[58]: Key=雲林特教, DocCount=77
DEBUG 2025/12/17 17:11:00   Bucket[59]: Key=臺南高商, DocCount=76
DEBUG 2025/12/17 17:11:00   Bucket[60]: Key=暨大附中, DocCount=74
DEBUG 2025/12/17 17:11:00   Bucket[61]: Key=南大附中, DocCount=73
DEBUG 2025/12/17 17:11:00   Bucket[62]: Key=苗栗高商, DocCount=71
DEBUG 2025/12/17 17:11:00   Bucket[63]: Key=成大南工, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[64]: Key=新竹高工, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[65]: Key=羅東高商, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[66]: Key=臺東高商, DocCount=67
DEBUG 2025/12/17 17:11:00   Bucket[67]: Key=花蓮高工, DocCount=65
DEBUG 2025/12/17 17:11:00   Bucket[68]: Key=新豐高中, DocCount=64
DEBUG 2025/12/17 17:11:00   Bucket[69]: Key=崇實高工, DocCount=63
DEBUG 2025/12/17 17:11:00   Bucket[70]: Key=白河商工, DocCount=63
DEBUG 2025/12/17 17:11:00   Bucket[71]: Key=嘉義高中, DocCount=62
DEBUG 2025/12/17 17:11:00   Bucket[72]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 17:11:00   Bucket[73]: Key=秀水高工, DocCount=60
DEBUG 2025/12/17 17:11:00   Bucket[74]: Key=高餐大附中, DocCount=58
DEBUG 2025/12/17 17:11:00   Bucket[75]: Key=屏東高中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[76]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[77]: Key=臺南一中, DocCount=57
DEBUG 2025/12/17 17:11:00   Bucket[78]: Key=土庫商工, DocCount=56
DEBUG 2025/12/17 17:11:00   Bucket[79]: Key=海大附中, DocCount=56
DEBUG 2025/12/17 17:11:00   Bucket[80]: Key=員林農工, DocCount=55
DEBUG 2025/12/17 17:11:00   Bucket[81]: Key=新竹高商, DocCount=55
DEBUG 2025/12/17 17:11:00   Bucket[82]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 17:11:00   Bucket[83]: Key=苗栗高中, DocCount=52
DEBUG 2025/12/17 17:11:00   Bucket[84]: Key=員林高中, DocCount=51
DEBUG 2025/12/17 17:11:00   Bucket[85]: Key=華南高商, DocCount=50
DEBUG 2025/12/17 17:11:00   Bucket[86]: Key=旗山農工, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[87]: Key=永靖高工, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[88]: Key=臺東女中, DocCount=49
DEBUG 2025/12/17 17:11:00   Bucket[89]: Key=善化高中, DocCount=46
DEBUG 2025/12/17 17:11:00   Bucket[90]: Key=北港農工, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[91]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[92]: Key=東石高中, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[93]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[94]: Key=花蓮高中, DocCount=45
DEBUG 2025/12/17 17:11:00   Bucket[95]: Key=北門高中, DocCount=44
DEBUG 2025/12/17 17:11:00   Bucket[96]: Key=嘉義高工, DocCount=44
DEBUG 2025/12/17 17:11:00   Bucket[97]: Key=羅東高工, DocCount=43
DEBUG 2025/12/17 17:11:00   Bucket[98]: Key=宜蘭高中, DocCount=41
DEBUG 2025/12/17 17:11:00   Bucket[99]: Key=花蓮特教, DocCount=41
DEBUG 2025/12/17 17:11:00 ========================================================
INFO 2025/12/17 17:11:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:11:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:11:08 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:11:09 Processing 15 offline devices
INFO 2025/12/17 17:11:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:11:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:11:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:11:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:11:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:11:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:11:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:11:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:11:09 Creating history record for offline device: 鳳山高中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 鳳山高中
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 鳳山高中
INFO 2025/12/17 17:11:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:11:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:11:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:11:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:11:09 Creating history record for offline device: 草屯商工
INFO 2025/12/17 17:11:09 About to add history to batch for device: 草屯商工
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 草屯商工
INFO 2025/12/17 17:11:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:11:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:11:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:11:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:11:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:11:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:11:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:11:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:11:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:11:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:11:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:11:13 ✅ Successfully flushed 30/30 history records to TimescaleDB
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:11:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:11:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:11:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:11:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:11:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:11:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:11:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:11:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:11:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:11:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:11:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:11:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:11:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:11:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:11:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:11:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:11:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:11:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.08% (threshold: 90.00%)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:11:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:11:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:11:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:11:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:11:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:12:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:12:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:12:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:12:00 Field: school_name.keyword
DEBUG 2025/12/17 17:12:00 Time From: 2025-12-17T17:11:00.000+08:00
DEBUG 2025/12/17 17:12:00 Time To: 2025-12-17T17:12:00.000+08:00
DEBUG 2025/12/17 17:12:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:11:00.000+08:00",
					"lte": "2025-12-17T17:12:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:12:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:12:00 ES Response IsError: false
DEBUG 2025/12/17 17:12:00 ES Response Body:
{"took":60,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":478,"buckets":[{"key":"黑快馬主機","doc_count":832},{"key":"花蓮高農","doc_count":753},{"key":"新竹女中","doc_count":690},{"key":"仁愛高農","doc_count":595},{"key":"金門農工","doc_count":589},{"key":"金門高中","doc_count":543},{"key":"宜蘭高商","doc_count":490},{"key":"中大壢中","doc_count":464},{"key":"旗美高中","doc_count":464},{"key":"竹北高中","doc_count":359},{"key":"華僑高中","doc_count":357},{"key":"澎湖海事","doc_count":355},{"key":"臺東高中","doc_count":355},{"key":"興大附中","doc_count":339},{"key":"政大附中","doc_count":326},{"key":"北門高中","doc_count":324},{"key":"南投高商","doc_count":299},{"key":"關西高中","doc_count":287},{"key":"虎尾高中","doc_count":284},{"key":"新港藝高","doc_count":259},{"key":"內埔農工","doc_count":258},{"key":"清華附小","doc_count":257},{"key":"玉里高中","doc_count":254},{"key":"花蓮高商","doc_count":245},{"key":"蘇澳海事","doc_count":231},{"key":"竹南高中","doc_count":216},{"key":"關山工商","doc_count":208},{"key":"苗栗農工","doc_count":195},{"key":"斗六家商","doc_count":187},{"key":"屏東女中","doc_count":186},{"key":"花蓮高中","doc_count":185},{"key":"後壁高中","doc_count":168},{"key":"東港海事","doc_count":159},{"key":"南投特教","doc_count":151},{"key":"彰師附工","doc_count":148},{"key":"南大附中","doc_count":139},{"key":"新化高工","doc_count":138},{"key":"南大附聰","doc_count":118},{"key":"北教大實小","doc_count":115},{"key":"師大附中高中部","doc_count":112},{"key":"新化高中","doc_count":110},{"key":"鳳山高中","doc_count":108},{"key":"成大南工","doc_count":107},{"key":"北斗家商","doc_count":104},{"key":"員林家商","doc_count":103},{"key":"嘉科實中","doc_count":100},{"key":"花蓮高工","doc_count":100},{"key":"南投高中","doc_count":98},{"key":"新營高工","doc_count":95},{"key":"秀水高工","doc_count":93},{"key":"暨大附中","doc_count":92},{"key":"草屯商工","doc_count":92},{"key":"彰化高商","doc_count":89},{"key":"員林農工","doc_count":87},{"key":"屏東高工","doc_count":87},{"key":"嘉義高商","doc_count":85},{"key":"頭城家商","doc_count":85},{"key":"臺南高商","doc_count":84},{"key":"雲林特教","doc_count":81},{"key":"苗栗高中","doc_count":80},{"key":"屏科實中","doc_count":79},{"key":"崇實高工","doc_count":77},{"key":"嘉義高中","doc_count":76},{"key":"永靖高工","doc_count":76},{"key":"臺南一中","doc_count":72},{"key":"新營高中","doc_count":71},{"key":"新竹高中","doc_count":70},{"key":"水里商工","doc_count":70},{"key":"竹山高中","doc_count":70},{"key":"曾文農工","doc_count":69},{"key":"中興高中","doc_count":68},{"key":"宜蘭高中","doc_count":68},{"key":"屏東高中","doc_count":68},{"key":"臺東高商","doc_count":66},{"key":"苗栗高商","doc_count":63},{"key":"北港高中","doc_count":59},{"key":"佳冬高農","doc_count":58},{"key":"竹東高中","doc_count":58},{"key":"東石高中","doc_count":57},{"key":"潮州高中","doc_count":57},{"key":"新竹高工","doc_count":56},{"key":"善化高中","doc_count":55},{"key":"埔里高工","doc_count":55},{"key":"二林工商","doc_count":51},{"key":"北港農工","doc_count":51},{"key":"花蓮特教","doc_count":51},{"key":"南大附小","doc_count":50},{"key":"羅東高工","doc_count":50},{"key":"興大附農","doc_count":49},{"key":"嘉義家職","doc_count":48},{"key":"基隆商工","doc_count":48},{"key":"海大附中","doc_count":48},{"key":"溪湖高中","doc_count":46},{"key":"華南高商","doc_count":46},{"key":"羅東高商","doc_count":44},{"key":"新豐高中","doc_count":43},{"key":"新竹高商","doc_count":41},{"key":"成功商水","doc_count":40},{"key":"嘉義高工","doc_count":39},{"key":"屏北高中","doc_count":39}]}}}
DEBUG 2025/12/17 17:12:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:12:00   Bucket[0]: Key=黑快馬主機, DocCount=832
DEBUG 2025/12/17 17:12:00   Bucket[1]: Key=花蓮高農, DocCount=753
DEBUG 2025/12/17 17:12:00   Bucket[2]: Key=新竹女中, DocCount=690
DEBUG 2025/12/17 17:12:00   Bucket[3]: Key=仁愛高農, DocCount=595
DEBUG 2025/12/17 17:12:00   Bucket[4]: Key=金門農工, DocCount=589
DEBUG 2025/12/17 17:12:00   Bucket[5]: Key=金門高中, DocCount=543
DEBUG 2025/12/17 17:12:00   Bucket[6]: Key=宜蘭高商, DocCount=490
DEBUG 2025/12/17 17:12:00   Bucket[7]: Key=中大壢中, DocCount=464
DEBUG 2025/12/17 17:12:00   Bucket[8]: Key=旗美高中, DocCount=464
DEBUG 2025/12/17 17:12:00   Bucket[9]: Key=竹北高中, DocCount=359
DEBUG 2025/12/17 17:12:00   Bucket[10]: Key=華僑高中, DocCount=357
DEBUG 2025/12/17 17:12:00   Bucket[11]: Key=澎湖海事, DocCount=355
DEBUG 2025/12/17 17:12:00   Bucket[12]: Key=臺東高中, DocCount=355
DEBUG 2025/12/17 17:12:00   Bucket[13]: Key=興大附中, DocCount=339
DEBUG 2025/12/17 17:12:00   Bucket[14]: Key=政大附中, DocCount=326
DEBUG 2025/12/17 17:12:00   Bucket[15]: Key=北門高中, DocCount=324
DEBUG 2025/12/17 17:12:00   Bucket[16]: Key=南投高商, DocCount=299
DEBUG 2025/12/17 17:12:00   Bucket[17]: Key=關西高中, DocCount=287
DEBUG 2025/12/17 17:12:00   Bucket[18]: Key=虎尾高中, DocCount=284
DEBUG 2025/12/17 17:12:00   Bucket[19]: Key=新港藝高, DocCount=259
DEBUG 2025/12/17 17:12:00   Bucket[20]: Key=內埔農工, DocCount=258
DEBUG 2025/12/17 17:12:00   Bucket[21]: Key=清華附小, DocCount=257
DEBUG 2025/12/17 17:12:00   Bucket[22]: Key=玉里高中, DocCount=254
DEBUG 2025/12/17 17:12:00   Bucket[23]: Key=花蓮高商, DocCount=245
DEBUG 2025/12/17 17:12:00   Bucket[24]: Key=蘇澳海事, DocCount=231
DEBUG 2025/12/17 17:12:00   Bucket[25]: Key=竹南高中, DocCount=216
DEBUG 2025/12/17 17:12:00   Bucket[26]: Key=關山工商, DocCount=208
DEBUG 2025/12/17 17:12:00   Bucket[27]: Key=苗栗農工, DocCount=195
DEBUG 2025/12/17 17:12:00   Bucket[28]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:12:00   Bucket[29]: Key=屏東女中, DocCount=186
DEBUG 2025/12/17 17:12:00   Bucket[30]: Key=花蓮高中, DocCount=185
DEBUG 2025/12/17 17:12:00   Bucket[31]: Key=後壁高中, DocCount=168
DEBUG 2025/12/17 17:12:00   Bucket[32]: Key=東港海事, DocCount=159
DEBUG 2025/12/17 17:12:00   Bucket[33]: Key=南投特教, DocCount=151
DEBUG 2025/12/17 17:12:00   Bucket[34]: Key=彰師附工, DocCount=148
DEBUG 2025/12/17 17:12:00   Bucket[35]: Key=南大附中, DocCount=139
DEBUG 2025/12/17 17:12:00   Bucket[36]: Key=新化高工, DocCount=138
DEBUG 2025/12/17 17:12:00   Bucket[37]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:12:00   Bucket[38]: Key=北教大實小, DocCount=115
DEBUG 2025/12/17 17:12:00   Bucket[39]: Key=師大附中高中部, DocCount=112
DEBUG 2025/12/17 17:12:00   Bucket[40]: Key=新化高中, DocCount=110
DEBUG 2025/12/17 17:12:00   Bucket[41]: Key=鳳山高中, DocCount=108
DEBUG 2025/12/17 17:12:00   Bucket[42]: Key=成大南工, DocCount=107
DEBUG 2025/12/17 17:12:00   Bucket[43]: Key=北斗家商, DocCount=104
DEBUG 2025/12/17 17:12:00   Bucket[44]: Key=員林家商, DocCount=103
DEBUG 2025/12/17 17:12:00   Bucket[45]: Key=嘉科實中, DocCount=100
DEBUG 2025/12/17 17:12:00   Bucket[46]: Key=花蓮高工, DocCount=100
DEBUG 2025/12/17 17:12:00   Bucket[47]: Key=南投高中, DocCount=98
DEBUG 2025/12/17 17:12:00   Bucket[48]: Key=新營高工, DocCount=95
DEBUG 2025/12/17 17:12:00   Bucket[49]: Key=秀水高工, DocCount=93
DEBUG 2025/12/17 17:12:00   Bucket[50]: Key=暨大附中, DocCount=92
DEBUG 2025/12/17 17:12:00   Bucket[51]: Key=草屯商工, DocCount=92
DEBUG 2025/12/17 17:12:00   Bucket[52]: Key=彰化高商, DocCount=89
DEBUG 2025/12/17 17:12:00   Bucket[53]: Key=員林農工, DocCount=87
DEBUG 2025/12/17 17:12:00   Bucket[54]: Key=屏東高工, DocCount=87
DEBUG 2025/12/17 17:12:00   Bucket[55]: Key=嘉義高商, DocCount=85
DEBUG 2025/12/17 17:12:00   Bucket[56]: Key=頭城家商, DocCount=85
DEBUG 2025/12/17 17:12:00   Bucket[57]: Key=臺南高商, DocCount=84
DEBUG 2025/12/17 17:12:00   Bucket[58]: Key=雲林特教, DocCount=81
DEBUG 2025/12/17 17:12:00   Bucket[59]: Key=苗栗高中, DocCount=80
DEBUG 2025/12/17 17:12:00   Bucket[60]: Key=屏科實中, DocCount=79
DEBUG 2025/12/17 17:12:00   Bucket[61]: Key=崇實高工, DocCount=77
DEBUG 2025/12/17 17:12:00   Bucket[62]: Key=嘉義高中, DocCount=76
DEBUG 2025/12/17 17:12:00   Bucket[63]: Key=永靖高工, DocCount=76
DEBUG 2025/12/17 17:12:00   Bucket[64]: Key=臺南一中, DocCount=72
DEBUG 2025/12/17 17:12:00   Bucket[65]: Key=新營高中, DocCount=71
DEBUG 2025/12/17 17:12:00   Bucket[66]: Key=新竹高中, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[67]: Key=水里商工, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[68]: Key=竹山高中, DocCount=70
DEBUG 2025/12/17 17:12:00   Bucket[69]: Key=曾文農工, DocCount=69
DEBUG 2025/12/17 17:12:00   Bucket[70]: Key=中興高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[71]: Key=宜蘭高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[72]: Key=屏東高中, DocCount=68
DEBUG 2025/12/17 17:12:00   Bucket[73]: Key=臺東高商, DocCount=66
DEBUG 2025/12/17 17:12:00   Bucket[74]: Key=苗栗高商, DocCount=63
DEBUG 2025/12/17 17:12:00   Bucket[75]: Key=北港高中, DocCount=59
DEBUG 2025/12/17 17:12:00   Bucket[76]: Key=佳冬高農, DocCount=58
DEBUG 2025/12/17 17:12:00   Bucket[77]: Key=竹東高中, DocCount=58
DEBUG 2025/12/17 17:12:00   Bucket[78]: Key=東石高中, DocCount=57
DEBUG 2025/12/17 17:12:00   Bucket[79]: Key=潮州高中, DocCount=57
DEBUG 2025/12/17 17:12:00   Bucket[80]: Key=新竹高工, DocCount=56
DEBUG 2025/12/17 17:12:00   Bucket[81]: Key=善化高中, DocCount=55
DEBUG 2025/12/17 17:12:00   Bucket[82]: Key=埔里高工, DocCount=55
DEBUG 2025/12/17 17:12:00   Bucket[83]: Key=二林工商, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[84]: Key=北港農工, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[85]: Key=花蓮特教, DocCount=51
DEBUG 2025/12/17 17:12:00   Bucket[86]: Key=南大附小, DocCount=50
DEBUG 2025/12/17 17:12:00   Bucket[87]: Key=羅東高工, DocCount=50
DEBUG 2025/12/17 17:12:00   Bucket[88]: Key=興大附農, DocCount=49
DEBUG 2025/12/17 17:12:00   Bucket[89]: Key=嘉義家職, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[90]: Key=基隆商工, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[91]: Key=海大附中, DocCount=48
DEBUG 2025/12/17 17:12:00   Bucket[92]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 17:12:00   Bucket[93]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:12:00   Bucket[94]: Key=羅東高商, DocCount=44
DEBUG 2025/12/17 17:12:00   Bucket[95]: Key=新豐高中, DocCount=43
DEBUG 2025/12/17 17:12:00   Bucket[96]: Key=新竹高商, DocCount=41
DEBUG 2025/12/17 17:12:00   Bucket[97]: Key=成功商水, DocCount=40
DEBUG 2025/12/17 17:12:00   Bucket[98]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:12:00   Bucket[99]: Key=屏北高中, DocCount=39
DEBUG 2025/12/17 17:12:00 ========================================================
INFO 2025/12/17 17:12:03 ✅ Successfully flushed 12/12 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:12:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:12:08 ✅ Successfully flushed 5/5 history records to TimescaleDB
INFO 2025/12/17 17:12:10 Processing 15 offline devices
INFO 2025/12/17 17:12:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:12:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:12:10 Creating history record for offline device: 高餐大附中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 高餐大附中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 高餐大附中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:12:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:12:10 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:12:10 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:12:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:12:10 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:12:10 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:12:10 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:12:10 Creating history record for offline device: 屏東特教
INFO 2025/12/17 17:12:10 About to add history to batch for device: 屏東特教
INFO 2025/12/17 17:12:11 Successfully added history record for offline device: 屏東特教
INFO 2025/12/17 17:12:11 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:12:11 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:12:11 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:12:13 ✅ Successfully flushed 34/34 history records to TimescaleDB
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:12:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:12:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:12:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:12:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:12:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:12:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:12:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:12:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:12:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:12:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:12:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:12:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:12:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:12:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:12:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:12:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.57% (threshold: 80.00%)
INFO 2025/12/17 17:12:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.35% (threshold: 85.00%)
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:12:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:12:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:12:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:12:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:12:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:12:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:12:48 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:12:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:13:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:13:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:13:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:13:00 Field: school_name.keyword
DEBUG 2025/12/17 17:13:00 Time From: 2025-12-17T17:12:00.000+08:00
DEBUG 2025/12/17 17:13:00 Time To: 2025-12-17T17:13:00.000+08:00
DEBUG 2025/12/17 17:13:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:12:00.000+08:00",
					"lte": "2025-12-17T17:13:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:13:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:13:00 ES Response IsError: false
DEBUG 2025/12/17 17:13:00 ES Response Body:
{"took":62,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":451,"buckets":[{"key":"黑快馬主機","doc_count":1360},{"key":"花蓮高農","doc_count":746},{"key":"新竹女中","doc_count":683},{"key":"金門農工","doc_count":658},{"key":"仁愛高農","doc_count":545},{"key":"金門高中","doc_count":536},{"key":"虎尾高中","doc_count":456},{"key":"宜蘭高商","doc_count":439},{"key":"旗美高中","doc_count":432},{"key":"北門高中","doc_count":425},{"key":"臺東高中","doc_count":409},{"key":"竹北高中","doc_count":405},{"key":"華僑高中","doc_count":382},{"key":"鳳山高中","doc_count":355},{"key":"花蓮高商","doc_count":312},{"key":"興大附中","doc_count":299},{"key":"玉里高中","doc_count":297},{"key":"新港藝高","doc_count":282},{"key":"政大附中","doc_count":279},{"key":"清華附小","doc_count":274},{"key":"關西高中","doc_count":274},{"key":"斗六家商","doc_count":267},{"key":"竹南高中","doc_count":264},{"key":"南投高商","doc_count":254},{"key":"新化高中","doc_count":244},{"key":"內埔農工","doc_count":242},{"key":"蘇澳海事","doc_count":224},{"key":"屏東女中","doc_count":199},{"key":"後壁高中","doc_count":198},{"key":"關山工商","doc_count":196},{"key":"中大壢中","doc_count":195},{"key":"澎湖海事","doc_count":187},{"key":"新化高工","doc_count":185},{"key":"彰師附工","doc_count":180},{"key":"苗栗農工","doc_count":169},{"key":"南投特教","doc_count":143},{"key":"嘉義高中","doc_count":133},{"key":"彰化高商","doc_count":127},{"key":"嘉義高商","doc_count":118},{"key":"南投高中","doc_count":117},{"key":"嘉科實中","doc_count":115},{"key":"東港海事","doc_count":112},{"key":"溪湖高中","doc_count":112},{"key":"花蓮高中","doc_count":111},{"key":"新營高工","doc_count":104},{"key":"北教大實小","doc_count":102},{"key":"員林家商","doc_count":100},{"key":"南大附聰","doc_count":98},{"key":"師大附中高中部","doc_count":97},{"key":"成大南工","doc_count":95},{"key":"苗栗高中","doc_count":94},{"key":"北斗家商","doc_count":93},{"key":"草屯商工","doc_count":93},{"key":"屏東高工","doc_count":91},{"key":"南大附中","doc_count":89},{"key":"羅東高商","doc_count":86},{"key":"暨大附中","doc_count":84},{"key":"北港高中","doc_count":82},{"key":"屏科實中","doc_count":82},{"key":"員林農工","doc_count":81},{"key":"臺南高商","doc_count":81},{"key":"水里商工","doc_count":78},{"key":"北港農工","doc_count":75},{"key":"新營高中","doc_count":73},{"key":"新竹高中","doc_count":72},{"key":"苗栗高商","doc_count":72},{"key":"嘉義家職","doc_count":63},{"key":"永靖高工","doc_count":63},{"key":"新竹高工","doc_count":62},{"key":"崇實高工","doc_count":61},{"key":"潮州高中","doc_count":61},{"key":"海大附中","doc_count":57},{"key":"高餐大附中","doc_count":55},{"key":"中興高中","doc_count":54},{"key":"二林工商","doc_count":54},{"key":"新竹高商","doc_count":53},{"key":"秀水高工","doc_count":53},{"key":"竹山高中","doc_count":53},{"key":"臺南一中","doc_count":53},{"key":"竹東高中","doc_count":52},{"key":"花蓮高工","doc_count":52},{"key":"雲林特教","doc_count":50},{"key":"基隆商工","doc_count":49},{"key":"頭城家商","doc_count":48},{"key":"土庫商工","doc_count":47},{"key":"宜蘭高中","doc_count":46},{"key":"埔里高工","doc_count":45},{"key":"善化高中","doc_count":44},{"key":"嘉義高工","doc_count":42},{"key":"屏東特教","doc_count":42},{"key":"曾文農工","doc_count":39},{"key":"蘭陽女中","doc_count":38},{"key":"華南高商","doc_count":37},{"key":"家齊高中","doc_count":36},{"key":"東石高中","doc_count":36},{"key":"玉井工商","doc_count":36},{"key":"師大附中國中部","doc_count":35},{"key":"旗山農工","doc_count":35},{"key":"屏東高中","doc_count":34},{"key":"羅東高工","doc_count":34}]}}}
DEBUG 2025/12/17 17:13:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:13:00   Bucket[0]: Key=黑快馬主機, DocCount=1360
DEBUG 2025/12/17 17:13:00   Bucket[1]: Key=花蓮高農, DocCount=746
DEBUG 2025/12/17 17:13:00   Bucket[2]: Key=新竹女中, DocCount=683
DEBUG 2025/12/17 17:13:00   Bucket[3]: Key=金門農工, DocCount=658
DEBUG 2025/12/17 17:13:00   Bucket[4]: Key=仁愛高農, DocCount=545
DEBUG 2025/12/17 17:13:00   Bucket[5]: Key=金門高中, DocCount=536
DEBUG 2025/12/17 17:13:00   Bucket[6]: Key=虎尾高中, DocCount=456
DEBUG 2025/12/17 17:13:00   Bucket[7]: Key=宜蘭高商, DocCount=439
DEBUG 2025/12/17 17:13:00   Bucket[8]: Key=旗美高中, DocCount=432
DEBUG 2025/12/17 17:13:00   Bucket[9]: Key=北門高中, DocCount=425
DEBUG 2025/12/17 17:13:00   Bucket[10]: Key=臺東高中, DocCount=409
DEBUG 2025/12/17 17:13:00   Bucket[11]: Key=竹北高中, DocCount=405
DEBUG 2025/12/17 17:13:00   Bucket[12]: Key=華僑高中, DocCount=382
DEBUG 2025/12/17 17:13:00   Bucket[13]: Key=鳳山高中, DocCount=355
DEBUG 2025/12/17 17:13:00   Bucket[14]: Key=花蓮高商, DocCount=312
DEBUG 2025/12/17 17:13:00   Bucket[15]: Key=興大附中, DocCount=299
DEBUG 2025/12/17 17:13:00   Bucket[16]: Key=玉里高中, DocCount=297
DEBUG 2025/12/17 17:13:00   Bucket[17]: Key=新港藝高, DocCount=282
DEBUG 2025/12/17 17:13:00   Bucket[18]: Key=政大附中, DocCount=279
DEBUG 2025/12/17 17:13:00   Bucket[19]: Key=清華附小, DocCount=274
DEBUG 2025/12/17 17:13:00   Bucket[20]: Key=關西高中, DocCount=274
DEBUG 2025/12/17 17:13:00   Bucket[21]: Key=斗六家商, DocCount=267
DEBUG 2025/12/17 17:13:00   Bucket[22]: Key=竹南高中, DocCount=264
DEBUG 2025/12/17 17:13:00   Bucket[23]: Key=南投高商, DocCount=254
DEBUG 2025/12/17 17:13:00   Bucket[24]: Key=新化高中, DocCount=244
DEBUG 2025/12/17 17:13:00   Bucket[25]: Key=內埔農工, DocCount=242
DEBUG 2025/12/17 17:13:00   Bucket[26]: Key=蘇澳海事, DocCount=224
DEBUG 2025/12/17 17:13:00   Bucket[27]: Key=屏東女中, DocCount=199
DEBUG 2025/12/17 17:13:00   Bucket[28]: Key=後壁高中, DocCount=198
DEBUG 2025/12/17 17:13:00   Bucket[29]: Key=關山工商, DocCount=196
DEBUG 2025/12/17 17:13:00   Bucket[30]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:13:00   Bucket[31]: Key=澎湖海事, DocCount=187
DEBUG 2025/12/17 17:13:00   Bucket[32]: Key=新化高工, DocCount=185
DEBUG 2025/12/17 17:13:00   Bucket[33]: Key=彰師附工, DocCount=180
DEBUG 2025/12/17 17:13:00   Bucket[34]: Key=苗栗農工, DocCount=169
DEBUG 2025/12/17 17:13:00   Bucket[35]: Key=南投特教, DocCount=143
DEBUG 2025/12/17 17:13:00   Bucket[36]: Key=嘉義高中, DocCount=133
DEBUG 2025/12/17 17:13:00   Bucket[37]: Key=彰化高商, DocCount=127
DEBUG 2025/12/17 17:13:00   Bucket[38]: Key=嘉義高商, DocCount=118
DEBUG 2025/12/17 17:13:00   Bucket[39]: Key=南投高中, DocCount=117
DEBUG 2025/12/17 17:13:00   Bucket[40]: Key=嘉科實中, DocCount=115
DEBUG 2025/12/17 17:13:00   Bucket[41]: Key=東港海事, DocCount=112
DEBUG 2025/12/17 17:13:00   Bucket[42]: Key=溪湖高中, DocCount=112
DEBUG 2025/12/17 17:13:00   Bucket[43]: Key=花蓮高中, DocCount=111
DEBUG 2025/12/17 17:13:00   Bucket[44]: Key=新營高工, DocCount=104
DEBUG 2025/12/17 17:13:00   Bucket[45]: Key=北教大實小, DocCount=102
DEBUG 2025/12/17 17:13:00   Bucket[46]: Key=員林家商, DocCount=100
DEBUG 2025/12/17 17:13:00   Bucket[47]: Key=南大附聰, DocCount=98
DEBUG 2025/12/17 17:13:00   Bucket[48]: Key=師大附中高中部, DocCount=97
DEBUG 2025/12/17 17:13:00   Bucket[49]: Key=成大南工, DocCount=95
DEBUG 2025/12/17 17:13:00   Bucket[50]: Key=苗栗高中, DocCount=94
DEBUG 2025/12/17 17:13:00   Bucket[51]: Key=北斗家商, DocCount=93
DEBUG 2025/12/17 17:13:00   Bucket[52]: Key=草屯商工, DocCount=93
DEBUG 2025/12/17 17:13:00   Bucket[53]: Key=屏東高工, DocCount=91
DEBUG 2025/12/17 17:13:00   Bucket[54]: Key=南大附中, DocCount=89
DEBUG 2025/12/17 17:13:00   Bucket[55]: Key=羅東高商, DocCount=86
DEBUG 2025/12/17 17:13:00   Bucket[56]: Key=暨大附中, DocCount=84
DEBUG 2025/12/17 17:13:00   Bucket[57]: Key=北港高中, DocCount=82
DEBUG 2025/12/17 17:13:00   Bucket[58]: Key=屏科實中, DocCount=82
DEBUG 2025/12/17 17:13:00   Bucket[59]: Key=員林農工, DocCount=81
DEBUG 2025/12/17 17:13:00   Bucket[60]: Key=臺南高商, DocCount=81
DEBUG 2025/12/17 17:13:00   Bucket[61]: Key=水里商工, DocCount=78
DEBUG 2025/12/17 17:13:00   Bucket[62]: Key=北港農工, DocCount=75
DEBUG 2025/12/17 17:13:00   Bucket[63]: Key=新營高中, DocCount=73
DEBUG 2025/12/17 17:13:00   Bucket[64]: Key=新竹高中, DocCount=72
DEBUG 2025/12/17 17:13:00   Bucket[65]: Key=苗栗高商, DocCount=72
DEBUG 2025/12/17 17:13:00   Bucket[66]: Key=嘉義家職, DocCount=63
DEBUG 2025/12/17 17:13:00   Bucket[67]: Key=永靖高工, DocCount=63
DEBUG 2025/12/17 17:13:00   Bucket[68]: Key=新竹高工, DocCount=62
DEBUG 2025/12/17 17:13:00   Bucket[69]: Key=崇實高工, DocCount=61
DEBUG 2025/12/17 17:13:00   Bucket[70]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:13:00   Bucket[71]: Key=海大附中, DocCount=57
DEBUG 2025/12/17 17:13:00   Bucket[72]: Key=高餐大附中, DocCount=55
DEBUG 2025/12/17 17:13:00   Bucket[73]: Key=中興高中, DocCount=54
DEBUG 2025/12/17 17:13:00   Bucket[74]: Key=二林工商, DocCount=54
DEBUG 2025/12/17 17:13:00   Bucket[75]: Key=新竹高商, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[76]: Key=秀水高工, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[77]: Key=竹山高中, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[78]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:13:00   Bucket[79]: Key=竹東高中, DocCount=52
DEBUG 2025/12/17 17:13:00   Bucket[80]: Key=花蓮高工, DocCount=52
DEBUG 2025/12/17 17:13:00   Bucket[81]: Key=雲林特教, DocCount=50
DEBUG 2025/12/17 17:13:00   Bucket[82]: Key=基隆商工, DocCount=49
DEBUG 2025/12/17 17:13:00   Bucket[83]: Key=頭城家商, DocCount=48
DEBUG 2025/12/17 17:13:00   Bucket[84]: Key=土庫商工, DocCount=47
DEBUG 2025/12/17 17:13:00   Bucket[85]: Key=宜蘭高中, DocCount=46
DEBUG 2025/12/17 17:13:00   Bucket[86]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:13:00   Bucket[87]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:13:00   Bucket[88]: Key=嘉義高工, DocCount=42
DEBUG 2025/12/17 17:13:00   Bucket[89]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:13:00   Bucket[90]: Key=曾文農工, DocCount=39
DEBUG 2025/12/17 17:13:00   Bucket[91]: Key=蘭陽女中, DocCount=38
DEBUG 2025/12/17 17:13:00   Bucket[92]: Key=華南高商, DocCount=37
DEBUG 2025/12/17 17:13:00   Bucket[93]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[94]: Key=東石高中, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[95]: Key=玉井工商, DocCount=36
DEBUG 2025/12/17 17:13:00   Bucket[96]: Key=師大附中國中部, DocCount=35
DEBUG 2025/12/17 17:13:00   Bucket[97]: Key=旗山農工, DocCount=35
DEBUG 2025/12/17 17:13:00   Bucket[98]: Key=屏東高中, DocCount=34
DEBUG 2025/12/17 17:13:00   Bucket[99]: Key=羅東高工, DocCount=34
DEBUG 2025/12/17 17:13:00 ========================================================
INFO 2025/12/17 17:13:03 ✅ Successfully flushed 13/13 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 53/2 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:13:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:13:08 ✅ Successfully flushed 11/11 history records to TimescaleDB
INFO 2025/12/17 17:13:08 Processing 15 offline devices
INFO 2025/12/17 17:13:08 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:13:08 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:13:08 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:13:08 Creating history record for offline device: 臺東高商
INFO 2025/12/17 17:13:08 About to add history to batch for device: 臺東高商
INFO 2025/12/17 17:13:08 Successfully added history record for offline device: 臺東高商
INFO 2025/12/17 17:13:08 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:13:08 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:13:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:13:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:13:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:13:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:13:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:13:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:13:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:13:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:13:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:13:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:13:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:13:09 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:13:09 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:13:09 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:13:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:13:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:13:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:13:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:13:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:13:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:13:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:13:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:13:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:13:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:13:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:13:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:13:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:13:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:13:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:13:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 5: Memory usage high: 87.02% (threshold: 80.00%)
WARN 2025/12/17 17:13:45 ES Alert Created [high][capacity]: Disk usage high: 93.40% (threshold: 85.00%)
WARN 2025/12/17 17:13:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:13:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:13:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:13:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:13:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:13:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:13:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:14:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:14:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:14:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:14:00 Field: school_name.keyword
DEBUG 2025/12/17 17:14:00 Time From: 2025-12-17T17:13:00.000+08:00
DEBUG 2025/12/17 17:14:00 Time To: 2025-12-17T17:14:00.000+08:00
DEBUG 2025/12/17 17:14:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:13:00.000+08:00",
					"lte": "2025-12-17T17:14:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:14:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:14:00 ES Response IsError: false
DEBUG 2025/12/17 17:14:00 ES Response Body:
{"took":63,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":473,"buckets":[{"key":"黑快馬主機","doc_count":1534},{"key":"花蓮高農","doc_count":797},{"key":"新竹女中","doc_count":752},{"key":"金門高中","doc_count":671},{"key":"仁愛高農","doc_count":598},{"key":"金門農工","doc_count":530},{"key":"宜蘭高商","doc_count":451},{"key":"北門高中","doc_count":416},{"key":"竹北高中","doc_count":405},{"key":"臺東高中","doc_count":402},{"key":"新港藝高","doc_count":396},{"key":"華僑高中","doc_count":386},{"key":"興大附中","doc_count":348},{"key":"旗美高中","doc_count":321},{"key":"新化高工","doc_count":317},{"key":"清華附小","doc_count":312},{"key":"花蓮高商","doc_count":293},{"key":"新化高中","doc_count":291},{"key":"草屯商工","doc_count":291},{"key":"南投高商","doc_count":288},{"key":"內埔農工","doc_count":283},{"key":"蘇澳海事","doc_count":283},{"key":"關西高中","doc_count":247},{"key":"竹南高中","doc_count":238},{"key":"斗六家商","doc_count":208},{"key":"屏東女中","doc_count":206},{"key":"關山工商","doc_count":195},{"key":"澎湖海事","doc_count":191},{"key":"後壁高中","doc_count":170},{"key":"玉里高中","doc_count":168},{"key":"南大附聰","doc_count":159},{"key":"嘉義高商","doc_count":157},{"key":"虎尾高中","doc_count":153},{"key":"南投特教","doc_count":152},{"key":"中大壢中","doc_count":147},{"key":"苗栗農工","doc_count":140},{"key":"暨大附中","doc_count":133},{"key":"秀水高工","doc_count":129},{"key":"彰師附工","doc_count":123},{"key":"嘉義高中","doc_count":122},{"key":"土庫商工","doc_count":122},{"key":"師大附中高中部","doc_count":121},{"key":"宜蘭高中","doc_count":120},{"key":"中興高中","doc_count":112},{"key":"東港海事","doc_count":108},{"key":"南大附中","doc_count":106},{"key":"新營高工","doc_count":104},{"key":"羅東高商","doc_count":104},{"key":"鳳山高中","doc_count":104},{"key":"員林家商","doc_count":102},{"key":"潮州高中","doc_count":98},{"key":"彰化高商","doc_count":97},{"key":"水里商工","doc_count":97},{"key":"基隆商工","doc_count":94},{"key":"北港農工","doc_count":92},{"key":"成大南工","doc_count":91},{"key":"嘉義家職","doc_count":87},{"key":"南投高中","doc_count":84},{"key":"屏科實中","doc_count":83},{"key":"永靖高工","doc_count":83},{"key":"嘉科實中","doc_count":80},{"key":"員林農工","doc_count":75},{"key":"北教大實小","doc_count":73},{"key":"新營高中","doc_count":69},{"key":"北斗家商","doc_count":66},{"key":"曾文農工","doc_count":66},{"key":"北港高中","doc_count":64},{"key":"崇實高工","doc_count":62},{"key":"新竹高中","doc_count":62},{"key":"屏東高工","doc_count":61},{"key":"苗栗高商","doc_count":61},{"key":"屏東高中","doc_count":60},{"key":"臺南一中","doc_count":60},{"key":"花蓮高工","doc_count":58},{"key":"埔里高工","doc_count":57},{"key":"東石高中","doc_count":54},{"key":"嘉義高工","doc_count":52},{"key":"新竹高工","doc_count":52},{"key":"臺南高商","doc_count":52},{"key":"華南高商","doc_count":49},{"key":"政大附中","doc_count":47},{"key":"二林工商","doc_count":46},{"key":"溪湖高中","doc_count":46},{"key":"花蓮特教","doc_count":46},{"key":"雲林特教","doc_count":46},{"key":"員林高中","doc_count":45},{"key":"臺東女中","doc_count":44},{"key":"興大附農","doc_count":44},{"key":"花蓮高中","doc_count":43},{"key":"新竹高商","doc_count":42},{"key":"南大附小","doc_count":40},{"key":"屏東特教","doc_count":40},{"key":"旗山農工","doc_count":40},{"key":"苗栗高中","doc_count":40},{"key":"高餐大附中","doc_count":40},{"key":"佳冬高農","doc_count":38},{"key":"新豐高中","doc_count":38},{"key":"海大附中","doc_count":38},{"key":"白河商工","doc_count":38},{"key":"臺東高商","doc_count":38}]}}}
DEBUG 2025/12/17 17:14:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:14:00   Bucket[0]: Key=黑快馬主機, DocCount=1534
DEBUG 2025/12/17 17:14:00   Bucket[1]: Key=花蓮高農, DocCount=797
DEBUG 2025/12/17 17:14:00   Bucket[2]: Key=新竹女中, DocCount=752
DEBUG 2025/12/17 17:14:00   Bucket[3]: Key=金門高中, DocCount=671
DEBUG 2025/12/17 17:14:00   Bucket[4]: Key=仁愛高農, DocCount=598
DEBUG 2025/12/17 17:14:00   Bucket[5]: Key=金門農工, DocCount=530
DEBUG 2025/12/17 17:14:00   Bucket[6]: Key=宜蘭高商, DocCount=451
DEBUG 2025/12/17 17:14:00   Bucket[7]: Key=北門高中, DocCount=416
DEBUG 2025/12/17 17:14:00   Bucket[8]: Key=竹北高中, DocCount=405
DEBUG 2025/12/17 17:14:00   Bucket[9]: Key=臺東高中, DocCount=402
DEBUG 2025/12/17 17:14:00   Bucket[10]: Key=新港藝高, DocCount=396
DEBUG 2025/12/17 17:14:00   Bucket[11]: Key=華僑高中, DocCount=386
DEBUG 2025/12/17 17:14:00   Bucket[12]: Key=興大附中, DocCount=348
DEBUG 2025/12/17 17:14:00   Bucket[13]: Key=旗美高中, DocCount=321
DEBUG 2025/12/17 17:14:00   Bucket[14]: Key=新化高工, DocCount=317
DEBUG 2025/12/17 17:14:00   Bucket[15]: Key=清華附小, DocCount=312
DEBUG 2025/12/17 17:14:00   Bucket[16]: Key=花蓮高商, DocCount=293
DEBUG 2025/12/17 17:14:00   Bucket[17]: Key=新化高中, DocCount=291
DEBUG 2025/12/17 17:14:00   Bucket[18]: Key=草屯商工, DocCount=291
DEBUG 2025/12/17 17:14:00   Bucket[19]: Key=南投高商, DocCount=288
DEBUG 2025/12/17 17:14:00   Bucket[20]: Key=內埔農工, DocCount=283
DEBUG 2025/12/17 17:14:00   Bucket[21]: Key=蘇澳海事, DocCount=283
DEBUG 2025/12/17 17:14:00   Bucket[22]: Key=關西高中, DocCount=247
DEBUG 2025/12/17 17:14:00   Bucket[23]: Key=竹南高中, DocCount=238
DEBUG 2025/12/17 17:14:00   Bucket[24]: Key=斗六家商, DocCount=208
DEBUG 2025/12/17 17:14:00   Bucket[25]: Key=屏東女中, DocCount=206
DEBUG 2025/12/17 17:14:00   Bucket[26]: Key=關山工商, DocCount=195
DEBUG 2025/12/17 17:14:00   Bucket[27]: Key=澎湖海事, DocCount=191
DEBUG 2025/12/17 17:14:00   Bucket[28]: Key=後壁高中, DocCount=170
DEBUG 2025/12/17 17:14:00   Bucket[29]: Key=玉里高中, DocCount=168
DEBUG 2025/12/17 17:14:00   Bucket[30]: Key=南大附聰, DocCount=159
DEBUG 2025/12/17 17:14:00   Bucket[31]: Key=嘉義高商, DocCount=157
DEBUG 2025/12/17 17:14:00   Bucket[32]: Key=虎尾高中, DocCount=153
DEBUG 2025/12/17 17:14:00   Bucket[33]: Key=南投特教, DocCount=152
DEBUG 2025/12/17 17:14:00   Bucket[34]: Key=中大壢中, DocCount=147
DEBUG 2025/12/17 17:14:00   Bucket[35]: Key=苗栗農工, DocCount=140
DEBUG 2025/12/17 17:14:00   Bucket[36]: Key=暨大附中, DocCount=133
DEBUG 2025/12/17 17:14:00   Bucket[37]: Key=秀水高工, DocCount=129
DEBUG 2025/12/17 17:14:00   Bucket[38]: Key=彰師附工, DocCount=123
DEBUG 2025/12/17 17:14:00   Bucket[39]: Key=嘉義高中, DocCount=122
DEBUG 2025/12/17 17:14:00   Bucket[40]: Key=土庫商工, DocCount=122
DEBUG 2025/12/17 17:14:00   Bucket[41]: Key=師大附中高中部, DocCount=121
DEBUG 2025/12/17 17:14:00   Bucket[42]: Key=宜蘭高中, DocCount=120
DEBUG 2025/12/17 17:14:00   Bucket[43]: Key=中興高中, DocCount=112
DEBUG 2025/12/17 17:14:00   Bucket[44]: Key=東港海事, DocCount=108
DEBUG 2025/12/17 17:14:00   Bucket[45]: Key=南大附中, DocCount=106
DEBUG 2025/12/17 17:14:00   Bucket[46]: Key=新營高工, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[47]: Key=羅東高商, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[48]: Key=鳳山高中, DocCount=104
DEBUG 2025/12/17 17:14:00   Bucket[49]: Key=員林家商, DocCount=102
DEBUG 2025/12/17 17:14:00   Bucket[50]: Key=潮州高中, DocCount=98
DEBUG 2025/12/17 17:14:00   Bucket[51]: Key=彰化高商, DocCount=97
DEBUG 2025/12/17 17:14:00   Bucket[52]: Key=水里商工, DocCount=97
DEBUG 2025/12/17 17:14:00   Bucket[53]: Key=基隆商工, DocCount=94
DEBUG 2025/12/17 17:14:00   Bucket[54]: Key=北港農工, DocCount=92
DEBUG 2025/12/17 17:14:00   Bucket[55]: Key=成大南工, DocCount=91
DEBUG 2025/12/17 17:14:00   Bucket[56]: Key=嘉義家職, DocCount=87
DEBUG 2025/12/17 17:14:00   Bucket[57]: Key=南投高中, DocCount=84
DEBUG 2025/12/17 17:14:00   Bucket[58]: Key=屏科實中, DocCount=83
DEBUG 2025/12/17 17:14:00   Bucket[59]: Key=永靖高工, DocCount=83
DEBUG 2025/12/17 17:14:00   Bucket[60]: Key=嘉科實中, DocCount=80
DEBUG 2025/12/17 17:14:00   Bucket[61]: Key=員林農工, DocCount=75
DEBUG 2025/12/17 17:14:00   Bucket[62]: Key=北教大實小, DocCount=73
DEBUG 2025/12/17 17:14:00   Bucket[63]: Key=新營高中, DocCount=69
DEBUG 2025/12/17 17:14:00   Bucket[64]: Key=北斗家商, DocCount=66
DEBUG 2025/12/17 17:14:00   Bucket[65]: Key=曾文農工, DocCount=66
DEBUG 2025/12/17 17:14:00   Bucket[66]: Key=北港高中, DocCount=64
DEBUG 2025/12/17 17:14:00   Bucket[67]: Key=崇實高工, DocCount=62
DEBUG 2025/12/17 17:14:00   Bucket[68]: Key=新竹高中, DocCount=62
DEBUG 2025/12/17 17:14:00   Bucket[69]: Key=屏東高工, DocCount=61
DEBUG 2025/12/17 17:14:00   Bucket[70]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:14:00   Bucket[71]: Key=屏東高中, DocCount=60
DEBUG 2025/12/17 17:14:00   Bucket[72]: Key=臺南一中, DocCount=60
DEBUG 2025/12/17 17:14:00   Bucket[73]: Key=花蓮高工, DocCount=58
DEBUG 2025/12/17 17:14:00   Bucket[74]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:14:00   Bucket[75]: Key=東石高中, DocCount=54
DEBUG 2025/12/17 17:14:00   Bucket[76]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[77]: Key=新竹高工, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[78]: Key=臺南高商, DocCount=52
DEBUG 2025/12/17 17:14:00   Bucket[79]: Key=華南高商, DocCount=49
DEBUG 2025/12/17 17:14:00   Bucket[80]: Key=政大附中, DocCount=47
DEBUG 2025/12/17 17:14:00   Bucket[81]: Key=二林工商, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[82]: Key=溪湖高中, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[83]: Key=花蓮特教, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[84]: Key=雲林特教, DocCount=46
DEBUG 2025/12/17 17:14:00   Bucket[85]: Key=員林高中, DocCount=45
DEBUG 2025/12/17 17:14:00   Bucket[86]: Key=臺東女中, DocCount=44
DEBUG 2025/12/17 17:14:00   Bucket[87]: Key=興大附農, DocCount=44
DEBUG 2025/12/17 17:14:00   Bucket[88]: Key=花蓮高中, DocCount=43
DEBUG 2025/12/17 17:14:00   Bucket[89]: Key=新竹高商, DocCount=42
DEBUG 2025/12/17 17:14:00   Bucket[90]: Key=南大附小, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[91]: Key=屏東特教, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[92]: Key=旗山農工, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[93]: Key=苗栗高中, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[94]: Key=高餐大附中, DocCount=40
DEBUG 2025/12/17 17:14:00   Bucket[95]: Key=佳冬高農, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[96]: Key=新豐高中, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[97]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[98]: Key=白河商工, DocCount=38
DEBUG 2025/12/17 17:14:00   Bucket[99]: Key=臺東高商, DocCount=38
DEBUG 2025/12/17 17:14:00 ========================================================
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:14:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:14:08 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:14:09 Processing 15 offline devices
INFO 2025/12/17 17:14:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:14:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:14:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:14:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:14:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:14:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:14:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:14:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:14:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:14:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:14:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:14:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:14:09 Creating history record for offline device: 善化高中
INFO 2025/12/17 17:14:09 About to add history to batch for device: 善化高中
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 善化高中
INFO 2025/12/17 17:14:10 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:14:10 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:14:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:14:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:14:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:14:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:14:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:14:13 ✅ Successfully flushed 33/33 history records to TimescaleDB
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:14:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:14:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:14:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:14:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:14:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:14:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:14:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:14:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:14:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:14:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:14:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:14:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:14:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:14:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:14:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:14:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:14:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:14:45 ES monitor check completed for: bimap123, status: warning
WARN 2025/12/17 17:14:45 ES Alert Created [high][performance]: Memory usage high: 88.88% (threshold: 80.00%)
INFO 2025/12/17 17:14:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.43% (threshold: 85.00%)
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:14:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:14:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:14:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:14:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:14:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:15:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:15:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:15:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:15:00 Field: school_name.keyword
DEBUG 2025/12/17 17:15:00 Time From: 2025-12-17T17:14:00.000+08:00
DEBUG 2025/12/17 17:15:00 Time To: 2025-12-17T17:15:00.000+08:00
DEBUG 2025/12/17 17:15:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:14:00.000+08:00",
					"lte": "2025-12-17T17:15:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:15:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:15:00 ES Response IsError: false
DEBUG 2025/12/17 17:15:00 ES Response Body:
{"took":81,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":502,"buckets":[{"key":"黑快馬主機","doc_count":2041},{"key":"新港藝高","doc_count":1529},{"key":"花蓮高農","doc_count":749},{"key":"仁愛高農","doc_count":657},{"key":"新竹女中","doc_count":630},{"key":"金門高中","doc_count":612},{"key":"竹北高中","doc_count":566},{"key":"金門農工","doc_count":540},{"key":"北門高中","doc_count":458},{"key":"華僑高中","doc_count":418},{"key":"宜蘭高商","doc_count":367},{"key":"臺東高中","doc_count":367},{"key":"旗美高中","doc_count":331},{"key":"花蓮高商","doc_count":319},{"key":"南投高商","doc_count":295},{"key":"嘉義高商","doc_count":288},{"key":"蘇澳海事","doc_count":280},{"key":"興大附中","doc_count":279},{"key":"清華附小","doc_count":274},{"key":"關西高中","doc_count":266},{"key":"嘉科實中","doc_count":259},{"key":"內埔農工","doc_count":256},{"key":"關山工商","doc_count":231},{"key":"員林家商","doc_count":221},{"key":"屏東女中","doc_count":219},{"key":"斗六家商","doc_count":206},{"key":"中大壢中","doc_count":195},{"key":"竹南高中","doc_count":194},{"key":"後壁高中","doc_count":188},{"key":"虎尾高中","doc_count":186},{"key":"玉里高中","doc_count":181},{"key":"苗栗農工","doc_count":181},{"key":"南投高中","doc_count":172},{"key":"東港海事","doc_count":166},{"key":"新營高工","doc_count":165},{"key":"南投特教","doc_count":163},{"key":"新竹高中","doc_count":161},{"key":"員林農工","doc_count":157},{"key":"澎湖海事","doc_count":156},{"key":"新化高工","doc_count":151},{"key":"南大附聰","doc_count":149},{"key":"彰師附工","doc_count":147},{"key":"新化高中","doc_count":138},{"key":"鳳山高中","doc_count":136},{"key":"南大附中","doc_count":133},{"key":"水里商工","doc_count":126},{"key":"北斗家商","doc_count":109},{"key":"師大附中國中部","doc_count":109},{"key":"師大附中高中部","doc_count":98},{"key":"彰化高商","doc_count":95},{"key":"旗山農工","doc_count":95},{"key":"嘉義高中","doc_count":94},{"key":"屏科實中","doc_count":93},{"key":"屏東高中","doc_count":89},{"key":"興大附農","doc_count":89},{"key":"新竹高工","doc_count":87},{"key":"中興高中","doc_count":86},{"key":"高餐大附中","doc_count":83},{"key":"苗栗高商","doc_count":80},{"key":"善化高中","doc_count":79},{"key":"新營高中","doc_count":73},{"key":"花蓮特教","doc_count":73},{"key":"新豐高中","doc_count":71},{"key":"溪湖高中","doc_count":71},{"key":"草屯商工","doc_count":66},{"key":"成大南工","doc_count":65},{"key":"羅東高商","doc_count":65},{"key":"新竹高商","doc_count":63},{"key":"臺南高商","doc_count":63},{"key":"南大附小","doc_count":62},{"key":"永靖高工","doc_count":62},{"key":"潮州高中","doc_count":61},{"key":"雲林特教","doc_count":61},{"key":"北教大實小","doc_count":59},{"key":"基隆商工","doc_count":57},{"key":"屏東高工","doc_count":55},{"key":"員林高中","doc_count":54},{"key":"屏東特教","doc_count":54},{"key":"二林工商","doc_count":53},{"key":"臺南一中","doc_count":53},{"key":"埔里高工","doc_count":52},{"key":"政大附中","doc_count":51},{"key":"暨大附中","doc_count":51},{"key":"宜蘭高中","doc_count":50},{"key":"北港高中","doc_count":49},{"key":"海大附中","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"嘉義家職","doc_count":47},{"key":"東石高中","doc_count":47},{"key":"竹東高中","doc_count":47},{"key":"北港農工","doc_count":46},{"key":"曾文農工","doc_count":45},{"key":"秀水高工","doc_count":45},{"key":"嘉義高工","doc_count":43},{"key":"白河商工","doc_count":43},{"key":"花蓮高中","doc_count":42},{"key":"玉井工商","doc_count":41},{"key":"臺東高商","doc_count":41},{"key":"花蓮高工","doc_count":40}]}}}
DEBUG 2025/12/17 17:15:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:15:00   Bucket[0]: Key=黑快馬主機, DocCount=2041
DEBUG 2025/12/17 17:15:00   Bucket[1]: Key=新港藝高, DocCount=1529
DEBUG 2025/12/17 17:15:00   Bucket[2]: Key=花蓮高農, DocCount=749
DEBUG 2025/12/17 17:15:00   Bucket[3]: Key=仁愛高農, DocCount=657
DEBUG 2025/12/17 17:15:00   Bucket[4]: Key=新竹女中, DocCount=630
DEBUG 2025/12/17 17:15:00   Bucket[5]: Key=金門高中, DocCount=612
DEBUG 2025/12/17 17:15:00   Bucket[6]: Key=竹北高中, DocCount=566
DEBUG 2025/12/17 17:15:00   Bucket[7]: Key=金門農工, DocCount=540
DEBUG 2025/12/17 17:15:00   Bucket[8]: Key=北門高中, DocCount=458
DEBUG 2025/12/17 17:15:00   Bucket[9]: Key=華僑高中, DocCount=418
DEBUG 2025/12/17 17:15:00   Bucket[10]: Key=宜蘭高商, DocCount=367
DEBUG 2025/12/17 17:15:00   Bucket[11]: Key=臺東高中, DocCount=367
DEBUG 2025/12/17 17:15:00   Bucket[12]: Key=旗美高中, DocCount=331
DEBUG 2025/12/17 17:15:00   Bucket[13]: Key=花蓮高商, DocCount=319
DEBUG 2025/12/17 17:15:00   Bucket[14]: Key=南投高商, DocCount=295
DEBUG 2025/12/17 17:15:00   Bucket[15]: Key=嘉義高商, DocCount=288
DEBUG 2025/12/17 17:15:00   Bucket[16]: Key=蘇澳海事, DocCount=280
DEBUG 2025/12/17 17:15:00   Bucket[17]: Key=興大附中, DocCount=279
DEBUG 2025/12/17 17:15:00   Bucket[18]: Key=清華附小, DocCount=274
DEBUG 2025/12/17 17:15:00   Bucket[19]: Key=關西高中, DocCount=266
DEBUG 2025/12/17 17:15:00   Bucket[20]: Key=嘉科實中, DocCount=259
DEBUG 2025/12/17 17:15:00   Bucket[21]: Key=內埔農工, DocCount=256
DEBUG 2025/12/17 17:15:00   Bucket[22]: Key=關山工商, DocCount=231
DEBUG 2025/12/17 17:15:00   Bucket[23]: Key=員林家商, DocCount=221
DEBUG 2025/12/17 17:15:00   Bucket[24]: Key=屏東女中, DocCount=219
DEBUG 2025/12/17 17:15:00   Bucket[25]: Key=斗六家商, DocCount=206
DEBUG 2025/12/17 17:15:00   Bucket[26]: Key=中大壢中, DocCount=195
DEBUG 2025/12/17 17:15:00   Bucket[27]: Key=竹南高中, DocCount=194
DEBUG 2025/12/17 17:15:00   Bucket[28]: Key=後壁高中, DocCount=188
DEBUG 2025/12/17 17:15:00   Bucket[29]: Key=虎尾高中, DocCount=186
DEBUG 2025/12/17 17:15:00   Bucket[30]: Key=玉里高中, DocCount=181
DEBUG 2025/12/17 17:15:00   Bucket[31]: Key=苗栗農工, DocCount=181
DEBUG 2025/12/17 17:15:00   Bucket[32]: Key=南投高中, DocCount=172
DEBUG 2025/12/17 17:15:00   Bucket[33]: Key=東港海事, DocCount=166
DEBUG 2025/12/17 17:15:00   Bucket[34]: Key=新營高工, DocCount=165
DEBUG 2025/12/17 17:15:00   Bucket[35]: Key=南投特教, DocCount=163
DEBUG 2025/12/17 17:15:00   Bucket[36]: Key=新竹高中, DocCount=161
DEBUG 2025/12/17 17:15:00   Bucket[37]: Key=員林農工, DocCount=157
DEBUG 2025/12/17 17:15:00   Bucket[38]: Key=澎湖海事, DocCount=156
DEBUG 2025/12/17 17:15:00   Bucket[39]: Key=新化高工, DocCount=151
DEBUG 2025/12/17 17:15:00   Bucket[40]: Key=南大附聰, DocCount=149
DEBUG 2025/12/17 17:15:00   Bucket[41]: Key=彰師附工, DocCount=147
DEBUG 2025/12/17 17:15:00   Bucket[42]: Key=新化高中, DocCount=138
DEBUG 2025/12/17 17:15:00   Bucket[43]: Key=鳳山高中, DocCount=136
DEBUG 2025/12/17 17:15:00   Bucket[44]: Key=南大附中, DocCount=133
DEBUG 2025/12/17 17:15:00   Bucket[45]: Key=水里商工, DocCount=126
DEBUG 2025/12/17 17:15:00   Bucket[46]: Key=北斗家商, DocCount=109
DEBUG 2025/12/17 17:15:00   Bucket[47]: Key=師大附中國中部, DocCount=109
DEBUG 2025/12/17 17:15:00   Bucket[48]: Key=師大附中高中部, DocCount=98
DEBUG 2025/12/17 17:15:00   Bucket[49]: Key=彰化高商, DocCount=95
DEBUG 2025/12/17 17:15:00   Bucket[50]: Key=旗山農工, DocCount=95
DEBUG 2025/12/17 17:15:00   Bucket[51]: Key=嘉義高中, DocCount=94
DEBUG 2025/12/17 17:15:00   Bucket[52]: Key=屏科實中, DocCount=93
DEBUG 2025/12/17 17:15:00   Bucket[53]: Key=屏東高中, DocCount=89
DEBUG 2025/12/17 17:15:00   Bucket[54]: Key=興大附農, DocCount=89
DEBUG 2025/12/17 17:15:00   Bucket[55]: Key=新竹高工, DocCount=87
DEBUG 2025/12/17 17:15:00   Bucket[56]: Key=中興高中, DocCount=86
DEBUG 2025/12/17 17:15:00   Bucket[57]: Key=高餐大附中, DocCount=83
DEBUG 2025/12/17 17:15:00   Bucket[58]: Key=苗栗高商, DocCount=80
DEBUG 2025/12/17 17:15:00   Bucket[59]: Key=善化高中, DocCount=79
DEBUG 2025/12/17 17:15:00   Bucket[60]: Key=新營高中, DocCount=73
DEBUG 2025/12/17 17:15:00   Bucket[61]: Key=花蓮特教, DocCount=73
DEBUG 2025/12/17 17:15:00   Bucket[62]: Key=新豐高中, DocCount=71
DEBUG 2025/12/17 17:15:00   Bucket[63]: Key=溪湖高中, DocCount=71
DEBUG 2025/12/17 17:15:00   Bucket[64]: Key=草屯商工, DocCount=66
DEBUG 2025/12/17 17:15:00   Bucket[65]: Key=成大南工, DocCount=65
DEBUG 2025/12/17 17:15:00   Bucket[66]: Key=羅東高商, DocCount=65
DEBUG 2025/12/17 17:15:00   Bucket[67]: Key=新竹高商, DocCount=63
DEBUG 2025/12/17 17:15:00   Bucket[68]: Key=臺南高商, DocCount=63
DEBUG 2025/12/17 17:15:00   Bucket[69]: Key=南大附小, DocCount=62
DEBUG 2025/12/17 17:15:00   Bucket[70]: Key=永靖高工, DocCount=62
DEBUG 2025/12/17 17:15:00   Bucket[71]: Key=潮州高中, DocCount=61
DEBUG 2025/12/17 17:15:00   Bucket[72]: Key=雲林特教, DocCount=61
DEBUG 2025/12/17 17:15:00   Bucket[73]: Key=北教大實小, DocCount=59
DEBUG 2025/12/17 17:15:00   Bucket[74]: Key=基隆商工, DocCount=57
DEBUG 2025/12/17 17:15:00   Bucket[75]: Key=屏東高工, DocCount=55
DEBUG 2025/12/17 17:15:00   Bucket[76]: Key=員林高中, DocCount=54
DEBUG 2025/12/17 17:15:00   Bucket[77]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 17:15:00   Bucket[78]: Key=二林工商, DocCount=53
DEBUG 2025/12/17 17:15:00   Bucket[79]: Key=臺南一中, DocCount=53
DEBUG 2025/12/17 17:15:00   Bucket[80]: Key=埔里高工, DocCount=52
DEBUG 2025/12/17 17:15:00   Bucket[81]: Key=政大附中, DocCount=51
DEBUG 2025/12/17 17:15:00   Bucket[82]: Key=暨大附中, DocCount=51
DEBUG 2025/12/17 17:15:00   Bucket[83]: Key=宜蘭高中, DocCount=50
DEBUG 2025/12/17 17:15:00   Bucket[84]: Key=北港高中, DocCount=49
DEBUG 2025/12/17 17:15:00   Bucket[85]: Key=海大附中, DocCount=49
DEBUG 2025/12/17 17:15:00   Bucket[86]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:15:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:15:00   Bucket[88]: Key=嘉義家職, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[89]: Key=東石高中, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[90]: Key=竹東高中, DocCount=47
DEBUG 2025/12/17 17:15:00   Bucket[91]: Key=北港農工, DocCount=46
DEBUG 2025/12/17 17:15:00   Bucket[92]: Key=曾文農工, DocCount=45
DEBUG 2025/12/17 17:15:00   Bucket[93]: Key=秀水高工, DocCount=45
DEBUG 2025/12/17 17:15:00   Bucket[94]: Key=嘉義高工, DocCount=43
DEBUG 2025/12/17 17:15:00   Bucket[95]: Key=白河商工, DocCount=43
DEBUG 2025/12/17 17:15:00   Bucket[96]: Key=花蓮高中, DocCount=42
DEBUG 2025/12/17 17:15:00   Bucket[97]: Key=玉井工商, DocCount=41
DEBUG 2025/12/17 17:15:00   Bucket[98]: Key=臺東高商, DocCount=41
DEBUG 2025/12/17 17:15:00   Bucket[99]: Key=花蓮高工, DocCount=40
DEBUG 2025/12/17 17:15:00 ========================================================
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:15:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:15:08 ✅ Successfully flushed 30/30 history records to TimescaleDB
INFO 2025/12/17 17:15:08 Processing 15 offline devices
INFO 2025/12/17 17:15:08 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:15:08 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:15:08 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:15:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:15:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:15:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:15:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:15:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:15:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:15:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:15:09 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:15:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:15:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:15:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:15:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:15:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:15:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:15:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:15:09 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:15:09 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:15:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:15:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:15:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:15:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:15:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:15:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:15:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:15:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:15:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:15:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:15:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:15:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:15:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:15:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:15:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:15:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:15:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:15:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:15:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.52% (threshold: 80.00%)
INFO 2025/12/17 17:15:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.47% (threshold: 85.00%)
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:15:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:15:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:15:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:15:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:15:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:16:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:16:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:16:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:16:00 Field: school_name.keyword
DEBUG 2025/12/17 17:16:00 Time From: 2025-12-17T17:15:00.000+08:00
DEBUG 2025/12/17 17:16:00 Time To: 2025-12-17T17:16:00.000+08:00
DEBUG 2025/12/17 17:16:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:15:00.000+08:00",
					"lte": "2025-12-17T17:16:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:16:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:16:00 ES Response IsError: false
DEBUG 2025/12/17 17:16:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":488,"buckets":[{"key":"黑快馬主機","doc_count":910},{"key":"花蓮高農","doc_count":781},{"key":"金門農工","doc_count":603},{"key":"金門高中","doc_count":598},{"key":"新港藝高","doc_count":589},{"key":"仁愛高農","doc_count":544},{"key":"新竹女中","doc_count":544},{"key":"華僑高中","doc_count":437},{"key":"北門高中","doc_count":408},{"key":"宜蘭高商","doc_count":406},{"key":"臺東高中","doc_count":393},{"key":"竹北高中","doc_count":350},{"key":"興大附中","doc_count":340},{"key":"嘉科實中","doc_count":335},{"key":"南投高商","doc_count":320},{"key":"內埔農工","doc_count":300},{"key":"旗美高中","doc_count":294},{"key":"蘇澳海事","doc_count":291},{"key":"新化高工","doc_count":281},{"key":"玉里高中","doc_count":272},{"key":"清華附小","doc_count":270},{"key":"花蓮高商","doc_count":247},{"key":"關西高中","doc_count":238},{"key":"彰師附工","doc_count":212},{"key":"中大壢中","doc_count":211},{"key":"關山工商","doc_count":197},{"key":"斗六家商","doc_count":187},{"key":"後壁高中","doc_count":184},{"key":"嘉義高商","doc_count":176},{"key":"苗栗農工","doc_count":176},{"key":"竹南高中","doc_count":174},{"key":"屏東女中","doc_count":161},{"key":"新化高中","doc_count":152},{"key":"南投特教","doc_count":146},{"key":"虎尾高中","doc_count":146},{"key":"員林家商","doc_count":145},{"key":"南投高中","doc_count":135},{"key":"東港海事","doc_count":133},{"key":"中興高中","doc_count":132},{"key":"羅東高商","doc_count":131},{"key":"員林農工","doc_count":123},{"key":"基隆商工","doc_count":121},{"key":"南大附聰","doc_count":120},{"key":"新營高工","doc_count":117},{"key":"新營高中","doc_count":112},{"key":"屏東高中","doc_count":111},{"key":"北教大實小","doc_count":101},{"key":"嘉義高中","doc_count":97},{"key":"南大附中","doc_count":93},{"key":"新竹高中","doc_count":92},{"key":"臺南一中","doc_count":92},{"key":"成大南工","doc_count":90},{"key":"鳳山高中","doc_count":90},{"key":"暨大附中","doc_count":89},{"key":"溪湖高中","doc_count":85},{"key":"潮州高中","doc_count":82},{"key":"新竹高商","doc_count":79},{"key":"雲林特教","doc_count":75},{"key":"新豐高中","doc_count":74},{"key":"臺南高商","doc_count":74},{"key":"彰化高商","doc_count":73},{"key":"師大附中高中部","doc_count":71},{"key":"新竹高工","doc_count":71},{"key":"水里商工","doc_count":71},{"key":"嘉義家職","doc_count":70},{"key":"苗栗高商","doc_count":70},{"key":"北斗家商","doc_count":68},{"key":"屏科實中","doc_count":67},{"key":"澎湖海事","doc_count":63},{"key":"草屯商工","doc_count":63},{"key":"東石高中","doc_count":59},{"key":"二林工商","doc_count":57},{"key":"海大附中","doc_count":55},{"key":"竹東高中","doc_count":55},{"key":"旗山農工","doc_count":54},{"key":"秀水高工","doc_count":54},{"key":"北港農工","doc_count":53},{"key":"善化高中","doc_count":53},{"key":"埔里高工","doc_count":53},{"key":"蘭陽女中","doc_count":53},{"key":"嘉義高工","doc_count":52},{"key":"北港高中","doc_count":51},{"key":"屏東特教","doc_count":51},{"key":"政大附中","doc_count":51},{"key":"竹山高中","doc_count":51},{"key":"高餐大附中","doc_count":50},{"key":"佳冬高農","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":46},{"key":"屏東高工","doc_count":45},{"key":"臺東高商","doc_count":45},{"key":"家齊高中","doc_count":44},{"key":"花蓮高工","doc_count":44},{"key":"玉井工商","doc_count":43},{"key":"崇實高工","doc_count":42},{"key":"曾文農工","doc_count":42},{"key":"白河商工","doc_count":42},{"key":"屏北高中","doc_count":41},{"key":"宜蘭高中","doc_count":40},{"key":"臺東女中","doc_count":40}]}}}
DEBUG 2025/12/17 17:16:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:16:00   Bucket[0]: Key=黑快馬主機, DocCount=910
DEBUG 2025/12/17 17:16:00   Bucket[1]: Key=花蓮高農, DocCount=781
DEBUG 2025/12/17 17:16:00   Bucket[2]: Key=金門農工, DocCount=603
DEBUG 2025/12/17 17:16:00   Bucket[3]: Key=金門高中, DocCount=598
DEBUG 2025/12/17 17:16:00   Bucket[4]: Key=新港藝高, DocCount=589
DEBUG 2025/12/17 17:16:00   Bucket[5]: Key=仁愛高農, DocCount=544
DEBUG 2025/12/17 17:16:00   Bucket[6]: Key=新竹女中, DocCount=544
DEBUG 2025/12/17 17:16:00   Bucket[7]: Key=華僑高中, DocCount=437
DEBUG 2025/12/17 17:16:00   Bucket[8]: Key=北門高中, DocCount=408
DEBUG 2025/12/17 17:16:00   Bucket[9]: Key=宜蘭高商, DocCount=406
DEBUG 2025/12/17 17:16:00   Bucket[10]: Key=臺東高中, DocCount=393
DEBUG 2025/12/17 17:16:00   Bucket[11]: Key=竹北高中, DocCount=350
DEBUG 2025/12/17 17:16:00   Bucket[12]: Key=興大附中, DocCount=340
DEBUG 2025/12/17 17:16:00   Bucket[13]: Key=嘉科實中, DocCount=335
DEBUG 2025/12/17 17:16:00   Bucket[14]: Key=南投高商, DocCount=320
DEBUG 2025/12/17 17:16:00   Bucket[15]: Key=內埔農工, DocCount=300
DEBUG 2025/12/17 17:16:00   Bucket[16]: Key=旗美高中, DocCount=294
DEBUG 2025/12/17 17:16:00   Bucket[17]: Key=蘇澳海事, DocCount=291
DEBUG 2025/12/17 17:16:00   Bucket[18]: Key=新化高工, DocCount=281
DEBUG 2025/12/17 17:16:00   Bucket[19]: Key=玉里高中, DocCount=272
DEBUG 2025/12/17 17:16:00   Bucket[20]: Key=清華附小, DocCount=270
DEBUG 2025/12/17 17:16:00   Bucket[21]: Key=花蓮高商, DocCount=247
DEBUG 2025/12/17 17:16:00   Bucket[22]: Key=關西高中, DocCount=238
DEBUG 2025/12/17 17:16:00   Bucket[23]: Key=彰師附工, DocCount=212
DEBUG 2025/12/17 17:16:00   Bucket[24]: Key=中大壢中, DocCount=211
DEBUG 2025/12/17 17:16:00   Bucket[25]: Key=關山工商, DocCount=197
DEBUG 2025/12/17 17:16:00   Bucket[26]: Key=斗六家商, DocCount=187
DEBUG 2025/12/17 17:16:00   Bucket[27]: Key=後壁高中, DocCount=184
DEBUG 2025/12/17 17:16:00   Bucket[28]: Key=嘉義高商, DocCount=176
DEBUG 2025/12/17 17:16:00   Bucket[29]: Key=苗栗農工, DocCount=176
DEBUG 2025/12/17 17:16:00   Bucket[30]: Key=竹南高中, DocCount=174
DEBUG 2025/12/17 17:16:00   Bucket[31]: Key=屏東女中, DocCount=161
DEBUG 2025/12/17 17:16:00   Bucket[32]: Key=新化高中, DocCount=152
DEBUG 2025/12/17 17:16:00   Bucket[33]: Key=南投特教, DocCount=146
DEBUG 2025/12/17 17:16:00   Bucket[34]: Key=虎尾高中, DocCount=146
DEBUG 2025/12/17 17:16:00   Bucket[35]: Key=員林家商, DocCount=145
DEBUG 2025/12/17 17:16:00   Bucket[36]: Key=南投高中, DocCount=135
DEBUG 2025/12/17 17:16:00   Bucket[37]: Key=東港海事, DocCount=133
DEBUG 2025/12/17 17:16:00   Bucket[38]: Key=中興高中, DocCount=132
DEBUG 2025/12/17 17:16:00   Bucket[39]: Key=羅東高商, DocCount=131
DEBUG 2025/12/17 17:16:00   Bucket[40]: Key=員林農工, DocCount=123
DEBUG 2025/12/17 17:16:00   Bucket[41]: Key=基隆商工, DocCount=121
DEBUG 2025/12/17 17:16:00   Bucket[42]: Key=南大附聰, DocCount=120
DEBUG 2025/12/17 17:16:00   Bucket[43]: Key=新營高工, DocCount=117
DEBUG 2025/12/17 17:16:00   Bucket[44]: Key=新營高中, DocCount=112
DEBUG 2025/12/17 17:16:00   Bucket[45]: Key=屏東高中, DocCount=111
DEBUG 2025/12/17 17:16:00   Bucket[46]: Key=北教大實小, DocCount=101
DEBUG 2025/12/17 17:16:00   Bucket[47]: Key=嘉義高中, DocCount=97
DEBUG 2025/12/17 17:16:00   Bucket[48]: Key=南大附中, DocCount=93
DEBUG 2025/12/17 17:16:00   Bucket[49]: Key=新竹高中, DocCount=92
DEBUG 2025/12/17 17:16:00   Bucket[50]: Key=臺南一中, DocCount=92
DEBUG 2025/12/17 17:16:00   Bucket[51]: Key=成大南工, DocCount=90
DEBUG 2025/12/17 17:16:00   Bucket[52]: Key=鳳山高中, DocCount=90
DEBUG 2025/12/17 17:16:00   Bucket[53]: Key=暨大附中, DocCount=89
DEBUG 2025/12/17 17:16:00   Bucket[54]: Key=溪湖高中, DocCount=85
DEBUG 2025/12/17 17:16:00   Bucket[55]: Key=潮州高中, DocCount=82
DEBUG 2025/12/17 17:16:00   Bucket[56]: Key=新竹高商, DocCount=79
DEBUG 2025/12/17 17:16:00   Bucket[57]: Key=雲林特教, DocCount=75
DEBUG 2025/12/17 17:16:00   Bucket[58]: Key=新豐高中, DocCount=74
DEBUG 2025/12/17 17:16:00   Bucket[59]: Key=臺南高商, DocCount=74
DEBUG 2025/12/17 17:16:00   Bucket[60]: Key=彰化高商, DocCount=73
DEBUG 2025/12/17 17:16:00   Bucket[61]: Key=師大附中高中部, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[62]: Key=新竹高工, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[63]: Key=水里商工, DocCount=71
DEBUG 2025/12/17 17:16:00   Bucket[64]: Key=嘉義家職, DocCount=70
DEBUG 2025/12/17 17:16:00   Bucket[65]: Key=苗栗高商, DocCount=70
DEBUG 2025/12/17 17:16:00   Bucket[66]: Key=北斗家商, DocCount=68
DEBUG 2025/12/17 17:16:00   Bucket[67]: Key=屏科實中, DocCount=67
DEBUG 2025/12/17 17:16:00   Bucket[68]: Key=澎湖海事, DocCount=63
DEBUG 2025/12/17 17:16:00   Bucket[69]: Key=草屯商工, DocCount=63
DEBUG 2025/12/17 17:16:00   Bucket[70]: Key=東石高中, DocCount=59
DEBUG 2025/12/17 17:16:00   Bucket[71]: Key=二林工商, DocCount=57
DEBUG 2025/12/17 17:16:00   Bucket[72]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:16:00   Bucket[73]: Key=竹東高中, DocCount=55
DEBUG 2025/12/17 17:16:00   Bucket[74]: Key=旗山農工, DocCount=54
DEBUG 2025/12/17 17:16:00   Bucket[75]: Key=秀水高工, DocCount=54
DEBUG 2025/12/17 17:16:00   Bucket[76]: Key=北港農工, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[77]: Key=善化高中, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[78]: Key=埔里高工, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[79]: Key=蘭陽女中, DocCount=53
DEBUG 2025/12/17 17:16:00   Bucket[80]: Key=嘉義高工, DocCount=52
DEBUG 2025/12/17 17:16:00   Bucket[81]: Key=北港高中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[82]: Key=屏東特教, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[83]: Key=政大附中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[84]: Key=竹山高中, DocCount=51
DEBUG 2025/12/17 17:16:00   Bucket[85]: Key=高餐大附中, DocCount=50
DEBUG 2025/12/17 17:16:00   Bucket[86]: Key=佳冬高農, DocCount=49
DEBUG 2025/12/17 17:16:00   Bucket[87]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:16:00   Bucket[88]: Key=華南高商, DocCount=46
DEBUG 2025/12/17 17:16:00   Bucket[89]: Key=屏東高工, DocCount=45
DEBUG 2025/12/17 17:16:00   Bucket[90]: Key=臺東高商, DocCount=45
DEBUG 2025/12/17 17:16:00   Bucket[91]: Key=家齊高中, DocCount=44
DEBUG 2025/12/17 17:16:00   Bucket[92]: Key=花蓮高工, DocCount=44
DEBUG 2025/12/17 17:16:00   Bucket[93]: Key=玉井工商, DocCount=43
DEBUG 2025/12/17 17:16:00   Bucket[94]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[95]: Key=曾文農工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[96]: Key=白河商工, DocCount=42
DEBUG 2025/12/17 17:16:00   Bucket[97]: Key=屏北高中, DocCount=41
DEBUG 2025/12/17 17:16:00   Bucket[98]: Key=宜蘭高中, DocCount=40
DEBUG 2025/12/17 17:16:00   Bucket[99]: Key=臺東女中, DocCount=40
DEBUG 2025/12/17 17:16:00 ========================================================
INFO 2025/12/17 17:16:03 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 50/57 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:16:06 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:16:08 ✅ Successfully flushed 23/23 history records to TimescaleDB
INFO 2025/12/17 17:16:08 Processing 15 offline devices
INFO 2025/12/17 17:16:08 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:16:08 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:16:08 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:16:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:16:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:16:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:16:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:16:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:16:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:16:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:16:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:16:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:16:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:16:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:16:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:16:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:16:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:16:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:16:09 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:16:09 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:16:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:16:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:16:09 Creating history record for offline device: 土庫商工
INFO 2025/12/17 17:16:09 About to add history to batch for device: 土庫商工
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 土庫商工
INFO 2025/12/17 17:16:09 Creating history record for offline device: 頭城家商
INFO 2025/12/17 17:16:09 About to add history to batch for device: 頭城家商
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 頭城家商
INFO 2025/12/17 17:16:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:16:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:16:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:16:13 ✅ Successfully flushed 19/19 history records to TimescaleDB
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:16:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:16:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:16:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:16:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:16:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:16:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:16:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:16:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:16:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:16:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:16:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:16:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:16:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:16:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:16:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:16:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:16:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:16:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:16:45 ES Alert Created [critical][performance]: Memory usage critical: 90.76% (threshold: 90.00%)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.50% (threshold: 85.00%)
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:16:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:16:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:16:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:16:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:16:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:17:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:17:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:17:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:17:00 Field: school_name.keyword
DEBUG 2025/12/17 17:17:00 Time From: 2025-12-17T17:16:00.000+08:00
DEBUG 2025/12/17 17:17:00 Time To: 2025-12-17T17:17:00.000+08:00
DEBUG 2025/12/17 17:17:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:16:00.000+08:00",
					"lte": "2025-12-17T17:17:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:17:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:17:00 ES Response IsError: false
DEBUG 2025/12/17 17:17:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":91,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":563,"buckets":[{"key":"黑快馬主機","doc_count":2022},{"key":"花蓮高農","doc_count":770},{"key":"新竹女中","doc_count":587},{"key":"仁愛高農","doc_count":582},{"key":"金門高中","doc_count":564},{"key":"金門農工","doc_count":548},{"key":"玉里高中","doc_count":531},{"key":"竹北高中","doc_count":480},{"key":"華僑高中","doc_count":464},{"key":"北門高中","doc_count":452},{"key":"新港藝高","doc_count":415},{"key":"臺東高中","doc_count":408},{"key":"旗美高中","doc_count":400},{"key":"南投高商","doc_count":398},{"key":"宜蘭高商","doc_count":379},{"key":"內埔農工","doc_count":332},{"key":"蘇澳海事","doc_count":326},{"key":"興大附中","doc_count":312},{"key":"清華附小","doc_count":257},{"key":"新化高工","doc_count":232},{"key":"關西高中","doc_count":225},{"key":"竹南高中","doc_count":215},{"key":"斗六家商","doc_count":204},{"key":"中大壢中","doc_count":202},{"key":"花蓮高商","doc_count":201},{"key":"苗栗農工","doc_count":200},{"key":"後壁高中","doc_count":190},{"key":"關山工商","doc_count":173},{"key":"花蓮高中","doc_count":168},{"key":"新化高中","doc_count":165},{"key":"新營高中","doc_count":163},{"key":"師大附中高中部","doc_count":157},{"key":"南投特教","doc_count":155},{"key":"東港海事","doc_count":149},{"key":"嘉義高商","doc_count":137},{"key":"屏東女中","doc_count":137},{"key":"彰師附工","doc_count":135},{"key":"虎尾高中","doc_count":126},{"key":"中興高中","doc_count":120},{"key":"水里商工","doc_count":118},{"key":"嘉義高中","doc_count":114},{"key":"新竹高工","doc_count":113},{"key":"成大南工","doc_count":112},{"key":"花蓮高工","doc_count":112},{"key":"彰化高商","doc_count":111},{"key":"苗栗高中","doc_count":110},{"key":"草屯商工","doc_count":110},{"key":"新營高工","doc_count":108},{"key":"南投高中","doc_count":106},{"key":"新竹高商","doc_count":105},{"key":"南大附聰","doc_count":104},{"key":"員林家商","doc_count":104},{"key":"曾文農工","doc_count":104},{"key":"嘉科實中","doc_count":101},{"key":"新竹高中","doc_count":101},{"key":"宜蘭高中","doc_count":95},{"key":"員林農工","doc_count":91},{"key":"員林高中","doc_count":89},{"key":"屏科實中","doc_count":88},{"key":"旗山農工","doc_count":87},{"key":"蘭陽女中","doc_count":82},{"key":"高餐大附中","doc_count":82},{"key":"善化高中","doc_count":80},{"key":"北斗家商","doc_count":78},{"key":"秀水高工","doc_count":78},{"key":"北教大實小","doc_count":76},{"key":"成功商水","doc_count":76},{"key":"崇實高工","doc_count":75},{"key":"雲林特教","doc_count":74},{"key":"臺東高商","doc_count":71},{"key":"屏東高中","doc_count":68},{"key":"潮州高中","doc_count":68},{"key":"鳳山高中","doc_count":66},{"key":"東石高中","doc_count":65},{"key":"白河商工","doc_count":64},{"key":"北港農工","doc_count":62},{"key":"羅東高工","doc_count":62},{"key":"羅東高商","doc_count":61},{"key":"臺南高商","doc_count":61},{"key":"屏東高工","doc_count":59},{"key":"土庫商工","doc_count":58},{"key":"臺南一中","doc_count":56},{"key":"暨大附中","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"頭城家商","doc_count":54},{"key":"南大附中","doc_count":53},{"key":"屏東特教","doc_count":52},{"key":"竹山高中","doc_count":52},{"key":"北港高中","doc_count":51},{"key":"竹東高中","doc_count":51},{"key":"二林工商","doc_count":50},{"key":"苗栗高商","doc_count":49},{"key":"澎湖海事","doc_count":48},{"key":"屏北高中","doc_count":47},{"key":"玉井工商","doc_count":47},{"key":"華南高商","doc_count":47},{"key":"永靖高工","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"埔里高工","doc_count":45},{"key":"臺東女中","doc_count":45}]}}}
DEBUG 2025/12/17 17:17:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:17:00   Bucket[0]: Key=黑快馬主機, DocCount=2022
DEBUG 2025/12/17 17:17:00   Bucket[1]: Key=花蓮高農, DocCount=770
DEBUG 2025/12/17 17:17:00   Bucket[2]: Key=新竹女中, DocCount=587
DEBUG 2025/12/17 17:17:00   Bucket[3]: Key=仁愛高農, DocCount=582
DEBUG 2025/12/17 17:17:00   Bucket[4]: Key=金門高中, DocCount=564
DEBUG 2025/12/17 17:17:00   Bucket[5]: Key=金門農工, DocCount=548
DEBUG 2025/12/17 17:17:00   Bucket[6]: Key=玉里高中, DocCount=531
DEBUG 2025/12/17 17:17:00   Bucket[7]: Key=竹北高中, DocCount=480
DEBUG 2025/12/17 17:17:00   Bucket[8]: Key=華僑高中, DocCount=464
DEBUG 2025/12/17 17:17:00   Bucket[9]: Key=北門高中, DocCount=452
DEBUG 2025/12/17 17:17:00   Bucket[10]: Key=新港藝高, DocCount=415
DEBUG 2025/12/17 17:17:00   Bucket[11]: Key=臺東高中, DocCount=408
DEBUG 2025/12/17 17:17:00   Bucket[12]: Key=旗美高中, DocCount=400
DEBUG 2025/12/17 17:17:00   Bucket[13]: Key=南投高商, DocCount=398
DEBUG 2025/12/17 17:17:00   Bucket[14]: Key=宜蘭高商, DocCount=379
DEBUG 2025/12/17 17:17:00   Bucket[15]: Key=內埔農工, DocCount=332
DEBUG 2025/12/17 17:17:00   Bucket[16]: Key=蘇澳海事, DocCount=326
DEBUG 2025/12/17 17:17:00   Bucket[17]: Key=興大附中, DocCount=312
DEBUG 2025/12/17 17:17:00   Bucket[18]: Key=清華附小, DocCount=257
DEBUG 2025/12/17 17:17:00   Bucket[19]: Key=新化高工, DocCount=232
DEBUG 2025/12/17 17:17:00   Bucket[20]: Key=關西高中, DocCount=225
DEBUG 2025/12/17 17:17:00   Bucket[21]: Key=竹南高中, DocCount=215
DEBUG 2025/12/17 17:17:00   Bucket[22]: Key=斗六家商, DocCount=204
DEBUG 2025/12/17 17:17:00   Bucket[23]: Key=中大壢中, DocCount=202
DEBUG 2025/12/17 17:17:00   Bucket[24]: Key=花蓮高商, DocCount=201
DEBUG 2025/12/17 17:17:00   Bucket[25]: Key=苗栗農工, DocCount=200
DEBUG 2025/12/17 17:17:00   Bucket[26]: Key=後壁高中, DocCount=190
DEBUG 2025/12/17 17:17:00   Bucket[27]: Key=關山工商, DocCount=173
DEBUG 2025/12/17 17:17:00   Bucket[28]: Key=花蓮高中, DocCount=168
DEBUG 2025/12/17 17:17:00   Bucket[29]: Key=新化高中, DocCount=165
DEBUG 2025/12/17 17:17:00   Bucket[30]: Key=新營高中, DocCount=163
DEBUG 2025/12/17 17:17:00   Bucket[31]: Key=師大附中高中部, DocCount=157
DEBUG 2025/12/17 17:17:00   Bucket[32]: Key=南投特教, DocCount=155
DEBUG 2025/12/17 17:17:00   Bucket[33]: Key=東港海事, DocCount=149
DEBUG 2025/12/17 17:17:00   Bucket[34]: Key=嘉義高商, DocCount=137
DEBUG 2025/12/17 17:17:00   Bucket[35]: Key=屏東女中, DocCount=137
DEBUG 2025/12/17 17:17:00   Bucket[36]: Key=彰師附工, DocCount=135
DEBUG 2025/12/17 17:17:00   Bucket[37]: Key=虎尾高中, DocCount=126
DEBUG 2025/12/17 17:17:00   Bucket[38]: Key=中興高中, DocCount=120
DEBUG 2025/12/17 17:17:00   Bucket[39]: Key=水里商工, DocCount=118
DEBUG 2025/12/17 17:17:00   Bucket[40]: Key=嘉義高中, DocCount=114
DEBUG 2025/12/17 17:17:00   Bucket[41]: Key=新竹高工, DocCount=113
DEBUG 2025/12/17 17:17:00   Bucket[42]: Key=成大南工, DocCount=112
DEBUG 2025/12/17 17:17:00   Bucket[43]: Key=花蓮高工, DocCount=112
DEBUG 2025/12/17 17:17:00   Bucket[44]: Key=彰化高商, DocCount=111
DEBUG 2025/12/17 17:17:00   Bucket[45]: Key=苗栗高中, DocCount=110
DEBUG 2025/12/17 17:17:00   Bucket[46]: Key=草屯商工, DocCount=110
DEBUG 2025/12/17 17:17:00   Bucket[47]: Key=新營高工, DocCount=108
DEBUG 2025/12/17 17:17:00   Bucket[48]: Key=南投高中, DocCount=106
DEBUG 2025/12/17 17:17:00   Bucket[49]: Key=新竹高商, DocCount=105
DEBUG 2025/12/17 17:17:00   Bucket[50]: Key=南大附聰, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[51]: Key=員林家商, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[52]: Key=曾文農工, DocCount=104
DEBUG 2025/12/17 17:17:00   Bucket[53]: Key=嘉科實中, DocCount=101
DEBUG 2025/12/17 17:17:00   Bucket[54]: Key=新竹高中, DocCount=101
DEBUG 2025/12/17 17:17:00   Bucket[55]: Key=宜蘭高中, DocCount=95
DEBUG 2025/12/17 17:17:00   Bucket[56]: Key=員林農工, DocCount=91
DEBUG 2025/12/17 17:17:00   Bucket[57]: Key=員林高中, DocCount=89
DEBUG 2025/12/17 17:17:00   Bucket[58]: Key=屏科實中, DocCount=88
DEBUG 2025/12/17 17:17:00   Bucket[59]: Key=旗山農工, DocCount=87
DEBUG 2025/12/17 17:17:00   Bucket[60]: Key=蘭陽女中, DocCount=82
DEBUG 2025/12/17 17:17:00   Bucket[61]: Key=高餐大附中, DocCount=82
DEBUG 2025/12/17 17:17:00   Bucket[62]: Key=善化高中, DocCount=80
DEBUG 2025/12/17 17:17:00   Bucket[63]: Key=北斗家商, DocCount=78
DEBUG 2025/12/17 17:17:00   Bucket[64]: Key=秀水高工, DocCount=78
DEBUG 2025/12/17 17:17:00   Bucket[65]: Key=北教大實小, DocCount=76
DEBUG 2025/12/17 17:17:00   Bucket[66]: Key=成功商水, DocCount=76
DEBUG 2025/12/17 17:17:00   Bucket[67]: Key=崇實高工, DocCount=75
DEBUG 2025/12/17 17:17:00   Bucket[68]: Key=雲林特教, DocCount=74
DEBUG 2025/12/17 17:17:00   Bucket[69]: Key=臺東高商, DocCount=71
DEBUG 2025/12/17 17:17:00   Bucket[70]: Key=屏東高中, DocCount=68
DEBUG 2025/12/17 17:17:00   Bucket[71]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:17:00   Bucket[72]: Key=鳳山高中, DocCount=66
DEBUG 2025/12/17 17:17:00   Bucket[73]: Key=東石高中, DocCount=65
DEBUG 2025/12/17 17:17:00   Bucket[74]: Key=白河商工, DocCount=64
DEBUG 2025/12/17 17:17:00   Bucket[75]: Key=北港農工, DocCount=62
DEBUG 2025/12/17 17:17:00   Bucket[76]: Key=羅東高工, DocCount=62
DEBUG 2025/12/17 17:17:00   Bucket[77]: Key=羅東高商, DocCount=61
DEBUG 2025/12/17 17:17:00   Bucket[78]: Key=臺南高商, DocCount=61
DEBUG 2025/12/17 17:17:00   Bucket[79]: Key=屏東高工, DocCount=59
DEBUG 2025/12/17 17:17:00   Bucket[80]: Key=土庫商工, DocCount=58
DEBUG 2025/12/17 17:17:00   Bucket[81]: Key=臺南一中, DocCount=56
DEBUG 2025/12/17 17:17:00   Bucket[82]: Key=暨大附中, DocCount=55
DEBUG 2025/12/17 17:17:00   Bucket[83]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:17:00   Bucket[84]: Key=頭城家商, DocCount=54
DEBUG 2025/12/17 17:17:00   Bucket[85]: Key=南大附中, DocCount=53
DEBUG 2025/12/17 17:17:00   Bucket[86]: Key=屏東特教, DocCount=52
DEBUG 2025/12/17 17:17:00   Bucket[87]: Key=竹山高中, DocCount=52
DEBUG 2025/12/17 17:17:00   Bucket[88]: Key=北港高中, DocCount=51
DEBUG 2025/12/17 17:17:00   Bucket[89]: Key=竹東高中, DocCount=51
DEBUG 2025/12/17 17:17:00   Bucket[90]: Key=二林工商, DocCount=50
DEBUG 2025/12/17 17:17:00   Bucket[91]: Key=苗栗高商, DocCount=49
DEBUG 2025/12/17 17:17:00   Bucket[92]: Key=澎湖海事, DocCount=48
DEBUG 2025/12/17 17:17:00   Bucket[93]: Key=屏北高中, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[94]: Key=玉井工商, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[95]: Key=華南高商, DocCount=47
DEBUG 2025/12/17 17:17:00   Bucket[96]: Key=永靖高工, DocCount=46
DEBUG 2025/12/17 17:17:00   Bucket[97]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:17:00   Bucket[98]: Key=埔里高工, DocCount=45
DEBUG 2025/12/17 17:17:00   Bucket[99]: Key=臺東女中, DocCount=45
DEBUG 2025/12/17 17:17:00 ========================================================
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 50/54 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:17:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:17:13 Processing 15 offline devices
INFO 2025/12/17 17:17:13 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:17:13 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:17:13 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:17:13 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:17:13 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:17:13 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:17:13 ✅ Successfully flushed 44/44 history records to TimescaleDB
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:17:13 Creating history record for offline device: 興大附農
INFO 2025/12/17 17:17:13 About to add history to batch for device: 興大附農
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 興大附農
INFO 2025/12/17 17:17:13 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:17:13 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:17:13 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:17:13 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:17:13 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:17:13 Creating history record for offline device: 政大附中
INFO 2025/12/17 17:17:13 About to add history to batch for device: 政大附中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 政大附中
INFO 2025/12/17 17:17:14 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:17:14 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:17:14 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:17:14 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:17:14 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:17:14 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:17:14 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:17:14 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:17:14 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:17:14 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:17:14 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:17:14 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:17:14 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:17:18 ✅ Successfully flushed 13/13 history records to TimescaleDB
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:17:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:17:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:17:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:17:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:17:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:17:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:17:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:17:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:17:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:17:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:17:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:17:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:17:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:17:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:17:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:17:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:17:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.86% (threshold: 80.00%)
INFO 2025/12/17 17:17:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.53% (threshold: 85.00%)
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:17:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:17:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:17:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:17:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:17:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:18:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:18:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:18:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:18:00 Field: school_name.keyword
DEBUG 2025/12/17 17:18:00 Time From: 2025-12-17T17:17:00.000+08:00
DEBUG 2025/12/17 17:18:00 Time To: 2025-12-17T17:18:00.000+08:00
DEBUG 2025/12/17 17:18:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:17:00.000+08:00",
					"lte": "2025-12-17T17:18:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:18:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:18:00 ES Response IsError: false
DEBUG 2025/12/17 17:18:00 ES Response Body:
{"took":64,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"黑快馬主機","doc_count":982},{"key":"花蓮高農","doc_count":783},{"key":"金門農工","doc_count":741},{"key":"金門高中","doc_count":552},{"key":"仁愛高農","doc_count":550},{"key":"竹北高中","doc_count":505},{"key":"新竹女中","doc_count":465},{"key":"北門高中","doc_count":428},{"key":"華僑高中","doc_count":422},{"key":"中大壢中","doc_count":395},{"key":"旗美高中","doc_count":370},{"key":"臺東高中","doc_count":349},{"key":"宜蘭高商","doc_count":343},{"key":"內埔農工","doc_count":327},{"key":"南投高商","doc_count":327},{"key":"花蓮高商","doc_count":269},{"key":"新化高中","doc_count":262},{"key":"蘇澳海事","doc_count":258},{"key":"後壁高中","doc_count":253},{"key":"興大附中","doc_count":253},{"key":"新港藝高","doc_count":248},{"key":"清華附小","doc_count":219},{"key":"斗六家商","doc_count":218},{"key":"關山工商","doc_count":189},{"key":"關西高中","doc_count":184},{"key":"玉里高中","doc_count":176},{"key":"中興高中","doc_count":175},{"key":"竹南高中","doc_count":172},{"key":"苗栗農工","doc_count":167},{"key":"員林家商","doc_count":166},{"key":"旗山農工","doc_count":157},{"key":"南投特教","doc_count":153},{"key":"東港海事","doc_count":153},{"key":"屏東女中","doc_count":151},{"key":"成大南工","doc_count":145},{"key":"新營高中","doc_count":134},{"key":"嘉義高商","doc_count":128},{"key":"政大附中","doc_count":126},{"key":"新營高工","doc_count":124},{"key":"南大附聰","doc_count":118},{"key":"師大附中國中部","doc_count":114},{"key":"彰師附工","doc_count":113},{"key":"新化高工","doc_count":112},{"key":"虎尾高中","doc_count":112},{"key":"永靖高工","doc_count":98},{"key":"南投高中","doc_count":96},{"key":"屏科實中","doc_count":89},{"key":"新竹高工","doc_count":86},{"key":"臺東高商","doc_count":85},{"key":"師大附中高中部","doc_count":83},{"key":"高餐大附中","doc_count":83},{"key":"曾文農工","doc_count":82},{"key":"北教大實小","doc_count":81},{"key":"鳳山高中","doc_count":80},{"key":"彰化高商","doc_count":79},{"key":"苗栗高中","doc_count":78},{"key":"嘉義高中","doc_count":77},{"key":"屏東高工","doc_count":75},{"key":"臺南一中","doc_count":74},{"key":"員林高中","doc_count":70},{"key":"屏東高中","doc_count":70},{"key":"嘉科實中","doc_count":65},{"key":"澎湖海事","doc_count":65},{"key":"北港農工","doc_count":64},{"key":"南大附小","doc_count":63},{"key":"成功商水","doc_count":63},{"key":"北港高中","doc_count":61},{"key":"土庫商工","doc_count":61},{"key":"基隆商工","doc_count":61},{"key":"華南高商","doc_count":61},{"key":"新竹高中","doc_count":59},{"key":"新竹高商","doc_count":59},{"key":"雲林特教","doc_count":59},{"key":"善化高中","doc_count":58},{"key":"埔里高工","doc_count":57},{"key":"暨大附中","doc_count":57},{"key":"竹東高中","doc_count":57},{"key":"花蓮高工","doc_count":57},{"key":"員林農工","doc_count":55},{"key":"蘭陽女中","doc_count":55},{"key":"頭城家商","doc_count":55},{"key":"屏東特教","doc_count":54},{"key":"苗栗高商","doc_count":53},{"key":"海大附中","doc_count":52},{"key":"秀水高工","doc_count":52},{"key":"草屯商工","doc_count":52},{"key":"北斗家商","doc_count":49},{"key":"溪湖高中","doc_count":49},{"key":"興大附農","doc_count":49},{"key":"花蓮高中","doc_count":49},{"key":"臺南高商","doc_count":48},{"key":"二林工商","doc_count":47},{"key":"佳冬高農","doc_count":46},{"key":"水里商工","doc_count":45},{"key":"嘉義家職","doc_count":42},{"key":"臺東女中","doc_count":42},{"key":"白河商工","doc_count":41},{"key":"嘉義高工","doc_count":39},{"key":"潮州高中","doc_count":39},{"key":"宜蘭高中","doc_count":37}]}}}
DEBUG 2025/12/17 17:18:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:18:00   Bucket[0]: Key=黑快馬主機, DocCount=982
DEBUG 2025/12/17 17:18:00   Bucket[1]: Key=花蓮高農, DocCount=783
DEBUG 2025/12/17 17:18:00   Bucket[2]: Key=金門農工, DocCount=741
DEBUG 2025/12/17 17:18:00   Bucket[3]: Key=金門高中, DocCount=552
DEBUG 2025/12/17 17:18:00   Bucket[4]: Key=仁愛高農, DocCount=550
DEBUG 2025/12/17 17:18:00   Bucket[5]: Key=竹北高中, DocCount=505
DEBUG 2025/12/17 17:18:00   Bucket[6]: Key=新竹女中, DocCount=465
DEBUG 2025/12/17 17:18:00   Bucket[7]: Key=北門高中, DocCount=428
DEBUG 2025/12/17 17:18:00   Bucket[8]: Key=華僑高中, DocCount=422
DEBUG 2025/12/17 17:18:00   Bucket[9]: Key=中大壢中, DocCount=395
DEBUG 2025/12/17 17:18:00   Bucket[10]: Key=旗美高中, DocCount=370
DEBUG 2025/12/17 17:18:00   Bucket[11]: Key=臺東高中, DocCount=349
DEBUG 2025/12/17 17:18:00   Bucket[12]: Key=宜蘭高商, DocCount=343
DEBUG 2025/12/17 17:18:00   Bucket[13]: Key=內埔農工, DocCount=327
DEBUG 2025/12/17 17:18:00   Bucket[14]: Key=南投高商, DocCount=327
DEBUG 2025/12/17 17:18:00   Bucket[15]: Key=花蓮高商, DocCount=269
DEBUG 2025/12/17 17:18:00   Bucket[16]: Key=新化高中, DocCount=262
DEBUG 2025/12/17 17:18:00   Bucket[17]: Key=蘇澳海事, DocCount=258
DEBUG 2025/12/17 17:18:00   Bucket[18]: Key=後壁高中, DocCount=253
DEBUG 2025/12/17 17:18:00   Bucket[19]: Key=興大附中, DocCount=253
DEBUG 2025/12/17 17:18:00   Bucket[20]: Key=新港藝高, DocCount=248
DEBUG 2025/12/17 17:18:00   Bucket[21]: Key=清華附小, DocCount=219
DEBUG 2025/12/17 17:18:00   Bucket[22]: Key=斗六家商, DocCount=218
DEBUG 2025/12/17 17:18:00   Bucket[23]: Key=關山工商, DocCount=189
DEBUG 2025/12/17 17:18:00   Bucket[24]: Key=關西高中, DocCount=184
DEBUG 2025/12/17 17:18:00   Bucket[25]: Key=玉里高中, DocCount=176
DEBUG 2025/12/17 17:18:00   Bucket[26]: Key=中興高中, DocCount=175
DEBUG 2025/12/17 17:18:00   Bucket[27]: Key=竹南高中, DocCount=172
DEBUG 2025/12/17 17:18:00   Bucket[28]: Key=苗栗農工, DocCount=167
DEBUG 2025/12/17 17:18:00   Bucket[29]: Key=員林家商, DocCount=166
DEBUG 2025/12/17 17:18:00   Bucket[30]: Key=旗山農工, DocCount=157
DEBUG 2025/12/17 17:18:00   Bucket[31]: Key=南投特教, DocCount=153
DEBUG 2025/12/17 17:18:00   Bucket[32]: Key=東港海事, DocCount=153
DEBUG 2025/12/17 17:18:00   Bucket[33]: Key=屏東女中, DocCount=151
DEBUG 2025/12/17 17:18:00   Bucket[34]: Key=成大南工, DocCount=145
DEBUG 2025/12/17 17:18:00   Bucket[35]: Key=新營高中, DocCount=134
DEBUG 2025/12/17 17:18:00   Bucket[36]: Key=嘉義高商, DocCount=128
DEBUG 2025/12/17 17:18:00   Bucket[37]: Key=政大附中, DocCount=126
DEBUG 2025/12/17 17:18:00   Bucket[38]: Key=新營高工, DocCount=124
DEBUG 2025/12/17 17:18:00   Bucket[39]: Key=南大附聰, DocCount=118
DEBUG 2025/12/17 17:18:00   Bucket[40]: Key=師大附中國中部, DocCount=114
DEBUG 2025/12/17 17:18:00   Bucket[41]: Key=彰師附工, DocCount=113
DEBUG 2025/12/17 17:18:00   Bucket[42]: Key=新化高工, DocCount=112
DEBUG 2025/12/17 17:18:00   Bucket[43]: Key=虎尾高中, DocCount=112
DEBUG 2025/12/17 17:18:00   Bucket[44]: Key=永靖高工, DocCount=98
DEBUG 2025/12/17 17:18:00   Bucket[45]: Key=南投高中, DocCount=96
DEBUG 2025/12/17 17:18:00   Bucket[46]: Key=屏科實中, DocCount=89
DEBUG 2025/12/17 17:18:00   Bucket[47]: Key=新竹高工, DocCount=86
DEBUG 2025/12/17 17:18:00   Bucket[48]: Key=臺東高商, DocCount=85
DEBUG 2025/12/17 17:18:00   Bucket[49]: Key=師大附中高中部, DocCount=83
DEBUG 2025/12/17 17:18:00   Bucket[50]: Key=高餐大附中, DocCount=83
DEBUG 2025/12/17 17:18:00   Bucket[51]: Key=曾文農工, DocCount=82
DEBUG 2025/12/17 17:18:00   Bucket[52]: Key=北教大實小, DocCount=81
DEBUG 2025/12/17 17:18:00   Bucket[53]: Key=鳳山高中, DocCount=80
DEBUG 2025/12/17 17:18:00   Bucket[54]: Key=彰化高商, DocCount=79
DEBUG 2025/12/17 17:18:00   Bucket[55]: Key=苗栗高中, DocCount=78
DEBUG 2025/12/17 17:18:00   Bucket[56]: Key=嘉義高中, DocCount=77
DEBUG 2025/12/17 17:18:00   Bucket[57]: Key=屏東高工, DocCount=75
DEBUG 2025/12/17 17:18:00   Bucket[58]: Key=臺南一中, DocCount=74
DEBUG 2025/12/17 17:18:00   Bucket[59]: Key=員林高中, DocCount=70
DEBUG 2025/12/17 17:18:00   Bucket[60]: Key=屏東高中, DocCount=70
DEBUG 2025/12/17 17:18:00   Bucket[61]: Key=嘉科實中, DocCount=65
DEBUG 2025/12/17 17:18:00   Bucket[62]: Key=澎湖海事, DocCount=65
DEBUG 2025/12/17 17:18:00   Bucket[63]: Key=北港農工, DocCount=64
DEBUG 2025/12/17 17:18:00   Bucket[64]: Key=南大附小, DocCount=63
DEBUG 2025/12/17 17:18:00   Bucket[65]: Key=成功商水, DocCount=63
DEBUG 2025/12/17 17:18:00   Bucket[66]: Key=北港高中, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[67]: Key=土庫商工, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[68]: Key=基隆商工, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[69]: Key=華南高商, DocCount=61
DEBUG 2025/12/17 17:18:00   Bucket[70]: Key=新竹高中, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[71]: Key=新竹高商, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[72]: Key=雲林特教, DocCount=59
DEBUG 2025/12/17 17:18:00   Bucket[73]: Key=善化高中, DocCount=58
DEBUG 2025/12/17 17:18:00   Bucket[74]: Key=埔里高工, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[75]: Key=暨大附中, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[76]: Key=竹東高中, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[77]: Key=花蓮高工, DocCount=57
DEBUG 2025/12/17 17:18:00   Bucket[78]: Key=員林農工, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[79]: Key=蘭陽女中, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[80]: Key=頭城家商, DocCount=55
DEBUG 2025/12/17 17:18:00   Bucket[81]: Key=屏東特教, DocCount=54
DEBUG 2025/12/17 17:18:00   Bucket[82]: Key=苗栗高商, DocCount=53
DEBUG 2025/12/17 17:18:00   Bucket[83]: Key=海大附中, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[84]: Key=秀水高工, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[85]: Key=草屯商工, DocCount=52
DEBUG 2025/12/17 17:18:00   Bucket[86]: Key=北斗家商, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[87]: Key=溪湖高中, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[88]: Key=興大附農, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[89]: Key=花蓮高中, DocCount=49
DEBUG 2025/12/17 17:18:00   Bucket[90]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 17:18:00   Bucket[91]: Key=二林工商, DocCount=47
DEBUG 2025/12/17 17:18:00   Bucket[92]: Key=佳冬高農, DocCount=46
DEBUG 2025/12/17 17:18:00   Bucket[93]: Key=水里商工, DocCount=45
DEBUG 2025/12/17 17:18:00   Bucket[94]: Key=嘉義家職, DocCount=42
DEBUG 2025/12/17 17:18:00   Bucket[95]: Key=臺東女中, DocCount=42
DEBUG 2025/12/17 17:18:00   Bucket[96]: Key=白河商工, DocCount=41
DEBUG 2025/12/17 17:18:00   Bucket[97]: Key=嘉義高工, DocCount=39
DEBUG 2025/12/17 17:18:00   Bucket[98]: Key=潮州高中, DocCount=39
DEBUG 2025/12/17 17:18:00   Bucket[99]: Key=宜蘭高中, DocCount=37
DEBUG 2025/12/17 17:18:00 ========================================================
INFO 2025/12/17 17:18:03 ✅ Successfully flushed 10/10 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:18:07 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:18:08 ✅ Successfully flushed 8/8 history records to TimescaleDB
INFO 2025/12/17 17:18:09 Processing 15 offline devices
INFO 2025/12/17 17:18:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:18:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:18:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:18:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:18:09 Creating history record for offline device: 東石高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 東石高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 東石高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:18:09 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:18:09 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:18:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:18:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:18:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:18:09 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:18:09 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:18:10 Creating history record for offline device: 羅東高工
INFO 2025/12/17 17:18:10 About to add history to batch for device: 羅東高工
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 羅東高工
INFO 2025/12/17 17:18:10 Creating history record for offline device: 南大附中
INFO 2025/12/17 17:18:10 About to add history to batch for device: 南大附中
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 南大附中
INFO 2025/12/17 17:18:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:18:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:18:10 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:18:10 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:18:10 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:18:13 ✅ Successfully flushed 31/31 history records to TimescaleDB
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:18:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:18:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:18:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:18:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:18:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:18:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:18:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:18:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:18:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:18:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:18:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:18:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:18:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:18:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:18:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:18:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:18:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Memory usage high: 88.52% (threshold: 80.00%)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.34% (threshold: 85.00%)
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
INFO 2025/12/17 17:18:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:18:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:18:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:18:45 ES monitor check completed for: ncku, status: online
WARN 2025/12/17 17:18:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:18:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:18:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:18:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:19:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:19:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:19:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:19:00 Field: school_name.keyword
DEBUG 2025/12/17 17:19:00 Time From: 2025-12-17T17:18:00.000+08:00
DEBUG 2025/12/17 17:19:00 Time To: 2025-12-17T17:19:00.000+08:00
DEBUG 2025/12/17 17:19:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:18:00.000+08:00",
					"lte": "2025-12-17T17:19:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:19:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:19:00 ES Response IsError: false
DEBUG 2025/12/17 17:19:00 ES Response Body:
{"took":65,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":516,"buckets":[{"key":"黑快馬主機","doc_count":1247},{"key":"花蓮高農","doc_count":733},{"key":"仁愛高農","doc_count":610},{"key":"金門農工","doc_count":572},{"key":"金門高中","doc_count":546},{"key":"新竹女中","doc_count":522},{"key":"竹北高中","doc_count":465},{"key":"北門高中","doc_count":429},{"key":"南投高商","doc_count":428},{"key":"華僑高中","doc_count":426},{"key":"臺東高中","doc_count":416},{"key":"宜蘭高商","doc_count":387},{"key":"旗美高中","doc_count":377},{"key":"花蓮高商","doc_count":314},{"key":"內埔農工","doc_count":308},{"key":"蘇澳海事","doc_count":289},{"key":"興大附中","doc_count":276},{"key":"斗六家商","doc_count":255},{"key":"屏東女中","doc_count":249},{"key":"清華附小","doc_count":247},{"key":"新港藝高","doc_count":235},{"key":"關西高中","doc_count":216},{"key":"後壁高中","doc_count":210},{"key":"新化高中","doc_count":196},{"key":"中大壢中","doc_count":194},{"key":"彰師附工","doc_count":189},{"key":"關山工商","doc_count":189},{"key":"虎尾高中","doc_count":179},{"key":"員林家商","doc_count":177},{"key":"竹南高中","doc_count":177},{"key":"玉里高中","doc_count":169},{"key":"苗栗農工","doc_count":169},{"key":"東港海事","doc_count":163},{"key":"南投特教","doc_count":156},{"key":"新竹高工","doc_count":155},{"key":"新化高工","doc_count":140},{"key":"新竹高商","doc_count":126},{"key":"嘉義家職","doc_count":122},{"key":"新營高工","doc_count":120},{"key":"嘉義高商","doc_count":108},{"key":"新營高中","doc_count":108},{"key":"鳳山高中","doc_count":105},{"key":"北港農工","doc_count":101},{"key":"南大附聰","doc_count":100},{"key":"臺東高商","doc_count":100},{"key":"屏東高工","doc_count":93},{"key":"師大附中高中部","doc_count":88},{"key":"南大附小","doc_count":87},{"key":"屏科實中","doc_count":87},{"key":"北教大實小","doc_count":86},{"key":"中興高中","doc_count":85},{"key":"員林高中","doc_count":85},{"key":"北斗家商","doc_count":82},{"key":"花蓮高中","doc_count":82},{"key":"屏東高中","doc_count":80},{"key":"政大附中","doc_count":80},{"key":"臺南一中","doc_count":80},{"key":"海大附中","doc_count":78},{"key":"水里商工","doc_count":77},{"key":"苗栗高中","doc_count":77},{"key":"北港高中","doc_count":76},{"key":"成大南工","doc_count":74},{"key":"草屯商工","doc_count":74},{"key":"羅東高商","doc_count":72},{"key":"員林農工","doc_count":71},{"key":"秀水高工","doc_count":69},{"key":"興大附農","doc_count":69},{"key":"宜蘭高中","doc_count":68},{"key":"潮州高中","doc_count":68},{"key":"佳冬高農","doc_count":66},{"key":"旗山農工","doc_count":65},{"key":"永靖高工","doc_count":65},{"key":"嘉義高中","doc_count":63},{"key":"南投高中","doc_count":62},{"key":"頭城家商","doc_count":62},{"key":"高餐大附中","doc_count":61},{"key":"澎湖海事","doc_count":59},{"key":"彰化高商","doc_count":58},{"key":"竹山高中","doc_count":58},{"key":"羅東高工","doc_count":58},{"key":"苗栗高商","doc_count":58},{"key":"屏北高中","doc_count":56},{"key":"東石高中","doc_count":56},{"key":"臺南高商","doc_count":56},{"key":"南大附中","doc_count":53},{"key":"嘉義特教","doc_count":50},{"key":"竹東高中","doc_count":50},{"key":"善化高中","doc_count":49},{"key":"土庫商工","doc_count":48},{"key":"雲林特教","doc_count":48},{"key":"白河商工","doc_count":46},{"key":"花蓮高工","doc_count":45},{"key":"蘭陽女中","doc_count":45},{"key":"嘉科實中","doc_count":44},{"key":"新竹高中","doc_count":44},{"key":"曾文農工","doc_count":44},{"key":"溪湖高中","doc_count":44},{"key":"臺東女中","doc_count":44},{"key":"二林工商","doc_count":43},{"key":"屏東特教","doc_count":42}]}}}
DEBUG 2025/12/17 17:19:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:19:00   Bucket[0]: Key=黑快馬主機, DocCount=1247
DEBUG 2025/12/17 17:19:00   Bucket[1]: Key=花蓮高農, DocCount=733
DEBUG 2025/12/17 17:19:00   Bucket[2]: Key=仁愛高農, DocCount=610
DEBUG 2025/12/17 17:19:00   Bucket[3]: Key=金門農工, DocCount=572
DEBUG 2025/12/17 17:19:00   Bucket[4]: Key=金門高中, DocCount=546
DEBUG 2025/12/17 17:19:00   Bucket[5]: Key=新竹女中, DocCount=522
DEBUG 2025/12/17 17:19:00   Bucket[6]: Key=竹北高中, DocCount=465
DEBUG 2025/12/17 17:19:00   Bucket[7]: Key=北門高中, DocCount=429
DEBUG 2025/12/17 17:19:00   Bucket[8]: Key=南投高商, DocCount=428
DEBUG 2025/12/17 17:19:00   Bucket[9]: Key=華僑高中, DocCount=426
DEBUG 2025/12/17 17:19:00   Bucket[10]: Key=臺東高中, DocCount=416
DEBUG 2025/12/17 17:19:00   Bucket[11]: Key=宜蘭高商, DocCount=387
DEBUG 2025/12/17 17:19:00   Bucket[12]: Key=旗美高中, DocCount=377
DEBUG 2025/12/17 17:19:00   Bucket[13]: Key=花蓮高商, DocCount=314
DEBUG 2025/12/17 17:19:00   Bucket[14]: Key=內埔農工, DocCount=308
DEBUG 2025/12/17 17:19:00   Bucket[15]: Key=蘇澳海事, DocCount=289
DEBUG 2025/12/17 17:19:00   Bucket[16]: Key=興大附中, DocCount=276
DEBUG 2025/12/17 17:19:00   Bucket[17]: Key=斗六家商, DocCount=255
DEBUG 2025/12/17 17:19:00   Bucket[18]: Key=屏東女中, DocCount=249
DEBUG 2025/12/17 17:19:00   Bucket[19]: Key=清華附小, DocCount=247
DEBUG 2025/12/17 17:19:00   Bucket[20]: Key=新港藝高, DocCount=235
DEBUG 2025/12/17 17:19:00   Bucket[21]: Key=關西高中, DocCount=216
DEBUG 2025/12/17 17:19:00   Bucket[22]: Key=後壁高中, DocCount=210
DEBUG 2025/12/17 17:19:00   Bucket[23]: Key=新化高中, DocCount=196
DEBUG 2025/12/17 17:19:00   Bucket[24]: Key=中大壢中, DocCount=194
DEBUG 2025/12/17 17:19:00   Bucket[25]: Key=彰師附工, DocCount=189
DEBUG 2025/12/17 17:19:00   Bucket[26]: Key=關山工商, DocCount=189
DEBUG 2025/12/17 17:19:00   Bucket[27]: Key=虎尾高中, DocCount=179
DEBUG 2025/12/17 17:19:00   Bucket[28]: Key=員林家商, DocCount=177
DEBUG 2025/12/17 17:19:00   Bucket[29]: Key=竹南高中, DocCount=177
DEBUG 2025/12/17 17:19:00   Bucket[30]: Key=玉里高中, DocCount=169
DEBUG 2025/12/17 17:19:00   Bucket[31]: Key=苗栗農工, DocCount=169
DEBUG 2025/12/17 17:19:00   Bucket[32]: Key=東港海事, DocCount=163
DEBUG 2025/12/17 17:19:00   Bucket[33]: Key=南投特教, DocCount=156
DEBUG 2025/12/17 17:19:00   Bucket[34]: Key=新竹高工, DocCount=155
DEBUG 2025/12/17 17:19:00   Bucket[35]: Key=新化高工, DocCount=140
DEBUG 2025/12/17 17:19:00   Bucket[36]: Key=新竹高商, DocCount=126
DEBUG 2025/12/17 17:19:00   Bucket[37]: Key=嘉義家職, DocCount=122
DEBUG 2025/12/17 17:19:00   Bucket[38]: Key=新營高工, DocCount=120
DEBUG 2025/12/17 17:19:00   Bucket[39]: Key=嘉義高商, DocCount=108
DEBUG 2025/12/17 17:19:00   Bucket[40]: Key=新營高中, DocCount=108
DEBUG 2025/12/17 17:19:00   Bucket[41]: Key=鳳山高中, DocCount=105
DEBUG 2025/12/17 17:19:00   Bucket[42]: Key=北港農工, DocCount=101
DEBUG 2025/12/17 17:19:00   Bucket[43]: Key=南大附聰, DocCount=100
DEBUG 2025/12/17 17:19:00   Bucket[44]: Key=臺東高商, DocCount=100
DEBUG 2025/12/17 17:19:00   Bucket[45]: Key=屏東高工, DocCount=93
DEBUG 2025/12/17 17:19:00   Bucket[46]: Key=師大附中高中部, DocCount=88
DEBUG 2025/12/17 17:19:00   Bucket[47]: Key=南大附小, DocCount=87
DEBUG 2025/12/17 17:19:00   Bucket[48]: Key=屏科實中, DocCount=87
DEBUG 2025/12/17 17:19:00   Bucket[49]: Key=北教大實小, DocCount=86
DEBUG 2025/12/17 17:19:00   Bucket[50]: Key=中興高中, DocCount=85
DEBUG 2025/12/17 17:19:00   Bucket[51]: Key=員林高中, DocCount=85
DEBUG 2025/12/17 17:19:00   Bucket[52]: Key=北斗家商, DocCount=82
DEBUG 2025/12/17 17:19:00   Bucket[53]: Key=花蓮高中, DocCount=82
DEBUG 2025/12/17 17:19:00   Bucket[54]: Key=屏東高中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[55]: Key=政大附中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[56]: Key=臺南一中, DocCount=80
DEBUG 2025/12/17 17:19:00   Bucket[57]: Key=海大附中, DocCount=78
DEBUG 2025/12/17 17:19:00   Bucket[58]: Key=水里商工, DocCount=77
DEBUG 2025/12/17 17:19:00   Bucket[59]: Key=苗栗高中, DocCount=77
DEBUG 2025/12/17 17:19:00   Bucket[60]: Key=北港高中, DocCount=76
DEBUG 2025/12/17 17:19:00   Bucket[61]: Key=成大南工, DocCount=74
DEBUG 2025/12/17 17:19:00   Bucket[62]: Key=草屯商工, DocCount=74
DEBUG 2025/12/17 17:19:00   Bucket[63]: Key=羅東高商, DocCount=72
DEBUG 2025/12/17 17:19:00   Bucket[64]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:19:00   Bucket[65]: Key=秀水高工, DocCount=69
DEBUG 2025/12/17 17:19:00   Bucket[66]: Key=興大附農, DocCount=69
DEBUG 2025/12/17 17:19:00   Bucket[67]: Key=宜蘭高中, DocCount=68
DEBUG 2025/12/17 17:19:00   Bucket[68]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:19:00   Bucket[69]: Key=佳冬高農, DocCount=66
DEBUG 2025/12/17 17:19:00   Bucket[70]: Key=旗山農工, DocCount=65
DEBUG 2025/12/17 17:19:00   Bucket[71]: Key=永靖高工, DocCount=65
DEBUG 2025/12/17 17:19:00   Bucket[72]: Key=嘉義高中, DocCount=63
DEBUG 2025/12/17 17:19:00   Bucket[73]: Key=南投高中, DocCount=62
DEBUG 2025/12/17 17:19:00   Bucket[74]: Key=頭城家商, DocCount=62
DEBUG 2025/12/17 17:19:00   Bucket[75]: Key=高餐大附中, DocCount=61
DEBUG 2025/12/17 17:19:00   Bucket[76]: Key=澎湖海事, DocCount=59
DEBUG 2025/12/17 17:19:00   Bucket[77]: Key=彰化高商, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[78]: Key=竹山高中, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[79]: Key=羅東高工, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[80]: Key=苗栗高商, DocCount=58
DEBUG 2025/12/17 17:19:00   Bucket[81]: Key=屏北高中, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[82]: Key=東石高中, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[83]: Key=臺南高商, DocCount=56
DEBUG 2025/12/17 17:19:00   Bucket[84]: Key=南大附中, DocCount=53
DEBUG 2025/12/17 17:19:00   Bucket[85]: Key=嘉義特教, DocCount=50
DEBUG 2025/12/17 17:19:00   Bucket[86]: Key=竹東高中, DocCount=50
DEBUG 2025/12/17 17:19:00   Bucket[87]: Key=善化高中, DocCount=49
DEBUG 2025/12/17 17:19:00   Bucket[88]: Key=土庫商工, DocCount=48
DEBUG 2025/12/17 17:19:00   Bucket[89]: Key=雲林特教, DocCount=48
DEBUG 2025/12/17 17:19:00   Bucket[90]: Key=白河商工, DocCount=46
DEBUG 2025/12/17 17:19:00   Bucket[91]: Key=花蓮高工, DocCount=45
DEBUG 2025/12/17 17:19:00   Bucket[92]: Key=蘭陽女中, DocCount=45
DEBUG 2025/12/17 17:19:00   Bucket[93]: Key=嘉科實中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[94]: Key=新竹高中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[95]: Key=曾文農工, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[96]: Key=溪湖高中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[97]: Key=臺東女中, DocCount=44
DEBUG 2025/12/17 17:19:00   Bucket[98]: Key=二林工商, DocCount=43
DEBUG 2025/12/17 17:19:00   Bucket[99]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:19:00 ========================================================
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 51/58 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:19:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 55/2 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 58/2 history records to TimescaleDB
INFO 2025/12/17 17:19:08 ✅ Successfully flushed 2/0 history records to TimescaleDB
INFO 2025/12/17 17:19:10 Processing 15 offline devices
INFO 2025/12/17 17:19:10 Creating history record for offline device: 家齊高中
INFO 2025/12/17 17:19:10 About to add history to batch for device: 家齊高中
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 家齊高中
INFO 2025/12/17 17:19:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:19:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:19:10 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:19:10 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:19:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:19:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:19:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 崇實高工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 崇實高工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 崇實高工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 基隆商工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 基隆商工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 基隆商工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:19:10 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:19:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:19:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:19:10 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:19:10 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:19:10 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:19:10 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:19:10 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:19:11 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:19:11 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:19:11 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:19:11 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:19:11 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:19:11 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:19:11 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:19:11 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:19:11 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:19:13 ✅ Successfully flushed 49/49 history records to TimescaleDB
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:19:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:19:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:19:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:19:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:19:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:19:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
INFO 2025/12/17 17:19:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:19:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:19:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:19:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:19:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:19:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:19:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:19:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:19:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 5: Memory usage high: 89.37% (threshold: 80.00%)
INFO 2025/12/17 17:19:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:19:45 ES Alert Created [high][capacity]: Disk usage high: 93.34% (threshold: 85.00%)
WARN 2025/12/17 17:19:45 ES Alert Created [high][health]: Unassigned shards detected: 36
WARN 2025/12/17 17:19:45 ES Alert Created [critical][health]: Cluster status is RED
INFO 2025/12/17 17:19:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:19:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:19:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:19:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:19:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:20:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:20:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:20:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:20:00 Field: school_name.keyword
DEBUG 2025/12/17 17:20:00 Time From: 2025-12-17T17:19:00.000+08:00
DEBUG 2025/12/17 17:20:00 Time To: 2025-12-17T17:20:00.000+08:00
DEBUG 2025/12/17 17:20:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:19:00.000+08:00",
					"lte": "2025-12-17T17:20:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:20:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:20:00 ES Response IsError: false
DEBUG 2025/12/17 17:20:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":472,"buckets":[{"key":"黑快馬主機","doc_count":1014},{"key":"花蓮高農","doc_count":797},{"key":"新竹女中","doc_count":627},{"key":"仁愛高農","doc_count":571},{"key":"金門農工","doc_count":518},{"key":"金門高中","doc_count":514},{"key":"華僑高中","doc_count":485},{"key":"臺東高中","doc_count":410},{"key":"竹北高中","doc_count":382},{"key":"北門高中","doc_count":377},{"key":"花蓮高商","doc_count":376},{"key":"宜蘭高商","doc_count":369},{"key":"南投高商","doc_count":362},{"key":"蘇澳海事","doc_count":300},{"key":"關西高中","doc_count":294},{"key":"興大附中","doc_count":280},{"key":"虎尾高中","doc_count":262},{"key":"彰師附工","doc_count":254},{"key":"旗美高中","doc_count":253},{"key":"清華附小","doc_count":249},{"key":"斗六家商","doc_count":229},{"key":"內埔農工","doc_count":228},{"key":"屏東女中","doc_count":223},{"key":"新化高中","doc_count":221},{"key":"後壁高中","doc_count":209},{"key":"竹南高中","doc_count":209},{"key":"中大壢中","doc_count":203},{"key":"南投特教","doc_count":201},{"key":"新港藝高","doc_count":195},{"key":"嘉義高商","doc_count":192},{"key":"政大附中","doc_count":181},{"key":"員林家商","doc_count":176},{"key":"關山工商","doc_count":175},{"key":"永靖高工","doc_count":170},{"key":"苗栗農工","doc_count":168},{"key":"玉里高中","doc_count":153},{"key":"臺東高商","doc_count":145},{"key":"屏北高中","doc_count":136},{"key":"臺南一中","doc_count":135},{"key":"新營高工","doc_count":125},{"key":"新化高工","doc_count":121},{"key":"新營高中","doc_count":113},{"key":"埔里高工","doc_count":106},{"key":"東港海事","doc_count":105},{"key":"南投高中","doc_count":101},{"key":"二林工商","doc_count":100},{"key":"新竹高工","doc_count":100},{"key":"草屯商工","doc_count":100},{"key":"嘉義高中","doc_count":97},{"key":"曾文農工","doc_count":97},{"key":"秀水高工","doc_count":97},{"key":"嘉義家職","doc_count":96},{"key":"水里商工","doc_count":96},{"key":"鳳山高中","doc_count":93},{"key":"中興高中","doc_count":91},{"key":"屏科實中","doc_count":91},{"key":"溪湖高中","doc_count":88},{"key":"成大南工","doc_count":86},{"key":"宜蘭高中","doc_count":84},{"key":"花蓮高工","doc_count":84},{"key":"南大附聰","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"北斗家商","doc_count":77},{"key":"高餐大附中","doc_count":76},{"key":"臺南高商","doc_count":73},{"key":"海大附中","doc_count":72},{"key":"頭城家商","doc_count":72},{"key":"旗山農工","doc_count":70},{"key":"臺東女中","doc_count":70},{"key":"北港高中","doc_count":69},{"key":"雲林特教","doc_count":68},{"key":"基隆商工","doc_count":67},{"key":"師大附中高中部","doc_count":66},{"key":"新竹高商","doc_count":66},{"key":"苗栗高商","doc_count":66},{"key":"潮州高中","doc_count":65},{"key":"北教大實小","doc_count":64},{"key":"北港農工","doc_count":63},{"key":"南大附中","doc_count":62},{"key":"崇實高工","doc_count":59},{"key":"彰化高商","doc_count":57},{"key":"嘉科實中","doc_count":51},{"key":"嘉義高工","doc_count":50},{"key":"竹山高中","doc_count":50},{"key":"花蓮特教","doc_count":50},{"key":"新豐高中","doc_count":49},{"key":"羅東高工","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"屏東特教","doc_count":47},{"key":"澎湖海事","doc_count":45},{"key":"興大附農","doc_count":45},{"key":"善化高中","doc_count":44},{"key":"苗栗高中","doc_count":43},{"key":"土庫商工","doc_count":42},{"key":"新竹高中","doc_count":41},{"key":"東石高中","doc_count":40},{"key":"羅東高商","doc_count":40},{"key":"家齊高中","doc_count":39},{"key":"蘭陽女中","doc_count":39},{"key":"花蓮高中","doc_count":38}]}}}
DEBUG 2025/12/17 17:20:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:20:00   Bucket[0]: Key=黑快馬主機, DocCount=1014
DEBUG 2025/12/17 17:20:00   Bucket[1]: Key=花蓮高農, DocCount=797
DEBUG 2025/12/17 17:20:00   Bucket[2]: Key=新竹女中, DocCount=627
DEBUG 2025/12/17 17:20:00   Bucket[3]: Key=仁愛高農, DocCount=571
DEBUG 2025/12/17 17:20:00   Bucket[4]: Key=金門農工, DocCount=518
DEBUG 2025/12/17 17:20:00   Bucket[5]: Key=金門高中, DocCount=514
DEBUG 2025/12/17 17:20:00   Bucket[6]: Key=華僑高中, DocCount=485
DEBUG 2025/12/17 17:20:00   Bucket[7]: Key=臺東高中, DocCount=410
DEBUG 2025/12/17 17:20:00   Bucket[8]: Key=竹北高中, DocCount=382
DEBUG 2025/12/17 17:20:00   Bucket[9]: Key=北門高中, DocCount=377
DEBUG 2025/12/17 17:20:00   Bucket[10]: Key=花蓮高商, DocCount=376
DEBUG 2025/12/17 17:20:00   Bucket[11]: Key=宜蘭高商, DocCount=369
DEBUG 2025/12/17 17:20:00   Bucket[12]: Key=南投高商, DocCount=362
DEBUG 2025/12/17 17:20:00   Bucket[13]: Key=蘇澳海事, DocCount=300
DEBUG 2025/12/17 17:20:00   Bucket[14]: Key=關西高中, DocCount=294
DEBUG 2025/12/17 17:20:00   Bucket[15]: Key=興大附中, DocCount=280
DEBUG 2025/12/17 17:20:00   Bucket[16]: Key=虎尾高中, DocCount=262
DEBUG 2025/12/17 17:20:00   Bucket[17]: Key=彰師附工, DocCount=254
DEBUG 2025/12/17 17:20:00   Bucket[18]: Key=旗美高中, DocCount=253
DEBUG 2025/12/17 17:20:00   Bucket[19]: Key=清華附小, DocCount=249
DEBUG 2025/12/17 17:20:00   Bucket[20]: Key=斗六家商, DocCount=229
DEBUG 2025/12/17 17:20:00   Bucket[21]: Key=內埔農工, DocCount=228
DEBUG 2025/12/17 17:20:00   Bucket[22]: Key=屏東女中, DocCount=223
DEBUG 2025/12/17 17:20:00   Bucket[23]: Key=新化高中, DocCount=221
DEBUG 2025/12/17 17:20:00   Bucket[24]: Key=後壁高中, DocCount=209
DEBUG 2025/12/17 17:20:00   Bucket[25]: Key=竹南高中, DocCount=209
DEBUG 2025/12/17 17:20:00   Bucket[26]: Key=中大壢中, DocCount=203
DEBUG 2025/12/17 17:20:00   Bucket[27]: Key=南投特教, DocCount=201
DEBUG 2025/12/17 17:20:00   Bucket[28]: Key=新港藝高, DocCount=195
DEBUG 2025/12/17 17:20:00   Bucket[29]: Key=嘉義高商, DocCount=192
DEBUG 2025/12/17 17:20:00   Bucket[30]: Key=政大附中, DocCount=181
DEBUG 2025/12/17 17:20:00   Bucket[31]: Key=員林家商, DocCount=176
DEBUG 2025/12/17 17:20:00   Bucket[32]: Key=關山工商, DocCount=175
DEBUG 2025/12/17 17:20:00   Bucket[33]: Key=永靖高工, DocCount=170
DEBUG 2025/12/17 17:20:00   Bucket[34]: Key=苗栗農工, DocCount=168
DEBUG 2025/12/17 17:20:00   Bucket[35]: Key=玉里高中, DocCount=153
DEBUG 2025/12/17 17:20:00   Bucket[36]: Key=臺東高商, DocCount=145
DEBUG 2025/12/17 17:20:00   Bucket[37]: Key=屏北高中, DocCount=136
DEBUG 2025/12/17 17:20:00   Bucket[38]: Key=臺南一中, DocCount=135
DEBUG 2025/12/17 17:20:00   Bucket[39]: Key=新營高工, DocCount=125
DEBUG 2025/12/17 17:20:00   Bucket[40]: Key=新化高工, DocCount=121
DEBUG 2025/12/17 17:20:00   Bucket[41]: Key=新營高中, DocCount=113
DEBUG 2025/12/17 17:20:00   Bucket[42]: Key=埔里高工, DocCount=106
DEBUG 2025/12/17 17:20:00   Bucket[43]: Key=東港海事, DocCount=105
DEBUG 2025/12/17 17:20:00   Bucket[44]: Key=南投高中, DocCount=101
DEBUG 2025/12/17 17:20:00   Bucket[45]: Key=二林工商, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[46]: Key=新竹高工, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[47]: Key=草屯商工, DocCount=100
DEBUG 2025/12/17 17:20:00   Bucket[48]: Key=嘉義高中, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[49]: Key=曾文農工, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[50]: Key=秀水高工, DocCount=97
DEBUG 2025/12/17 17:20:00   Bucket[51]: Key=嘉義家職, DocCount=96
DEBUG 2025/12/17 17:20:00   Bucket[52]: Key=水里商工, DocCount=96
DEBUG 2025/12/17 17:20:00   Bucket[53]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:20:00   Bucket[54]: Key=中興高中, DocCount=91
DEBUG 2025/12/17 17:20:00   Bucket[55]: Key=屏科實中, DocCount=91
DEBUG 2025/12/17 17:20:00   Bucket[56]: Key=溪湖高中, DocCount=88
DEBUG 2025/12/17 17:20:00   Bucket[57]: Key=成大南工, DocCount=86
DEBUG 2025/12/17 17:20:00   Bucket[58]: Key=宜蘭高中, DocCount=84
DEBUG 2025/12/17 17:20:00   Bucket[59]: Key=花蓮高工, DocCount=84
DEBUG 2025/12/17 17:20:00   Bucket[60]: Key=南大附聰, DocCount=82
DEBUG 2025/12/17 17:20:00   Bucket[61]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:20:00   Bucket[62]: Key=北斗家商, DocCount=77
DEBUG 2025/12/17 17:20:00   Bucket[63]: Key=高餐大附中, DocCount=76
DEBUG 2025/12/17 17:20:00   Bucket[64]: Key=臺南高商, DocCount=73
DEBUG 2025/12/17 17:20:00   Bucket[65]: Key=海大附中, DocCount=72
DEBUG 2025/12/17 17:20:00   Bucket[66]: Key=頭城家商, DocCount=72
DEBUG 2025/12/17 17:20:00   Bucket[67]: Key=旗山農工, DocCount=70
DEBUG 2025/12/17 17:20:00   Bucket[68]: Key=臺東女中, DocCount=70
DEBUG 2025/12/17 17:20:00   Bucket[69]: Key=北港高中, DocCount=69
DEBUG 2025/12/17 17:20:00   Bucket[70]: Key=雲林特教, DocCount=68
DEBUG 2025/12/17 17:20:00   Bucket[71]: Key=基隆商工, DocCount=67
DEBUG 2025/12/17 17:20:00   Bucket[72]: Key=師大附中高中部, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[73]: Key=新竹高商, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[74]: Key=苗栗高商, DocCount=66
DEBUG 2025/12/17 17:20:00   Bucket[75]: Key=潮州高中, DocCount=65
DEBUG 2025/12/17 17:20:00   Bucket[76]: Key=北教大實小, DocCount=64
DEBUG 2025/12/17 17:20:00   Bucket[77]: Key=北港農工, DocCount=63
DEBUG 2025/12/17 17:20:00   Bucket[78]: Key=南大附中, DocCount=62
DEBUG 2025/12/17 17:20:00   Bucket[79]: Key=崇實高工, DocCount=59
DEBUG 2025/12/17 17:20:00   Bucket[80]: Key=彰化高商, DocCount=57
DEBUG 2025/12/17 17:20:00   Bucket[81]: Key=嘉科實中, DocCount=51
DEBUG 2025/12/17 17:20:00   Bucket[82]: Key=嘉義高工, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[83]: Key=竹山高中, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[84]: Key=花蓮特教, DocCount=50
DEBUG 2025/12/17 17:20:00   Bucket[85]: Key=新豐高中, DocCount=49
DEBUG 2025/12/17 17:20:00   Bucket[86]: Key=羅東高工, DocCount=48
DEBUG 2025/12/17 17:20:00   Bucket[87]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:20:00   Bucket[88]: Key=屏東特教, DocCount=47
DEBUG 2025/12/17 17:20:00   Bucket[89]: Key=澎湖海事, DocCount=45
DEBUG 2025/12/17 17:20:00   Bucket[90]: Key=興大附農, DocCount=45
DEBUG 2025/12/17 17:20:00   Bucket[91]: Key=善化高中, DocCount=44
DEBUG 2025/12/17 17:20:00   Bucket[92]: Key=苗栗高中, DocCount=43
DEBUG 2025/12/17 17:20:00   Bucket[93]: Key=土庫商工, DocCount=42
DEBUG 2025/12/17 17:20:00   Bucket[94]: Key=新竹高中, DocCount=41
DEBUG 2025/12/17 17:20:00   Bucket[95]: Key=東石高中, DocCount=40
DEBUG 2025/12/17 17:20:00   Bucket[96]: Key=羅東高商, DocCount=40
DEBUG 2025/12/17 17:20:00   Bucket[97]: Key=家齊高中, DocCount=39
DEBUG 2025/12/17 17:20:00   Bucket[98]: Key=蘭陽女中, DocCount=39
DEBUG 2025/12/17 17:20:00   Bucket[99]: Key=花蓮高中, DocCount=38
DEBUG 2025/12/17 17:20:00 ========================================================
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:20:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:20:08 ✅ Successfully flushed 24/24 history records to TimescaleDB
INFO 2025/12/17 17:20:09 Processing 15 offline devices
INFO 2025/12/17 17:20:09 Creating history record for offline device: 白河商工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 白河商工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 白河商工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:20:09 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:20:09 Creating history record for offline device: 屏東高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 屏東高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 員林高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 員林高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 員林高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:20:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:20:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:20:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:20:09 Creating history record for offline device: 員林農工
INFO 2025/12/17 17:20:09 About to add history to batch for device: 員林農工
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 員林農工
INFO 2025/12/17 17:20:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:20:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:20:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:20:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:20:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:20:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:20:09 Creating history record for offline device: 佳冬高農
INFO 2025/12/17 17:20:09 About to add history to batch for device: 佳冬高農
INFO 2025/12/17 17:20:09 Successfully added history record for offline device: 佳冬高農
INFO 2025/12/17 17:20:13 ✅ Successfully flushed 26/26 history records to TimescaleDB
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:20:45 Starting ES monitor check for: NTU
INFO 2025/12/17 17:20:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:20:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:20:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:20:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:20:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:20:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:20:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:20:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:20:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:20:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:20:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:20:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:20:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
WARN 2025/12/17 17:20:45 ES Alert Created [high][health]: Unassigned shards detected: 4
INFO 2025/12/17 17:20:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.41% (threshold: 90.00%)
INFO 2025/12/17 17:20:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.14% (threshold: 85.00%)
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:20:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:20:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:20:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:20:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:20:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:21:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:21:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:21:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:21:00 Field: school_name.keyword
DEBUG 2025/12/17 17:21:00 Time From: 2025-12-17T17:20:00.000+08:00
DEBUG 2025/12/17 17:21:00 Time To: 2025-12-17T17:21:00.000+08:00
DEBUG 2025/12/17 17:21:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:20:00.000+08:00",
					"lte": "2025-12-17T17:21:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:21:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:21:00 ES Response IsError: false
DEBUG 2025/12/17 17:21:00 ES Response Body:
{"took":187,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":421,"buckets":[{"key":"黑快馬主機","doc_count":790},{"key":"花蓮高農","doc_count":787},{"key":"新竹女中","doc_count":658},{"key":"仁愛高農","doc_count":559},{"key":"金門高中","doc_count":545},{"key":"金門農工","doc_count":504},{"key":"北門高中","doc_count":434},{"key":"竹北高中","doc_count":428},{"key":"華僑高中","doc_count":404},{"key":"南投高商","doc_count":388},{"key":"臺東高中","doc_count":380},{"key":"花蓮高商","doc_count":360},{"key":"蘇澳海事","doc_count":330},{"key":"關西高中","doc_count":317},{"key":"宜蘭高商","doc_count":312},{"key":"興大附中","doc_count":265},{"key":"清華附小","doc_count":239},{"key":"新港藝高","doc_count":229},{"key":"旗美高中","doc_count":227},{"key":"後壁高中","doc_count":220},{"key":"關山工商","doc_count":190},{"key":"玉里高中","doc_count":188},{"key":"斗六家商","doc_count":185},{"key":"虎尾高中","doc_count":174},{"key":"中大壢中","doc_count":169},{"key":"南投特教","doc_count":161},{"key":"內埔農工","doc_count":159},{"key":"政大附中","doc_count":153},{"key":"竹南高中","doc_count":150},{"key":"苗栗農工","doc_count":149},{"key":"中興高中","doc_count":143},{"key":"基隆商工","doc_count":143},{"key":"屏東女中","doc_count":142},{"key":"嘉義高商","doc_count":139},{"key":"新營高工","doc_count":139},{"key":"旗山農工","doc_count":138},{"key":"新化高工","doc_count":132},{"key":"員林家商","doc_count":131},{"key":"水里商工","doc_count":126},{"key":"新竹高工","doc_count":122},{"key":"彰師附工","doc_count":121},{"key":"北教大實小","doc_count":120},{"key":"宜蘭高中","doc_count":109},{"key":"北港高中","doc_count":107},{"key":"南大附中","doc_count":107},{"key":"屏科實中","doc_count":104},{"key":"南投高中","doc_count":102},{"key":"東港海事","doc_count":102},{"key":"新化高中","doc_count":98},{"key":"新營高中","doc_count":96},{"key":"北港農工","doc_count":95},{"key":"成大南工","doc_count":93},{"key":"南大附聰","doc_count":90},{"key":"鳳山高中","doc_count":87},{"key":"臺東高商","doc_count":85},{"key":"師大附中高中部","doc_count":82},{"key":"北斗家商","doc_count":80},{"key":"嘉義高中","doc_count":79},{"key":"溪湖高中","doc_count":78},{"key":"員林農工","doc_count":71},{"key":"秀水高工","doc_count":71},{"key":"蘭陽女中","doc_count":69},{"key":"高餐大附中","doc_count":69},{"key":"新竹高中","doc_count":68},{"key":"竹山高中","doc_count":68},{"key":"花蓮高工","doc_count":68},{"key":"草屯商工","doc_count":62},{"key":"雲林特教","doc_count":62},{"key":"嘉義家職","doc_count":61},{"key":"二林工商","doc_count":60},{"key":"潮州高中","doc_count":59},{"key":"羅東高商","doc_count":59},{"key":"員林高中","doc_count":58},{"key":"崇實高工","doc_count":57},{"key":"頭城家商","doc_count":57},{"key":"嘉科實中","doc_count":56},{"key":"新豐高中","doc_count":56},{"key":"南大附小","doc_count":55},{"key":"海大附中","doc_count":55},{"key":"東石高中","doc_count":53},{"key":"彰化高商","doc_count":52},{"key":"臺南一中","doc_count":52},{"key":"苗栗高中","doc_count":52},{"key":"臺東女中","doc_count":50},{"key":"興大附農","doc_count":50},{"key":"苗栗高商","doc_count":50},{"key":"屏東高工","doc_count":49},{"key":"白河商工","doc_count":49},{"key":"善化高中","doc_count":47},{"key":"土庫商工","doc_count":47},{"key":"羅東高工","doc_count":47},{"key":"竹東高中","doc_count":46},{"key":"佳冬高農","doc_count":44},{"key":"埔里高工","doc_count":44},{"key":"屏東特教","doc_count":44},{"key":"臺南高商","doc_count":43},{"key":"新竹高商","doc_count":41},{"key":"華南高商","doc_count":37},{"key":"家齊高中","doc_count":36},{"key":"曾文農工","doc_count":35}]}}}
DEBUG 2025/12/17 17:21:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:21:00   Bucket[0]: Key=黑快馬主機, DocCount=790
DEBUG 2025/12/17 17:21:00   Bucket[1]: Key=花蓮高農, DocCount=787
DEBUG 2025/12/17 17:21:00   Bucket[2]: Key=新竹女中, DocCount=658
DEBUG 2025/12/17 17:21:00   Bucket[3]: Key=仁愛高農, DocCount=559
DEBUG 2025/12/17 17:21:00   Bucket[4]: Key=金門高中, DocCount=545
DEBUG 2025/12/17 17:21:00   Bucket[5]: Key=金門農工, DocCount=504
DEBUG 2025/12/17 17:21:00   Bucket[6]: Key=北門高中, DocCount=434
DEBUG 2025/12/17 17:21:00   Bucket[7]: Key=竹北高中, DocCount=428
DEBUG 2025/12/17 17:21:00   Bucket[8]: Key=華僑高中, DocCount=404
DEBUG 2025/12/17 17:21:00   Bucket[9]: Key=南投高商, DocCount=388
DEBUG 2025/12/17 17:21:00   Bucket[10]: Key=臺東高中, DocCount=380
DEBUG 2025/12/17 17:21:00   Bucket[11]: Key=花蓮高商, DocCount=360
DEBUG 2025/12/17 17:21:00   Bucket[12]: Key=蘇澳海事, DocCount=330
DEBUG 2025/12/17 17:21:00   Bucket[13]: Key=關西高中, DocCount=317
DEBUG 2025/12/17 17:21:00   Bucket[14]: Key=宜蘭高商, DocCount=312
DEBUG 2025/12/17 17:21:00   Bucket[15]: Key=興大附中, DocCount=265
DEBUG 2025/12/17 17:21:00   Bucket[16]: Key=清華附小, DocCount=239
DEBUG 2025/12/17 17:21:00   Bucket[17]: Key=新港藝高, DocCount=229
DEBUG 2025/12/17 17:21:00   Bucket[18]: Key=旗美高中, DocCount=227
DEBUG 2025/12/17 17:21:00   Bucket[19]: Key=後壁高中, DocCount=220
DEBUG 2025/12/17 17:21:00   Bucket[20]: Key=關山工商, DocCount=190
DEBUG 2025/12/17 17:21:00   Bucket[21]: Key=玉里高中, DocCount=188
DEBUG 2025/12/17 17:21:00   Bucket[22]: Key=斗六家商, DocCount=185
DEBUG 2025/12/17 17:21:00   Bucket[23]: Key=虎尾高中, DocCount=174
DEBUG 2025/12/17 17:21:00   Bucket[24]: Key=中大壢中, DocCount=169
DEBUG 2025/12/17 17:21:00   Bucket[25]: Key=南投特教, DocCount=161
DEBUG 2025/12/17 17:21:00   Bucket[26]: Key=內埔農工, DocCount=159
DEBUG 2025/12/17 17:21:00   Bucket[27]: Key=政大附中, DocCount=153
DEBUG 2025/12/17 17:21:00   Bucket[28]: Key=竹南高中, DocCount=150
DEBUG 2025/12/17 17:21:00   Bucket[29]: Key=苗栗農工, DocCount=149
DEBUG 2025/12/17 17:21:00   Bucket[30]: Key=中興高中, DocCount=143
DEBUG 2025/12/17 17:21:00   Bucket[31]: Key=基隆商工, DocCount=143
DEBUG 2025/12/17 17:21:00   Bucket[32]: Key=屏東女中, DocCount=142
DEBUG 2025/12/17 17:21:00   Bucket[33]: Key=嘉義高商, DocCount=139
DEBUG 2025/12/17 17:21:00   Bucket[34]: Key=新營高工, DocCount=139
DEBUG 2025/12/17 17:21:00   Bucket[35]: Key=旗山農工, DocCount=138
DEBUG 2025/12/17 17:21:00   Bucket[36]: Key=新化高工, DocCount=132
DEBUG 2025/12/17 17:21:00   Bucket[37]: Key=員林家商, DocCount=131
DEBUG 2025/12/17 17:21:00   Bucket[38]: Key=水里商工, DocCount=126
DEBUG 2025/12/17 17:21:00   Bucket[39]: Key=新竹高工, DocCount=122
DEBUG 2025/12/17 17:21:00   Bucket[40]: Key=彰師附工, DocCount=121
DEBUG 2025/12/17 17:21:00   Bucket[41]: Key=北教大實小, DocCount=120
DEBUG 2025/12/17 17:21:00   Bucket[42]: Key=宜蘭高中, DocCount=109
DEBUG 2025/12/17 17:21:00   Bucket[43]: Key=北港高中, DocCount=107
DEBUG 2025/12/17 17:21:00   Bucket[44]: Key=南大附中, DocCount=107
DEBUG 2025/12/17 17:21:00   Bucket[45]: Key=屏科實中, DocCount=104
DEBUG 2025/12/17 17:21:00   Bucket[46]: Key=南投高中, DocCount=102
DEBUG 2025/12/17 17:21:00   Bucket[47]: Key=東港海事, DocCount=102
DEBUG 2025/12/17 17:21:00   Bucket[48]: Key=新化高中, DocCount=98
DEBUG 2025/12/17 17:21:00   Bucket[49]: Key=新營高中, DocCount=96
DEBUG 2025/12/17 17:21:00   Bucket[50]: Key=北港農工, DocCount=95
DEBUG 2025/12/17 17:21:00   Bucket[51]: Key=成大南工, DocCount=93
DEBUG 2025/12/17 17:21:00   Bucket[52]: Key=南大附聰, DocCount=90
DEBUG 2025/12/17 17:21:00   Bucket[53]: Key=鳳山高中, DocCount=87
DEBUG 2025/12/17 17:21:00   Bucket[54]: Key=臺東高商, DocCount=85
DEBUG 2025/12/17 17:21:00   Bucket[55]: Key=師大附中高中部, DocCount=82
DEBUG 2025/12/17 17:21:00   Bucket[56]: Key=北斗家商, DocCount=80
DEBUG 2025/12/17 17:21:00   Bucket[57]: Key=嘉義高中, DocCount=79
DEBUG 2025/12/17 17:21:00   Bucket[58]: Key=溪湖高中, DocCount=78
DEBUG 2025/12/17 17:21:00   Bucket[59]: Key=員林農工, DocCount=71
DEBUG 2025/12/17 17:21:00   Bucket[60]: Key=秀水高工, DocCount=71
DEBUG 2025/12/17 17:21:00   Bucket[61]: Key=蘭陽女中, DocCount=69
DEBUG 2025/12/17 17:21:00   Bucket[62]: Key=高餐大附中, DocCount=69
DEBUG 2025/12/17 17:21:00   Bucket[63]: Key=新竹高中, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[64]: Key=竹山高中, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[65]: Key=花蓮高工, DocCount=68
DEBUG 2025/12/17 17:21:00   Bucket[66]: Key=草屯商工, DocCount=62
DEBUG 2025/12/17 17:21:00   Bucket[67]: Key=雲林特教, DocCount=62
DEBUG 2025/12/17 17:21:00   Bucket[68]: Key=嘉義家職, DocCount=61
DEBUG 2025/12/17 17:21:00   Bucket[69]: Key=二林工商, DocCount=60
DEBUG 2025/12/17 17:21:00   Bucket[70]: Key=潮州高中, DocCount=59
DEBUG 2025/12/17 17:21:00   Bucket[71]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:21:00   Bucket[72]: Key=員林高中, DocCount=58
DEBUG 2025/12/17 17:21:00   Bucket[73]: Key=崇實高工, DocCount=57
DEBUG 2025/12/17 17:21:00   Bucket[74]: Key=頭城家商, DocCount=57
DEBUG 2025/12/17 17:21:00   Bucket[75]: Key=嘉科實中, DocCount=56
DEBUG 2025/12/17 17:21:00   Bucket[76]: Key=新豐高中, DocCount=56
DEBUG 2025/12/17 17:21:00   Bucket[77]: Key=南大附小, DocCount=55
DEBUG 2025/12/17 17:21:00   Bucket[78]: Key=海大附中, DocCount=55
DEBUG 2025/12/17 17:21:00   Bucket[79]: Key=東石高中, DocCount=53
DEBUG 2025/12/17 17:21:00   Bucket[80]: Key=彰化高商, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[81]: Key=臺南一中, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[82]: Key=苗栗高中, DocCount=52
DEBUG 2025/12/17 17:21:00   Bucket[83]: Key=臺東女中, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[84]: Key=興大附農, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[85]: Key=苗栗高商, DocCount=50
DEBUG 2025/12/17 17:21:00   Bucket[86]: Key=屏東高工, DocCount=49
DEBUG 2025/12/17 17:21:00   Bucket[87]: Key=白河商工, DocCount=49
DEBUG 2025/12/17 17:21:00   Bucket[88]: Key=善化高中, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[89]: Key=土庫商工, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[90]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:21:00   Bucket[91]: Key=竹東高中, DocCount=46
DEBUG 2025/12/17 17:21:00   Bucket[92]: Key=佳冬高農, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[93]: Key=埔里高工, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[94]: Key=屏東特教, DocCount=44
DEBUG 2025/12/17 17:21:00   Bucket[95]: Key=臺南高商, DocCount=43
DEBUG 2025/12/17 17:21:00   Bucket[96]: Key=新竹高商, DocCount=41
DEBUG 2025/12/17 17:21:00   Bucket[97]: Key=華南高商, DocCount=37
DEBUG 2025/12/17 17:21:00   Bucket[98]: Key=家齊高中, DocCount=36
DEBUG 2025/12/17 17:21:00   Bucket[99]: Key=曾文農工, DocCount=35
DEBUG 2025/12/17 17:21:00 ========================================================
INFO 2025/12/17 17:21:03 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 50/60 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 51/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 1/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 52/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 54/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 57/2 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 58/0 history records to TimescaleDB
INFO 2025/12/17 17:21:06 ✅ Successfully flushed 59/1 history records to TimescaleDB
INFO 2025/12/17 17:21:08 Processing 15 offline devices
INFO 2025/12/17 17:21:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:21:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:21:08 ✅ Successfully flushed 14/14 history records to TimescaleDB
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:21:08 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 屏東高中
INFO 2025/12/17 17:21:08 About to add history to batch for device: 屏東高中
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 屏東高中
INFO 2025/12/17 17:21:08 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:21:08 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:21:08 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:21:08 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:21:08 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:21:08 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:21:08 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:21:08 Creating history record for offline device: 嘉義高工
INFO 2025/12/17 17:21:08 About to add history to batch for device: 嘉義高工
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 嘉義高工
INFO 2025/12/17 17:21:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:21:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:21:09 Creating history record for offline device: 永靖高工
INFO 2025/12/17 17:21:09 About to add history to batch for device: 永靖高工
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 永靖高工
INFO 2025/12/17 17:21:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:21:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:21:09 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:21:09 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:21:09 Creating history record for offline device: 屏北高中
INFO 2025/12/17 17:21:09 About to add history to batch for device: 屏北高中
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 屏北高中
INFO 2025/12/17 17:21:09 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:21:09 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:21:09 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:21:13 ✅ Successfully flushed 15/15 history records to TimescaleDB
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: 213 (ID: 1)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: 213
INFO 2025/12/17 17:21:45 Starting ES monitor check for: ncku
DEBUG 2025/12/17 17:21:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:21:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: 93
DEBUG 2025/12/17 17:21:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:21:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:21:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:21:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:21:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:21:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:21:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:21:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:21:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:21:45 ES monitor check completed for: bimap123, status: warning
DEBUG 2025/12/17 17:21:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
INFO 2025/12/17 17:21:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:21:45 ES Alert Created [high][performance]: Memory usage high: 88.23% (threshold: 80.00%)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.17% (threshold: 85.00%)
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:21:45 ES monitor check completed for: 93, status: error
INFO 2025/12/17 17:21:45 ES monitor check completed for: ncku, status: online
DEBUG 2025/12/17 17:21:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:21:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:21:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:22:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:22:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:22:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:22:00 Field: school_name.keyword
DEBUG 2025/12/17 17:22:00 Time From: 2025-12-17T17:21:00.000+08:00
DEBUG 2025/12/17 17:22:00 Time To: 2025-12-17T17:22:00.000+08:00
DEBUG 2025/12/17 17:22:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:21:00.000+08:00",
					"lte": "2025-12-17T17:22:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:22:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:22:00 ES Response IsError: false
DEBUG 2025/12/17 17:22:00 ES Response Body:
{"took":66,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":494,"buckets":[{"key":"花蓮高農","doc_count":746},{"key":"仁愛高農","doc_count":675},{"key":"黑快馬主機","doc_count":660},{"key":"金門農工","doc_count":573},{"key":"新竹女中","doc_count":546},{"key":"金門高中","doc_count":504},{"key":"竹北高中","doc_count":480},{"key":"北門高中","doc_count":431},{"key":"臺東高中","doc_count":395},{"key":"華僑高中","doc_count":349},{"key":"宜蘭高商","doc_count":340},{"key":"蘇澳海事","doc_count":336},{"key":"花蓮高商","doc_count":278},{"key":"南投高商","doc_count":274},{"key":"新化高工","doc_count":268},{"key":"興大附中","doc_count":262},{"key":"清華附小","doc_count":258},{"key":"關山工商","doc_count":221},{"key":"新港藝高","doc_count":218},{"key":"竹南高中","doc_count":215},{"key":"斗六家商","doc_count":202},{"key":"關西高中","doc_count":202},{"key":"中大壢中","doc_count":200},{"key":"後壁高中","doc_count":200},{"key":"旗美高中","doc_count":194},{"key":"苗栗農工","doc_count":182},{"key":"新營高中","doc_count":174},{"key":"南投特教","doc_count":171},{"key":"新化高中","doc_count":168},{"key":"內埔農工","doc_count":165},{"key":"虎尾高中","doc_count":155},{"key":"玉里高中","doc_count":151},{"key":"嘉義高商","doc_count":149},{"key":"南大附中","doc_count":144},{"key":"屏東女中","doc_count":138},{"key":"北教大實小","doc_count":132},{"key":"東港海事","doc_count":130},{"key":"新營高工","doc_count":126},{"key":"宜蘭高中","doc_count":116},{"key":"新竹高商","doc_count":113},{"key":"北斗家商","doc_count":111},{"key":"北港高中","doc_count":111},{"key":"員林家商","doc_count":109},{"key":"苗栗高中","doc_count":109},{"key":"彰師附工","doc_count":104},{"key":"南大附聰","doc_count":96},{"key":"新竹高工","doc_count":96},{"key":"員林高中","doc_count":95},{"key":"鳳山高中","doc_count":93},{"key":"彰化高商","doc_count":91},{"key":"旗山農工","doc_count":89},{"key":"嘉義高中","doc_count":87},{"key":"屏科實中","doc_count":85},{"key":"永靖高工","doc_count":85},{"key":"政大附中","doc_count":84},{"key":"師大附中高中部","doc_count":83},{"key":"蘭陽女中","doc_count":82},{"key":"屏東高工","doc_count":80},{"key":"水里商工","doc_count":79},{"key":"中興高中","doc_count":78},{"key":"嘉科實中","doc_count":77},{"key":"南投高中","doc_count":76},{"key":"花蓮高工","doc_count":73},{"key":"新竹高中","doc_count":71},{"key":"臺南一中","doc_count":71},{"key":"草屯商工","doc_count":70},{"key":"員林農工","doc_count":69},{"key":"基隆商工","doc_count":69},{"key":"白河商工","doc_count":69},{"key":"興大附農","doc_count":69},{"key":"潮州高中","doc_count":68},{"key":"高餐大附中","doc_count":64},{"key":"秀水高工","doc_count":63},{"key":"臺東高商","doc_count":63},{"key":"苗栗高商","doc_count":61},{"key":"羅東高商","doc_count":59},{"key":"嘉義家職","doc_count":58},{"key":"東石高中","doc_count":57},{"key":"土庫商工","doc_count":56},{"key":"雲林特教","doc_count":54},{"key":"成大南工","doc_count":53},{"key":"海大附中","doc_count":53},{"key":"家齊高中","doc_count":52},{"key":"頭城家商","doc_count":50},{"key":"屏東特教","doc_count":49},{"key":"羅東高工","doc_count":47},{"key":"新竹特教","doc_count":46},{"key":"屏東高中","doc_count":44},{"key":"師大附中國中部","doc_count":44},{"key":"臺南高商","doc_count":44},{"key":"屏北高中","doc_count":42},{"key":"崇實高工","doc_count":42},{"key":"佳冬高農","doc_count":41},{"key":"南大附小","doc_count":40},{"key":"善化高中","doc_count":40},{"key":"埔里高工","doc_count":39},{"key":"北港農工","doc_count":38},{"key":"嘉義高工","doc_count":38},{"key":"溪湖高中","doc_count":38},{"key":"澎湖海事","doc_count":38}]}}}
DEBUG 2025/12/17 17:22:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:22:00   Bucket[0]: Key=花蓮高農, DocCount=746
DEBUG 2025/12/17 17:22:00   Bucket[1]: Key=仁愛高農, DocCount=675
DEBUG 2025/12/17 17:22:00   Bucket[2]: Key=黑快馬主機, DocCount=660
DEBUG 2025/12/17 17:22:00   Bucket[3]: Key=金門農工, DocCount=573
DEBUG 2025/12/17 17:22:00   Bucket[4]: Key=新竹女中, DocCount=546
DEBUG 2025/12/17 17:22:00   Bucket[5]: Key=金門高中, DocCount=504
DEBUG 2025/12/17 17:22:00   Bucket[6]: Key=竹北高中, DocCount=480
DEBUG 2025/12/17 17:22:00   Bucket[7]: Key=北門高中, DocCount=431
DEBUG 2025/12/17 17:22:00   Bucket[8]: Key=臺東高中, DocCount=395
DEBUG 2025/12/17 17:22:00   Bucket[9]: Key=華僑高中, DocCount=349
DEBUG 2025/12/17 17:22:00   Bucket[10]: Key=宜蘭高商, DocCount=340
DEBUG 2025/12/17 17:22:00   Bucket[11]: Key=蘇澳海事, DocCount=336
DEBUG 2025/12/17 17:22:00   Bucket[12]: Key=花蓮高商, DocCount=278
DEBUG 2025/12/17 17:22:00   Bucket[13]: Key=南投高商, DocCount=274
DEBUG 2025/12/17 17:22:00   Bucket[14]: Key=新化高工, DocCount=268
DEBUG 2025/12/17 17:22:00   Bucket[15]: Key=興大附中, DocCount=262
DEBUG 2025/12/17 17:22:00   Bucket[16]: Key=清華附小, DocCount=258
DEBUG 2025/12/17 17:22:00   Bucket[17]: Key=關山工商, DocCount=221
DEBUG 2025/12/17 17:22:00   Bucket[18]: Key=新港藝高, DocCount=218
DEBUG 2025/12/17 17:22:00   Bucket[19]: Key=竹南高中, DocCount=215
DEBUG 2025/12/17 17:22:00   Bucket[20]: Key=斗六家商, DocCount=202
DEBUG 2025/12/17 17:22:00   Bucket[21]: Key=關西高中, DocCount=202
DEBUG 2025/12/17 17:22:00   Bucket[22]: Key=中大壢中, DocCount=200
DEBUG 2025/12/17 17:22:00   Bucket[23]: Key=後壁高中, DocCount=200
DEBUG 2025/12/17 17:22:00   Bucket[24]: Key=旗美高中, DocCount=194
DEBUG 2025/12/17 17:22:00   Bucket[25]: Key=苗栗農工, DocCount=182
DEBUG 2025/12/17 17:22:00   Bucket[26]: Key=新營高中, DocCount=174
DEBUG 2025/12/17 17:22:00   Bucket[27]: Key=南投特教, DocCount=171
DEBUG 2025/12/17 17:22:00   Bucket[28]: Key=新化高中, DocCount=168
DEBUG 2025/12/17 17:22:00   Bucket[29]: Key=內埔農工, DocCount=165
DEBUG 2025/12/17 17:22:00   Bucket[30]: Key=虎尾高中, DocCount=155
DEBUG 2025/12/17 17:22:00   Bucket[31]: Key=玉里高中, DocCount=151
DEBUG 2025/12/17 17:22:00   Bucket[32]: Key=嘉義高商, DocCount=149
DEBUG 2025/12/17 17:22:00   Bucket[33]: Key=南大附中, DocCount=144
DEBUG 2025/12/17 17:22:00   Bucket[34]: Key=屏東女中, DocCount=138
DEBUG 2025/12/17 17:22:00   Bucket[35]: Key=北教大實小, DocCount=132
DEBUG 2025/12/17 17:22:00   Bucket[36]: Key=東港海事, DocCount=130
DEBUG 2025/12/17 17:22:00   Bucket[37]: Key=新營高工, DocCount=126
DEBUG 2025/12/17 17:22:00   Bucket[38]: Key=宜蘭高中, DocCount=116
DEBUG 2025/12/17 17:22:00   Bucket[39]: Key=新竹高商, DocCount=113
DEBUG 2025/12/17 17:22:00   Bucket[40]: Key=北斗家商, DocCount=111
DEBUG 2025/12/17 17:22:00   Bucket[41]: Key=北港高中, DocCount=111
DEBUG 2025/12/17 17:22:00   Bucket[42]: Key=員林家商, DocCount=109
DEBUG 2025/12/17 17:22:00   Bucket[43]: Key=苗栗高中, DocCount=109
DEBUG 2025/12/17 17:22:00   Bucket[44]: Key=彰師附工, DocCount=104
DEBUG 2025/12/17 17:22:00   Bucket[45]: Key=南大附聰, DocCount=96
DEBUG 2025/12/17 17:22:00   Bucket[46]: Key=新竹高工, DocCount=96
DEBUG 2025/12/17 17:22:00   Bucket[47]: Key=員林高中, DocCount=95
DEBUG 2025/12/17 17:22:00   Bucket[48]: Key=鳳山高中, DocCount=93
DEBUG 2025/12/17 17:22:00   Bucket[49]: Key=彰化高商, DocCount=91
DEBUG 2025/12/17 17:22:00   Bucket[50]: Key=旗山農工, DocCount=89
DEBUG 2025/12/17 17:22:00   Bucket[51]: Key=嘉義高中, DocCount=87
DEBUG 2025/12/17 17:22:00   Bucket[52]: Key=屏科實中, DocCount=85
DEBUG 2025/12/17 17:22:00   Bucket[53]: Key=永靖高工, DocCount=85
DEBUG 2025/12/17 17:22:00   Bucket[54]: Key=政大附中, DocCount=84
DEBUG 2025/12/17 17:22:00   Bucket[55]: Key=師大附中高中部, DocCount=83
DEBUG 2025/12/17 17:22:00   Bucket[56]: Key=蘭陽女中, DocCount=82
DEBUG 2025/12/17 17:22:00   Bucket[57]: Key=屏東高工, DocCount=80
DEBUG 2025/12/17 17:22:00   Bucket[58]: Key=水里商工, DocCount=79
DEBUG 2025/12/17 17:22:00   Bucket[59]: Key=中興高中, DocCount=78
DEBUG 2025/12/17 17:22:00   Bucket[60]: Key=嘉科實中, DocCount=77
DEBUG 2025/12/17 17:22:00   Bucket[61]: Key=南投高中, DocCount=76
DEBUG 2025/12/17 17:22:00   Bucket[62]: Key=花蓮高工, DocCount=73
DEBUG 2025/12/17 17:22:00   Bucket[63]: Key=新竹高中, DocCount=71
DEBUG 2025/12/17 17:22:00   Bucket[64]: Key=臺南一中, DocCount=71
DEBUG 2025/12/17 17:22:00   Bucket[65]: Key=草屯商工, DocCount=70
DEBUG 2025/12/17 17:22:00   Bucket[66]: Key=員林農工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[67]: Key=基隆商工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[68]: Key=白河商工, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[69]: Key=興大附農, DocCount=69
DEBUG 2025/12/17 17:22:00   Bucket[70]: Key=潮州高中, DocCount=68
DEBUG 2025/12/17 17:22:00   Bucket[71]: Key=高餐大附中, DocCount=64
DEBUG 2025/12/17 17:22:00   Bucket[72]: Key=秀水高工, DocCount=63
DEBUG 2025/12/17 17:22:00   Bucket[73]: Key=臺東高商, DocCount=63
DEBUG 2025/12/17 17:22:00   Bucket[74]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:22:00   Bucket[75]: Key=羅東高商, DocCount=59
DEBUG 2025/12/17 17:22:00   Bucket[76]: Key=嘉義家職, DocCount=58
DEBUG 2025/12/17 17:22:00   Bucket[77]: Key=東石高中, DocCount=57
DEBUG 2025/12/17 17:22:00   Bucket[78]: Key=土庫商工, DocCount=56
DEBUG 2025/12/17 17:22:00   Bucket[79]: Key=雲林特教, DocCount=54
DEBUG 2025/12/17 17:22:00   Bucket[80]: Key=成大南工, DocCount=53
DEBUG 2025/12/17 17:22:00   Bucket[81]: Key=海大附中, DocCount=53
DEBUG 2025/12/17 17:22:00   Bucket[82]: Key=家齊高中, DocCount=52
DEBUG 2025/12/17 17:22:00   Bucket[83]: Key=頭城家商, DocCount=50
DEBUG 2025/12/17 17:22:00   Bucket[84]: Key=屏東特教, DocCount=49
DEBUG 2025/12/17 17:22:00   Bucket[85]: Key=羅東高工, DocCount=47
DEBUG 2025/12/17 17:22:00   Bucket[86]: Key=新竹特教, DocCount=46
DEBUG 2025/12/17 17:22:00   Bucket[87]: Key=屏東高中, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[88]: Key=師大附中國中部, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[89]: Key=臺南高商, DocCount=44
DEBUG 2025/12/17 17:22:00   Bucket[90]: Key=屏北高中, DocCount=42
DEBUG 2025/12/17 17:22:00   Bucket[91]: Key=崇實高工, DocCount=42
DEBUG 2025/12/17 17:22:00   Bucket[92]: Key=佳冬高農, DocCount=41
DEBUG 2025/12/17 17:22:00   Bucket[93]: Key=南大附小, DocCount=40
DEBUG 2025/12/17 17:22:00   Bucket[94]: Key=善化高中, DocCount=40
DEBUG 2025/12/17 17:22:00   Bucket[95]: Key=埔里高工, DocCount=39
DEBUG 2025/12/17 17:22:00   Bucket[96]: Key=北港農工, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[97]: Key=嘉義高工, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[98]: Key=溪湖高中, DocCount=38
DEBUG 2025/12/17 17:22:00   Bucket[99]: Key=澎湖海事, DocCount=38
DEBUG 2025/12/17 17:22:00 ========================================================
INFO 2025/12/17 17:22:03 ✅ Successfully flushed 7/7 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 50/56 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 51/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 52/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 53/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 54/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:22:06 ✅ Successfully flushed 56/0 history records to TimescaleDB
INFO 2025/12/17 17:22:08 ✅ Successfully flushed 25/25 history records to TimescaleDB
INFO 2025/12/17 17:22:10 Processing 15 offline devices
INFO 2025/12/17 17:22:10 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:22:10 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:22:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:22:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:22:10 Creating history record for offline device: 曾文農工
INFO 2025/12/17 17:22:10 About to add history to batch for device: 曾文農工
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 曾文農工
INFO 2025/12/17 17:22:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:22:10 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:22:10 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:22:10 Creating history record for offline device: 二林工商
INFO 2025/12/17 17:22:10 About to add history to batch for device: 二林工商
INFO 2025/12/17 17:22:10 Successfully added history record for offline device: 二林工商
INFO 2025/12/17 17:22:10 Creating history record for offline device: 暨大附中
INFO 2025/12/17 17:22:10 About to add history to batch for device: 暨大附中
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 暨大附中
INFO 2025/12/17 17:22:11 Creating history record for offline device: 華南高商
INFO 2025/12/17 17:22:11 About to add history to batch for device: 華南高商
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 華南高商
INFO 2025/12/17 17:22:11 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:22:11 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:22:11 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:22:11 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:22:11 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:22:11 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:22:11 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:22:11 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:22:11 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:22:13 ✅ Successfully flushed 27/27 history records to TimescaleDB
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: ncku (ID: 2)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: 93 (ID: 5)
INFO 2025/12/17 17:22:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:22:45 Starting ES monitor check for: bimap123
INFO 2025/12/17 17:22:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:22:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:22:45 Scheduled monitoring check for ES: NTU (ID: 3)
INFO 2025/12/17 17:22:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:22:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:22:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:22:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:22:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:22:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:22:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:22:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:22:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:22:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:22:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:22:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:22:45 ES monitor check completed for: 213, status: online
WARN 2025/12/17 17:22:45 ES Alert Created [critical][performance]: Memory usage critical: 90.93% (threshold: 90.00%)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.21% (threshold: 85.00%)
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:22:45 ES monitor check completed for: 93, status: error
DEBUG 2025/12/17 17:22:45 Skipping duplicate alert for monitor 3: Unassigned shards detected: 8
INFO 2025/12/17 17:22:45 ES monitor check completed for: NTU, status: warning
INFO 2025/12/17 17:22:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:22:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
DEBUG 2025/12/17 17:23:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:23:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:23:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:23:00 Field: school_name.keyword
DEBUG 2025/12/17 17:23:00 Time From: 2025-12-17T17:22:00.000+08:00
DEBUG 2025/12/17 17:23:00 Time To: 2025-12-17T17:23:00.000+08:00
DEBUG 2025/12/17 17:23:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:22:00.000+08:00",
					"lte": "2025-12-17T17:23:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:23:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:23:00 ES Response IsError: false
DEBUG 2025/12/17 17:23:00 ES Response Body:
{"took":181,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":482,"buckets":[{"key":"花蓮高農","doc_count":831},{"key":"仁愛高農","doc_count":618},{"key":"新竹女中","doc_count":596},{"key":"竹北高中","doc_count":525},{"key":"金門高中","doc_count":520},{"key":"金門農工","doc_count":470},{"key":"北門高中","doc_count":465},{"key":"黑快馬主機","doc_count":448},{"key":"臺東高中","doc_count":393},{"key":"蘇澳海事","doc_count":341},{"key":"興大附中","doc_count":338},{"key":"花蓮高商","doc_count":316},{"key":"宜蘭高商","doc_count":313},{"key":"南投高商","doc_count":312},{"key":"華僑高中","doc_count":292},{"key":"清華附小","doc_count":266},{"key":"關西高中","doc_count":239},{"key":"新化高工","doc_count":221},{"key":"玉里高中","doc_count":217},{"key":"竹南高中","doc_count":210},{"key":"南投特教","doc_count":207},{"key":"後壁高中","doc_count":206},{"key":"關山工商","doc_count":205},{"key":"內埔農工","doc_count":201},{"key":"員林家商","doc_count":196},{"key":"斗六家商","doc_count":195},{"key":"北教大實小","doc_count":180},{"key":"成大南工","doc_count":177},{"key":"新港藝高","doc_count":177},{"key":"旗美高中","doc_count":174},{"key":"永靖高工","doc_count":173},{"key":"屏東高工","doc_count":166},{"key":"東港海事","doc_count":165},{"key":"政大附中","doc_count":155},{"key":"虎尾高中","doc_count":154},{"key":"新竹高工","doc_count":152},{"key":"苗栗農工","doc_count":149},{"key":"中大壢中","doc_count":145},{"key":"嘉義高商","doc_count":142},{"key":"新營高中","doc_count":140},{"key":"師大附中高中部","doc_count":137},{"key":"彰師附工","doc_count":128},{"key":"員林高中","doc_count":126},{"key":"新化高中","doc_count":125},{"key":"屏東女中","doc_count":124},{"key":"新營高工","doc_count":116},{"key":"北港高中","doc_count":108},{"key":"南投高中","doc_count":99},{"key":"基隆商工","doc_count":99},{"key":"高餐大附中","doc_count":98},{"key":"溪湖高中","doc_count":95},{"key":"屏科實中","doc_count":93},{"key":"南大附聰","doc_count":92},{"key":"鳳山高中","doc_count":92},{"key":"潮州高中","doc_count":91},{"key":"南大附中","doc_count":88},{"key":"北斗家商","doc_count":85},{"key":"彰化高商","doc_count":83},{"key":"二林工商","doc_count":78},{"key":"草屯商工","doc_count":76},{"key":"頭城家商","doc_count":75},{"key":"中興高中","doc_count":70},{"key":"苗栗高商","doc_count":65},{"key":"佳冬高農","doc_count":64},{"key":"嘉義高中","doc_count":64},{"key":"屏東高中","doc_count":64},{"key":"北港農工","doc_count":63},{"key":"水里商工","doc_count":63},{"key":"竹山高中","doc_count":62},{"key":"臺南一中","doc_count":60},{"key":"雲林特教","doc_count":58},{"key":"秀水高工","doc_count":56},{"key":"土庫商工","doc_count":54},{"key":"新竹特教","doc_count":53},{"key":"蘭陽女中","doc_count":53},{"key":"東石高中","doc_count":52},{"key":"羅東高工","doc_count":51},{"key":"宜蘭高中","doc_count":50},{"key":"興大附農","doc_count":50},{"key":"花蓮高中","doc_count":50},{"key":"崇實高工","doc_count":49},{"key":"員林農工","doc_count":48},{"key":"嘉科實中","doc_count":48},{"key":"暨大附中","doc_count":48},{"key":"臺南高商","doc_count":48},{"key":"新竹高商","doc_count":47},{"key":"花蓮高工","doc_count":46},{"key":"嘉義高工","doc_count":45},{"key":"師大附中國中部","doc_count":44},{"key":"屏東特教","doc_count":42},{"key":"華南高商","doc_count":42},{"key":"家齊高中","doc_count":41},{"key":"曾文農工","doc_count":40},{"key":"海大附中","doc_count":40},{"key":"白河商工","doc_count":40},{"key":"善化高中","doc_count":38},{"key":"新竹高中","doc_count":38},{"key":"花蓮特教","doc_count":38},{"key":"屏北高中","doc_count":37},{"key":"臺東高商","doc_count":37}]}}}
DEBUG 2025/12/17 17:23:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:23:00   Bucket[0]: Key=花蓮高農, DocCount=831
DEBUG 2025/12/17 17:23:00   Bucket[1]: Key=仁愛高農, DocCount=618
DEBUG 2025/12/17 17:23:00   Bucket[2]: Key=新竹女中, DocCount=596
DEBUG 2025/12/17 17:23:00   Bucket[3]: Key=竹北高中, DocCount=525
DEBUG 2025/12/17 17:23:00   Bucket[4]: Key=金門高中, DocCount=520
DEBUG 2025/12/17 17:23:00   Bucket[5]: Key=金門農工, DocCount=470
DEBUG 2025/12/17 17:23:00   Bucket[6]: Key=北門高中, DocCount=465
DEBUG 2025/12/17 17:23:00   Bucket[7]: Key=黑快馬主機, DocCount=448
DEBUG 2025/12/17 17:23:00   Bucket[8]: Key=臺東高中, DocCount=393
DEBUG 2025/12/17 17:23:00   Bucket[9]: Key=蘇澳海事, DocCount=341
DEBUG 2025/12/17 17:23:00   Bucket[10]: Key=興大附中, DocCount=338
DEBUG 2025/12/17 17:23:00   Bucket[11]: Key=花蓮高商, DocCount=316
DEBUG 2025/12/17 17:23:00   Bucket[12]: Key=宜蘭高商, DocCount=313
DEBUG 2025/12/17 17:23:00   Bucket[13]: Key=南投高商, DocCount=312
DEBUG 2025/12/17 17:23:00   Bucket[14]: Key=華僑高中, DocCount=292
DEBUG 2025/12/17 17:23:00   Bucket[15]: Key=清華附小, DocCount=266
DEBUG 2025/12/17 17:23:00   Bucket[16]: Key=關西高中, DocCount=239
DEBUG 2025/12/17 17:23:00   Bucket[17]: Key=新化高工, DocCount=221
DEBUG 2025/12/17 17:23:00   Bucket[18]: Key=玉里高中, DocCount=217
DEBUG 2025/12/17 17:23:00   Bucket[19]: Key=竹南高中, DocCount=210
DEBUG 2025/12/17 17:23:00   Bucket[20]: Key=南投特教, DocCount=207
DEBUG 2025/12/17 17:23:00   Bucket[21]: Key=後壁高中, DocCount=206
DEBUG 2025/12/17 17:23:00   Bucket[22]: Key=關山工商, DocCount=205
DEBUG 2025/12/17 17:23:00   Bucket[23]: Key=內埔農工, DocCount=201
DEBUG 2025/12/17 17:23:00   Bucket[24]: Key=員林家商, DocCount=196
DEBUG 2025/12/17 17:23:00   Bucket[25]: Key=斗六家商, DocCount=195
DEBUG 2025/12/17 17:23:00   Bucket[26]: Key=北教大實小, DocCount=180
DEBUG 2025/12/17 17:23:00   Bucket[27]: Key=成大南工, DocCount=177
DEBUG 2025/12/17 17:23:00   Bucket[28]: Key=新港藝高, DocCount=177
DEBUG 2025/12/17 17:23:00   Bucket[29]: Key=旗美高中, DocCount=174
DEBUG 2025/12/17 17:23:00   Bucket[30]: Key=永靖高工, DocCount=173
DEBUG 2025/12/17 17:23:00   Bucket[31]: Key=屏東高工, DocCount=166
DEBUG 2025/12/17 17:23:00   Bucket[32]: Key=東港海事, DocCount=165
DEBUG 2025/12/17 17:23:00   Bucket[33]: Key=政大附中, DocCount=155
DEBUG 2025/12/17 17:23:00   Bucket[34]: Key=虎尾高中, DocCount=154
DEBUG 2025/12/17 17:23:00   Bucket[35]: Key=新竹高工, DocCount=152
DEBUG 2025/12/17 17:23:00   Bucket[36]: Key=苗栗農工, DocCount=149
DEBUG 2025/12/17 17:23:00   Bucket[37]: Key=中大壢中, DocCount=145
DEBUG 2025/12/17 17:23:00   Bucket[38]: Key=嘉義高商, DocCount=142
DEBUG 2025/12/17 17:23:00   Bucket[39]: Key=新營高中, DocCount=140
DEBUG 2025/12/17 17:23:00   Bucket[40]: Key=師大附中高中部, DocCount=137
DEBUG 2025/12/17 17:23:00   Bucket[41]: Key=彰師附工, DocCount=128
DEBUG 2025/12/17 17:23:00   Bucket[42]: Key=員林高中, DocCount=126
DEBUG 2025/12/17 17:23:00   Bucket[43]: Key=新化高中, DocCount=125
DEBUG 2025/12/17 17:23:00   Bucket[44]: Key=屏東女中, DocCount=124
DEBUG 2025/12/17 17:23:00   Bucket[45]: Key=新營高工, DocCount=116
DEBUG 2025/12/17 17:23:00   Bucket[46]: Key=北港高中, DocCount=108
DEBUG 2025/12/17 17:23:00   Bucket[47]: Key=南投高中, DocCount=99
DEBUG 2025/12/17 17:23:00   Bucket[48]: Key=基隆商工, DocCount=99
DEBUG 2025/12/17 17:23:00   Bucket[49]: Key=高餐大附中, DocCount=98
DEBUG 2025/12/17 17:23:00   Bucket[50]: Key=溪湖高中, DocCount=95
DEBUG 2025/12/17 17:23:00   Bucket[51]: Key=屏科實中, DocCount=93
DEBUG 2025/12/17 17:23:00   Bucket[52]: Key=南大附聰, DocCount=92
DEBUG 2025/12/17 17:23:00   Bucket[53]: Key=鳳山高中, DocCount=92
DEBUG 2025/12/17 17:23:00   Bucket[54]: Key=潮州高中, DocCount=91
DEBUG 2025/12/17 17:23:00   Bucket[55]: Key=南大附中, DocCount=88
DEBUG 2025/12/17 17:23:00   Bucket[56]: Key=北斗家商, DocCount=85
DEBUG 2025/12/17 17:23:00   Bucket[57]: Key=彰化高商, DocCount=83
DEBUG 2025/12/17 17:23:00   Bucket[58]: Key=二林工商, DocCount=78
DEBUG 2025/12/17 17:23:00   Bucket[59]: Key=草屯商工, DocCount=76
DEBUG 2025/12/17 17:23:00   Bucket[60]: Key=頭城家商, DocCount=75
DEBUG 2025/12/17 17:23:00   Bucket[61]: Key=中興高中, DocCount=70
DEBUG 2025/12/17 17:23:00   Bucket[62]: Key=苗栗高商, DocCount=65
DEBUG 2025/12/17 17:23:00   Bucket[63]: Key=佳冬高農, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[64]: Key=嘉義高中, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[65]: Key=屏東高中, DocCount=64
DEBUG 2025/12/17 17:23:00   Bucket[66]: Key=北港農工, DocCount=63
DEBUG 2025/12/17 17:23:00   Bucket[67]: Key=水里商工, DocCount=63
DEBUG 2025/12/17 17:23:00   Bucket[68]: Key=竹山高中, DocCount=62
DEBUG 2025/12/17 17:23:00   Bucket[69]: Key=臺南一中, DocCount=60
DEBUG 2025/12/17 17:23:00   Bucket[70]: Key=雲林特教, DocCount=58
DEBUG 2025/12/17 17:23:00   Bucket[71]: Key=秀水高工, DocCount=56
DEBUG 2025/12/17 17:23:00   Bucket[72]: Key=土庫商工, DocCount=54
DEBUG 2025/12/17 17:23:00   Bucket[73]: Key=新竹特教, DocCount=53
DEBUG 2025/12/17 17:23:00   Bucket[74]: Key=蘭陽女中, DocCount=53
DEBUG 2025/12/17 17:23:00   Bucket[75]: Key=東石高中, DocCount=52
DEBUG 2025/12/17 17:23:00   Bucket[76]: Key=羅東高工, DocCount=51
DEBUG 2025/12/17 17:23:00   Bucket[77]: Key=宜蘭高中, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[78]: Key=興大附農, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[79]: Key=花蓮高中, DocCount=50
DEBUG 2025/12/17 17:23:00   Bucket[80]: Key=崇實高工, DocCount=49
DEBUG 2025/12/17 17:23:00   Bucket[81]: Key=員林農工, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[82]: Key=嘉科實中, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[83]: Key=暨大附中, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[84]: Key=臺南高商, DocCount=48
DEBUG 2025/12/17 17:23:00   Bucket[85]: Key=新竹高商, DocCount=47
DEBUG 2025/12/17 17:23:00   Bucket[86]: Key=花蓮高工, DocCount=46
DEBUG 2025/12/17 17:23:00   Bucket[87]: Key=嘉義高工, DocCount=45
DEBUG 2025/12/17 17:23:00   Bucket[88]: Key=師大附中國中部, DocCount=44
DEBUG 2025/12/17 17:23:00   Bucket[89]: Key=屏東特教, DocCount=42
DEBUG 2025/12/17 17:23:00   Bucket[90]: Key=華南高商, DocCount=42
DEBUG 2025/12/17 17:23:00   Bucket[91]: Key=家齊高中, DocCount=41
DEBUG 2025/12/17 17:23:00   Bucket[92]: Key=曾文農工, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[93]: Key=海大附中, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[94]: Key=白河商工, DocCount=40
DEBUG 2025/12/17 17:23:00   Bucket[95]: Key=善化高中, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[96]: Key=新竹高中, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[97]: Key=花蓮特教, DocCount=38
DEBUG 2025/12/17 17:23:00   Bucket[98]: Key=屏北高中, DocCount=37
DEBUG 2025/12/17 17:23:00   Bucket[99]: Key=臺東高商, DocCount=37
DEBUG 2025/12/17 17:23:00 ========================================================
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 50/59 history records to TimescaleDB
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:23:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 55/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 56/2 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 59/0 history records to TimescaleDB
INFO 2025/12/17 17:23:08 ✅ Successfully flushed 2/2 history records to TimescaleDB
INFO 2025/12/17 17:23:09 Processing 15 offline devices
INFO 2025/12/17 17:23:09 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:23:09 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:23:09 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:23:09 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:23:09 Creating history record for offline device: 羅東高商
INFO 2025/12/17 17:23:09 About to add history to batch for device: 羅東高商
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 羅東高商
INFO 2025/12/17 17:23:09 Creating history record for offline device: 新豐高中
INFO 2025/12/17 17:23:09 About to add history to batch for device: 新豐高中
INFO 2025/12/17 17:23:09 Successfully added history record for offline device: 新豐高中
INFO 2025/12/17 17:23:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:23:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:23:10 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:23:10 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:23:10 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:23:10 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:23:10 Creating history record for offline device: 澎湖海事
INFO 2025/12/17 17:23:10 About to add history to batch for device: 澎湖海事
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 澎湖海事
INFO 2025/12/17 17:23:10 Creating history record for offline device: 成功商水
INFO 2025/12/17 17:23:10 About to add history to batch for device: 成功商水
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 成功商水
INFO 2025/12/17 17:23:10 Creating history record for offline device: 南大附小
INFO 2025/12/17 17:23:10 About to add history to batch for device: 南大附小
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 南大附小
INFO 2025/12/17 17:23:10 Creating history record for offline device: 旗山農工
INFO 2025/12/17 17:23:10 About to add history to batch for device: 旗山農工
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 旗山農工
INFO 2025/12/17 17:23:10 Creating history record for offline device: 臺東女中
INFO 2025/12/17 17:23:10 About to add history to batch for device: 臺東女中
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 臺東女中
INFO 2025/12/17 17:23:10 Creating history record for offline device: 埔里高工
INFO 2025/12/17 17:23:10 About to add history to batch for device: 埔里高工
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 埔里高工
INFO 2025/12/17 17:23:10 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:23:10 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:23:10 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:23:10 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:23:10 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:23:13 ✅ Successfully flushed 43/43 history records to TimescaleDB
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: 213 (ID: 1)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: 93 (ID: 5)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: ncku (ID: 2)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: ncku
INFO 2025/12/17 17:23:45 Starting ES monitor check for: 93
INFO 2025/12/17 17:23:45 Starting ES monitor check for: 213
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: NTU (ID: 3)
DEBUG 2025/12/17 17:23:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:23:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:23:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: NTU
DEBUG 2025/12/17 17:23:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:23:45 Scheduled monitoring check for ES: bimap123 (ID: 4)
INFO 2025/12/17 17:23:45 Starting ES monitor check for: bimap123
DEBUG 2025/12/17 17:23:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:23:45 Monitor 4 (bimap123): using preloaded ESConnection 6 (bimap123)
DEBUG 2025/12/17 17:23:45 Monitor 2 (ncku): using preloaded ESConnection 4 (ncku)
DEBUG 2025/12/17 17:23:45 Monitor 5 (93): using preloaded ESConnection 7 (93)
DEBUG 2025/12/17 17:23:45 Monitor 1 (213): using preloaded ESConnection 3 (213)
DEBUG 2025/12/17 17:23:45 Monitor 3 (NTU): using preloaded ESConnection 5 (NTU)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 4: Unassigned shards detected: 4
INFO 2025/12/17 17:23:45 ES monitor check completed for: bimap123, status: warning
INFO 2025/12/17 17:23:45 ES monitor check completed for: 213, status: online
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Memory usage critical: 90.51% (threshold: 90.00%)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Disk usage high: 93.24% (threshold: 85.00%)
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Unassigned shards detected: 36
DEBUG 2025/12/17 17:23:45 Skipping duplicate alert for monitor 5: Cluster status is RED
INFO 2025/12/17 17:23:45 ES monitor check completed for: 93, status: error
WARN 2025/12/17 17:23:45 ES Alert Created [high][health]: Unassigned shards detected: 8
INFO 2025/12/17 17:23:45 ES monitor check completed for: ncku, status: online
INFO 2025/12/17 17:23:48 ✅ Successfully flushed 5/5 ES metrics to TimescaleDB
INFO 2025/12/17 17:23:48 Alert notification sent to 1 receivers for monitor: NTU
INFO 2025/12/17 17:23:48 ES monitor check completed for: NTU, status: warning
DEBUG 2025/12/17 17:24:00 Index 1 using ES connection 4
DEBUG 2025/12/17 17:24:00 ==================== ES Query Debug ====================
DEBUG 2025/12/17 17:24:00 Index: logstash-firewall-fortigate*
DEBUG 2025/12/17 17:24:00 Field: school_name.keyword
DEBUG 2025/12/17 17:24:00 Time From: 2025-12-17T17:23:00.000+08:00
DEBUG 2025/12/17 17:24:00 Time To: 2025-12-17T17:24:00.000+08:00
DEBUG 2025/12/17 17:24:00 Query Body:
{
		"aggs": {
		  "2": {
			"terms": {
			  "field": "school_name.keyword",
			  "order": {
				"_count": "desc"
			  },
			  "size": 100,
			  "shard_size": 25
			}
		  }
		},
		"size": 0,
		"fields": [
		  {
			"field": "@timestamp",
			"format": "date_time"
		  }
		],
		"script_fields": {},
		"stored_fields": [
		  "*"
		],
		"runtime_mappings": {},
		"_source": {
		  "excludes": []
		},
		"query": {
		  "bool": {
			"must": [],
			"filter": [
			  {
				"range": {
				  "@timestamp": {
					"format": "strict_date_optional_time",
					"gte": "2025-12-17T17:23:00.000+08:00",
					"lte": "2025-12-17T17:24:00.000+08:00"
				  }
				}
			  }
			],
			"should": [],
			"must_not": []
		  }
		}
	  }
DEBUG 2025/12/17 17:24:00 ES Response Status: 200 OK
DEBUG 2025/12/17 17:24:00 ES Response IsError: false
DEBUG 2025/12/17 17:24:00 ES Response Body:
{"took":69,"timed_out":false,"_shards":{"total":444,"successful":444,"skipped":90,"failed":0},"hits":{"total":{"value":10000,"relation":"gte"},"max_score":null,"hits":[]},"aggregations":{"2":{"doc_count_error_upper_bound":0,"sum_other_doc_count":449,"buckets":[{"key":"黑快馬主機","doc_count":1797},{"key":"花蓮高農","doc_count":889},{"key":"仁愛高農","doc_count":599},{"key":"新竹女中","doc_count":560},{"key":"金門農工","doc_count":490},{"key":"金門高中","doc_count":483},{"key":"北門高中","doc_count":447},{"key":"玉里高中","doc_count":439},{"key":"竹北高中","doc_count":385},{"key":"南投高商","doc_count":338},{"key":"臺東高中","doc_count":337},{"key":"宜蘭高商","doc_count":323},{"key":"蘇澳海事","doc_count":321},{"key":"華僑高中","doc_count":314},{"key":"興大附中","doc_count":278},{"key":"中大壢中","doc_count":262},{"key":"旗美高中","doc_count":259},{"key":"清華附小","doc_count":251},{"key":"新港藝高","doc_count":236},{"key":"南投特教","doc_count":217},{"key":"屏東女中","doc_count":210},{"key":"關西高中","doc_count":204},{"key":"竹南高中","doc_count":202},{"key":"關山工商","doc_count":191},{"key":"新竹高工","doc_count":181},{"key":"後壁高中","doc_count":180},{"key":"花蓮高商","doc_count":180},{"key":"員林家商","doc_count":177},{"key":"內埔農工","doc_count":175},{"key":"新營高中","doc_count":175},{"key":"斗六家商","doc_count":170},{"key":"嘉義高商","doc_count":162},{"key":"新化高工","doc_count":159},{"key":"虎尾高中","doc_count":149},{"key":"苗栗農工","doc_count":145},{"key":"新竹高中","doc_count":132},{"key":"成大南工","doc_count":126},{"key":"東港海事","doc_count":125},{"key":"東石高中","doc_count":115},{"key":"高餐大附中","doc_count":108},{"key":"新營高工","doc_count":103},{"key":"北教大實小","doc_count":102},{"key":"草屯商工","doc_count":101},{"key":"鳳山高中","doc_count":95},{"key":"新化高中","doc_count":94},{"key":"南投高中","doc_count":91},{"key":"北斗家商","doc_count":90},{"key":"屏科實中","doc_count":90},{"key":"師大附中高中部","doc_count":86},{"key":"土庫商工","doc_count":85},{"key":"佳冬高農","doc_count":84},{"key":"崇實高工","doc_count":81},{"key":"彰化高商","doc_count":81},{"key":"彰師附工","doc_count":81},{"key":"屏東高工","doc_count":78},{"key":"潮州高中","doc_count":78},{"key":"臺東高商","doc_count":77},{"key":"新竹高商","doc_count":76},{"key":"秀水高工","doc_count":74},{"key":"永靖高工","doc_count":72},{"key":"南大附聰","doc_count":71},{"key":"北港高中","doc_count":68},{"key":"嘉科實中","doc_count":67},{"key":"水里商工","doc_count":66},{"key":"澎湖海事","doc_count":62},{"key":"臺南高商","doc_count":62},{"key":"苗栗高商","doc_count":61},{"key":"屏北高中","doc_count":59},{"key":"新豐高中","doc_count":57},{"key":"羅東高工","doc_count":56},{"key":"頭城家商","doc_count":56},{"key":"臺南一中","doc_count":54},{"key":"家齊高中","doc_count":53},{"key":"員林農工","doc_count":52},{"key":"善化高中","doc_count":52},{"key":"白河商工","doc_count":50},{"key":"羅東高商","doc_count":49},{"key":"成功商水","doc_count":48},{"key":"華南高商","doc_count":48},{"key":"嘉義高中","doc_count":47},{"key":"基隆商工","doc_count":46},{"key":"旗山農工","doc_count":45},{"key":"南大附小","doc_count":43},{"key":"員林高中","doc_count":43},{"key":"屏東特教","doc_count":43},{"key":"曾文農工","doc_count":43},{"key":"雲林特教","doc_count":41},{"key":"中興高中","doc_count":40},{"key":"屏東高中","doc_count":40},{"key":"興大附農","doc_count":40},{"key":"二林工商","doc_count":39},{"key":"埔里高工","doc_count":39},{"key":"暨大附中","doc_count":38},{"key":"海大附中","doc_count":38},{"key":"南大附中","doc_count":37},{"key":"政大附中","doc_count":37},{"key":"嘉義高工","doc_count":36},{"key":"臺東女中","doc_count":36},{"key":"花蓮高工","doc_count":36},{"key":"宜蘭高中","doc_count":35}]}}}
DEBUG 2025/12/17 17:24:00 Aggregation Buckets Count: 100
DEBUG 2025/12/17 17:24:00   Bucket[0]: Key=黑快馬主機, DocCount=1797
DEBUG 2025/12/17 17:24:00   Bucket[1]: Key=花蓮高農, DocCount=889
DEBUG 2025/12/17 17:24:00   Bucket[2]: Key=仁愛高農, DocCount=599
DEBUG 2025/12/17 17:24:00   Bucket[3]: Key=新竹女中, DocCount=560
DEBUG 2025/12/17 17:24:00   Bucket[4]: Key=金門農工, DocCount=490
DEBUG 2025/12/17 17:24:00   Bucket[5]: Key=金門高中, DocCount=483
DEBUG 2025/12/17 17:24:00   Bucket[6]: Key=北門高中, DocCount=447
DEBUG 2025/12/17 17:24:00   Bucket[7]: Key=玉里高中, DocCount=439
DEBUG 2025/12/17 17:24:00   Bucket[8]: Key=竹北高中, DocCount=385
DEBUG 2025/12/17 17:24:00   Bucket[9]: Key=南投高商, DocCount=338
DEBUG 2025/12/17 17:24:00   Bucket[10]: Key=臺東高中, DocCount=337
DEBUG 2025/12/17 17:24:00   Bucket[11]: Key=宜蘭高商, DocCount=323
DEBUG 2025/12/17 17:24:00   Bucket[12]: Key=蘇澳海事, DocCount=321
DEBUG 2025/12/17 17:24:00   Bucket[13]: Key=華僑高中, DocCount=314
DEBUG 2025/12/17 17:24:00   Bucket[14]: Key=興大附中, DocCount=278
DEBUG 2025/12/17 17:24:00   Bucket[15]: Key=中大壢中, DocCount=262
DEBUG 2025/12/17 17:24:00   Bucket[16]: Key=旗美高中, DocCount=259
DEBUG 2025/12/17 17:24:00   Bucket[17]: Key=清華附小, DocCount=251
DEBUG 2025/12/17 17:24:00   Bucket[18]: Key=新港藝高, DocCount=236
DEBUG 2025/12/17 17:24:00   Bucket[19]: Key=南投特教, DocCount=217
DEBUG 2025/12/17 17:24:00   Bucket[20]: Key=屏東女中, DocCount=210
DEBUG 2025/12/17 17:24:00   Bucket[21]: Key=關西高中, DocCount=204
DEBUG 2025/12/17 17:24:00   Bucket[22]: Key=竹南高中, DocCount=202
DEBUG 2025/12/17 17:24:00   Bucket[23]: Key=關山工商, DocCount=191
DEBUG 2025/12/17 17:24:00   Bucket[24]: Key=新竹高工, DocCount=181
DEBUG 2025/12/17 17:24:00   Bucket[25]: Key=後壁高中, DocCount=180
DEBUG 2025/12/17 17:24:00   Bucket[26]: Key=花蓮高商, DocCount=180
DEBUG 2025/12/17 17:24:00   Bucket[27]: Key=員林家商, DocCount=177
DEBUG 2025/12/17 17:24:00   Bucket[28]: Key=內埔農工, DocCount=175
DEBUG 2025/12/17 17:24:00   Bucket[29]: Key=新營高中, DocCount=175
DEBUG 2025/12/17 17:24:00   Bucket[30]: Key=斗六家商, DocCount=170
DEBUG 2025/12/17 17:24:00   Bucket[31]: Key=嘉義高商, DocCount=162
DEBUG 2025/12/17 17:24:00   Bucket[32]: Key=新化高工, DocCount=159
DEBUG 2025/12/17 17:24:00   Bucket[33]: Key=虎尾高中, DocCount=149
DEBUG 2025/12/17 17:24:00   Bucket[34]: Key=苗栗農工, DocCount=145
DEBUG 2025/12/17 17:24:00   Bucket[35]: Key=新竹高中, DocCount=132
DEBUG 2025/12/17 17:24:00   Bucket[36]: Key=成大南工, DocCount=126
DEBUG 2025/12/17 17:24:00   Bucket[37]: Key=東港海事, DocCount=125
DEBUG 2025/12/17 17:24:00   Bucket[38]: Key=東石高中, DocCount=115
DEBUG 2025/12/17 17:24:00   Bucket[39]: Key=高餐大附中, DocCount=108
DEBUG 2025/12/17 17:24:00   Bucket[40]: Key=新營高工, DocCount=103
DEBUG 2025/12/17 17:24:00   Bucket[41]: Key=北教大實小, DocCount=102
DEBUG 2025/12/17 17:24:00   Bucket[42]: Key=草屯商工, DocCount=101
DEBUG 2025/12/17 17:24:00   Bucket[43]: Key=鳳山高中, DocCount=95
DEBUG 2025/12/17 17:24:00   Bucket[44]: Key=新化高中, DocCount=94
DEBUG 2025/12/17 17:24:00   Bucket[45]: Key=南投高中, DocCount=91
DEBUG 2025/12/17 17:24:00   Bucket[46]: Key=北斗家商, DocCount=90
DEBUG 2025/12/17 17:24:00   Bucket[47]: Key=屏科實中, DocCount=90
DEBUG 2025/12/17 17:24:00   Bucket[48]: Key=師大附中高中部, DocCount=86
DEBUG 2025/12/17 17:24:00   Bucket[49]: Key=土庫商工, DocCount=85
DEBUG 2025/12/17 17:24:00   Bucket[50]: Key=佳冬高農, DocCount=84
DEBUG 2025/12/17 17:24:00   Bucket[51]: Key=崇實高工, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[52]: Key=彰化高商, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[53]: Key=彰師附工, DocCount=81
DEBUG 2025/12/17 17:24:00   Bucket[54]: Key=屏東高工, DocCount=78
DEBUG 2025/12/17 17:24:00   Bucket[55]: Key=潮州高中, DocCount=78
DEBUG 2025/12/17 17:24:00   Bucket[56]: Key=臺東高商, DocCount=77
DEBUG 2025/12/17 17:24:00   Bucket[57]: Key=新竹高商, DocCount=76
DEBUG 2025/12/17 17:24:00   Bucket[58]: Key=秀水高工, DocCount=74
DEBUG 2025/12/17 17:24:00   Bucket[59]: Key=永靖高工, DocCount=72
DEBUG 2025/12/17 17:24:00   Bucket[60]: Key=南大附聰, DocCount=71
DEBUG 2025/12/17 17:24:00   Bucket[61]: Key=北港高中, DocCount=68
DEBUG 2025/12/17 17:24:00   Bucket[62]: Key=嘉科實中, DocCount=67
DEBUG 2025/12/17 17:24:00   Bucket[63]: Key=水里商工, DocCount=66
DEBUG 2025/12/17 17:24:00   Bucket[64]: Key=澎湖海事, DocCount=62
DEBUG 2025/12/17 17:24:00   Bucket[65]: Key=臺南高商, DocCount=62
DEBUG 2025/12/17 17:24:00   Bucket[66]: Key=苗栗高商, DocCount=61
DEBUG 2025/12/17 17:24:00   Bucket[67]: Key=屏北高中, DocCount=59
DEBUG 2025/12/17 17:24:00   Bucket[68]: Key=新豐高中, DocCount=57
DEBUG 2025/12/17 17:24:00   Bucket[69]: Key=羅東高工, DocCount=56
DEBUG 2025/12/17 17:24:00   Bucket[70]: Key=頭城家商, DocCount=56
DEBUG 2025/12/17 17:24:00   Bucket[71]: Key=臺南一中, DocCount=54
DEBUG 2025/12/17 17:24:00   Bucket[72]: Key=家齊高中, DocCount=53
DEBUG 2025/12/17 17:24:00   Bucket[73]: Key=員林農工, DocCount=52
DEBUG 2025/12/17 17:24:00   Bucket[74]: Key=善化高中, DocCount=52
DEBUG 2025/12/17 17:24:00   Bucket[75]: Key=白河商工, DocCount=50
DEBUG 2025/12/17 17:24:00   Bucket[76]: Key=羅東高商, DocCount=49
DEBUG 2025/12/17 17:24:00   Bucket[77]: Key=成功商水, DocCount=48
DEBUG 2025/12/17 17:24:00   Bucket[78]: Key=華南高商, DocCount=48
DEBUG 2025/12/17 17:24:00   Bucket[79]: Key=嘉義高中, DocCount=47
DEBUG 2025/12/17 17:24:00   Bucket[80]: Key=基隆商工, DocCount=46
DEBUG 2025/12/17 17:24:00   Bucket[81]: Key=旗山農工, DocCount=45
DEBUG 2025/12/17 17:24:00   Bucket[82]: Key=南大附小, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[83]: Key=員林高中, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[84]: Key=屏東特教, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[85]: Key=曾文農工, DocCount=43
DEBUG 2025/12/17 17:24:00   Bucket[86]: Key=雲林特教, DocCount=41
DEBUG 2025/12/17 17:24:00   Bucket[87]: Key=中興高中, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[88]: Key=屏東高中, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[89]: Key=興大附農, DocCount=40
DEBUG 2025/12/17 17:24:00   Bucket[90]: Key=二林工商, DocCount=39
DEBUG 2025/12/17 17:24:00   Bucket[91]: Key=埔里高工, DocCount=39
DEBUG 2025/12/17 17:24:00   Bucket[92]: Key=暨大附中, DocCount=38
DEBUG 2025/12/17 17:24:00   Bucket[93]: Key=海大附中, DocCount=38
DEBUG 2025/12/17 17:24:00   Bucket[94]: Key=南大附中, DocCount=37
DEBUG 2025/12/17 17:24:00   Bucket[95]: Key=政大附中, DocCount=37
DEBUG 2025/12/17 17:24:00   Bucket[96]: Key=嘉義高工, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[97]: Key=臺東女中, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[98]: Key=花蓮高工, DocCount=36
DEBUG 2025/12/17 17:24:00   Bucket[99]: Key=宜蘭高中, DocCount=35
DEBUG 2025/12/17 17:24:00 ========================================================
INFO 2025/12/17 17:24:03 ✅ Successfully flushed 9/9 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 50/58 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 51/2 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 52/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 53/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 54/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 55/0 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 56/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 57/1 history records to TimescaleDB
INFO 2025/12/17 17:24:07 ✅ Successfully flushed 58/1 history records to TimescaleDB
INFO 2025/12/17 17:24:08 ✅ Successfully flushed 16/16 history records to TimescaleDB
INFO 2025/12/17 17:24:08 Processing 15 offline devices
INFO 2025/12/17 17:24:08 Creating history record for offline device: 竹東高中
INFO 2025/12/17 17:24:08 About to add history to batch for device: 竹東高中
INFO 2025/12/17 17:24:08 Successfully added history record for offline device: 竹東高中
INFO 2025/12/17 17:24:08 Creating history record for offline device: 蘭陽女中
INFO 2025/12/17 17:24:08 About to add history to batch for device: 蘭陽女中
INFO 2025/12/17 17:24:08 Successfully added history record for offline device: 蘭陽女中
INFO 2025/12/17 17:24:08 Creating history record for offline device: 北科附工
INFO 2025/12/17 17:24:08 About to add history to batch for device: 北科附工
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 北科附工
INFO 2025/12/17 17:24:09 Creating history record for offline device: 嘉義家職
INFO 2025/12/17 17:24:09 About to add history to batch for device: 嘉義家職
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 嘉義家職
INFO 2025/12/17 17:24:09 Creating history record for offline device: 北港農工
INFO 2025/12/17 17:24:09 About to add history to batch for device: 北港農工
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 北港農工
INFO 2025/12/17 17:24:09 Creating history record for offline device: 嘉義特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 嘉義特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 嘉義特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 苗栗高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 苗栗高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 苗栗高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 玉井工商
INFO 2025/12/17 17:24:09 About to add history to batch for device: 玉井工商
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 玉井工商
INFO 2025/12/17 17:24:09 Creating history record for offline device: 花蓮高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 花蓮高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 花蓮高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 新竹特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 新竹特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 新竹特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 竹山高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 竹山高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 竹山高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 基隆特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 基隆特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 基隆特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 溪湖高中
INFO 2025/12/17 17:24:09 About to add history to batch for device: 溪湖高中
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 溪湖高中
INFO 2025/12/17 17:24:09 Creating history record for offline device: 花蓮特教
INFO 2025/12/17 17:24:09 About to add history to batch for device: 花蓮特教
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 花蓮特教
INFO 2025/12/17 17:24:09 Creating history record for offline device: 師大附中國中部
INFO 2025/12/17 17:24:09 About to add history to batch for device: 師大附中國中部
INFO 2025/12/17 17:24:09 Successfully added history record for offline device: 師大附中國中部
INFO 2025/12/17 17:24:13 ✅ Successfully flushed 23/23 history records to TimescaleDB
