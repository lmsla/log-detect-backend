# Elasticsearch ç›£æ§ API - adjust.md ä¿®æ­£å®Œæˆå ±å‘Š

## âœ… å·²å®Œæˆä¿®æ­£

### 1. **æ˜ç¢ºæ¨™è¨»å–®ä½å’Œæ ¼å¼** - å·²å®Œæˆ

#### ä¿®æ”¹æª”æ¡ˆ
- `docs/openapi.yml` âœ…
- `entities/elasticsearch.go` âœ…
- `docs/elasticsearch-frontend-api.md` âœ…

#### ä¿®æ­£å…§å®¹

**openapi.yml æ›´æ–°**:
```yaml
response_time:
  type: integer
  format: int64
  description: "éŸ¿æ‡‰æ™‚é–“ï¼ˆå–®ä½ï¼šæ¯«ç§’ï¼‰"  # âœ… å·²æ¨™è¨»

cpu_usage:
  type: number
  format: float
  description: "CPU ä½¿ç”¨ç‡ï¼ˆå–®ä½ï¼šç™¾åˆ†æ¯” 0-100ï¼‰"  # âœ… å·²æ¨™è¨»

interval:
  type: integer
  description: "æª¢æŸ¥é–“éš”ï¼ˆå–®ä½ï¼šç§’ï¼Œç¯„åœï¼š10-3600ï¼‰"  # âœ… å·²æ¨™è¨»
  minimum: 10
  maximum: 3600
```

**entities/elasticsearch.go æ›´æ–°**:
```go
type ESMonitorStatus struct {
    ResponseTime     int64     `json:"response_time"` // éŸ¿æ‡‰æ™‚é–“ï¼ˆå–®ä½ï¼šæ¯«ç§’ï¼‰âœ…
    CPUUsage         float64   `json:"cpu_usage"` // CPU ä½¿ç”¨ç‡ï¼ˆå–®ä½ï¼šç™¾åˆ†æ¯” 0-100ï¼‰âœ…
    MemoryUsage      float64   `json:"memory_usage"` // è¨˜æ†¶é«”ä½¿ç”¨ç‡ï¼ˆå–®ä½ï¼šç™¾åˆ†æ¯” 0-100ï¼‰âœ…
    DiskUsage        float64   `json:"disk_usage"` // ç£ç¢Ÿä½¿ç”¨ç‡ï¼ˆå–®ä½ï¼šç™¾åˆ†æ¯” 0-100ï¼‰âœ…
    LastCheckTime    time.Time `json:"last_check_time"` // ISO 8601 æ ¼å¼ âœ…
}
```

**å‰ç«¯æ–‡æª”æ›´æ–°**:
- âœ… åœ¨æ–‡æª”é ‚éƒ¨æ·»åŠ ã€Œé‡è¦èªªæ˜ã€ç« ç¯€
- âœ… æ·»åŠ è³‡æ–™é¡å‹å’Œå–®ä½å°ç…§è¡¨
- âœ… æ·»åŠ  receivers æ¬„ä½è™•ç†ç¯„ä¾‹
- âœ… æ·»åŠ æ™‚é–“æ¬„ä½è™•ç†ç¯„ä¾‹
- âœ… æ·»åŠ ç™¾åˆ†æ¯”æ¬„ä½é¡¯ç¤ºç¯„ä¾‹

### 2. **æ˜ç¢ºèªªæ˜ receivers æ ¼å¼** - å·²å®Œæˆ

#### ä¿®æ”¹å…§å®¹

**openapi.yml**:
```yaml
receivers:
  type: string
  description: "å‘Šè­¦æ¥æ”¶è€…ï¼ˆJSON é™£åˆ—å­—ä¸²ï¼Œæ ¼å¼ï¼š'[\"email1@example.com\",\"email2@example.com\"]'ï¼‰"
  example: '["admin@example.com","ops@example.com"]'
```

**entities/elasticsearch.go**:
```go
Receivers string `json:"receivers" gorm:"type:text;comment:å‘Šè­¦æ”¶ä»¶äºº(JSONé™£åˆ—å­—ä¸²,æ ¼å¼:[\"email@example.com\"])"`
```

**å‰ç«¯æ–‡æª”**:
```javascript
// ç™¼é€æ™‚åºåˆ—åŒ–
const body = {
  receivers: JSON.stringify(["admin@example.com"])
};

// æ¥æ”¶æ™‚ååºåˆ—åŒ–
const receivers = JSON.parse(monitor.receivers || '[]');
```

### 3. **çµ±ä¸€ interval å‘½åå’Œèªªæ˜** - å·²å®Œæˆ

#### æ±ºç­–
ä¿æŒä½¿ç”¨ `interval` åç¨±ï¼ˆèˆ‡å¯¦é«”å’Œ API ä¸€è‡´ï¼‰ï¼Œåœ¨æ–‡æª”ä¸­æ˜ç¢ºæ¨™è¨»å–®ä½ç‚ºã€Œç§’ã€ã€‚

#### ä¿®æ”¹å…§å®¹
- âœ… openapi.yml: æ·»åŠ å–®ä½èªªæ˜å’Œç¯„åœé™åˆ¶ï¼ˆ10-3600 ç§’ï¼‰
- âœ… entities/elasticsearch.go: æ›´æ–°è¨»é‡‹èªªæ˜ç¯„åœ
- âœ… å‰ç«¯æ–‡æª”: æ˜ç¢ºæ¨™è¨»å–®ä½

### 4. **é‡æ–°ç”Ÿæˆ Swagger æ–‡æª”** - å·²å®Œæˆ

```bash
swag init
```

ç”Ÿæˆæª”æ¡ˆ:
- âœ… `docs/docs.go`
- âœ… `docs/swagger.json`
- âœ… `docs/swagger.yaml`

---

## ğŸ“‹ adjust.md å•é¡Œå›æ‡‰

### âœ… å·²è§£æ±ºçš„å•é¡Œ

| å•é¡Œ | ç‹€æ…‹ | è§£æ±ºæ–¹æ¡ˆ |
|------|------|----------|
| æ¸¬è©¦ç«¯é»è·¯å¾‘ä¸ä¸€è‡´ | âœ… å·²ä¿®æ­£ | å·²åœ¨ä¹‹å‰çµ±ä¸€ç‚º `/monitors/test`ï¼ˆç„¡éœ€ idï¼‰ |
| receivers é¡å‹èªªæ˜ä¸æ¸… | âœ… å·²ä¿®æ­£ | åœ¨æ‰€æœ‰æ–‡æª”ä¸­æ˜ç¢ºèªªæ˜ç‚º JSON å­—ä¸²æ ¼å¼ |
| interval å‘½åä¸ä¸€è‡´ | âœ… å·²çµ±ä¸€ | ä¿æŒ intervalï¼Œæ˜ç¢ºæ¨™è¨»å–®ä½ |
| å–®ä½å’Œæ ¼å¼ä¸æ˜ç¢º | âœ… å·²ä¿®æ­£ | æ‰€æœ‰æ¬„ä½éƒ½å·²æ¨™è¨»å–®ä½ |
| æ™‚é–“æ ¼å¼ä¸çµ±ä¸€ | âœ… å·²ä¿®æ­£ | çµ±ä¸€ä½¿ç”¨ ISO 8601 æ ¼å¼ |

### â³ Phase 2 åŠŸèƒ½ï¼ˆæš«ä¸è™•ç†ï¼‰

| å•é¡Œ | ç‹€æ…‹ | è¨ˆç•« |
|------|------|------|
| ç¼ºå°‘ per-monitor ç«¯é» | Phase 2 | `/status/{id}`, `/status/{id}/history`, `/status/{id}/trends` |
| ç¼ºå°‘ Alerts ç«¯é» | Phase 2 | `/alerts`, `/alerts/{id}`, `/alerts/{id}/resolve` |
| ç¼ºå°‘æŸ¥è©¢åƒæ•¸ï¼ˆåˆ†é /éæ¿¾ï¼‰ | Phase 2 | æ·»åŠ  page, page_size, status ç­‰åƒæ•¸ |

### ğŸ’¡ è¨­è¨ˆå»ºè­°ï¼ˆæœªä¾†å„ªåŒ–ï¼‰

| å»ºè­° | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| æ¬Šé™æ¨™è¨»ï¼ˆx-permissionsï¼‰ | å¯é¸ | å¯åœ¨æœªä¾†æ·»åŠ åˆ° OpenAPI |
| çµ±ä¸€éŸ¿æ‡‰æ ¼å¼ | ç¶­æŒç¾ç‹€ | æ”¹å‹•æˆæœ¬é«˜ï¼Œåœ¨æ–‡æª”ä¸­èªªæ˜å³å¯ |

---

## ğŸ¯ å‰ç«¯é–‹ç™¼å¯ä»¥é–‹å§‹çš„å·¥ä½œ

### âœ… ç«‹å³å¯ç”¨ï¼ˆ100% å°±ç·’ï¼‰

1. **ç›£æ§é…ç½®ç®¡ç†é é¢**
   - æ‰€æœ‰ CRUD API å·²å°±ç·’
   - æ–‡æª”å®Œæ•´ï¼ŒåŒ…å«ç¤ºä¾‹ä»£ç¢¼
   - å–®ä½å’Œæ ¼å¼å·²æ˜ç¢ºæ¨™è¨»
   - è¡¨å–®é©—è­‰è¦å‰‡å·²æä¾›

2. **ç›£æ§ç‹€æ…‹ç¸½è¦½é é¢**
   - GET /status API å·²å°±ç·’
   - GET /statistics API å·²å°±ç·’
   - è³‡æ–™çµæ§‹æ¸…æ™°
   - é¡¯ç¤ºç¯„ä¾‹å·²æä¾›

### ğŸ“ å‰ç«¯é–‹ç™¼æª¢æŸ¥æ¸…å–®

- [ ] é–±è®€ `docs/elasticsearch-frontend-api.md` çš„ã€Œé‡è¦èªªæ˜ã€ç« ç¯€
- [ ] å¯¦ä½œ receivers æ¬„ä½çš„åºåˆ—åŒ–/ååºåˆ—åŒ–é‚è¼¯
- [ ] å¯¦ä½œæ™‚é–“æ¬„ä½çš„æ ¼å¼åŒ–é¡¯ç¤º
- [ ] å¯¦ä½œç™¾åˆ†æ¯”æ¬„ä½çš„é€²åº¦æ¢é¡¯ç¤º
- [ ] é…ç½® interval æ¬„ä½çš„ç¯„åœé©—è­‰ï¼ˆ10-3600 ç§’ï¼‰
- [ ] æ¸¬è©¦æ‰€æœ‰ API ç«¯é»

### ğŸ“š æ–‡æª”è³‡æº

| æ–‡æª” | ç”¨é€” | å®Œæ•´åº¦ |
|------|------|--------|
| `elasticsearch-frontend-api.md` | å‰ç«¯å°æ¥ä¸»è¦æ–‡æª” | âœ… 100% |
| `openapi.yml` | API è¦ç¯„ï¼ˆå¯ç”Ÿæˆ TS é¡å‹ï¼‰ | âœ… 100% |
| `swagger UI` (http://localhost:8006/swagger) | äº’å‹•æ¸¬è©¦ | âœ… 100% |
| `adjust-analysis.md` | å•é¡Œåˆ†æå ±å‘Š | âœ… 100% |
| `elasticsearch-api-status.md` | API å¯¦ä½œç‹€æ…‹ | âœ… 100% |

---

## ğŸ”„ è®Šæ›´æ‘˜è¦

### æª”æ¡ˆä¿®æ”¹æ¸…å–®

| æª”æ¡ˆ | è®Šæ›´é¡å‹ | èªªæ˜ |
|------|----------|------|
| `docs/openapi.yml` | æ›´æ–° | æ·»åŠ å–®ä½å’Œæ ¼å¼èªªæ˜ |
| `entities/elasticsearch.go` | æ›´æ–° | æ·»åŠ æ¬„ä½è¨»é‡‹ |
| `docs/elasticsearch-frontend-api.md` | æ›´æ–° | æ·»åŠ é‡è¦èªªæ˜ç« ç¯€ |
| `docs/docs.go` | é‡æ–°ç”Ÿæˆ | Swagger è‡ªå‹•ç”Ÿæˆ |
| `docs/swagger.json` | é‡æ–°ç”Ÿæˆ | Swagger è‡ªå‹•ç”Ÿæˆ |
| `docs/swagger.yaml` | é‡æ–°ç”Ÿæˆ | Swagger è‡ªå‹•ç”Ÿæˆ |
| `docs/adjust-analysis.md` | æ–°å¢ | å•é¡Œåˆ†ææ–‡æª” |
| `docs/adjust-completed.md` | æ–°å¢ | ä¿®æ­£å®Œæˆå ±å‘Š |

### Git Commit å»ºè­°

```bash
git add docs/openapi.yml
git add entities/elasticsearch.go
git add docs/elasticsearch-frontend-api.md
git add docs/docs.go docs/swagger.*
git add docs/adjust-*.md

git commit -m "docs(elasticsearch): æ˜ç¢ºæ¨™è¨» API æ¬„ä½å–®ä½å’Œæ ¼å¼

- åœ¨ openapi.yml ä¸­æ·»åŠ æ‰€æœ‰æ¬„ä½çš„å–®ä½èªªæ˜
- æ›´æ–° entities/elasticsearch.go çš„æ¬„ä½è¨»é‡‹
- åœ¨å‰ç«¯ API æ–‡æª”ä¸­æ·»åŠ ã€Œé‡è¦èªªæ˜ã€ç« ç¯€
- æä¾› receivers æ¬„ä½è™•ç†ç¯„ä¾‹ä»£ç¢¼
- æä¾›æ™‚é–“å’Œç™¾åˆ†æ¯”æ¬„ä½é¡¯ç¤ºç¯„ä¾‹
- é‡æ–°ç”Ÿæˆ Swagger æ–‡æª”

è§£æ±º adjust.md ä¸­æå‡ºçš„å•é¡Œï¼š
- âœ… æ˜ç¢ºæ¨™è¨» response_timeï¼ˆæ¯«ç§’ï¼‰
- âœ… æ˜ç¢ºæ¨™è¨» *_usageï¼ˆç™¾åˆ†æ¯” 0-100ï¼‰
- âœ… æ˜ç¢ºæ¨™è¨» intervalï¼ˆç§’ï¼Œç¯„åœ 10-3600ï¼‰
- âœ… æ˜ç¢ºèªªæ˜ receivers æ ¼å¼ï¼ˆJSON å­—ä¸²ï¼‰
- âœ… çµ±ä¸€æ™‚é–“æ ¼å¼ï¼ˆISO 8601ï¼‰
- âœ… æ·»åŠ æ¬„ä½ç¯„åœé©—è­‰ï¼ˆminimum/maximumï¼‰

å‰ç«¯ç¾åœ¨å¯ä»¥é–‹å§‹å¯¦ä½œï¼Œæ‰€æœ‰å¿…è¦è³‡è¨Šå·²å®Œæ•´æä¾›ã€‚
"
```

---

## âœ… çµè«–

**adjust.md æå‡ºçš„æ‰€æœ‰é«˜å„ªå…ˆç´šå•é¡Œå·²å…¨éƒ¨è§£æ±ºï¼**

### ä¿®æ­£æˆæœ
- âœ… æ‰€æœ‰æ¬„ä½å–®ä½å·²æ˜ç¢ºæ¨™è¨»
- âœ… receivers æ ¼å¼å·²æ¸…æ¥šèªªæ˜ä¸¦æä¾›ç¯„ä¾‹
- âœ… interval å‘½åå·²çµ±ä¸€ä¸¦æ¨™è¨»ç¯„åœ
- âœ… æ™‚é–“æ ¼å¼å·²çµ±ä¸€ç‚º ISO 8601
- âœ… å‰ç«¯æ–‡æª”å·²æ·»åŠ å®Œæ•´çš„è™•ç†ç¯„ä¾‹
- âœ… Swagger æ–‡æª”å·²é‡æ–°ç”Ÿæˆ

### å‰ç«¯é–‹ç™¼ç¾æ³
**å¯ä»¥ç«‹å³é–‹å§‹å¯¦ä½œå‰ç«¯é é¢ï¼** æ‰€æœ‰å¿…è¦çš„è³‡è¨Šã€ç¤ºä¾‹å’Œé©—è­‰è¦å‰‡éƒ½å·²æº–å‚™å°±ç·’ã€‚

---

**å®Œæˆæ—¥æœŸ**: 2025-10-06
**ç‰ˆæœ¬**: 1.0
**è² è²¬äºº**: Log Detect é–‹ç™¼åœ˜éšŠ
